{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 444,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": false,
  "key": "bu6cekkvbo",
  "leftColumn": 0,
  "mobileBottomRow": 291,
  "mobileLeftColumn": 1,
  "mobileRightColumn": 25,
  "mobileTopRow": 259,
  "needsErrorInfo": false,
  "originalBottomRow": 444,
  "originalTopRow": 289,
  "parentColumnSpace": 35.078125,
  "parentId": "0",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "https://www.example.com",
  "srcDoc": "<style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    body {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;\n        background: #f5f7fa;\n        padding: 12px;\n        font-size: 11px;\n    }\n    \n    .painel-container {\n        max-width: 1600px;\n        margin: 0 auto;\n    }\n    \n    .painel-header {\n        background: white;\n        border-radius: 16px;\n        padding: 24px;\n        margin-bottom: 24px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    \n    .painel-title {\n        font-size: 32px;\n        font-weight: 900;\n        color: #1890ff;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n    }\n    \n    .live-indicator {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        color: #10b981;\n    }\n    \n    .live-dot {\n        width: 12px;\n        height: 12px;\n        background: #10b981;\n        border-radius: 50%;\n        animation: pulse 2s infinite;\n    }\n    \n    @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n    }\n    \n    .stats-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 16px;\n        margin-bottom: 24px;\n    }\n    \n    .stat-card {\n        background: white;\n        border-radius: 12px;\n        padding: 20px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        text-align: center;\n        transition: transform 0.2s;\n    }\n    \n    .stat-card:hover {\n        transform: translateY(-4px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.15);\n    }\n    \n    .stat-card.stat-sucesso {\n        background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);\n        border: 2px solid #10b981;\n    }\n    \n    .stat-card.stat-erro {\n        background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%);\n        border: 2px solid #ef4444;\n    }\n    \n    .stat-card.stat-alerta {\n        background: linear-gradient(135deg, #fed7aa 0%, #ffedd5 100%);\n        border: 2px solid #f59e0b;\n    }\n    \n    .stat-value {\n        font-size: 36px;\n        font-weight: 900;\n        color: #1890ff;\n        line-height: 1;\n        margin-bottom: 8px;\n    }\n    \n    .stat-label {\n        font-size: 12px;\n        font-weight: 600;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .rotas-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));\n        gap: 20px;\n    }\n    \n    .rota-card {\n        background: white;\n        border-radius: 16px;\n        padding: 20px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        transition: all 0.3s;\n        border-left: 6px solid #1890ff;\n        position: relative;\n        overflow: hidden;\n    }\n    \n    .rota-card.pendente {\n        border-left-color: #fbbf24;\n        background: linear-gradient(135deg, #fffbeb 0%, white 100%);\n    }\n    \n    .rota-card.em-rota {\n        border-left-color: #10b981;\n        background: linear-gradient(135deg, #ecfdf5 0%, white 100%);\n    }\n    \n    .rota-card.atrasada {\n        border-left-color: #ef4444;\n        background: linear-gradient(135deg, #fef2f2 0%, white 100%);\n        animation: shake 0.5s infinite;\n    }\n    \n    @keyframes shake {\n        0%, 100% { transform: translateX(0); }\n        25% { transform: translateX(-5px); }\n        75% { transform: translateX(5px); }\n    }\n    \n    .rota-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 16px;\n        padding-bottom: 12px;\n        border-bottom: 2px solid #f3f4f6;\n    }\n    \n    .rota-id {\n        font-size: 20px;\n        font-weight: 900;\n        color: #1f2937;\n    }\n    \n    .rota-status {\n        padding: 6px 12px;\n        border-radius: 999px;\n        font-size: 11px;\n        font-weight: 800;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .rota-status.pendente {\n        background: #fef3c7;\n        color: #92400e;\n    }\n    \n    .rota-status.em-rota {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .rota-status.atrasada {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    .cronometro {\n        text-align: center;\n        padding: 20px;\n        background: #1890ff;\n        border-radius: 12px;\n        margin-bottom: 16px;\n    }\n    \n    .cronometro-tempo {\n        font-size: 48px;\n        font-weight: 900;\n        color: white;\n        font-family: 'Courier New', monospace;\n        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n    }\n    \n    .cronometro-label {\n        font-size: 11px;\n        color: rgba(255,255,255,0.8);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        margin-top: 4px;\n    }\n    \n    .rota-info {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n        margin-bottom: 16px;\n    }\n    \n    .info-item {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .info-label {\n        font-size: 10px;\n        font-weight: 700;\n        color: #9ca3af;\n        text-transform: uppercase;\n    }\n    \n    .info-value {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1f2937;\n    }\n    \n    .pedidos-list {\n        margin-top: 12px;\n        padding-top: 12px;\n        border-top: 2px solid #f3f4f6;\n    }\n    \n    .pedidos-header {\n        font-size: 11px;\n        font-weight: 700;\n        color: #6b7280;\n        text-transform: uppercase;\n        margin-bottom: 8px;\n    }\n    \n    .pedido-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 8px;\n        background: #f9fafb;\n        border-radius: 6px;\n        margin-bottom: 6px;\n        font-size: 12px;\n    }\n    \n    .pedido-numero {\n        font-weight: 700;\n        color: #667eea;\n    }\n    \n    .pedido-status {\n        font-size: 10px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-weight: 700;\n    }\n    \n    .pedido-status.ok {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .pedido-status.fora-ordem {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    .alerta-pedidos {\n        background: #fef3c7;\n        border: 2px solid #f59e0b;\n        border-radius: 8px;\n        padding: 12px;\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: #92400e;\n        font-weight: 600;\n    }\n    \n    .sem-rotas {\n        text-align: center;\n        padding: 60px;\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n    }\n    \n    .sem-rotas-icon {\n        font-size: 80px;\n        margin-bottom: 20px;\n    }\n    \n    .sem-rotas-text {\n        font-size: 24px;\n        font-weight: 700;\n        color: #6b7280;\n    }\n    \n    .controles {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n    }\n    \n    .btn-controle {\n        padding: 10px 20px;\n        border: none;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .btn-atualizar {\n        background: #1890ff;\n        color: white;\n    }\n\n    .btn-atualizar:hover {\n        background: #1066cc;\n        transform: translateY(-2px);\n    }\n    \n    .btn-som {\n        background: #10b981;\n        color: white;\n    }\n    \n    .btn-som:hover {\n        background: #059669;\n    }\n    \n    .btn-som.muted {\n        background: #ef4444;\n    }\n    \n    .btn-log {\n        background: #6b7280;\n        color: white;\n        padding: 8px 16px;\n        border: none;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .btn-log:hover {\n        background: #4b5563;\n        transform: translateY(-2px);\n    }\n    \n    /* Modal */\n    .modal {\n        display: none;\n        position: fixed;\n        z-index: 1000;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0,0,0,0.5);\n    }\n    \n    .modal-content {\n        background-color: #1f2937;\n        color: #f9fafb;\n        margin: 5% auto;\n        padding: 20px;\n        border-radius: 8px;\n        width: 90%;\n        max-width: 800px;\n        max-height: 80%;\n        overflow-y: auto;\n        font-family: 'Courier New', monospace;\n        font-size: 12px;\n        line-height: 1.4;\n    }\n    \n    .modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n        border-bottom: 1px solid #374151;\n        padding-bottom: 10px;\n    }\n    \n    .modal-title {\n        color: #10b981;\n        font-size: 18px;\n        font-weight: 700;\n    }\n    \n    .close {\n        color: #9ca3af;\n        font-size: 24px;\n        font-weight: bold;\n        cursor: pointer;\n        background: none;\n        border: none;\n    }\n    \n    .close:hover {\n        color: #f87171;\n    }\n    \n    .log-entry {\n        margin-bottom: 5px;\n        padding: 5px;\n        border-left: 3px solid #374151;\n        padding-left: 10px;\n    }\n    \n    .log-entry.info {\n        border-left-color: #3b82f6;\n        color: #93c5fd;\n    }\n    \n    .log-entry.success {\n        border-left-color: #10b981;\n        color: #6ee7b7;\n    }\n    \n    .log-entry.warning {\n        border-left-color: #f59e0b;\n        color: #fbbf24;\n    }\n    \n    .log-entry.error {\n        border-left-color: #ef4444;\n        color: #fca5a5;\n    }\n    \n    /* Filters */\n    .filters-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n        gap: 10px;\n        margin-bottom: 16px;\n        padding: 16px;\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        border-bottom: 2px solid #e5e7eb;\n    }\n    \n    .filter-group {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .filter-label {\n        font-size: 9px;\n        font-weight: 700;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .filter-select {\n        padding: 6px 10px;\n        background: #f9fafb;\n        border: 1px solid #e5e7eb;\n        border-radius: 6px;\n        font-size: 11px;\n        color: #111827;\n        font-weight: 600;\n    }\n    \n    /* View modes */\n    .view-controls {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n        margin-bottom: 16px;\n    }\n    \n    .btn-modo {\n        padding: 8px 16px;\n        border: 2px solid #1890ff;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        background: white;\n        color: #1890ff;\n    }\n    \n    .btn-modo.ativo {\n        background: #1890ff;\n        color: white;\n    }\n    \n    .btn-modo:hover {\n        background: #e6f3ff;\n    }\n    \n    .btn-modo.ativo:hover {\n        background: #1066cc;\n    }\n    \n    /* Lista mode */\n    .rotas-lista {\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        overflow: hidden;\n    }\n    \n    .lista-header {\n        background: #1890ff;\n        color: white;\n        padding: 12px 16px;\n        font-size: 12px;\n        font-weight: 700;\n        display: grid;\n        grid-template-columns: 100px 150px 140px 80px 80px 80px 120px 100px;\n        gap: 8px;\n        border-bottom: 2px solid #1066cc;\n    }\n    \n    .lista-item {\n        display: grid;\n        grid-template-columns: 100px 150px 140px 80px 80px 80px 120px 100px;\n        gap: 8px;\n        padding: 12px 16px;\n        border-bottom: 1px solid #f3f4f6;\n        align-items: center;\n        font-size: 11px;\n        transition: background 0.2s;\n    }\n    \n    .lista-item:hover {\n        background: #f9fafb;\n    }\n    \n    .lista-item.pendente {\n        border-left: 4px solid #fbbf24;\n    }\n    \n    .lista-item.em-rota {\n        border-left: 4px solid #10b981;\n    }\n    \n    .lista-item.atrasada {\n        border-left: 4px solid #ef4444;\n        background: #fef2f2;\n    }\n    \n    .lista-cronometro {\n        font-family: 'Courier New', monospace;\n        font-weight: 700;\n        font-size: 14px;\n    }\n    \n    .lista-status {\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 9px;\n        font-weight: 700;\n        text-align: center;\n    }\n    \n    .lista-status.pendente {\n        background: #fef3c7;\n        color: #92400e;\n    }\n    \n    .lista-status.em-rota {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .lista-status.atrasada {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    /* Bot√£o Ver Rota */\n    .btn-ver-rota {\n        display: inline-block;\n        padding: 6px 12px;\n        background: #10b981;\n        color: white !important;\n        text-decoration: none !important;\n        border-radius: 6px;\n        font-size: 11px;\n        font-weight: 600;\n        transition: all 0.2s;\n        border: none;\n        cursor: pointer;\n    }\n    \n    .btn-ver-rota:hover {\n        background: #059669 !important;\n        color: white !important;\n        text-decoration: none !important;\n        transform: translateY(-2px);\n        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n    }\n    \n    .btn-ver-rota:visited {\n        color: white !important;\n        text-decoration: none !important;\n    }\n    \n    .filial-badge {\n        background: #1890ff;\n        color: white;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 10px;\n        font-weight: 700;\n        margin-right: 8px;\n    }\n    \n    /* Estat√≠sticas por Filial */\n    .stats-filial {\n        background: white;\n        border-radius: 8px;\n        padding: 16px;\n        margin-bottom: 16px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n    \n    .stats-filial-title {\n        font-size: 16px;\n        font-weight: 700;\n        color: #1890ff;\n        margin-bottom: 12px;\n        border-bottom: 2px solid #1890ff;\n        padding-bottom: 8px;\n    }\n    \n    .filial-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n    }\n    \n    @media (max-width: 768px) {\n        .filial-row {\n            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n            gap: 8px;\n        }\n        \n        .filial-item {\n            padding: 8px;\n        }\n        \n        .filial-nome {\n            font-size: 16px;\n        }\n        \n        .filial-stat-valor {\n            font-size: 18px;\n        }\n    }\n    \n    .filial-item {\n        border: 1px solid #e5e7eb;\n        border-radius: 6px;\n        padding: 12px;\n        transition: transform 0.2s;\n    }\n    \n    .filial-item:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(24, 144, 255, 0.2);\n        border-color: #1890ff;\n    }\n    \n    .filial-nome {\n        font-size: 18px;\n        font-weight: 900;\n        color: #1890ff;\n        margin-bottom: 8px;\n        text-align: center;\n    }\n    \n    .filial-stats {\n        display: flex;\n        justify-content: space-around;\n        gap: 8px;\n    }\n    \n    .filial-stat {\n        text-align: center;\n        flex: 1;\n    }\n    \n    .filial-stat-valor {\n        font-size: 20px;\n        font-weight: 800;\n        margin-bottom: 4px;\n    }\n    \n    .filial-stat-label {\n        font-size: 10px;\n        font-weight: 600;\n        text-transform: uppercase;\n    }\n    \n    .filial-stat.ativo .filial-stat-valor {\n        color: #10b981;\n    }\n    \n    .filial-stat.pendente .filial-stat-valor {\n        color: #f59e0b;\n    }\n    \n    .filial-stat.atrasada .filial-stat-valor {\n        color: #ef4444;\n    }\n    \n    /* Modal Maps */\n    .modal-maps {\n        position: fixed;\n        z-index: 1001;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0,0,0,0.8);\n        display: none;\n    }\n    \n    .modal-maps-content {\n        background-color: white;\n        margin: 2% auto;\n        padding: 20px;\n        border-radius: 12px;\n        width: 90%;\n        max-width: 800px;\n        max-height: 90%;\n        overflow-y: auto;\n    }\n    \n    .modal-maps-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n        border-bottom: 2px solid #1890ff;\n        padding-bottom: 10px;\n    }\n    \n    .modal-maps-title {\n        color: #1890ff;\n        font-size: 18px;\n        font-weight: 700;\n    }\n    \n    .url-display {\n        background: #f9fafb;\n        border: 2px solid #e5e7eb;\n        border-radius: 8px;\n        padding: 12px;\n        font-family: monospace;\n        font-size: 12px;\n        word-break: break-all;\n        margin-bottom: 16px;\n        color: #374151;\n        cursor: pointer;\n        transition: all 0.2s;\n    }\n    \n    .url-display:hover {\n        background: #e5e7eb;\n        border-color: #1890ff;\n    }\n    \n    /* Anima√ß√µes para mensagens */\n    @keyframes slideIn {\n        from { transform: translateX(100%); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n    }\n    \n    @keyframes slideOut {\n        from { transform: translateX(0); opacity: 1; }\n        to { transform: translateX(100%); opacity: 0; }\n    }\n    \n    /* Estilos para painel de tempo de espera */\n    .tempo-espera-badge {\n        display: inline-block;\n        padding: 8px 16px;\n        border-radius: 8px;\n        font-weight: 800;\n        font-size: 14px;\n        margin: 0 8px;\n    }\n    \n    .tempo-espera-rapido {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .tempo-espera-moderado {\n        background: #fef3c7;\n        color: #92400e;\n    }\n    \n    .tempo-espera-lento {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    /* Estilos para gr√°ficos */\n    .graficos-container {\n        display: grid;\n        gap: 24px;\n    }\n    \n    .grafico-card {\n        background: white;\n        border-radius: 12px;\n        padding: 24px;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n    }\n    \n    .grafico-titulo {\n        font-size: 20px;\n        font-weight: 900;\n        color: #1890ff;\n        margin-bottom: 20px;\n        border-bottom: 3px solid #1890ff;\n        padding-bottom: 12px;\n    }\n    \n    .grafico-item {\n        margin-bottom: 16px;\n        padding: 12px;\n        background: #f9fafb;\n        border-radius: 8px;\n        transition: all 0.2s;\n    }\n    \n    .grafico-item:hover {\n        background: #f0f9ff;\n        transform: translateX(4px);\n    }\n    \n    .grafico-label {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 8px;\n        font-size: 13px;\n        font-weight: 700;\n        color: #374151;\n    }\n    \n    .grafico-barra-container {\n        background: #e5e7eb;\n        height: 32px;\n        border-radius: 16px;\n        overflow: hidden;\n        position: relative;\n    }\n    \n    .grafico-barra {\n        height: 100%;\n        background: linear-gradient(90deg, #10b981, #3b82f6);\n        border-radius: 16px;\n        transition: width 0.5s ease;\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n        padding-right: 12px;\n        font-size: 12px;\n        font-weight: 900;\n        color: white;\n        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);\n    }\n    \n    .grafico-barra.rapido {\n        background: linear-gradient(90deg, #10b981, #34d399);\n    }\n    \n    .grafico-barra.moderado {\n        background: linear-gradient(90deg, #f59e0b, #fbbf24);\n    }\n    \n    .grafico-barra.lento {\n        background: linear-gradient(90deg, #ef4444, #f87171);\n    }\n    \n    .ranking-card {\n        display: grid;\n        grid-template-columns: 60px 1fr 120px;\n        gap: 16px;\n        align-items: center;\n        padding: 16px;\n        background: white;\n        border-radius: 12px;\n        margin-bottom: 12px;\n        border-left: 4px solid;\n        transition: all 0.2s;\n    }\n    \n    .ranking-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 8px 16px rgba(0,0,0,0.1);\n    }\n    \n    .ranking-card.ouro {\n        border-color: #fbbf24;\n        background: linear-gradient(135deg, #fffbeb 0%, white 100%);\n    }\n    \n    .ranking-card.prata {\n        border-color: #9ca3af;\n        background: linear-gradient(135deg, #f9fafb 0%, white 100%);\n    }\n    \n    .ranking-card.bronze {\n        border-color: #f97316;\n        background: linear-gradient(135deg, #fff7ed 0%, white 100%);\n    }\n    \n    .ranking-posicao {\n        font-size: 36px;\n        font-weight: 900;\n        text-align: center;\n    }\n    \n    .ranking-info {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .ranking-nome {\n        font-size: 16px;\n        font-weight: 700;\n        color: #1f2937;\n    }\n    \n    .ranking-detalhes {\n        font-size: 11px;\n        color: #6b7280;\n    }\n    \n    .ranking-tempo {\n        text-align: right;\n        font-size: 24px;\n        font-weight: 900;\n        color: #1890ff;\n    }\n</style>\n\n<div class=\"painel-container\">\n    <!-- Header -->\n    <div class=\"painel-header\">\n        <div class=\"painel-title\">\n            üöö Painel de Monitoramento - Rotas em Tempo Real\n        </div>\n        <div style=\"display: flex; gap: 24px; align-items: center;\">\n            <div class=\"live-indicator\">\n                <div class=\"live-dot\"></div>\n                AO VIVO\n            </div>\n            <div class=\"controles\">\n                <button class=\"btn-controle btn-atualizar\" onclick=\"atualizarManual()\">\n                    üîÑ Atualizar\n                </button>\n                <button class=\"btn-controle btn-som\" id=\"btnSom\" onclick=\"toggleSom()\">\n                    üîî Som: ON\n                </button>\n                <div id=\"indicadorSons\" style=\"font-size: 10px; color: #6b7280; text-align: center; margin-left: 12px; min-width: 120px; padding: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; border: 1px solid rgba(255,255,255,0.2);\">\n                    <!-- Status dos sons ser√° inserido aqui -->\n                </div>\n                <button class=\"btn-controle btn-log\" onclick=\"abrirModalLogs()\">\n                    üìã LOGS\n                </button>\n                <button class=\"btn-controle\" onclick=\"testarURLs()\" style=\"background: #8b5cf6; color: white;\">\n                    üß™ Testar URLs\n                </button>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Filtros Internos -->\n    <div class=\"filters-row\">\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üìç Filial</div>\n            <select class=\"filter-select\" id=\"filterFilial\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todas</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üìä Status</div>\n            <select class=\"filter-select\" id=\"filterStatus\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n                <option value=\"pendente\">‚è≥ Pendentes</option>\n                <option value=\"em-rota\">üöö Em Rota</option>\n                <option value=\"atrasada\">üö® Atrasadas</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üèçÔ∏è Motoboy</div>\n            <select class=\"filter-select\" id=\"filterMotoboy\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üßπ A√ß√µes</div>\n            <button class=\"filter-select\" onclick=\"limparFiltros()\" style=\"cursor: pointer; text-align: center; background: #ef4444; color: white; border: none; font-weight: 600;\">\n                üßπ Limpar Filtros\n            </button>\n        </div>\n    </div>\n    \n    <!-- View Controls -->\n    <div class=\"view-controls\">\n        <button class=\"btn-modo ativo\" id=\"btnCards\" onclick=\"alterarModo('cards')\">\n            üì± Cards\n        </button>\n        <button class=\"btn-modo\" id=\"btnLista\" onclick=\"alterarModo('lista')\">\n            üìã Lista\n        </button>\n        <button class=\"btn-modo\" id=\"btnTempoEspera\" onclick=\"alterarModo('tempo-espera')\">\n            ‚è±Ô∏è Tempo de Espera\n        </button>\n        <button class=\"btn-modo\" id=\"btnGraficos\" onclick=\"alterarModo('graficos')\">\n            üìä An√°lise Gr√°fica\n        </button>\n        <button class=\"btn-modo\" id=\"btnAuditoria\" onclick=\"alterarModo('auditoria')\">\n            üìã Auditoria\n        </button>\n    </div>\n    \n    <!-- Stats Gerais -->\n    <div class=\"stats-row\">\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"totalRotas\">0</div>\n            <div class=\"stat-label\">Total de Rotas Ativas</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasPendentes\">0</div>\n            <div class=\"stat-label\">‚è≥ Pendentes</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasEmRota\">0</div>\n            <div class=\"stat-label\">üöö Em Rota</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasAtrasadas\">0</div>\n            <div class=\"stat-label\">üö® Atrasadas (Atribu√≠das >20min)</div>\n        </div>\n        <div class=\"stat-card\" style=\"background: linear-gradient(135deg, #f0f9ff 0%, white 100%); border-left: 4px solid #3b82f6;\">\n            <div class=\"stat-value\" id=\"tempoMedioEspera\" style=\"color: #3b82f6; font-size: 28px;\">--:--</div>\n            <div class=\"stat-label\">‚è±Ô∏è Tempo M√©dio de Espera</div>\n        </div>\n    </div>\n    \n    <!-- Stats por Filial -->\n    <div class=\"stats-filial\">\n        <div class=\"stats-filial-title\">üìä Estat√≠sticas por Filial</div>\n        <div class=\"filial-row\" id=\"statsFilial\">\n            <!-- Estat√≠sticas por filial ser√£o inseridas aqui -->\n        </div>\n    </div>\n    \n    <!-- Grid de Rotas -->\n    <div class=\"rotas-grid\" id=\"rotasGrid\">\n        <!-- Cards ser√£o inseridos aqui via JavaScript -->\n    </div>\n    \n    <!-- Lista de Rotas -->\n    <div class=\"rotas-lista\" id=\"rotasLista\" style=\"display: none;\">\n        <div class=\"lista-header\">\n            <div>Rota ID</div>\n            <div>Nome da Rota</div>\n            <div>Motoboy</div>\n            <div>Status</div>\n            <div>Pedidos</div>\n            <div>Filial</div>\n            <div>Cron√¥metro</div>\n            <div>Ver Rota</div>\n        </div>\n        <div id=\"rotasListaBody\">\n            <!-- Lista ser√° inserida aqui via JavaScript -->\n        </div>\n    </div>\n    \n    <!-- An√°lise Gr√°fica -->\n    <div class=\"graficos-container\" id=\"rotasGraficos\" style=\"display: none;\">\n        <!-- Conte√∫do ser√° inserido via JavaScript -->\n    </div>\n    \n    <!-- üìã Auditoria de Rotas Atribu√≠das -->\n    <div class=\"rotas-lista\" id=\"rotasAuditoria\" style=\"display: none;\">\n        <div style=\"background: linear-gradient(135deg, #8b5cf6 0%, #6b21a8 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);\">\n            <h2 style=\"margin: 0 0 8px 0; font-size: 28px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;\">\n                üìã AUDITORIA - TEMPO DE RESPOSTA DO MOTOBOY\n            </h2>\n            <p style=\"margin: 0; font-size: 14px; opacity: 0.95; font-weight: 500;\">\n                Lista completa de rotas atribu√≠das com tempo de resposta calculado (Atribui√ß√£o ‚Üí Primeira Sa√≠da) ‚Ä¢ üéØ Meta: ‚â§ 5 minutos\n            </p>\n        </div>\n        \n        <div style=\"background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); overflow: hidden;\">\n            <div style=\"overflow-x: auto;\">\n                <table style=\"width: 100%; border-collapse: collapse; font-size: 13px;\">\n                    <thead style=\"background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); border-bottom: 2px solid #e5e7eb;\">\n                        <tr>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Status</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">‚è±Ô∏è Tempo Resposta</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Session ID</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Filial</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Motoboy</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Sa√≠da ID</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">üìÖ Atribui√ß√£o</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">üöÄ Primeira Sa√≠da</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Tipo Rota</th>\n                            <th style=\"padding: 16px 12px; text-align: left; font-weight: 800; color: #374151; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px;\">Pedidos</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"rotasAuditoriaBody\">\n                        <!-- Conte√∫do ser√° inserido via JavaScript -->\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Tabela de Tempo de Espera -->\n    <div class=\"rotas-lista\" id=\"rotasTempoEspera\" style=\"display: none;\">\n        <div style=\"background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0;\">\n            <h2 style=\"margin: 0; font-size: 24px; font-weight: 900;\">‚è±Ô∏è An√°lise de Tempo de Espera</h2>\n            <p style=\"margin: 8px 0 0 0; font-size: 14px; opacity: 0.9;\">Tempo entre cria√ß√£o da rota e atribui√ß√£o ao motoboy (validado por Sa√≠da ID)</p>\n        </div>\n        <div class=\"lista-header\" style=\"grid-template-columns: 120px 180px 100px 140px 90px 90px 100px 120px 100px;\">\n            <div title=\"Identificador √∫nico da rota\">üÜî Rota ID</div>\n            <div title=\"Nome descritivo da rota\">üìç Nome da Rota</div>\n            <div title=\"Filial respons√°vel\">üè¢ Filial</div>\n            <div title=\"Motoboy designado\">üèçÔ∏è Motoboy</div>\n            <div title=\"Hor√°rio de cria√ß√£o da rota\">üïê Cria√ß√£o</div>\n            <div title=\"Hor√°rio de atribui√ß√£o ao motoboy\">‚úÖ Atribui√ß√£o</div>\n            <div title=\"Sa√≠da ID (valida√ß√£o de atribui√ß√£o)\">üé´ Sa√≠da ID</div>\n            <div title=\"Tempo decorrido at√© atribui√ß√£o\">‚è±Ô∏è Tempo Espera</div>\n            <div title=\"Status atual da rota\">üìä Status</div>\n        </div>\n        <div id=\"rotasTempoEsperaBody\">\n            <!-- Lista ser√° inserida aqui via JavaScript -->\n        </div>\n    </div>\n</div>\n\n<!-- Modal Maps -->\n<div id=\"modalMaps\" class=\"modal-maps\">\n    <div class=\"modal-maps-content\">\n        <div class=\"modal-maps-header\">\n            <div class=\"modal-maps-title\">üó∫Ô∏è Rota no Google Maps</div>\n            <button class=\"close\" onclick=\"fecharModalMaps()\">&times;</button>\n        </div>\n        <div id=\"mapsContainer\">\n            <!-- Conte√∫do ser√° inserido aqui -->\n        </div>\n    </div>\n</div>\n\n<!-- Modal de Logs -->\n<div id=\"modalLogs\" class=\"modal\">\n    <div class=\"modal-content\">\n        <div class=\"modal-header\">\n            <div class=\"modal-title\">üìã Logs de Debug do Sistema</div>\n            <button class=\"close\" onclick=\"fecharModalLogs()\">&times;</button>\n        </div>\n        <div id=\"logsContainer\">\n            <!-- Logs ser√£o inseridos aqui -->\n        </div>\n    </div>\n</div>\n\n<script>\n// Configura√ß√µes\nlet somAtivo = true;\nlet tempoAtualizacao = 1000; // Atualizar cron√¥metros a cada 1 segundo\nlet tempoRecarregar = 30000; // Recarregar dados a cada 30 segundos\nlet rotasData = [];\nlet rotasFiltradas = [];\nlet modoAtual = 'cards'; // 'cards' ou 'lista'\n\n// Sistema simplificado - filtros internos HTML\n\n// Sistema de Logs\nlet systemLogs = [];\nconst originalConsoleLog = console.log;\nconst originalConsoleError = console.error;\nconst originalConsoleWarn = console.warn;\n\n// Fun√ß√£o para adicionar log ao sistema\nfunction addLog(message, type = 'info') {\n    const timestamp = new Date().toLocaleTimeString('pt-BR');\n    const logEntry = {\n        timestamp,\n        message: typeof message === 'object' ? JSON.stringify(message, null, 2) : String(message),\n        type\n    };\n    systemLogs.push(logEntry);\n    \n    // Manter apenas os √∫ltimos 100 logs\n    if (systemLogs.length > 100) {\n        systemLogs.shift();\n    }\n}\n\n// Sobrescrever console.log para capturar logs\nconsole.log = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'info');\n    originalConsoleLog.apply(console, args);\n};\n\nconsole.error = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'error');\n    originalConsoleError.apply(console, args);\n};\n\nconsole.warn = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'warning');\n    originalConsoleWarn.apply(console, args);\n};\n\n// Fun√ß√µes do Modal de Logs\nfunction abrirModalLogs() {\n    const modal = document.getElementById('modalLogs');\n    const container = document.getElementById('logsContainer');\n    \n    // Limpar container\n    container.innerHTML = '';\n    \n    // Adicionar logs\n    if (systemLogs.length === 0) {\n        container.innerHTML = '<div class=\"log-entry\">Nenhum log dispon√≠vel</div>';\n    } else {\n        systemLogs.forEach(log => {\n            const logDiv = document.createElement('div');\n            logDiv.className = 'log-entry ' + log.type;\n            logDiv.innerHTML = '[' + log.timestamp + '] ' + log.message;\n            container.appendChild(logDiv);\n        });\n    }\n    \n    // Scroll para o final\n    container.scrollTop = container.scrollHeight;\n    \n    // Mostrar modal\n    modal.style.display = 'block';\n}\n\nfunction fecharModalLogs() {\n    const modal = document.getElementById('modalLogs');\n    modal.style.display = 'none';\n}\n\n// Fechar modals clicando fora\nwindow.onclick = function(event) {\n    const modalLogs = document.getElementById('modalLogs');\n    const modalMaps = document.getElementById('modalMaps');\n    \n    if (event.target === modalLogs) {\n        modalLogs.style.display = 'none';\n    }\n    \n    if (event.target === modalMaps) {\n        modalMaps.style.display = 'none';\n    }\n}\n\n// Sistema de Sons Avan√ßado (Web Audio API)\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)();\nlet intervalAtrasadas = null;\nlet intervalAguardando = null;\n\n// Som para rotas ATRASADAS (agudo, r√°pido, urgente)\n// üÜï NOVA REGRA: Rotas ATRIBU√çDAS h√° mais de 20min\nfunction playAlertAtrasadas() {\n    if (!somAtivo) return;\n    \n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.frequency.value = 1200; // Mais agudo = mais urgente\n    oscillator.type = 'square'; // Som mais √°spero para urg√™ncia\n    \n    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);\n    \n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.3);\n    \n    console.log('üö® Som de alerta para rotas atrasadas (atribu√≠das h√° mais de 20min)');\n}\n\n// Som para rotas PENDENTES (grave, lento, suave)\n// üÜï NOVA REGRA: Rotas ainda n√£o atribu√≠das (sem motoboy)\nfunction playAlertAguardando() {\n    if (!somAtivo) return;\n    \n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.frequency.value = 400; // Mais grave = menos urgente\n    oscillator.type = 'sine'; // Som mais suave\n    \n    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);\n    \n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.8);\n    \n    console.log('‚è≥ Som de lembrete para rotas pendentes (sem atribui√ß√£o)');\n}\n\n// Fun√ß√£o legacy (manter compatibilidade)\nfunction playAlertSound() {\n    playAlertAtrasadas();\n}\n\nfunction toggleSom() {\n    somAtivo = !somAtivo;\n    const btn = document.getElementById('btnSom');\n    if (somAtivo) {\n        btn.textContent = 'üîî Som: ON';\n        btn.classList.remove('muted');\n        // Reiniciar sistema de sons\n        configurarSistemaSons();\n    } else {\n        btn.textContent = 'üîá Som: OFF';\n        btn.classList.add('muted');\n        // Parar todos os sons\n        pararTodosSons();\n    }\n}\n\n// Configurar sistema de sons baseado no status das rotas\nfunction configurarSistemaSons() {\n    console.log('üîä Configurando sistema de sons...');\n    \n    // Parar intervalos antigos\n    pararTodosSons();\n    \n    if (!somAtivo) {\n        // Atualizar indicador para mostrar que est√° desabilitado\n        atualizarIndicadorSons({ atrasadas: 0, pendentes: 0, emRota: 0 });\n        return;\n    }\n    \n    // Verificar status atual das rotas\n    const statusRotas = analisarStatusRotas();\n    \n    console.log('üîç Status das rotas:', statusRotas);\n    \n    // Som para rotas ATRASADAS (1 em 1 segundo - URGENTE)\n    // üÜï NOVA REGRA: Rotas ATRIBU√çDAS h√° mais de 20min\n    if (statusRotas.atrasadas > 0) {\n        console.log(`üö® Iniciando alertas para ${statusRotas.atrasadas} rotas atrasadas (atribu√≠das h√° >20min) - a cada 1 segundo`);\n        intervalAtrasadas = setInterval(() => {\n            playAlertAtrasadas();\n        }, 1000); // A cada 1 segundo\n    }\n    \n    // Som para rotas PENDENTES (a cada 5 segundos - LEMBRETE SUAVE)\n    // üÜï NOVA REGRA: Rotas ainda n√£o atribu√≠das (sem motoboy)\n    if (statusRotas.pendentes > 0) {\n        console.log(`‚è≥ Iniciando lembretes para ${statusRotas.pendentes} rotas pendentes (sem atribui√ß√£o) - a cada 5 segundos`);\n        intervalAguardando = setInterval(() => {\n            playAlertAguardando();\n        }, 5000); // A cada 5 segundos\n    }\n    \n    console.log('‚úÖ Sistema de sons configurado');\n    \n    // Atualizar indicador visual\n    atualizarIndicadorSons(statusRotas);\n}\n\n// Parar todos os intervalos de som\nfunction pararTodosSons() {\n    if (intervalAtrasadas) {\n        clearInterval(intervalAtrasadas);\n        intervalAtrasadas = null;\n        console.log('üîá Parou sons de rotas atrasadas');\n    }\n    \n    if (intervalAguardando) {\n        clearInterval(intervalAguardando);\n        intervalAguardando = null;\n        console.log('üîá Parou sons de rotas aguardando');\n    }\n}\n\n// Analisar status atual das rotas (usar dados filtrados se existir)\nfunction analisarStatusRotas() {\n    let atrasadas = 0;\n    let pendentes = 0;\n    let emRota = 0;\n    \n    // Usar rotasFiltradas se houver filtros ativos, sen√£o rotasData\n    const rotasParaAnalisar = rotasFiltradas.length > 0 ? rotasFiltradas : rotasData;\n    \n    rotasParaAnalisar.forEach(rota => {\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n        const isAtrasada = tempo.minutos >= 20 && !isPendente;\n        \n        if (isPendente) {\n            pendentes++;\n        } else if (isAtrasada) {\n            atrasadas++;\n        } else {\n            emRota++;\n        }\n    });\n    \n    console.log(`üîç An√°lise de ${rotasParaAnalisar.length} rotas:`, { atrasadas, pendentes, emRota });\n    return { atrasadas, pendentes, emRota };\n}\n\n// Atualizar indicador visual de sons\nfunction atualizarIndicadorSons(statusRotas) {\n    const indicador = document.getElementById('indicadorSons');\n    if (!indicador) return;\n    \n    let status = [];\n    \n    if (!somAtivo) {\n        status.push('üîá Sons desabilitados');\n    } else {\n        if (statusRotas.atrasadas > 0) {\n            status.push(`üö® ${statusRotas.atrasadas} atrasada${statusRotas.atrasadas > 1 ? 's' : ''}`);\n            status.push(`üîî Alerta a cada 1s`);\n        }\n        if (statusRotas.pendentes > 0) {\n            status.push(`‚è≥ ${statusRotas.pendentes} aguardando`);\n            status.push(`üîî Lembrete a cada 5s`);\n        }\n        if (statusRotas.atrasadas === 0 && statusRotas.pendentes === 0) {\n            status.push('‚úÖ Todas em rota');\n            status.push('üîá Sem alertas');\n        }\n    }\n    \n    indicador.innerHTML = status.join('<br>');\n    \n    // Cor baseada na urg√™ncia\n    if (statusRotas.atrasadas > 0) {\n        indicador.style.color = '#ef4444'; // Vermelho para atrasadas\n    } else if (statusRotas.pendentes > 0) {\n        indicador.style.color = '#f59e0b'; // Amarelo para aguardando\n    } else {\n        indicador.style.color = '#10b981'; // Verde para ok\n    }\n}\n\n// Fun√ß√£o para calcular tempo decorrido\n// üÜï NOVA REGRA: Tempo come√ßa quando rota √© ATRIBU√çDA (saida_numero preenchido)\nfunction calcularTempoDecorrido(dataCriacao, dataAtualizacao, saidaNumero) {\n    const agora = new Date();\n    \n    // Status: rota est√° pendente se n√£o tem saida_numero\n    let isPendente = !saidaNumero || saidaNumero === null || saidaNumero === '';\n    \n    let tempoInicio;\n    let tempoFim;\n    \n    if (isPendente) {\n        // ‚è≥ ROTA PENDENTE (sem motoboy atribu√≠do)\n        // N√£o h√° cron√¥metro - rota ainda n√£o come√ßou\n        tempoInicio = new Date(dataCriacao);\n        tempoFim = new Date(dataCriacao); // Zerar cron√¥metro\n    } else {\n        // ‚úÖ ROTA ATRIBU√çDA (tem saida_numero)\n        // Tempo come√ßa no updated_at (momento da atribui√ß√£o) e conta at√© AGORA\n        tempoInicio = new Date(dataAtualizacao);\n        // Ajustar para GMT-3: somar 3 horas para converter de GMT para Brasil\n        tempoInicio.setHours(tempoInicio.getHours() + 3);\n        tempoFim = agora; // Conta at√© agora em tempo real\n    }\n    \n    const diffMs = tempoFim - tempoInicio;\n    const diffSegundos = Math.floor(diffMs / 1000);\n    \n    // Evitar tempos negativos\n    const segundosPositivos = Math.max(0, Math.abs(diffSegundos));\n    \n    const horas = Math.floor(segundosPositivos / 3600);\n    const minutos = Math.floor((segundosPositivos % 3600) / 60);\n    const segundos = segundosPositivos % 60;\n    \n    return {\n        total: diffMs,\n        horas,\n        minutos,\n        segundos,\n        isPendente,\n        formatted: String(horas).padStart(2, '0') + ':' + String(minutos).padStart(2, '0') + ':' + String(segundos).padStart(2, '0')\n    };\n}\n\n// üÜï Fun√ß√£o para calcular TEMPO DE ESPERA (cria√ß√£o at√© atribui√ß√£o)\n// ‚úÖ VALIDA√á√ÉO: Verifica saida_numero para determinar status\nfunction calcularTempoEspera(dataCriacao, dataAtualizacao, saidaNumero, debug = false) {\n    // ‚úÖ VALIDA√á√ÉO: Verificar se saida_numero existe e n√£o est√° vazio\n    const isPendente = !saidaNumero || saidaNumero === null || saidaNumero === '' || saidaNumero === undefined;\n    \n    // Log apenas em modo debug para reduzir spam\n    if (debug) {\n        console.log(`‚è±Ô∏è Calculando tempo de espera - saida_numero: ${saidaNumero || 'VAZIO'} ‚Üí isPendente: ${isPendente}`);\n    }\n    \n    const inicio = new Date(dataCriacao);\n    let fim;\n    \n    if (isPendente) {\n        // Ainda aguardando atribui√ß√£o - contar at√© agora\n        fim = new Date();\n        if (debug) console.log(`   ‚è≥ Rota PENDENTE - contando at√© agora`);\n    } else {\n        // J√° foi atribu√≠da - calcular tempo de espera que teve\n        fim = new Date(dataAtualizacao);\n        // Ajustar para GMT-3\n        fim.setHours(fim.getHours() + 3);\n        if (debug) console.log(`   ‚úÖ Rota ATRIBU√çDA (saida_numero: ${saidaNumero}) - tempo at√© atribui√ß√£o`);\n    }\n    \n    const diffMs = fim - inicio;\n    const diffSegundos = Math.floor(diffMs / 1000);\n    const segundosPositivos = Math.max(0, Math.abs(diffSegundos));\n    \n    const horas = Math.floor(segundosPositivos / 3600);\n    const minutos = Math.floor((segundosPositivos % 3600) / 60);\n    const segundos = segundosPositivos % 60;\n    \n    return {\n        total: diffMs,\n        horas,\n        minutos,\n        segundos,\n        isPendente,\n        saidaNumero: saidaNumero || null, // ‚úÖ Incluir saida_numero na resposta\n        temSaida: !isPendente, // ‚úÖ Flag de valida√ß√£o\n        formatted: String(horas).padStart(2, '0') + ':' + String(minutos).padStart(2, '0') + ':' + String(segundos).padStart(2, '0')\n    };\n}\n\n// Vari√°veis globais para dados\nlet globalRotasData = [];\nlet globalPedidosData = [];\nlet globalRotasBIData = []; // üÜï Dados de rotas_bi_motoboy para an√°lise avan√ßada\n\n// Processar dados das rotas\nfunction processarRotas() {\n    console.log('üîç Iniciando processamento de rotas...');\n    \n    // Verificar se as vari√°veis globais existem\n    if (!globalRotasData) {\n        console.error('‚ùå globalRotasData n√£o existe!');\n        return;\n    }\n    if (!globalPedidosData) {\n        console.error('‚ùå globalPedidosData n√£o existe!');\n        return;\n    }\n    \n    const rotas = globalRotasData;\n    const pedidos = globalPedidosData;\n    \n    console.log('üìä Dados carregados:');\n    console.log('  - Rotas:', rotas.length, 'registros');\n    console.log('  - Pedidos:', pedidos.length, 'registros');\n    console.log('  - Tipo de rotas:', typeof rotas);\n    console.log('  - √â array?', Array.isArray(rotas));\n    \n    if (rotas.length > 0) {\n        console.log('üîç Exemplo de rota (primeira linha da query):', rotas[0]);\n        console.log('üîë Todos os campos dispon√≠veis:', Object.keys(rotas[0]));\n        console.log('üè¢ Campo filial:', rotas[0].filial);\n        console.log('üìç Campo rota_cliente:', rotas[0].rota_cliente);\n        console.log('üó∫Ô∏è Campo URL:', rotas[0].url);\n        \n        // Teste direto da URL da primeira rota\n        if (rotas[0].url) {\n            console.log('üß™ URL da primeira rota est√° dispon√≠vel - testando formato...');\n            console.log('   üîó URL completa:', rotas[0].url);\n            console.log('   ‚úÖ Cont√©m google.com/maps?', rotas[0].url.includes('google.com/maps'));\n            console.log('   üìè Tamanho:', rotas[0].url.length, 'caracteres');\n        } else {\n            console.log('‚ùå URL da primeira rota est√° VAZIA!');\n        }\n    }\n    \n    if (rotas.length === 0) {\n        console.error('‚ùå Nenhuma rota encontrada!');\n        rotasData = [];\n        renderizarRotas();\n        atualizarStats();\n        return;\n    }\n    \n    // L√ìGICA CORRETA DO SESSION_ID:\n    // - Cada session_id = 1 otimiza√ß√£o da rota (pode ter v√°rios pedidos)\n    // - Pedido novo chegou? ‚Üí Nova otimiza√ß√£o ‚Üí Novo session_id\n    // - Motoboy mudou? ‚Üí Nova otimiza√ß√£o ‚Üí Novo session_id  \n    // - SOLU√á√ÉO: Pegar apenas SESSION_ID MAIS RECENTE por filial\n    console.log('üîó Identificando session_ids mais recentes por filial...');\n    \n    // Primeiro: agrupar por session_id + motoboy (chave composta)\n    const rotasAgrupadas = {};\n    rotas.forEach((rota, index) => {\n        const sessionId = rota.session_id;\n        const motoboy = rota.descricao_motorista;\n        \n        if (!sessionId) {\n            console.warn(`‚ö†Ô∏è Rota ${index} sem session_id:`, rota);\n            return;\n        }\n        \n        // Chave composta: session_id + motoboy\n        const chaveRota = sessionId + '|' + (motoboy || 'SEM_MOTOBOY');\n        \n        if (!rotasAgrupadas[chaveRota]) {\n            // ‚úÖ VALIDA√á√ÉO: Verificar se saida_numero existe\n            const temSaidaNumero = rota.saida_numero && rota.saida_numero !== null && rota.saida_numero !== '';\n            \n            rotasAgrupadas[chaveRota] = {\n                session_id: sessionId,\n                filial: rota.filial,\n                data_criacao_rota: rota.data_criacao_rota,\n                saida_numero: rota.saida_numero, // ‚úÖ Pode ser null/vazio\n                temSaidaNumero: temSaidaNumero, // ‚úÖ Flag de valida√ß√£o\n                updated_at: rota.updated_at,\n                descricao_motorista: motoboy,\n                codigo_motorista: rota.codigo_motorista,\n                rota_cliente: rota.rota_cliente,\n                url: rota.url, // URL direta da query - sem processamento\n                pedidos: [],\n                pedidosUnicos: [],\n                pedidosOrdenados: []\n            };\n        }\n        \n        rotasAgrupadas[chaveRota].pedidos.push({\n            pedido_numero: rota.pedido_numero,\n            num_ordem: rota.num_ordem,\n            cod_cliente: rota.cod_cliente,\n            nome_cliente: rota.nome_cliente,\n            url_maps: rota.url\n        });\n        \n        // Atualizar informa√ß√µes mais recentes\n        if (rota.updated_at > rotasAgrupadas[chaveRota].updated_at) {\n            rotasAgrupadas[chaveRota].updated_at = rota.updated_at;\n            rotasAgrupadas[chaveRota].saida_numero = rota.saida_numero;\n        }\n        \n        // Garantir que temos a URL (usar sempre a √∫ltima encontrada)\n        if (rota.url) {\n            rotasAgrupadas[chaveRota].url = rota.url; // Sempre atualizar com a URL mais recente\n        }\n    });\n    \n    console.log('üîó Rotas agrupadas por session_id + motoboy:', Object.keys(rotasAgrupadas).length);\n    \n    // Segundo: encontrar a data de cria√ß√£o mais recente globalmente\n    const datasUnicas = [...new Set(Object.values(rotasAgrupadas).map(s => s.data_criacao_rota))].sort();\n    const dataMaisRecente = datasUnicas[datasUnicas.length - 1];\n    \n    console.log('üìÖ Datas de cria√ß√£o encontradas:', datasUnicas);\n    console.log('üìÖ Data mais recente:', dataMaisRecente);\n    \n    // Terceiro: pegar TODOS os sessions+motoboys da data mais recente (√∫ltima otimiza√ß√£o)\n    const rotasAtivas = Object.values(rotasAgrupadas).filter(rota => \n        rota.data_criacao_rota === dataMaisRecente\n    );\n    \n    console.log(`üéØ Filtrando rotas da data mais recente (${dataMaisRecente}):`);\n    rotasAtivas.forEach(rota => {\n        console.log(`   ‚úÖ Rota ${rota.session_id.substring(0,8)} + ${rota.descricao_motorista} (${rota.filial}) - ${rota.pedidos.length} pedidos`);\n    });\n    console.log('üìã Total de rotas encontradas:', Object.keys(rotasAgrupadas).length);\n    console.log('‚úÖ Rotas ativas (√∫ltima otimiza√ß√£o):', rotasAtivas.length);\n    \n    // Ordenar pedidos e remover duplicados por pedido_numero dentro de cada session_id\n    rotasAtivas.forEach(rota => {\n        console.log(`üîó Processando rota ativa ${rota.session_id.substring(0,8)} ‚Üí ${rota.descricao_motorista} (${rota.filial}):`);\n        console.log(`   üì¶ Total pedidos brutos: ${rota.pedidos.length}`);\n        console.log(`   üìç Nome: ${rota.rota_cliente || 'Sem nome'}`);\n        console.log(`   üèçÔ∏è Motoboy desta rota: ${rota.descricao_motorista}`);\n        \n        // Debug espec√≠fico da URL\n        console.log(`   üó∫Ô∏è URL original da query: ${rota.url || 'VAZIA'}`);\n        if (rota.url) {\n            const urlValida = rota.url.startsWith('https://www.google.com/maps');\n            console.log(`   ‚úÖ URL v√°lida? ${urlValida ? 'SIM' : 'N√ÉO'}`);\n            console.log(`   üîó URL completa: ${rota.url}`);\n            console.log(`   üìè Tamanho URL: ${rota.url.length} caracteres`);\n        } else {\n            console.log(`   ‚ùå Campo 'url' est√° vazio na query!`);\n        }\n        \n        // Remover duplicados por pedido_numero (manter o primeiro)\n        const pedidosMap = new Map();\n        rota.pedidos.forEach(pedido => {\n            if (!pedidosMap.has(pedido.pedido_numero)) {\n                pedidosMap.set(pedido.pedido_numero, pedido);\n            }\n        });\n        \n        rota.pedidosUnicos = Array.from(pedidosMap.values());\n        \n        // Ordenar pedidos √∫nicos por num_ordem\n        rota.pedidosOrdenados = [...rota.pedidosUnicos].sort((a, b) => a.num_ordem - b.num_ordem);\n        \n        console.log(`   ‚úÖ Pedidos √∫nicos: ${rota.pedidosUnicos.length}`);\n        console.log(`   üîÑ Duplicados removidos: ${rota.pedidos.length - rota.pedidosUnicos.length}`);\n        console.log(`   üìã Sequ√™ncia final: ${rota.pedidosOrdenados.map(p => `${p.num_ordem}¬∫-${p.pedido_numero}`).join(' ‚Üí ')}`);\n    });\n    \n    // Buscar informa√ß√µes adicionais dos pedidos na tabela pedidos_e_saidas_do_dia\n    rotasAtivas.forEach(rota => {\n        console.log(`üîç Enriquecendo dados da rota ${rota.session_id.substring(0,8)} do motoboy ${rota.descricao_motorista}:`);\n        \n        rota.pedidosOrdenados.forEach(pedido => {\n            const pedidoInfo = pedidos.find(p => p.PEDIDO === pedido.pedido_numero);\n            if (pedidoInfo) {\n                pedido.status = pedidoInfo.STATUS;\n                pedido.entrega_cliente = pedidoInfo.ENTREGA_CLIENTE;\n                // N√£o sobrescrever motoboy - j√° est√° correto no agrupamento\n            }\n        });\n        \n        // Motoboy j√° est√° correto (descricao_motorista do agrupamento)\n        rota.motoboy = rota.descricao_motorista || 'N/A';\n        \n        // Filial j√° est√° correta do session_id\n        if (!rota.filial || rota.filial === 'N/A') {\n            rota.filial = rota.rota_cliente || 'N/A';\n        }\n        \n        console.log(`   ‚úÖ Rota finalizada: ${rota.motoboy} com ${rota.pedidosUnicos.length} pedidos`);\n    });\n    \n    // Usar apenas as rotas mais recentes (1 por filial)\n    rotasData = rotasAtivas;\n    console.log('‚úÖ Rotas processadas:', rotasData.length);\n    \n    // Debug detalhado: rotas da √∫ltima otimiza√ß√£o (1 rota = 1 session_id + 1 motoboy)\n    console.log('üìä ROTAS ATIVAS (√öLTIMA OTIMIZA√á√ÉO - SESSION_ID + MOTOBOY):');\n    let rotasComSaida = 0;\n    let rotasSemSaida = 0;\n    \n    rotasData.forEach((rota, index) => {\n        // ‚úÖ VALIDA√á√ÉO: Verificar saida_numero\n        const temSaida = rota.saida_numero && rota.saida_numero !== null && rota.saida_numero !== '';\n        if (temSaida) rotasComSaida++;\n        else rotasSemSaida++;\n        \n        console.log(`   ${index + 1}. Rota #${rota.session_id.substring(0,8)} ‚Üí ${rota.motoboy}:`);\n        console.log(`      üè¢ Filial: ${rota.filial}`);\n        console.log(`      üìÖ Cria√ß√£o: ${rota.data_criacao_rota}`);\n        console.log(`      üìç Nome: ${rota.rota_cliente}`);\n        console.log(`      üì¶ Pedidos √∫nicos: ${rota.pedidosUnicos.length} (brutos: ${rota.pedidos.length})`);\n        console.log(`      üèçÔ∏è Motoboy espec√≠fico: ${rota.motoboy}`);\n        console.log(`      üö¶ Sa√≠da ID: ${rota.saida_numero || '‚è≥ PENDENTE (sem saida_numero)'} ${temSaida ? '‚úÖ' : '‚ùå'}`);\n        console.log(`      ‚úÖ Tem Sa√≠da? ${temSaida ? 'SIM' : 'N√ÉO'}`);\n        console.log(`      üó∫Ô∏è URL: ${rota.url ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o encontrada'}`);\n        if (rota.url) {\n            console.log(`      üîó Link Maps: ${rota.url.substring(0, 100)}...`);\n        }\n        console.log(`      üìã Sequ√™ncia: ${rota.pedidosOrdenados.map(p => `${p.num_ordem}¬∫-${p.pedido_numero}`).join(' ‚Üí ')}`);\n        console.log('      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n    });\n    \n    console.log('üìä VALIDA√á√ÉO DE SA√çDA ID:');\n    console.log(`   ‚úÖ Rotas COM saida_numero: ${rotasComSaida}`);\n    console.log(`   ‚ùå Rotas SEM saida_numero: ${rotasSemSaida}`);\n    console.log(`   üìä Total: ${rotasData.length}`);\n    \n    // Estat√≠sticas finais\n    const totalRotasProcessadas = Object.keys(rotasAgrupadas).length;\n    const totalPedidosUnicos = rotasData.reduce((total, r) => total + r.pedidosUnicos.length, 0);\n    const totalPedidosBrutos = rotasData.reduce((total, r) => total + r.pedidos.length, 0);\n    \n    const filiaisStats = {};\n    rotasData.forEach(r => {\n        const filial = r.filial || 'N/A';\n        filiaisStats[filial] = (filiaisStats[filial] || 0) + 1;\n    });\n    \n    const filiaisUnicas = Object.keys(filiaisStats).filter(f => f !== 'N/A');\n    \n    const rotasComURL = rotasData.filter(r => r.url).length;\n    \n    console.log('üéØ ESTAT√çSTICAS FINAIS:');\n    console.log('   üìä Total de combina√ß√µes processadas:', totalRotasProcessadas, '(session_id + motoboy)');\n    console.log('   üè¢ Filiais com rotas ativas:', filiaisUnicas.length);\n    console.log('   ‚úÖ Rotas da √∫ltima otimiza√ß√£o:', rotasData.length, '(apenas data mais recente)');\n    console.log('   üì¶ Total de pedidos √∫nicos:', totalPedidosUnicos);\n    console.log('   üì¶ Total de pedidos brutos:', totalPedidosBrutos);\n    console.log('   üîÑ Duplicados removidos:', totalPedidosBrutos - totalPedidosUnicos);\n    console.log('   üó∫Ô∏è Rotas com URL do Maps:', rotasComURL, 'de', rotasData.length);\n    console.log('   üè¢ Distribui√ß√£o por filial:', filiaisStats);\n    console.log('   üìä M√©dia de pedidos por rota:', (totalPedidosUnicos / rotasData.length).toFixed(1));\n    console.log('   üèçÔ∏è IMPORTANTE: Cada rota = 1 session_id + 1 motoboy espec√≠fico');\n    if (rotasData.length > 0) {\n        console.log('   üìÖ Data da otimiza√ß√£o atual:', rotasData[0].data_criacao_rota);\n        console.log('   üß™ Primeira rota tem URL?', !!rotasData[0].url);\n        if (rotasData[0].url) {\n            console.log('   üîó URL exemplo:', rotasData[0].url.substring(0, 80) + '...');\n        }\n    }\n    \n    const filiaisEncontradas = Object.keys(filiaisStats).filter(f => f !== 'N/A');\n    console.log('üè¢ Filiais dispon√≠veis para filtro:', filiaisEncontradas);\n    \n    // Popular filtros e aplicar inicial\n    popularFiltros();\n    aplicarFiltros();\n    \n    // Inicializar estat√≠sticas por filial\n    console.log('üè¢ Inicializando estat√≠sticas por filial...');\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons inicial\n    console.log('üîä Configurando sistema de sons inicial...');\n    configurarSistemaSons();\n    \n    console.log('üîç === PROCESSAR ROTAS FINALIZADO ===');\n}\n\n// Renderizar cards das rotas\nfunction renderizarRotas() {\n    console.log('üé¥ === RENDERIZAR ROTAS INICIADO ===');\n    console.log('üìä rotasFiltradas.length:', rotasFiltradas.length);\n    console.log('üéØ rotasFiltradas dados:', rotasFiltradas);\n    \n    const grid = document.getElementById('rotasGrid');\n    console.log('üé≠ Elemento rotasGrid encontrado:', !!grid);\n    \n    if (!grid) {\n        console.error('‚ùå Elemento rotasGrid n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        console.log('üì≠ Nenhuma rota para exibir');\n        grid.innerHTML = `\n            <div class=\"sem-rotas\">\n                <div class=\"sem-rotas-icon\">üì≠</div>\n                <div class=\"sem-rotas-text\">Nenhuma rota encontrada com os filtros selecionados</div>\n            </div>\n        `;\n        console.log('üì≠ HTML de \"sem rotas\" inserido');\n        return;\n    }\n    \n    // üÜï Enriquecer dados com BI antes de renderizar\n    enriquecerRotasComBI();\n    \n    console.log('üé® Gerando HTML para', rotasFiltradas.length, 'rotas...');\n    \n    grid.innerHTML = rotasFiltradas.map((rota, index) => {\n        const tempo = calcularTempoDecorrido(\n            rota.data_criacao_rota, \n            rota.updated_at, \n            rota.saida_numero\n        );\n        \n        const isPendente = tempo.isPendente;\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min (n√£o pendentes)\n        const isAtrasada = tempo.minutos >= 20 && !isPendente;\n        \n        let statusClass = isPendente ? 'pendente' : 'em-rota';\n        let statusText = isPendente ? '‚è≥ Aguardando Atribui√ß√£o' : 'üöö Em Rota';\n        \n        if (isAtrasada) {\n            statusClass = 'atrasada';\n            statusText = 'üö® Atrasada';\n        }\n        \n        // Verificar se pedidos est√£o na ordem correta\n        const pedidosForaOrdem = rota.pedidosOrdenados.filter((p, idx) => {\n            if (idx === 0) return false;\n            return p.num_ordem < rota.pedidosOrdenados[idx - 1].num_ordem;\n        });\n        \n        // Alerta se h√° problemas na ordem dos pedidos OU se houve duplicados\n        const temAlerta = pedidosForaOrdem.length > 0 || rota.pedidos.length !== rota.pedidosUnicos.length;\n        \n        // Encurtar session_id para exibi√ß√£o (primeiros 8 caracteres)\n        const sessionIdCurto = rota.session_id.substring(0, 8);\n        \n        // Calcular tempo de espera (cria√ß√£o ‚Üí atribui√ß√£o)\n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        \n        // Debug do bot√£o URL na renderiza√ß√£o\n        console.log(`üó∫Ô∏è Renderizando rota ${sessionIdCurto}: URL = ${rota.url || 'VAZIA'}`);\n        if (rota.url) {\n            console.log(`üîó URL completa: ${rota.url}`);\n        }\n        \n        return `\n            <div class=\"rota-card ${statusClass}\" data-index=\"${index}\">\n                <div class=\"rota-header\">\n                    <div class=\"rota-id\">\n                        <span class=\"filial-badge\">\n                            ${rota.filial}\n                        </span>\n                        Rota #${sessionIdCurto}\n                    </div>\n                    <div class=\"rota-status ${statusClass}\">${statusText}</div>\n                </div>\n                \n                <div style=\"margin-bottom: 16px;\">\n                    <div style=\"font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 8px;\">\n                        üìç ${rota.rota_cliente || 'Rota sem nome'}\n                    </div>\n                    ${rota.url ? \n                        `<div style=\"display: flex; gap: 8px;\">\n                            <button class=\"btn-ver-rota\" \n                                    onclick=\"copiarURL('${rota.url}', '${sessionIdCurto}');\" \n                                    title=\"Copiar URL para √°rea de transfer√™ncia\">\n                                üìã Copiar URL\n                            </button>\n                            <button class=\"btn-ver-rota\" \n                                    onclick=\"abrirModalMaps('${rota.url}', '${sessionIdCurto}', '${rota.rota_cliente}');\" \n                                    style=\"background: #8b5cf6;\" \n                                    title=\"Ver rota em modal interno\">\n                                üó∫Ô∏è Ver Mapa\n                            </button>\n                        </div>` \n                        : \n                        `<div style=\"padding: 6px 12px; background: #d1d5db; color: #6b7280; border-radius: 6px; font-size: 11px;\">\n                            üó∫Ô∏è URL n√£o dispon√≠vel\n                        </div>`\n                    }\n                </div>\n                \n                ${(() => {\n                    // üéØ VERIFICAR SE TEM TEMPO DE RESPOSTA CALCULADO (MOTOBOY J√Å SAIU)\n                    if (rota.dadosBI && rota.dadosBI.tempoRespostaMotoboy !== null) {\n                        const tempoResposta = rota.dadosBI.tempoRespostaMotoboy;\n                        const dentroMeta = rota.dadosBI.dentroMeta;\n                        const corFundo = dentroMeta ? '#d1fae5' : '#fee2e2';\n                        const corTexto = dentroMeta ? '#10b981' : '#ef4444';\n                        const corBorda = dentroMeta ? '#10b981' : '#ef4444';\n                        const emoji = dentroMeta ? '‚úÖ' : 'üö®';\n                        const status = dentroMeta ? 'DENTRO DA META' : 'FORA DA META';\n                        \n                        return `\n                            <div style=\"background: linear-gradient(135deg, ${corFundo} 0%, white 100%); border-radius: 12px; padding: 16px; margin-bottom: 16px; border: 3px solid ${corBorda}; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\n                                <div style=\"text-align: center; margin-bottom: 12px;\">\n                                    <div style=\"font-size: 10px; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 6px;\">\n                                        üéØ TEMPO DE RESPOSTA DO MOTOBOY\n                                    </div>\n                                    <div style=\"font-size: 36px; font-weight: 900; color: ${corTexto}; line-height: 1; font-family: 'Courier New', monospace;\">\n                                        ${tempoResposta.toFixed(1)} min\n                                    </div>\n                                    <div style=\"display: inline-block; margin-top: 8px; padding: 4px 12px; background: ${corTexto}; color: white; border-radius: 20px; font-size: 10px; font-weight: 800;\">\n                                        ${emoji} ${status}\n                                    </div>\n                                </div>\n                                <div style=\"background: rgba(0,0,0,0.05); padding: 8px; border-radius: 6px; font-size: 10px; text-align: center; color: #6b7280;\">\n                                    ‚è±Ô∏è Atribui√ß√£o ‚Üí Primeira Sa√≠da ‚Ä¢ Meta: ‚â§ 5 minutos\n                                </div>\n                                ${rota.dadosBI.primeiraSaida ? `\n                                <div style=\"margin-top: 8px; text-align: center; font-size: 11px; color: #6b7280;\">\n                                    üöÄ Saiu em: <strong style=\"color: ${corTexto};\">${rota.dadosBI.primeiraSaida}</strong>\n                                </div>\n                                ` : ''}\n                            </div>\n                        `;\n                    }\n                    \n                    // Se n√£o tem dados BI, mostrar cron√¥metro normal\n                    return `\n                        <div class=\"cronometro\">\n                            <div class=\"cronometro-tempo\" data-rota-id=\"${rota.session_id}\">\n                                ${tempo.formatted}\n                            </div>\n                            <div class=\"cronometro-label\">\n                                ${isPendente ? '‚è≥ Aguardando atribui√ß√£o' : '‚è±Ô∏è Aguardando sa√≠da do motoboy'}\n                            </div>\n                            ${!isPendente ? `\n                            <div style=\"margin-top: 8px; padding: 6px; background: #fef3c7; border-radius: 6px; font-size: 10px; color: #92400e; text-align: center;\">\n                                ‚ö†Ô∏è Cron√¥metro ativo: motoboy ainda n√£o saiu\n                            </div>\n                            ` : ''}\n                        </div>\n                    `;\n                })()}\n                \n                ${!isPendente ? `\n                <div style=\"background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; padding: 12px; margin-bottom: 16px; border: 2px solid #3b82f6;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                        <div style=\"font-size: 10px; font-weight: 700; color: #1e40af; text-transform: uppercase;\">\n                            ‚è±Ô∏è Tempo de Espera at√© Atribui√ß√£o\n                        </div>\n                        <div style=\"font-size: 18px; font-weight: 900; color: #3b82f6; font-family: 'Courier New', monospace;\">\n                            ${tempoEspera.formatted}\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: rgba(59, 130, 246, 0.1); border-radius: 4px;\">\n                        <div style=\"font-size: 9px; color: #64748b;\">\n                            Tempo entre cria√ß√£o e atribui√ß√£o\n                        </div>\n                        <div style=\"font-size: 10px; font-weight: 700; color: #10b981;\">\n                            ‚úÖ Sa√≠da ID: ${rota.saida_numero || 'N/A'}\n                        </div>\n                    </div>\n                </div>\n                ` : ''}\n                \n                <div class=\"rota-info\">\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üèçÔ∏è Motoboy</div>\n                        <div class=\"info-value\">${rota.motoboy}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üì¶ Pedidos</div>\n                        <div class=\"info-value\">\n                            ${rota.pedidosUnicos.length}\n                            ${rota.pedidos.length !== rota.pedidosUnicos.length ? `<div style=\"font-size: 9px; color: #f59e0b;\">(${rota.pedidos.length - rota.pedidosUnicos.length} duplicados removidos)</div>` : ''}\n                        </div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üïê Cria√ß√£o</div>\n                        <div class=\"info-value\">${new Date(rota.data_criacao_rota).toLocaleTimeString('pt-BR')}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üö¶ Sa√≠da</div>\n                        <div class=\"info-value\">${rota.saida_numero || 'Pendente'}</div>\n                    </div>\n                </div>\n                \n                <div class=\"pedidos-list\">\n                    <div class=\"pedidos-header\">Pedidos na Rota:</div>\n                    ${rota.pedidosOrdenados.map((p, idx) => `\n                        <div class=\"pedido-item\">\n                            <span>${idx + 1}¬∫ - <span class=\"pedido-numero\">Pedido ${p.pedido_numero}</span></span>\n                            <span class=\"pedido-status ok\">${p.nome_cliente || 'Cliente'}</span>\n                        </div>\n                    `).join('')}\n                </div>\n                \n                ${temAlerta ? `\n                    <div class=\"alerta-pedidos\">\n                        ${pedidosForaOrdem.length > 0 ? '‚ö†Ô∏è Pedidos fora da ordem prevista!' : ''} \n                        ${rota.pedidos.length !== rota.pedidosUnicos.length ? `üîÑ ${rota.pedidos.length - rota.pedidosUnicos.length} pedidos duplicados removidos` : ''}\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Rotas renderizadas com sucesso!');\n    console.log('üéØ HTML inserido no grid');\n    \n    // Atualizar estat√≠sticas por filial\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons baseado no status atual\n    configurarSistemaSons();\n    \n    console.log('üé¥ === RENDERIZAR ROTAS FINALIZADO ===');\n}\n\n// *** SISTEMA SIMPLIFICADO - APENAS FILTROS INTERNOS ***\n\n// Popular filtros internos\nfunction popularFiltros() {\n    console.log('üìã Populando filtros internos...');\n    \n    // Popular filtro de filial\n    const filiais = [...new Set(rotasData.map(r => r.filial))].filter(f => f && f !== 'N/A').sort();\n    const selectFilial = document.getElementById('filterFilial');\n    selectFilial.innerHTML = '<option value=\"\">Todas</option>';\n    filiais.forEach(filial => {\n        selectFilial.innerHTML += '<option value=\"' + filial + '\">' + filial + '</option>';\n    });\n    \n    // Popular filtro de motoboy\n    const motoboys = [...new Set(rotasData.map(r => r.motoboy))].filter(m => m && m !== 'N/A').sort();\n    const selectMotoboy = document.getElementById('filterMotoboy');\n    selectMotoboy.innerHTML = '<option value=\"\">Todos</option>';\n    motoboys.forEach(motoboy => {\n        selectMotoboy.innerHTML += '<option value=\"' + motoboy + '\">' + motoboy + '</option>';\n    });\n    \n    console.log('üìã Filtros populados:', { filiais: filiais.length, motoboys: motoboys.length });\n}\n\n// Aplicar filtros internos (sem localStorage - com valida√ß√£o completa)\nfunction aplicarFiltros() {\n    console.log('üîçüîçüîç === APLICAR FILTROS INTERNOS === üîçüîçüîç');\n    \n    const filterFilial = document.getElementById('filterFilial').value;\n    const filterStatus = document.getElementById('filterStatus').value;\n    const filterMotoboy = document.getElementById('filterMotoboy').value;\n    \n    // === ANTES DO FILTRO ===\n    console.log('üìä ANTES DO FILTRO:');\n    console.log(`   Total: ${rotasData.length} rotas`);\n    \n    // Contar quantidades por categoria\n    const filiaisDisponiveis = {};\n    const motoboyDisponiveis = {};\n    const statusCount = { pendentes: 0, emRota: 0, atrasadas: 0 };\n    \n    rotasData.forEach(rota => {\n        // Contar filiais\n        filiaisDisponiveis[rota.filial] = (filiaisDisponiveis[rota.filial] || 0) + 1;\n        \n        // Contar motoboys\n        motoboyDisponiveis[rota.motoboy] = (motoboyDisponiveis[rota.motoboy] || 0) + 1;\n        \n        // Contar status\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n        const isAtrasada = tempo.minutos >= 20 && !isPendente;\n        \n        if (isPendente) {\n            statusCount.pendentes++;\n        } else {\n            statusCount.emRota++;\n            if (isAtrasada) statusCount.atrasadas++;\n        }\n    });\n    \n    console.log('üìä Quantidade por filial:', filiaisDisponiveis);\n    console.log('üìä Quantidade por status:', statusCount);\n    console.log('üéØ FILTROS SELECIONADOS:', { filterFilial, filterStatus, filterMotoboy });\n    \n    // === APLICAR FILTROS ===\n    console.log('üîÑ Aplicando filtros...');\n    const rotasAntes = rotasData.length;\n    \n    rotasFiltradas = rotasData.filter(rota => {\n        // Filtro por filial\n        if (filterFilial && rota.filial !== filterFilial) return false;\n        \n        // Filtro por motoboy\n        if (filterMotoboy && rota.motoboy !== filterMotoboy) return false;\n        \n        // Filtro por status\n        if (filterStatus) {\n            const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n            const isPendente = tempo.isPendente;\n            // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n            const isAtrasada = tempo.minutos >= 20 && !isPendente;\n            \n            if (filterStatus === 'pendente' && !isPendente) return false;\n            if (filterStatus === 'em-rota' && isPendente) return false;\n            if (filterStatus === 'atrasada' && !isAtrasada) return false;\n        }\n        \n        return true;\n    });\n    \n    // === DEPOIS DO FILTRO ===\n    console.log('üìà RESULTADO DO FILTRO:');\n    console.log(`   ‚úÖ ANTES: ${rotasAntes} rotas`);\n    console.log(`   ‚úÖ DEPOIS: ${rotasFiltradas.length} rotas`);\n    console.log(`   üéØ REDU√á√ÉO: ${rotasAntes - rotasFiltradas.length} rotas removidas`);\n    \n    if (rotasFiltradas.length > 0) {\n        const filiaisFiltradas = [...new Set(rotasFiltradas.map(r => r.filial))];\n        console.log(`   üè¢ Filiais no resultado:`, filiaisFiltradas);\n    }\n    \n    // Renderizar conforme modo atual\n    if (modoAtual === 'cards') {\n        renderizarRotas();\n    } else if (modoAtual === 'lista') {\n        renderizarLista();\n    } else if (modoAtual === 'tempo-espera') {\n        renderizarTempoEspera();\n    } else if (modoAtual === 'graficos') {\n        renderizarGraficos();\n    }\n    \n    atualizarStats();\n    atualizarStatsFilial();\n    \n    // Reconfigurar sons baseado nos dados filtrados\n    configurarSistemaSons();\n    \n    console.log('üîçüîçüîç === FILTROS APLICADOS COM SUCESSO === üîçüîçüîç');\n}\n\n// Alterar modo de visualiza√ß√£o\nfunction alterarModo(modo) {\n    modoAtual = modo;\n    \n    // Atualizar bot√µes\n    document.getElementById('btnCards').classList.toggle('ativo', modo === 'cards');\n    document.getElementById('btnLista').classList.toggle('ativo', modo === 'lista');\n    document.getElementById('btnTempoEspera').classList.toggle('ativo', modo === 'tempo-espera');\n    document.getElementById('btnGraficos').classList.toggle('ativo', modo === 'graficos');\n    document.getElementById('btnAuditoria').classList.toggle('ativo', modo === 'auditoria');\n    \n    // Mostrar/ocultar containers\n    document.getElementById('rotasGrid').style.display = modo === 'cards' ? 'grid' : 'none';\n    document.getElementById('rotasLista').style.display = modo === 'lista' ? 'block' : 'none';\n    document.getElementById('rotasTempoEspera').style.display = modo === 'tempo-espera' ? 'block' : 'none';\n    document.getElementById('rotasGraficos').style.display = modo === 'graficos' ? 'block' : 'none';\n    document.getElementById('rotasAuditoria').style.display = modo === 'auditoria' ? 'block' : 'none';\n    \n    // Renderizar conforme modo\n    if (modo === 'cards') {\n        renderizarRotas();\n    } else if (modo === 'lista') {\n        renderizarLista();\n    } else if (modo === 'tempo-espera') {\n        renderizarTempoEspera();\n    } else if (modo === 'graficos') {\n        renderizarGraficos();\n    } else if (modo === 'auditoria') {\n        renderizarAuditoria();\n    }\n    \n    console.log('üëÄ Modo alterado para:', modo);\n}\n\n// üÜï Enriquecer dados das rotas com informa√ß√µes BI\nfunction enriquecerRotasComBI() {\n    console.log('üìä Enriquecendo rotas com dados de rotas_bi_motoboy...');\n    console.log('üìä Total de registros BI dispon√≠veis:', globalRotasBIData.length);\n    \n    if (!globalRotasBIData || globalRotasBIData.length === 0) {\n        console.warn('‚ö†Ô∏è Nenhum dado de rotas_bi_motoboy dispon√≠vel');\n        return;\n    }\n    \n    // Agrupar dados BI por SAIDAID para acesso r√°pido\n    const dadosBIPorSaida = {};\n    globalRotasBIData.forEach(item => {\n        const saidaId = item.SAIDAID;\n        if (!saidaId) return;\n        \n        if (!dadosBIPorSaida[saidaId]) {\n            dadosBIPorSaida[saidaId] = [];\n        }\n        dadosBIPorSaida[saidaId].push(item);\n    });\n    \n    console.log('üìä SAIDAIDs encontradas no BI:', Object.keys(dadosBIPorSaida).length);\n    \n    // Enriquecer cada rota com dados BI\n    let rotasEnriquecidas = 0;\n    rotasData.forEach(rota => {\n        const saidaId = rota.saida_numero;\n        if (!saidaId || !dadosBIPorSaida[saidaId]) {\n            // Rota sem dados BI (provavelmente ainda n√£o foi executada)\n            rota.dadosBI = null;\n            return;\n        }\n        \n        const pedidosBI = dadosBIPorSaida[saidaId];\n        \n        // üéØ M√âTRICA PRINCIPAL: TEMPO DE RESPOSTA DO MOTOBOY\n        // Atribui√ß√£o (updated_at) ‚Üí Primeira Sa√≠da (DATASAIDA_STR do primeiro pedido)\n        // META: 5 MINUTOS\n        let tempoRespostaMotoboy = null;\n        \n        // Encontrar o primeiro pedido (menor DATASAIDA_STR)\n        const pedidosOrdenados = [...pedidosBI].sort((a, b) => {\n            const dataA = converterDataBrasileira(a.DATASAIDA_STR);\n            const dataB = converterDataBrasileira(b.DATASAIDA_STR);\n            if (!dataA) return 1;\n            if (!dataB) return -1;\n            return dataA - dataB;\n        });\n        \n        const primeiroPedido = pedidosOrdenados[0];\n        \n        if (primeiroPedido && primeiroPedido.DATASAIDA_STR) {\n            const dataAtribuicao = new Date(rota.updated_at);\n            dataAtribuicao.setHours(dataAtribuicao.getHours() + 3); // Ajuste GMT-3\n            \n            const dataPrimeiraSaida = converterDataBrasileira(primeiroPedido.DATASAIDA_STR);\n            \n            if (dataPrimeiraSaida) {\n                tempoRespostaMotoboy = Math.floor((dataPrimeiraSaida - dataAtribuicao) / 60000); // minutos\n                \n                // Validar se o tempo faz sentido (n√£o pode ser negativo ou muito grande)\n                if (tempoRespostaMotoboy < 0 || tempoRespostaMotoboy > 1440) { // Max 24h\n                    console.warn(`‚ö†Ô∏è Tempo de resposta anormal: ${tempoRespostaMotoboy}min - Rota ${saidaId}`);\n                    tempoRespostaMotoboy = null;\n                }\n            }\n        }\n        \n        // Calcular m√©tricas agregadas da rota\n        const temposExecucao = [];\n        const temposRetorno = [];\n        const atrasos = [];\n        let totalPedidos = pedidosBI.length;\n        let pedidosEntregues = 0;\n        \n        pedidosBI.forEach(pedido => {\n            // Tempo de execu√ß√£o (sa√≠da ‚Üí entrega)\n            if (pedido.DATASAIDA_STR && pedido.DATAENTREGA_STR) {\n                const saida = converterDataBrasileira(pedido.DATASAIDA_STR);\n                const entrega = converterDataBrasileira(pedido.DATAENTREGA_STR);\n                if (saida && entrega) {\n                    const tempoExec = Math.floor((entrega - saida) / 60000); // minutos\n                    temposExecucao.push(tempoExec);\n                    pedidosEntregues++;\n                }\n            }\n            \n            // Tempo de retorno (entrega ‚Üí retorno)\n            if (pedido.DATAENTREGA_STR && pedido.DATARETORNO_STR) {\n                const entrega = converterDataBrasileira(pedido.DATAENTREGA_STR);\n                const retorno = converterDataBrasileira(pedido.DATARETORNO_STR);\n                if (entrega && retorno) {\n                    const tempoRet = Math.floor((retorno - entrega) / 60000); // minutos\n                    temposRetorno.push(tempoRet);\n                }\n            }\n            \n            // Atrasos\n            if (pedido.MINUTOS_ATRASO) {\n                const atraso = parseInt(pedido.MINUTOS_ATRASO) || 0;\n                atrasos.push(atraso);\n            }\n        });\n        \n        // Calcular m√©dias\n        const mediaExecucao = temposExecucao.length > 0 \n            ? Math.round(temposExecucao.reduce((a, b) => a + b, 0) / temposExecucao.length)\n            : 0;\n        const mediaRetorno = temposRetorno.length > 0\n            ? Math.round(temposRetorno.reduce((a, b) => a + b, 0) / temposRetorno.length)\n            : 0;\n        const mediaAtraso = atrasos.length > 0\n            ? Math.round(atrasos.reduce((a, b) => a + b, 0) / atrasos.length)\n            : 0;\n        const somaAtrasos = atrasos.reduce((a, b) => a + b, 0);\n        \n        // Anexar dados BI √† rota\n        rota.dadosBI = {\n            totalPedidos,\n            pedidosEntregues,\n            taxaSucesso: totalPedidos > 0 ? (pedidosEntregues / totalPedidos) * 100 : 0,\n            tempoExecucaoMedio: mediaExecucao,\n            tempoRetornoMedio: mediaRetorno,\n            atrasoMedio: mediaAtraso,\n            atrasoTotal: somaAtrasos,\n            tipo: pedidosBI[0]?.TIPO || 'N/A',\n            filial: pedidosBI[0]?.FILIAL || rota.filial,\n            pedidosDetalhados: pedidosBI,\n            // üéØ M√âTRICA PRINCIPAL\n            tempoRespostaMotoboy: tempoRespostaMotoboy, // Atribui√ß√£o ‚Üí Primeira Sa√≠da\n            dentroMeta: tempoRespostaMotoboy !== null ? tempoRespostaMotoboy <= 5 : null, // Meta: 5min\n            primeiraSaida: primeiroPedido?.DATASAIDA_STR || null\n        };\n        \n        rotasEnriquecidas++;\n        \n        // Log da m√©trica principal\n        if (tempoRespostaMotoboy !== null) {\n            const status = tempoRespostaMotoboy <= 5 ? '‚úÖ DENTRO' : 'üö® FORA';\n            console.log(`${status} Meta - Rota ${saidaId}: ${tempoRespostaMotoboy}min (Meta: 5min)`);\n        }\n    });\n    \n    console.log(`‚úÖ ${rotasEnriquecidas}/${rotasData.length} rotas enriquecidas com dados BI`);\n    \n    // Estat√≠sticas da m√©trica principal\n    const comTempoResposta = rotasData.filter(r => r.dadosBI && r.dadosBI.tempoRespostaMotoboy !== null);\n    const dentroMeta = comTempoResposta.filter(r => r.dadosBI.dentroMeta);\n    const foraMeta = comTempoResposta.filter(r => !r.dadosBI.dentroMeta);\n    \n    console.log('üéØ M√âTRICA PRINCIPAL - TEMPO DE RESPOSTA DO MOTOBOY:');\n    console.log(`   üìä Total com dados: ${comTempoResposta.length}`);\n    console.log(`   ‚úÖ Dentro da meta (‚â§5min): ${dentroMeta.length} (${comTempoResposta.length > 0 ? Math.round(dentroMeta.length / comTempoResposta.length * 100) : 0}%)`);\n    console.log(`   üö® Fora da meta (>5min): ${foraMeta.length} (${comTempoResposta.length > 0 ? Math.round(foraMeta.length / comTempoResposta.length * 100) : 0}%)`);\n}\n\n// Fun√ß√£o auxiliar para converter data brasileira (do rotas_bi_motoboy)\nfunction converterDataBrasileira(dataStr) {\n    if (!dataStr) return null;\n    \n    try {\n        // Formato: \"21/11/2025 08:07:46\"\n        const regex = /(\\d{2})\\/(\\d{2})\\/(\\d{4}) (\\d{2}):(\\d{2}):(\\d{2})/;\n        const match = dataStr.match(regex);\n        \n        if (match) {\n            const [, dia, mes, ano, hora, minuto, segundo] = match;\n            return new Date(ano, mes - 1, dia, hora, minuto, segundo);\n        }\n        return null;\n    } catch (error) {\n        console.error(`‚ùå Erro ao converter data ${dataStr}:`, error);\n        return null;\n    }\n}\n\n// üÜï Renderizar gr√°ficos de an√°lise\nfunction renderizarGraficos() {\n    console.log('üìä === RENDERIZAR GR√ÅFICOS INICIADO ===');\n    const container = document.getElementById('rotasGraficos');\n    \n    if (!container) {\n        console.error('‚ùå Container rotasGraficos n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        container.innerHTML = `\n            <div style=\"padding: 40px; text-align: center; color: #6b7280; font-size: 14px; background: white; border-radius: 12px;\">\n                üì≠ Nenhuma rota encontrada com os filtros selecionados\n            </div>\n        `;\n        return;\n    }\n    \n    // üÜï Enriquecer dados com BI antes de processar\n    enriquecerRotasComBI();\n    \n    // Contar rotas com dados BI\n    const rotasComBI = rotasFiltradas.filter(r => r.dadosBI).length;\n    const rotasSemBI = rotasFiltradas.length - rotasComBI;\n    \n    console.log(`üìä Rotas com dados BI: ${rotasComBI}/${rotasFiltradas.length}`);\n    \n    // üìä CALCULAR M√âDIAS POR FILIAL\n    const estatisticasFilial = {};\n    rotasFiltradas.forEach(rota => {\n        const filial = rota.filial;\n        if (!filial || filial === 'N/A') return;\n        \n        if (!estatisticasFilial[filial]) {\n            estatisticasFilial[filial] = {\n                nome: filial,\n                tempos: [],\n                somaTempos: 0,\n                totalRotas: 0,\n                comSaida: 0,\n                semSaida: 0,\n                // üÜï M√©tricas BI\n                temposExecucao: [],\n                atrasos: [],\n                taxasSucesso: [],\n                comDadosBI: 0,\n                // üéØ M√âTRICA PRINCIPAL\n                temposResposta: [], // Atribui√ß√£o ‚Üí Sa√≠da\n                dentroMeta: 0, // ‚â§5min\n                foraMeta: 0    // >5min\n            };\n        }\n        \n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        estatisticasFilial[filial].tempos.push(tempoEspera.minutos);\n        estatisticasFilial[filial].somaTempos += tempoEspera.minutos;\n        estatisticasFilial[filial].totalRotas++;\n        \n        if (tempoEspera.temSaida) {\n            estatisticasFilial[filial].comSaida++;\n        } else {\n            estatisticasFilial[filial].semSaida++;\n        }\n        \n        // üÜï Processar dados BI se dispon√≠veis\n        if (rota.dadosBI) {\n            estatisticasFilial[filial].comDadosBI++;\n            if (rota.dadosBI.tempoExecucaoMedio > 0) {\n                estatisticasFilial[filial].temposExecucao.push(rota.dadosBI.tempoExecucaoMedio);\n            }\n            if (rota.dadosBI.atrasoMedio >= 0) {\n                estatisticasFilial[filial].atrasos.push(rota.dadosBI.atrasoMedio);\n            }\n            if (rota.dadosBI.taxaSucesso > 0) {\n                estatisticasFilial[filial].taxasSucesso.push(rota.dadosBI.taxaSucesso);\n            }\n            // üéØ M√âTRICA PRINCIPAL\n            if (rota.dadosBI.tempoRespostaMotoboy !== null) {\n                estatisticasFilial[filial].temposResposta.push(rota.dadosBI.tempoRespostaMotoboy);\n                if (rota.dadosBI.dentroMeta) {\n                    estatisticasFilial[filial].dentroMeta++;\n                } else {\n                    estatisticasFilial[filial].foraMeta++;\n                }\n            }\n        }\n    });\n    \n    // Calcular m√©dias\n    Object.values(estatisticasFilial).forEach(filial => {\n        filial.media = Math.round(filial.somaTempos / filial.totalRotas);\n        // üÜï M√©tricas BI\n        filial.mediaExecucao = filial.temposExecucao.length > 0 \n            ? Math.round(filial.temposExecucao.reduce((a, b) => a + b, 0) / filial.temposExecucao.length)\n            : 0;\n        filial.mediaAtraso = filial.atrasos.length > 0\n            ? Math.round(filial.atrasos.reduce((a, b) => a + b, 0) / filial.atrasos.length)\n            : 0;\n        filial.mediaTaxaSucesso = filial.taxasSucesso.length > 0\n            ? Math.round(filial.taxasSucesso.reduce((a, b) => a + b, 0) / filial.taxasSucesso.length)\n            : 0;\n    });\n    \n    // Ordenar por m√©dia (menor primeiro = melhor)\n    const filiaisOrdenadas = Object.values(estatisticasFilial).sort((a, b) => a.media - b.media);\n    \n    // Encontrar m√°ximo para escala\n    const maxMediaFilial = Math.max(...filiaisOrdenadas.map(f => f.media));\n    const maxExecucaoFilial = Math.max(...filiaisOrdenadas.map(f => f.mediaExecucao));\n    const maxAtrasoFilial = Math.max(...filiaisOrdenadas.map(f => f.mediaAtraso));\n    \n    // üìä CALCULAR M√âDIAS POR MOTOBOY\n    const estatisticasMotoboy = {};\n    rotasFiltradas.forEach(rota => {\n        const motoboy = rota.motoboy;\n        if (!motoboy || motoboy === 'N/A') return;\n        \n        if (!estatisticasMotoboy[motoboy]) {\n            estatisticasMotoboy[motoboy] = {\n                nome: motoboy,\n                tempos: [],\n                somaTempos: 0,\n                totalRotas: 0,\n                comSaida: 0,\n                semSaida: 0,\n                filiais: new Set(),\n                // üÜï M√©tricas BI\n                temposExecucao: [],\n                atrasos: [],\n                taxasSucesso: [],\n                comDadosBI: 0,\n                tiposRota: [],\n                // üéØ M√âTRICA PRINCIPAL\n                temposResposta: [], // Atribui√ß√£o ‚Üí Sa√≠da\n                dentroMeta: 0, // ‚â§5min\n                foraMeta: 0    // >5min\n            };\n        }\n        \n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        estatisticasMotoboy[motoboy].tempos.push(tempoEspera.minutos);\n        estatisticasMotoboy[motoboy].somaTempos += tempoEspera.minutos;\n        estatisticasMotoboy[motoboy].totalRotas++;\n        estatisticasMotoboy[motoboy].filiais.add(rota.filial);\n        \n        if (tempoEspera.temSaida) {\n            estatisticasMotoboy[motoboy].comSaida++;\n        } else {\n            estatisticasMotoboy[motoboy].semSaida++;\n        }\n        \n        // üÜï Processar dados BI se dispon√≠veis\n        if (rota.dadosBI) {\n            estatisticasMotoboy[motoboy].comDadosBI++;\n            if (rota.dadosBI.tempoExecucaoMedio > 0) {\n                estatisticasMotoboy[motoboy].temposExecucao.push(rota.dadosBI.tempoExecucaoMedio);\n            }\n            if (rota.dadosBI.atrasoMedio >= 0) {\n                estatisticasMotoboy[motoboy].atrasos.push(rota.dadosBI.atrasoMedio);\n            }\n            if (rota.dadosBI.taxaSucesso > 0) {\n                estatisticasMotoboy[motoboy].taxasSucesso.push(rota.dadosBI.taxaSucesso);\n            }\n            if (rota.dadosBI.tipo) {\n                estatisticasMotoboy[motoboy].tiposRota.push(rota.dadosBI.tipo);\n            }\n            // üéØ M√âTRICA PRINCIPAL\n            if (rota.dadosBI.tempoRespostaMotoboy !== null) {\n                estatisticasMotoboy[motoboy].temposResposta.push(rota.dadosBI.tempoRespostaMotoboy);\n                if (rota.dadosBI.dentroMeta) {\n                    estatisticasMotoboy[motoboy].dentroMeta++;\n                } else {\n                    estatisticasMotoboy[motoboy].foraMeta++;\n                }\n            }\n        }\n    });\n    \n    // Calcular m√©dias\n    Object.values(estatisticasMotoboy).forEach(motoboy => {\n        motoboy.media = Math.round(motoboy.somaTempos / motoboy.totalRotas);\n        // üÜï M√©tricas BI\n        motoboy.mediaExecucao = motoboy.temposExecucao.length > 0\n            ? Math.round(motoboy.temposExecucao.reduce((a, b) => a + b, 0) / motoboy.temposExecucao.length)\n            : 0;\n        motoboy.mediaAtraso = motoboy.atrasos.length > 0\n            ? Math.round(motoboy.atrasos.reduce((a, b) => a + b, 0) / motoboy.atrasos.length)\n            : 0;\n        motoboy.mediaTaxaSucesso = motoboy.taxasSucesso.length > 0\n            ? Math.round(motoboy.taxasSucesso.reduce((a, b) => a + b, 0) / motoboy.taxasSucesso.length)\n            : 0;\n    });\n    \n    // Ordenar por m√©dia (menor primeiro = melhor)\n    const motoboysOrdenados = Object.values(estatisticasMotoboy).sort((a, b) => a.media - b.media);\n    \n    // Encontrar m√°ximo para escala\n    const maxMediaMotoboy = Math.max(...motoboysOrdenados.map(m => m.media));\n    const maxExecucaoMotoboy = Math.max(...motoboysOrdenados.map(m => m.mediaExecucao));\n    const maxAtrasoMotoboy = Math.max(...motoboysOrdenados.map(m => m.mediaAtraso));\n    \n    // üèÜ RANKING TOP 5 MOTOBOYS\n    const top5Motoboys = motoboysOrdenados.slice(0, 5);\n    \n    // üö® RANKING BOTTOM 5 MOTOBOYS\n    const bottom5Motoboys = motoboysOrdenados.slice(-5).reverse();\n    \n    // üéØ CALCULAR M√âTRICA PRINCIPAL: TEMPO DE RESPOSTA\n    const rotasComTempoResposta = rotasFiltradas.filter(r => r.dadosBI && r.dadosBI.tempoRespostaMotoboy !== null);\n    const totalDentroMeta = rotasComTempoResposta.filter(r => r.dadosBI.dentroMeta).length;\n    const totalForaMeta = rotasComTempoResposta.filter(r => !r.dadosBI.dentroMeta).length;\n    const percentualMeta = rotasComTempoResposta.length > 0 ? (totalDentroMeta / rotasComTempoResposta.length * 100) : 0;\n    \n    const temposResposta = rotasComTempoResposta.map(r => r.dadosBI.tempoRespostaMotoboy);\n    const tempoRespostaMedio = temposResposta.length > 0 ? temposResposta.reduce((a, b) => a + b, 0) / temposResposta.length : 0;\n    \n    // üìä GERAR HTML\n    container.innerHTML = `\n        <!-- üéØ M√âTRICA PRINCIPAL -->\n        ${rotasComTempoResposta.length > 0 ? `\n        <div class=\"grafico-card\" style=\"background: linear-gradient(135deg, ${tempoRespostaMedio <= 5 ? '#10b981' : '#ef4444'} 0%, ${tempoRespostaMedio <= 5 ? '#059669' : '#dc2626'} 100%); color: white; border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.2);\">\n            <h2 style=\"margin: 0 0 8px 0; font-size: 32px; font-weight: 900; text-align: center; text-transform: uppercase; letter-spacing: 2px;\">\n                üéØ M√âTRICA PRINCIPAL: TEMPO DE RESPOSTA DO MOTOBOY\n            </h2>\n            <p style=\"margin: 0 0 24px 0; text-align: center; font-size: 15px; opacity: 0.95; font-weight: 600;\">\n                ‚è±Ô∏è Tempo entre ATRIBUI√á√ÉO da rota at√© a PRIMEIRA SA√çDA &nbsp;|&nbsp; üéØ META: ‚â§ 5 MINUTOS\n            </p>\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; text-align: center;\">\n                <div style=\"background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);\">\n                    <div style=\"font-size: 48px; font-weight: 900; margin-bottom: 8px;\">${tempoRespostaMedio.toFixed(1)}</div>\n                    <div style=\"font-size: 14px; opacity: 0.95; font-weight: 700;\">‚è±Ô∏è Tempo M√©dio (min)</div>\n                    <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">${tempoRespostaMedio <= 5 ? '‚úÖ DENTRO DA META' : 'üö® FORA DA META'}</div>\n                </div>\n                <div style=\"background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);\">\n                    <div style=\"font-size: 48px; font-weight: 900; margin-bottom: 8px;\">${totalDentroMeta}</div>\n                    <div style=\"font-size: 14px; opacity: 0.95; font-weight: 700;\">‚úÖ Dentro da Meta</div>\n                    <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">‚â§ 5 minutos</div>\n                </div>\n                <div style=\"background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);\">\n                    <div style=\"font-size: 48px; font-weight: 900; margin-bottom: 8px;\">${totalForaMeta}</div>\n                    <div style=\"font-size: 14px; opacity: 0.95; font-weight: 700;\">üö® Fora da Meta</div>\n                    <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">> 5 minutos</div>\n                </div>\n                <div style=\"background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; backdrop-filter: blur(10px);\">\n                    <div style=\"font-size: 48px; font-weight: 900; margin-bottom: 8px;\">${percentualMeta.toFixed(0)}%</div>\n                    <div style=\"font-size: 14px; opacity: 0.95; font-weight: 700;\">üìä Taxa de Cumprimento</div>\n                    <div style=\"font-size: 12px; opacity: 0.8; margin-top: 4px;\">${rotasComTempoResposta.length} rotas analisadas</div>\n                </div>\n            </div>\n        </div>\n        ` : ''}\n        \n        <!-- Estat√≠sticas Gerais -->\n        <div class=\"grafico-card\" style=\"background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%); color: white;\">\n            <h2 style=\"margin: 0 0 20px 0; font-size: 24px; font-weight: 700; text-align: center;\">\n                üìä Vis√£o Geral - Todas as M√©tricas\n            </h2>\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; text-align: center;\">\n                <div>\n                    <div style=\"font-size: 40px; font-weight: 900;\">${rotasFiltradas.length}</div>\n                    <div style=\"font-size: 13px; opacity: 0.9;\">Total de Rotas</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 40px; font-weight: 900;\">${filiaisOrdenadas.length}</div>\n                    <div style=\"font-size: 13px; opacity: 0.9;\">Filiais</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 40px; font-weight: 900;\">${motoboysOrdenados.length}</div>\n                    <div style=\"font-size: 13px; opacity: 0.9;\">Motoboys</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 40px; font-weight: 900;\">${Math.round(rotasFiltradas.reduce((sum, r) => {\n                        const t = calcularTempoEspera(r.data_criacao_rota, r.updated_at, r.saida_numero);\n                        return sum + t.minutos;\n                    }, 0) / rotasFiltradas.length)}min</div>\n                    <div style=\"font-size: 13px; opacity: 0.9;\">Tempo M√©dio Espera</div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Gr√°fico por Filial -->\n        <div class=\"grafico-card\">\n            <div class=\"grafico-titulo\">üè¢ Tempo M√©dio de Espera por Filial</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Menor tempo = Melhor performance ‚Ä¢ Verde: ‚â§5min ‚Ä¢ Amarelo: 5-10min ‚Ä¢ Vermelho: >10min\n            </div>\n            ${filiaisOrdenadas.map((filial, index) => {\n                const porcentagem = (filial.media / maxMediaFilial) * 100;\n                let classeCategoria = 'rapido';\n                if (filial.media > 10) classeCategoria = 'lento';\n                else if (filial.media > 5) classeCategoria = 'moderado';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span>\n                                <span style=\"font-size: 16px; margin-right: 8px;\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üìç'}</span>\n                                <strong>${filial.nome}</strong>\n                            </span>\n                            <span style=\"color: #1890ff;\">\n                                ${filial.media} minutos\n                            </span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%\">\n                                ${filial.totalRotas} rotas\n                            </div>\n                        </div>\n                        <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                            <span>‚úÖ Com Sa√≠da: ${filial.comSaida}</span>\n                            <span>‚è≥ Sem Sa√≠da: ${filial.semSaida}</span>\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        \n        <!-- üéØ GR√ÅFICO DE TEMPO DE RESPOSTA POR FILIAL (M√âTRICA PRINCIPAL) -->\n        ${rotasComTempoResposta.length > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #8b5cf6; background: linear-gradient(135deg, #faf5ff 0%, white 100%);\">\n            <div class=\"grafico-titulo\" style=\"color: #8b5cf6;\">üéØ Tempo de Resposta por Filial (Atribui√ß√£o ‚Üí Primeira Sa√≠da)</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                ‚ö° <strong>META: ‚â§ 5 MINUTOS</strong> ‚Ä¢ Verde: ‚â§5min (Dentro da Meta) ‚Ä¢ Vermelho: >5min (Fora da Meta)\n            </div>\n            ${(() => {\n                // Calcular m√©dias de tempo de resposta por filial\n                const filialComResposta = Object.values(estatisticasFilial)\n                    .filter(f => f.temposResposta.length > 0)\n                    .map(f => ({\n                        ...f,\n                        mediaResposta: f.temposResposta.reduce((a, b) => a + b, 0) / f.temposResposta.length\n                    }))\n                    .sort((a, b) => a.mediaResposta - b.mediaResposta);\n                \n                const maxResposta = Math.max(...filialComResposta.map(f => f.mediaResposta));\n                \n                return filialComResposta.map((filial, index) => {\n                    const porcentagem = (filial.mediaResposta / maxResposta) * 100;\n                    const dentroMeta = filial.mediaResposta <= 5;\n                    \n                    return `\n                        <div class=\"grafico-item\">\n                            <div class=\"grafico-label\">\n                                <span>\n                                    <span style=\"font-size: 16px; margin-right: 8px;\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üìç'}</span>\n                                    <strong>${filial.nome}</strong>\n                                    ${dentroMeta ? '<span style=\"color: #10b981; font-size: 12px; margin-left: 8px;\">‚úÖ META</span>' : '<span style=\"color: #ef4444; font-size: 12px; margin-left: 8px;\">üö® FORA</span>'}\n                                </span>\n                                <span style=\"color: ${dentroMeta ? '#10b981' : '#ef4444'}; font-weight: 700;\">\n                                    ${filial.mediaResposta.toFixed(1)} min\n                                </span>\n                            </div>\n                            <div class=\"grafico-barra-container\">\n                                <div class=\"grafico-barra ${dentroMeta ? 'rapido' : 'lento'}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, ${dentroMeta ? '#10b981, #34d399' : '#ef4444, #f87171'});\">\n                                    ‚úÖ ${filial.dentroMeta} | üö® ${filial.foraMeta}\n                                </div>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                                <span>üìä ${filial.temposResposta.length} rotas analisadas</span>\n                                <span>Taxa: ${filial.temposResposta.length > 0 ? ((filial.dentroMeta / filial.temposResposta.length) * 100).toFixed(0) : 0}% na meta</span>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            })()}\n        </div>\n        ` : ''}\n        \n        <!-- üÜï Gr√°fico de Tempo de Execu√ß√£o por Filial -->\n        ${rotasComBI > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #10b981;\">\n            <div class=\"grafico-titulo\" style=\"color: #10b981; border-color: #10b981;\">‚è±Ô∏è Tempo M√©dio de Execu√ß√£o por Filial (Sa√≠da ‚Üí Entrega)</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Tempo real de execu√ß√£o das entregas ‚Ä¢ Dados de ${rotasComBI} rotas executadas\n            </div>\n            ${filiaisOrdenadas.filter(f => f.mediaExecucao > 0).map((filial, index) => {\n                const porcentagem = (filial.mediaExecucao / maxExecucaoFilial) * 100;\n                let classeCategoria = 'rapido';\n                if (filial.mediaExecucao > 30) classeCategoria = 'lento';\n                else if (filial.mediaExecucao > 20) classeCategoria = 'moderado';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span><strong>${filial.nome}</strong></span>\n                            <span style=\"color: #10b981;\">${filial.mediaExecucao} minutos</span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, #10b981, #34d399);\">\n                                ${filial.comDadosBI} rotas\n                            </div>\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        ` : ''}\n        \n        <!-- üÜï Gr√°fico de Atrasos por Filial -->\n        ${rotasComBI > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #ef4444;\">\n            <div class=\"grafico-titulo\" style=\"color: #ef4444; border-color: #ef4444;\">üö® Atraso M√©dio por Filial</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Minutos de atraso m√©dio nas entregas ‚Ä¢ Menor √© melhor\n            </div>\n            ${filiaisOrdenadas.filter(f => f.atrasos.length > 0).sort((a, b) => b.mediaAtraso - a.mediaAtraso).map((filial, index) => {\n                const porcentagem = maxAtrasoFilial > 0 ? (filial.mediaAtraso / maxAtrasoFilial) * 100 : 0;\n                let classeCategoria = filial.mediaAtraso <= 5 ? 'rapido' : filial.mediaAtraso <= 15 ? 'moderado' : 'lento';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span><strong>${filial.nome}</strong></span>\n                            <span style=\"color: ${filial.mediaAtraso > 15 ? '#ef4444' : filial.mediaAtraso > 5 ? '#f59e0b' : '#10b981'};\">\n                                ${filial.mediaAtraso > 0 ? '+' : ''}${filial.mediaAtraso} min\n                            </span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, #ef4444, #f87171);\">\n                                ${filial.comDadosBI} rotas\n                            </div>\n                        </div>\n                        <div style=\"font-size: 10px; color: #6b7280; margin-top: 4px;\">\n                            Taxa de sucesso: ${filial.mediaTaxaSucesso}%\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        ` : ''}\n        \n        <!-- Gr√°fico por Motoboy -->\n        <div class=\"grafico-card\">\n            <div class=\"grafico-titulo\">üèçÔ∏è Tempo M√©dio de Espera por Motoboy</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Menor tempo = Melhor performance ‚Ä¢ Ordenado do melhor ao pior\n            </div>\n            ${motoboysOrdenados.map((motoboy, index) => {\n                const porcentagem = (motoboy.media / maxMediaMotoboy) * 100;\n                let classeCategoria = 'rapido';\n                if (motoboy.media > 10) classeCategoria = 'lento';\n                else if (motoboy.media > 5) classeCategoria = 'moderado';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span>\n                                <span style=\"font-size: 16px; margin-right: 8px;\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèçÔ∏è'}</span>\n                                <strong>${motoboy.nome}</strong>\n                            </span>\n                            <span style=\"color: #1890ff;\">\n                                ${motoboy.media} minutos\n                            </span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%\">\n                                ${motoboy.totalRotas} rotas\n                            </div>\n                        </div>\n                        <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                            <span>üìç Filiais: ${motoboy.filiais.size}</span>\n                            <span>‚úÖ ${motoboy.comSaida} | ‚è≥ ${motoboy.semSaida}</span>\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        \n        <!-- üéØ GR√ÅFICO DE TEMPO DE RESPOSTA POR MOTOBOY (M√âTRICA PRINCIPAL) -->\n        ${rotasComTempoResposta.length > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #8b5cf6; background: linear-gradient(135deg, #faf5ff 0%, white 100%);\">\n            <div class=\"grafico-titulo\" style=\"color: #8b5cf6;\">üéØ Tempo de Resposta por Motoboy (Atribui√ß√£o ‚Üí Primeira Sa√≠da)</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                ‚ö° <strong>META: ‚â§ 5 MINUTOS</strong> ‚Ä¢ Ranking dos mais r√°pidos ‚Ä¢ Verde: ‚â§5min (Dentro da Meta) ‚Ä¢ Vermelho: >5min (Fora da Meta)\n            </div>\n            ${(() => {\n                // Calcular m√©dias de tempo de resposta por motoboy\n                const motoboyComResposta = Object.values(estatisticasMotoboy)\n                    .filter(m => m.temposResposta.length > 0)\n                    .map(m => ({\n                        ...m,\n                        mediaResposta: m.temposResposta.reduce((a, b) => a + b, 0) / m.temposResposta.length\n                    }))\n                    .sort((a, b) => a.mediaResposta - b.mediaResposta);\n                \n                const maxResposta = Math.max(...motoboyComResposta.map(m => m.mediaResposta));\n                \n                return motoboyComResposta.slice(0, 20).map((motoboy, index) => {\n                    const porcentagem = (motoboy.mediaResposta / maxResposta) * 100;\n                    const dentroMeta = motoboy.mediaResposta <= 5;\n                    \n                    return `\n                        <div class=\"grafico-item\">\n                            <div class=\"grafico-label\">\n                                <span>\n                                    <span style=\"font-size: 16px; margin-right: 8px;\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '‚ö°'}</span>\n                                    <strong>${motoboy.nome}</strong>\n                                    ${dentroMeta ? '<span style=\"color: #10b981; font-size: 12px; margin-left: 8px;\">‚úÖ META</span>' : '<span style=\"color: #ef4444; font-size: 12px; margin-left: 8px;\">üö® FORA</span>'}\n                                </span>\n                                <span style=\"color: ${dentroMeta ? '#10b981' : '#ef4444'}; font-weight: 700;\">\n                                    ${motoboy.mediaResposta.toFixed(1)} min\n                                </span>\n                            </div>\n                            <div class=\"grafico-barra-container\">\n                                <div class=\"grafico-barra ${dentroMeta ? 'rapido' : 'lento'}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, ${dentroMeta ? '#10b981, #34d399' : '#ef4444, #f87171'});\">\n                                    ‚úÖ ${motoboy.dentroMeta} | üö® ${motoboy.foraMeta}\n                                </div>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                                <span>üìä ${motoboy.temposResposta.length} rotas | ${motoboy.filiais.size} filiais</span>\n                                <span>Taxa: ${motoboy.temposResposta.length > 0 ? ((motoboy.dentroMeta / motoboy.temposResposta.length) * 100).toFixed(0) : 0}% na meta</span>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            })()}\n            ${(() => {\n                // Contar quantos est√£o ocultos\n                const motoboyComResposta = Object.values(estatisticasMotoboy)\n                    .filter(m => m.temposResposta.length > 0);\n                const ocultos = motoboyComResposta.length - 20;\n                \n                if (ocultos > 0) {\n                    return `<div style=\"text-align: center; padding: 12px; color: #6b7280; font-size: 13px; font-style: italic;\">\n                        ... e mais ${ocultos} motoboy${ocultos > 1 ? 's' : ''} n√£o exibido${ocultos > 1 ? 's' : ''}\n                    </div>`;\n                }\n                return '';\n            })()}\n        </div>\n        ` : ''}\n        \n        <!-- Ranking Top 5 -->\n        <div class=\"grafico-card\">\n            <div class=\"grafico-titulo\">üèÜ Top 5 Motoboys - Melhor Desempenho (Tempo de Espera)</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Motoboys com menor tempo m√©dio de espera (mais r√°pidos)\n            </div>\n            ${top5Motoboys.map((motoboy, index) => {\n                let classeRanking = index === 0 ? 'ouro' : index === 1 ? 'prata' : index === 2 ? 'bronze' : '';\n                let emoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}¬∫`;\n                \n                return `\n                    <div class=\"ranking-card ${classeRanking}\">\n                        <div class=\"ranking-posicao\">${emoji}</div>\n                        <div class=\"ranking-info\">\n                            <div class=\"ranking-nome\">${motoboy.nome}</div>\n                            <div class=\"ranking-detalhes\">\n                                ${motoboy.totalRotas} rotas ‚Ä¢ ${motoboy.filiais.size} filiais ‚Ä¢ ${motoboy.comSaida} atribu√≠das\n                            </div>\n                        </div>\n                        <div class=\"ranking-tempo\">${motoboy.media}min</div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        \n        <!-- üÜï Gr√°fico de Tempo de Execu√ß√£o por Motoboy -->\n        ${rotasComBI > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #10b981;\">\n            <div class=\"grafico-titulo\" style=\"color: #10b981; border-color: #10b981;\">‚ö° Tempo M√©dio de Execu√ß√£o por Motoboy</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Motoboys mais r√°pidos na execu√ß√£o das entregas ‚Ä¢ Dados de ${rotasComBI} rotas\n            </div>\n            ${motoboysOrdenados.filter(m => m.mediaExecucao > 0).sort((a, b) => a.mediaExecucao - b.mediaExecucao).map((motoboy, index) => {\n                const porcentagem = (motoboy.mediaExecucao / maxExecucaoMotoboy) * 100;\n                let classeCategoria = motoboy.mediaExecucao <= 20 ? 'rapido' : motoboy.mediaExecucao <= 30 ? 'moderado' : 'lento';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span>\n                                ${index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : '‚ö°'} <strong>${motoboy.nome}</strong>\n                            </span>\n                            <span style=\"color: #10b981;\">${motoboy.mediaExecucao} min</span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, #10b981, #34d399);\">\n                                ${motoboy.comDadosBI} rotas\n                            </div>\n                        </div>\n                        <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                            <span>Sucesso: ${motoboy.mediaTaxaSucesso}%</span>\n                            <span>Atraso: ${motoboy.mediaAtraso}min</span>\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        ` : ''}\n        \n        <!-- üÜï Gr√°fico de Atrasos por Motoboy -->\n        ${rotasComBI > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #ef4444;\">\n            <div class=\"grafico-titulo\" style=\"color: #ef4444; border-color: #ef4444;\">üö® Ranking de Atrasos por Motoboy</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Motoboys com maior atraso m√©dio ‚Ä¢ Do pior ao melhor\n            </div>\n            ${motoboysOrdenados.filter(m => m.atrasos.length > 0).sort((a, b) => b.mediaAtraso - a.mediaAtraso).map((motoboy, index) => {\n                const porcentagem = maxAtrasoMotoboy > 0 ? (motoboy.mediaAtraso / maxAtrasoMotoboy) * 100 : 0;\n                let classeCategoria = motoboy.mediaAtraso <= 5 ? 'rapido' : motoboy.mediaAtraso <= 15 ? 'moderado' : 'lento';\n                \n                return `\n                    <div class=\"grafico-item\">\n                        <div class=\"grafico-label\">\n                            <span><strong>${motoboy.nome}</strong></span>\n                            <span style=\"color: ${motoboy.mediaAtraso > 15 ? '#ef4444' : motoboy.mediaAtraso > 5 ? '#f59e0b' : '#10b981'}; font-weight: 900;\">\n                                ${motoboy.mediaAtraso > 0 ? '+' : ''}${motoboy.mediaAtraso} min\n                            </span>\n                        </div>\n                        <div class=\"grafico-barra-container\">\n                            <div class=\"grafico-barra ${classeCategoria}\" style=\"width: ${porcentagem}%; background: linear-gradient(90deg, #ef4444, #f87171);\">\n                                ${motoboy.comDadosBI} rotas\n                            </div>\n                        </div>\n                        <div style=\"display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px; color: #6b7280;\">\n                            <span>üìç ${motoboy.filiais.size} filiais</span>\n                            <span>‚úÖ ${motoboy.mediaTaxaSucesso}% sucesso</span>\n                        </div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        ` : ''}\n        \n        <!-- üÜï An√°lise por Tipo de Rota -->\n        ${rotasComBI > 0 ? `\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #8b5cf6;\">\n            <div class=\"grafico-titulo\" style=\"color: #8b5cf6; border-color: #8b5cf6;\">üìã An√°lise por Tipo de Rota</div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Comparativo de desempenho entre tipos de rota\n            </div>\n            ${(() => {\n                // Agrupar por tipo\n                const porTipo = {};\n                rotasFiltradas.filter(r => r.dadosBI).forEach(rota => {\n                    const tipo = rota.dadosBI.tipo || 'N/A';\n                    if (!porTipo[tipo]) {\n                        porTipo[tipo] = {\n                            tipo,\n                            count: 0,\n                            temposExec: [],\n                            atrasos: [],\n                            taxas: []\n                        };\n                    }\n                    porTipo[tipo].count++;\n                    if (rota.dadosBI.tempoExecucaoMedio > 0) {\n                        porTipo[tipo].temposExec.push(rota.dadosBI.tempoExecucaoMedio);\n                    }\n                    if (rota.dadosBI.atrasoMedio >= 0) {\n                        porTipo[tipo].atrasos.push(rota.dadosBI.atrasoMedio);\n                    }\n                    if (rota.dadosBI.taxaSucesso > 0) {\n                        porTipo[tipo].taxas.push(rota.dadosBI.taxaSucesso);\n                    }\n                });\n                \n                // Calcular m√©dias\n                Object.values(porTipo).forEach(tipo => {\n                    tipo.mediaExec = tipo.temposExec.length > 0 \n                        ? Math.round(tipo.temposExec.reduce((a,b) => a+b, 0) / tipo.temposExec.length)\n                        : 0;\n                    tipo.mediaAtraso = tipo.atrasos.length > 0\n                        ? Math.round(tipo.atrasos.reduce((a,b) => a+b, 0) / tipo.atrasos.length)\n                        : 0;\n                    tipo.mediaTaxa = tipo.taxas.length > 0\n                        ? Math.round(tipo.taxas.reduce((a,b) => a+b, 0) / tipo.taxas.length)\n                        : 0;\n                });\n                \n                const tipos = Object.values(porTipo).sort((a, b) => b.count - a.count);\n                const maxCount = Math.max(...tipos.map(t => t.count));\n                \n                return tipos.map(tipo => `\n                    <div style=\"background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 12px;\">\n                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n                            <div>\n                                <div style=\"font-size: 18px; font-weight: 900; color: #8b5cf6;\">${tipo.tipo}</div>\n                                <div style=\"font-size: 12px; color: #6b7280;\">${tipo.count} rotas executadas</div>\n                            </div>\n                            <div style=\"text-align: right;\">\n                                <div style=\"font-size: 28px; font-weight: 900; color: #1890ff;\">${tipo.mediaTaxa}%</div>\n                                <div style=\"font-size: 11px; color: #6b7280;\">Taxa de Sucesso</div>\n                            </div>\n                        </div>\n                        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px;\">\n                            <div style=\"text-align: center; padding: 12px; background: #f0f9ff; border-radius: 8px;\">\n                                <div style=\"font-size: 20px; font-weight: 800; color: #10b981;\">${tipo.mediaExec}min</div>\n                                <div style=\"font-size: 10px; color: #6b7280;\">Tempo Execu√ß√£o</div>\n                            </div>\n                            <div style=\"text-align: center; padding: 12px; background: ${tipo.mediaAtraso > 10 ? '#fef2f2' : '#f9fafb'}; border-radius: 8px;\">\n                                <div style=\"font-size: 20px; font-weight: 800; color: ${tipo.mediaAtraso > 10 ? '#ef4444' : '#f59e0b'};\">${tipo.mediaAtraso}min</div>\n                                <div style=\"font-size: 10px; color: #6b7280;\">Atraso M√©dio</div>\n                            </div>\n                        </div>\n                    </div>\n                `).join('');\n            })()}\n        </div>\n        ` : ''}\n        \n        <!-- Ranking Bottom 5 -->\n        <div class=\"grafico-card\" style=\"border-top: 4px solid #ef4444;\">\n            <div class=\"grafico-titulo\" style=\"color: #ef4444; border-color: #ef4444;\">\n                üö® Bottom 5 - Necessita Aten√ß√£o\n            </div>\n            <div style=\"font-size: 12px; color: #6b7280; margin-bottom: 20px;\">\n                Motoboys com maior tempo m√©dio de espera (mais lentos)\n            </div>\n            ${bottom5Motoboys.map((motoboy, index) => {\n                return `\n                    <div class=\"ranking-card\" style=\"border-color: #ef4444; background: linear-gradient(135deg, #fef2f2 0%, white 100%);\">\n                        <div class=\"ranking-posicao\" style=\"color: #ef4444;\">${motoboysOrdenados.length - index}</div>\n                        <div class=\"ranking-info\">\n                            <div class=\"ranking-nome\">${motoboy.nome}</div>\n                            <div class=\"ranking-detalhes\">\n                                ${motoboy.totalRotas} rotas ‚Ä¢ ${motoboy.filiais.size} filiais ‚Ä¢ ${motoboy.comSaida} atribu√≠das\n                            </div>\n                        </div>\n                        <div class=\"ranking-tempo\" style=\"color: #ef4444;\">${motoboy.media}min</div>\n                    </div>\n                `;\n            }).join('')}\n        </div>\n        \n        <!-- Explica√ß√£o -->\n        <div class=\"grafico-card\" style=\"background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-left: 4px solid #8b5cf6;\">\n            <div style=\"font-size: 16px; font-weight: 900; color: #6b21a8; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px;\">\n                üí° Como Interpretar os Gr√°ficos:\n            </div>\n            <div style=\"font-size: 13px; color: #78350f; line-height: 2.0;\">\n                <div style=\"background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #8b5cf6;\">\n                    <strong style=\"font-size: 15px; color: #6b21a8;\">üéØ M√âTRICA PRINCIPAL - TEMPO DE RESPOSTA DO MOTOBOY:</strong><br>\n                    <div style=\"margin-top: 8px; padding-left: 12px;\">\n                        ‚Ä¢ <strong>O QUE √â:</strong> Tempo entre a <strong>ATRIBUI√á√ÉO</strong> da rota e a <strong>PRIMEIRA SA√çDA</strong> (primeiro pedido)<br>\n                        ‚Ä¢ <strong>META:</strong> ‚â§ <strong style=\"color: #8b5cf6;\">5 MINUTOS</strong><br>\n                        ‚Ä¢ <strong>PROP√ìSITO:</strong> Medir a agilidade do motoboy em iniciar a rota ap√≥s atribui√ß√£o<br>\n                        ‚Ä¢ <strong>‚úÖ Verde (‚â§5min):</strong> Dentro da meta - Excelente resposta<br>\n                        ‚Ä¢ <strong>üö® Vermelho (>5min):</strong> Fora da meta - Requer aten√ß√£o<br>\n                        ‚Ä¢ <strong>DISPON√çVEL:</strong> Apenas para rotas com dados BI (${rotasComTempoResposta.length} rotas)\n                    </div>\n                </div>\n                \n                <strong style=\"font-size: 14px;\">üìä M√©tricas Secund√°rias:</strong><br>\n                <div style=\"padding-left: 12px; margin-top: 8px;\">\n                    ‚Ä¢ <strong>Tempo de Espera</strong>: Per√≠odo entre cria√ß√£o e atribui√ß√£o da rota<br>\n                    ‚Ä¢ <strong>Tempo de Execu√ß√£o</strong>: Per√≠odo entre sa√≠da e entrega (dados de ${rotasComBI} rotas)<br>\n                    ‚Ä¢ <strong>Atraso M√©dio</strong>: Minutos de atraso em rela√ß√£o ao previsto<br>\n                    ‚Ä¢ <strong>Taxa de Sucesso</strong>: Percentual de pedidos entregues com sucesso<br>\n                    ‚Ä¢ <strong>Tipo de Rota</strong>: FIXA, IMEDIATA, ou outros tipos\n                </div><br>\n                \n                <strong style=\"font-size: 14px;\">üìà Rankings e Visualiza√ß√µes:</strong><br>\n                <div style=\"padding-left: 12px; margin-top: 8px;\">\n                    ‚Ä¢ ü•áü•àü•â <strong>Medalhas:</strong> 3 melhores desempenhos em cada categoria<br>\n                    ‚Ä¢ <strong>Gr√°ficos por Filial:</strong> Comparativo de desempenho entre unidades<br>\n                    ‚Ä¢ <strong>Gr√°ficos por Motoboy:</strong> Top 20 mais r√°pidos + Bottom 5 que precisam aten√ß√£o<br>\n                    ‚Ä¢ <strong>An√°lise por Tipo:</strong> Comparativo entre rotas FIXAS vs IMEDIATAS\n                </div><br>\n                \n                <strong style=\"font-size: 14px;\">üîç Valida√ß√µes e Status:</strong><br>\n                <div style=\"padding-left: 12px; margin-top: 8px;\">\n                    ‚Ä¢ <strong>Com Sa√≠da ID:</strong> Rotas j√° atribu√≠das e validadas<br>\n                    ‚Ä¢ <strong>Sem Sa√≠da ID:</strong> Rotas pendentes de atribui√ß√£o<br>\n                    ‚Ä¢ <strong>Com Dados BI:</strong> Rotas executadas com m√©tricas completas (${rotasComBI} no total)\n                </div>\n            </div>\n        </div>\n    `;\n    \n    console.log('‚úÖ Gr√°ficos renderizados com sucesso!');\n    console.log('üìä Estat√≠sticas:', {\n        filiais: filiaisOrdenadas.length,\n        motoboys: motoboysOrdenados.length,\n        melhorFilial: filiaisOrdenadas[0]?.nome,\n        melhorMotoboy: motoboysOrdenados[0]?.nome\n    });\n}\n\n// üÜï Renderizar tabela de tempo de espera\nfunction renderizarTempoEspera() {\n    console.log('‚è±Ô∏è Renderizando an√°lise de tempo de espera...', rotasFiltradas.length);\n    const tempoEsperaBody = document.getElementById('rotasTempoEsperaBody');\n    \n    if (!tempoEsperaBody) {\n        console.error('‚ùå Elemento rotasTempoEsperaBody n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        console.log('üì≠ Nenhuma rota para exibir na an√°lise');\n        tempoEsperaBody.innerHTML = `\n            <div style=\"padding: 40px; text-align: center; color: #6b7280; font-size: 14px;\">\n                üì≠ Nenhuma rota encontrada com os filtros selecionados\n            </div>\n        `;\n        return;\n    }\n    \n    // Ordenar rotas por tempo de espera (maior primeiro)\n    const rotasOrdenadas = [...rotasFiltradas].sort((a, b) => {\n        const tempoA = calcularTempoEspera(a.data_criacao_rota, a.updated_at, a.saida_numero);\n        const tempoB = calcularTempoEspera(b.data_criacao_rota, b.updated_at, b.saida_numero);\n        return tempoB.total - tempoA.total; // Decrescente\n    });\n    \n    // Calcular estat√≠sticas\n    let totalRapido = 0; // <= 5min\n    let totalModerado = 0; // 5-10min\n    let totalLento = 0; // > 10min\n    let somaTempos = 0;\n    let menorTempo = Infinity;\n    let maiorTempo = 0;\n    \n    rotasOrdenadas.forEach(rota => {\n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        somaTempos += tempoEspera.minutos;\n        \n        if (tempoEspera.minutos < menorTempo) menorTempo = tempoEspera.minutos;\n        if (tempoEspera.minutos > maiorTempo) maiorTempo = tempoEspera.minutos;\n        \n        if (tempoEspera.minutos <= 5) {\n            totalRapido++;\n        } else if (tempoEspera.minutos <= 10) {\n            totalModerado++;\n        } else {\n            totalLento++;\n        }\n    });\n    \n    const mediaTempo = rotasOrdenadas.length > 0 ? Math.round(somaTempos / rotasOrdenadas.length) : 0;\n    \n    // ‚úÖ Contar rotas com e sem saida_numero\n    let rotasComSaida = 0;\n    let rotasSemSaida = 0;\n    \n    rotasOrdenadas.forEach(rota => {\n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        if (tempoEspera.temSaida) {\n            rotasComSaida++;\n        } else {\n            rotasSemSaida++;\n        }\n    });\n    \n    // Gerar resumo estat√≠stico com explica√ß√µes detalhadas\n    const resumoHTML = `\n        <div style=\"background: white; padding: 24px; margin-bottom: 16px; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.12); border-top: 4px solid #3b82f6;\">\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;\">\n                <div>\n                    <h3 style=\"margin: 0; font-size: 24px; color: #1f2937; font-weight: 900;\">üìä Resumo Estat√≠stico - Tempo de Espera</h3>\n                    <p style=\"margin: 4px 0 0 0; font-size: 13px; color: #6b7280;\">Tempo entre a cria√ß√£o da rota e sua atribui√ß√£o ao motoboy</p>\n                </div>\n                <div style=\"text-align: right;\">\n                    <div style=\"font-size: 14px; font-weight: 600; color: #3b82f6;\">\n                        ‚úÖ Com Sa√≠da ID: <span style=\"font-size: 20px; font-weight: 900;\">${rotasComSaida}</span>\n                    </div>\n                    <div style=\"font-size: 14px; font-weight: 600; color: #f59e0b;\">\n                        ‚è≥ Sem Sa√≠da ID: <span style=\"font-size: 20px; font-weight: 900;\">${rotasSemSaida}</span>\n                    </div>\n                </div>\n            </div>\n            \n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 20px;\">\n                <div style=\"text-align: center; padding: 20px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; border: 3px solid #3b82f6; box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);\">\n                    <div style=\"font-size: 40px; font-weight: 900; color: #3b82f6; line-height: 1;\">${mediaTempo}min</div>\n                    <div style=\"font-size: 13px; font-weight: 700; color: #1e40af; text-transform: uppercase; margin-top: 8px;\">‚è±Ô∏è Tempo M√©dio de Espera</div>\n                    <div style=\"font-size: 11px; color: #64748b; margin-top: 6px;\">M√©dia do tempo at√© atribui√ß√£o</div>\n                </div>\n                <div style=\"text-align: center; padding: 20px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-radius: 12px; border: 3px solid #10b981; box-shadow: 0 4px 8px rgba(16, 185, 129, 0.2);\">\n                    <div style=\"font-size: 40px; font-weight: 900; color: #10b981; line-height: 1;\">${menorTempo === Infinity ? 0 : menorTempo}min</div>\n                    <div style=\"font-size: 13px; font-weight: 700; color: #065f46; text-transform: uppercase; margin-top: 8px;\">‚úÖ Menor Tempo</div>\n                    <div style=\"font-size: 11px; color: #64748b; margin-top: 6px;\">Atribui√ß√£o mais r√°pida</div>\n                </div>\n                <div style=\"text-align: center; padding: 20px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-radius: 12px; border: 3px solid #ef4444; box-shadow: 0 4px 8px rgba(239, 68, 68, 0.2);\">\n                    <div style=\"font-size: 40px; font-weight: 900; color: #ef4444; line-height: 1;\">${maiorTempo}min</div>\n                    <div style=\"font-size: 13px; font-weight: 700; color: #991b1b; text-transform: uppercase; margin-top: 8px;\">üö® Maior Tempo</div>\n                    <div style=\"font-size: 11px; color: #64748b; margin-top: 6px;\">Atribui√ß√£o mais demorada</div>\n                </div>\n            </div>\n            \n            <div style=\"background: #f9fafb; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 16px;\">\n                <div style=\"font-size: 13px; font-weight: 700; color: #374151; margin-bottom: 12px; text-transform: uppercase;\">üìã Classifica√ß√£o por Velocidade:</div>\n                <div style=\"display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;\">\n                    <div class=\"tempo-espera-badge tempo-espera-rapido\">\n                        ‚úÖ R√°pido (‚â§5min): <strong>${totalRapido}</strong> rotas\n                    </div>\n                    <div class=\"tempo-espera-badge tempo-espera-moderado\">\n                        ‚ö†Ô∏è Moderado (5-10min): <strong>${totalModerado}</strong> rotas\n                    </div>\n                    <div class=\"tempo-espera-badge tempo-espera-lento\">\n                        üö® Lento (>10min): <strong>${totalLento}</strong> rotas\n                    </div>\n                </div>\n            </div>\n            \n            <div style=\"background: #fffbeb; padding: 12px 16px; border-radius: 8px; border-left: 4px solid #f59e0b; font-size: 12px; color: #92400e;\">\n                <strong>üí° Como interpretar:</strong><br>\n                ‚Ä¢ <strong>Tempo de Espera</strong>: Per√≠odo entre a cria√ß√£o da rota e sua atribui√ß√£o ao motoboy (preenchimento do Sa√≠da ID)<br>\n                ‚Ä¢ <strong>Com Sa√≠da ID</strong>: Rotas que j√° foram atribu√≠das (t√™m saida_numero preenchido)<br>\n                ‚Ä¢ <strong>Sem Sa√≠da ID</strong>: Rotas ainda aguardando atribui√ß√£o (pendentes)<br>\n                ‚Ä¢ <strong>R√°pido/Moderado/Lento</strong>: Classifica√ß√£o baseada no tempo de resposta da opera√ß√£o\n            </div>\n        </div>\n    `;\n    \n    tempoEsperaBody.innerHTML = resumoHTML + rotasOrdenadas.map((rota, index) => {\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const tempoEspera = calcularTempoEspera(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        \n        const isPendente = tempo.isPendente;\n        const sessionIdCurto = rota.session_id.substring(0, 8);\n        \n        // Cor baseada no tempo de espera\n        let corEspera = '#10b981'; // Verde (r√°pido)\n        let bgEspera = '#ecfdf5';\n        if (tempoEspera.minutos > 10) {\n            corEspera = '#ef4444'; // Vermelho (demorado)\n            bgEspera = '#fef2f2';\n        } else if (tempoEspera.minutos > 5) {\n            corEspera = '#f59e0b'; // Amarelo (moderado)\n            bgEspera = '#fffbeb';\n        }\n        \n        const statusText = isPendente ? '‚è≥ Aguardando' : '‚úÖ Atribu√≠da';\n        const statusColor = isPendente ? '#f59e0b' : '#10b981';\n        \n        // ‚úÖ VALIDA√á√ÉO: Exibir saida_numero ou indicar que est√° vazio\n        const saidaIdDisplay = rota.saida_numero \n            ? `<span style=\"font-weight: 700; color: #10b981;\">${rota.saida_numero}</span>` \n            : `<span style=\"font-weight: 600; color: #ef4444;\">SEM SA√çDA</span>`;\n        \n        return `\n            <div class=\"lista-item\" style=\"border-left: 4px solid ${corEspera}; background: ${bgEspera}; grid-template-columns: 120px 180px 100px 140px 90px 90px 100px 120px 100px;\">\n                <div style=\"font-weight: 700; color: #1890ff;\">\n                    <span class=\"filial-badge\" style=\"font-size: 9px; padding: 2px 6px;\">${rota.filial}</span>\n                    <div style=\"margin-top: 4px;\">#${sessionIdCurto}</div>\n                </div>\n                <div style=\"font-size: 10px; font-weight: 600; color: #374151;\">\n                    ${rota.rota_cliente || 'Sem nome'}\n                </div>\n                <div style=\"text-align: center; font-weight: 600; font-size: 11px;\">${rota.filial}</div>\n                <div style=\"font-weight: 600; font-size: 11px;\">${rota.motoboy}</div>\n                <div style=\"font-size: 10px; text-align: center;\">\n                    ${new Date(rota.data_criacao_rota).toLocaleTimeString('pt-BR')}\n                </div>\n                <div style=\"font-size: 10px; text-align: center;\">\n                    ${isPendente ? '<span style=\"color: #f59e0b; font-weight: 600;\">‚è≥ Pendente</span>' : new Date(rota.updated_at).toLocaleTimeString('pt-BR')}\n                </div>\n                <div style=\"font-size: 11px; text-align: center;\">\n                    ${saidaIdDisplay}\n                </div>\n                <div style=\"font-family: 'Courier New', monospace; font-weight: 900; font-size: 16px; color: ${corEspera}; text-align: center;\">\n                    ${tempoEspera.formatted}\n                </div>\n                <div style=\"text-align: center;\">\n                    <span style=\"padding: 4px 8px; background: ${statusColor}22; color: ${statusColor}; border-radius: 4px; font-size: 10px; font-weight: 700;\">\n                        ${statusText}\n                    </span>\n                </div>\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ An√°lise de tempo de espera renderizada!');\n    \n    // Atualizar estat√≠sticas por filial\n    atualizarStatsFilial();\n}\n\n// üìã Renderizar Auditoria de Rotas Atribu√≠das com Tempo de Resposta\nfunction renderizarAuditoria() {\n    console.log('üìã === RENDERIZAR AUDITORIA INICIADO ===');\n    const auditoriaBody = document.getElementById('rotasAuditoriaBody');\n    const auditoriaContainer = document.getElementById('rotasAuditoria');\n    \n    if (!auditoriaBody) {\n        console.error('‚ùå Elemento rotasAuditoriaBody n√£o encontrado!');\n        return;\n    }\n    \n    // üÜï Enriquecer dados com BI antes de processar\n    enriquecerRotasComBI();\n    \n    // Filtrar apenas rotas que t√™m tempo de resposta calculado (atribu√≠das + com dados BI)\n    const rotasParaAuditoria = rotasFiltradas.filter(rota => {\n        return rota.dadosBI && rota.dadosBI.tempoRespostaMotoboy !== null;\n    });\n    \n    console.log(`üìä Total de rotas para auditoria: ${rotasParaAuditoria.length}`);\n    \n    if (rotasParaAuditoria.length === 0) {\n        auditoriaBody.innerHTML = `\n            <tr>\n                <td colspan=\"10\" style=\"padding: 60px 20px; text-align: center; color: #6b7280; font-size: 14px;\">\n                    <div style=\"font-size: 48px; margin-bottom: 16px;\">üì≠</div>\n                    <div style=\"font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #374151;\">Nenhuma Rota Dispon√≠vel para Auditoria</div>\n                    <div style=\"font-size: 13px; color: #6b7280;\">\n                        Rotas com tempo de resposta calculado aparecer√£o aqui.<br>\n                        Necess√°rio: rotas atribu√≠das + dados de execu√ß√£o (rotas_bi_motoboy)\n                    </div>\n                </td>\n            </tr>\n        `;\n        return;\n    }\n    \n    // Ordenar por tempo de resposta (maior primeiro = mais cr√≠tico)\n    const rotasOrdenadas = [...rotasParaAuditoria].sort((a, b) => {\n        return b.dadosBI.tempoRespostaMotoboy - a.dadosBI.tempoRespostaMotoboy;\n    });\n    \n    // Renderizar tabela\n    auditoriaBody.innerHTML = rotasOrdenadas.map((rota, index) => {\n        const tempoResposta = rota.dadosBI.tempoRespostaMotoboy;\n        const dentroMeta = rota.dadosBI.dentroMeta;\n        const primeiraSaida = rota.dadosBI.primeiraSaida || 'N/A';\n        \n        // Formatar data de atribui√ß√£o\n        const dataAtribuicao = new Date(rota.updated_at);\n        dataAtribuicao.setHours(dataAtribuicao.getHours() + 3); // GMT-3\n        const dataAtribuicaoFormatada = `${dataAtribuicao.toLocaleDateString('pt-BR')} ${dataAtribuicao.toLocaleTimeString('pt-BR')}`;\n        \n        // Cores e status\n        const corStatus = dentroMeta ? '#10b981' : '#ef4444';\n        const bgStatus = dentroMeta ? '#d1fae5' : '#fee2e2';\n        const textoStatus = dentroMeta ? '‚úÖ DENTRO' : 'üö® FORA';\n        const corTempo = dentroMeta ? '#10b981' : '#ef4444';\n        \n        // Tipo de rota\n        const tipoRota = rota.dadosBI.tipo || 'N/A';\n        const corTipo = tipoRota === 'IMEDIATA' ? '#f59e0b' : tipoRota === 'FIXA' ? '#1890ff' : '#6b7280';\n        \n        // Total de pedidos\n        const totalPedidos = rota.dadosBI.totalPedidos || 0;\n        \n        return `\n            <tr style=\"border-bottom: 1px solid #e5e7eb; transition: all 0.2s; ${index % 2 === 0 ? 'background: #fafafa;' : 'background: white;'}\" onmouseover=\"this.style.background='#f0f9ff'; this.style.transform='scale(1.01)'\" onmouseout=\"this.style.background='${index % 2 === 0 ? '#fafafa' : 'white'}'; this.style.transform='scale(1)'\"\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"display: inline-block; padding: 6px 12px; border-radius: 20px; background: ${bgStatus}; color: ${corStatus}; font-weight: 800; font-size: 11px;\">\n                        ${textoStatus}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-size: 20px; font-weight: 900; color: ${corTempo}; line-height: 1;\">\n                        ${tempoResposta.toFixed(1)} min\n                    </div>\n                    <div style=\"font-size: 10px; color: #6b7280; margin-top: 4px;\">\n                        Meta: ‚â§5min\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-weight: 700; color: #1890ff; font-size: 12px; font-family: monospace;\">\n                        ${rota.session_id}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-weight: 700; color: #374151; font-size: 13px;\">\n                        ${rota.filial || 'N/A'}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-weight: 700; color: #374151; font-size: 13px;\">\n                        ${rota.motoboy || 'N/A'}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"display: inline-block; padding: 4px 10px; border-radius: 6px; background: #dbeafe; color: #1e40af; font-weight: 800; font-size: 12px; font-family: monospace;\">\n                        #${rota.saida_numero}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-size: 12px; color: #374151; font-weight: 600;\">\n                        ${dataAtribuicaoFormatada}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"font-size: 12px; color: #10b981; font-weight: 600;\">\n                        ${primeiraSaida}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px;\">\n                    <div style=\"display: inline-block; padding: 4px 10px; border-radius: 6px; background: ${corTipo}20; color: ${corTipo}; font-weight: 800; font-size: 11px;\">\n                        ${tipoRota}\n                    </div>\n                </td>\n                <td style=\"padding: 16px 12px; text-align: center;\">\n                    <div style=\"font-size: 16px; font-weight: 900; color: #1890ff;\">\n                        ${totalPedidos}\n                    </div>\n                    <div style=\"font-size: 10px; color: #6b7280;\">\n                        pedido${totalPedidos !== 1 ? 's' : ''}\n                    </div>\n                </td>\n            </tr>\n        `;\n    }).join('');\n    \n    console.log(`‚úÖ Auditoria renderizada: ${rotasOrdenadas.length} rotas`);\n    \n    // Estat√≠sticas resumidas\n    const dentroMeta = rotasOrdenadas.filter(r => r.dadosBI.dentroMeta).length;\n    const foraMeta = rotasOrdenadas.length - dentroMeta;\n    const percentualMeta = rotasOrdenadas.length > 0 ? (dentroMeta / rotasOrdenadas.length * 100) : 0;\n    \n    // Calcular tempo m√©dio, m√≠nimo e m√°ximo\n    const tempos = rotasOrdenadas.map(r => r.dadosBI.tempoRespostaMotoboy);\n    const tempoMedio = tempos.reduce((a, b) => a + b, 0) / tempos.length;\n    const tempoMinimo = Math.min(...tempos);\n    const tempoMaximo = Math.max(...tempos);\n    \n    // Adicionar card de estat√≠sticas antes da tabela\n    const statsCard = auditoriaContainer.querySelector('.stats-auditoria-card');\n    if (statsCard) statsCard.remove(); // Remove card anterior se existir\n    \n    const statsHTML = `\n        <div class=\"stats-auditoria-card\" style=\"background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);\">\n            <h3 style=\"margin: 0 0 20px 0; font-size: 18px; font-weight: 800; color: #374151; text-transform: uppercase; letter-spacing: 1px;\">\n                üìä Resumo da Auditoria\n            </h3>\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;\">\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%); border-radius: 10px; border: 2px solid #1890ff;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #1890ff;\">${rotasOrdenadas.length}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">Total de Rotas</div>\n                </div>\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%); border-radius: 10px; border: 2px solid #10b981;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #10b981;\">${dentroMeta}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">‚úÖ Dentro da Meta</div>\n                    <div style=\"font-size: 11px; color: #6b7280; margin-top: 4px;\">${percentualMeta.toFixed(1)}%</div>\n                </div>\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%); border-radius: 10px; border: 2px solid #ef4444;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #ef4444;\">${foraMeta}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">üö® Fora da Meta</div>\n                    <div style=\"font-size: 11px; color: #6b7280; margin-top: 4px;\">${(100 - percentualMeta).toFixed(1)}%</div>\n                </div>\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #fef3c7 0%, #fef9e5 100%); border-radius: 10px; border: 2px solid #f59e0b;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #f59e0b;\">${tempoMedio.toFixed(1)}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">‚è±Ô∏è Tempo M√©dio (min)</div>\n                </div>\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #e0e7ff 0%, #eef2ff 100%); border-radius: 10px; border: 2px solid #818cf8;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #10b981;\">${tempoMinimo.toFixed(1)}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">üöÄ Mais R√°pido (min)</div>\n                </div>\n                <div style=\"text-align: center; padding: 16px; background: linear-gradient(135deg, #fce7f3 0%, #fdf2f8 100%); border-radius: 10px; border: 2px solid #ec4899;\">\n                    <div style=\"font-size: 36px; font-weight: 900; color: #ef4444;\">${tempoMaximo.toFixed(1)}</div>\n                    <div style=\"font-size: 12px; font-weight: 700; color: #374151; margin-top: 6px;\">üêå Mais Lento (min)</div>\n                </div>\n            </div>\n        </div>\n    `;\n    \n    // Inserir stats antes da tabela\n    const tabelaContainer = auditoriaContainer.querySelector('.rotas-lista > div:last-child');\n    if (tabelaContainer) {\n        tabelaContainer.insertAdjacentHTML('beforebegin', statsHTML);\n    }\n    \n    console.log('üìä Estat√≠sticas da Auditoria:');\n    console.log(`   ‚úÖ Dentro da meta: ${dentroMeta} (${percentualMeta.toFixed(1)}%)`);\n    console.log(`   üö® Fora da meta: ${foraMeta} (${(100 - percentualMeta).toFixed(1)}%)`);\n    console.log(`   ‚è±Ô∏è Tempo m√©dio: ${tempoMedio.toFixed(1)}min`);\n    console.log(`   üöÄ Mais r√°pido: ${tempoMinimo.toFixed(1)}min`);\n    console.log(`   üêå Mais lento: ${tempoMaximo.toFixed(1)}min`);\n}\n\n// Renderizar lista de rotas\nfunction renderizarLista() {\n    console.log('üìã Renderizando lista...', rotasFiltradas.length);\n    const listaBody = document.getElementById('rotasListaBody');\n    \n    if (!listaBody) {\n        console.error('‚ùå Elemento rotasListaBody n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        console.log('üì≠ Nenhuma rota para exibir na lista');\n        listaBody.innerHTML = `\n            <div style=\"padding: 40px; text-align: center; color: #6b7280; font-size: 14px;\">\n                üì≠ Nenhuma rota encontrada com os filtros selecionados\n            </div>\n        `;\n        return;\n    }\n    \n    // üÜï Enriquecer dados com BI antes de renderizar\n    enriquecerRotasComBI();\n    \n    listaBody.innerHTML = rotasFiltradas.map((rota, index) => {\n        const tempo = calcularTempoDecorrido(\n            rota.data_criacao_rota,\n            rota.updated_at,\n            rota.saida_numero\n        );\n        \n        const isPendente = tempo.isPendente;\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n        const isAtrasada = tempo.minutos >= 20 && !isPendente;\n        \n        let statusClass = isPendente ? 'pendente' : 'em-rota';\n        let statusText = isPendente ? '‚è≥ Pendente' : 'üöö Em Rota';\n        \n        if (isAtrasada) {\n            statusClass = 'atrasada';\n            statusText = 'üö® Atrasada';\n        }\n        \n        const sessionIdCurto = rota.session_id.substring(0, 8);\n        \n        return `\n            <div class=\"lista-item ${statusClass}\" data-index=\"${index}\">\n                <div style=\"font-weight: 700; color: #1890ff;\">\n                    <span class=\"filial-badge\">${rota.filial}</span>\n                    #${sessionIdCurto}\n                </div>\n                <div style=\"font-size: 10px; font-weight: 600; color: #374151;\">\n                    ${rota.rota_cliente || 'Sem nome'}\n                </div>\n                <div>${rota.motoboy}</div>\n                <div class=\"lista-status ${statusClass}\">${statusText}</div>\n                <div style=\"font-weight: 600; text-align: center;\">\n                    ${rota.pedidosUnicos.length}\n                    ${rota.pedidos.length !== rota.pedidosUnicos.length ? `<div style=\"color: #f59e0b; font-size: 8px;\">(${rota.pedidos.length - rota.pedidosUnicos.length} dup.)</div>` : ''}\n                </div>\n                <div style=\"text-align: center;\">${rota.filial}</div>\n                <div class=\"lista-cronometro\" data-rota-id=\"${rota.session_id}\" style=\"text-align: center;\">\n                    ${tempo.formatted}\n                </div>\n                <div style=\"text-align: center;\">\n                    ${rota.url ? \n                        `<button class=\"btn-ver-rota\" \n                                 style=\"padding: 4px 8px; font-size: 10px;\" \n                                 onclick=\"copiarURL('${rota.url}', '${rota.session_id.substring(0,8)}');\" \n                                 title=\"Copiar URL do Google Maps\">\n                            üìã URL\n                        </button>`\n                        :\n                        `<span style=\"font-size: 10px; color: #9ca3af;\">\n                            üö´ Sem URL\n                        </span>`\n                    }\n                </div>\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Lista renderizada com sucesso!');\n    \n    // Atualizar estat√≠sticas por filial\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons baseado no status atual\n    configurarSistemaSons();\n}\n\n// Atualizar estat√≠sticas\nfunction atualizarStats() {\n    console.log('üìà === ATUALIZAR STATS INICIADO ===');\n    console.log('üìä rotasData.length:', rotasData.length);\n    console.log('üì¶ Usando pedidos √∫nicos para estat√≠sticas');\n    \n    const total = rotasData.length;\n    const totalPedidos = rotasData.reduce((sum, r) => sum + (r.pedidosUnicos?.length || r.pedidos?.length || 0), 0);\n    \n    const pendentes = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return tempo.isPendente;\n    }).length;\n    const emRota = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return !tempo.isPendente;\n    }).length;\n    const atrasadas = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n        return tempo.minutos >= 20 && !tempo.isPendente;\n    }).length;\n    \n    // üÜï Calcular tempo m√©dio de espera (apenas rotas j√° atribu√≠das)\n    const rotasAtribuidas = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return !tempo.isPendente;\n    });\n    \n    let tempoMedioMs = 0;\n    if (rotasAtribuidas.length > 0) {\n        const somaTemposEspera = rotasAtribuidas.reduce((sum, r) => {\n            const tempoEspera = calcularTempoEspera(r.data_criacao_rota, r.updated_at, r.saida_numero);\n            return sum + tempoEspera.total;\n        }, 0);\n        tempoMedioMs = somaTemposEspera / rotasAtribuidas.length;\n    }\n    \n    const tempoMedioSegundos = Math.floor(tempoMedioMs / 1000);\n    const tempoMedioMinutos = Math.floor(tempoMedioSegundos / 60);\n    const tempoMedioSegsResto = tempoMedioSegundos % 60;\n    const tempoMedioFormatado = tempoMedioMinutos > 0 \n        ? `${tempoMedioMinutos}:${String(tempoMedioSegsResto).padStart(2, '0')}` \n        : `${tempoMedioSegsResto}s`;\n    \n    console.log('üìä Estat√≠sticas calculadas:', { \n        total, \n        pendentes, \n        emRota, \n        atrasadas, \n        totalPedidos,\n        tempoMedioEspera: tempoMedioFormatado\n    });\n    \n    // Verificar se elementos existem\n    const elTotal = document.getElementById('totalRotas');\n    const elPendentes = document.getElementById('rotasPendentes');\n    const elEmRota = document.getElementById('rotasEmRota');\n    const elAtrasadas = document.getElementById('rotasAtrasadas');\n    const elTempoMedio = document.getElementById('tempoMedioEspera');\n    \n    console.log('üé≠ Elementos encontrados:', {\n        totalRotas: !!elTotal,\n        rotasPendentes: !!elPendentes, \n        rotasEmRota: !!elEmRota,\n        rotasAtrasadas: !!elAtrasadas,\n        tempoMedioEspera: !!elTempoMedio\n    });\n    \n    if (elTotal) elTotal.textContent = total;\n    if (elPendentes) elPendentes.textContent = pendentes;\n    if (elEmRota) elEmRota.textContent = emRota;\n    if (elAtrasadas) elAtrasadas.textContent = atrasadas;\n    if (elTempoMedio) elTempoMedio.textContent = rotasAtribuidas.length > 0 ? tempoMedioFormatado : '--:--';\n    \n    console.log('üìà === ATUALIZAR STATS FINALIZADO ===');\n}\n\n// Atualizar estat√≠sticas por filial\nfunction atualizarStatsFilial() {\n    console.log('üè¢ === ATUALIZANDO STATS POR FILIAL ===');\n    \n    const statsFilial = {};\n    \n    // Usar rotasFiltradas se existir, sen√£o rotasData (para mostrar stats dos dados filtrados)\n    const dadosParaStats = rotasFiltradas.length > 0 ? rotasFiltradas : rotasData;\n    console.log('üìä Usando dados:', dadosParaStats.length, 'rotas', rotasFiltradas.length > 0 ? '(filtradas)' : '(todas)');\n    \n    // Calcular stats para cada filial\n    dadosParaStats.forEach(rota => {\n        const filial = rota.filial;\n        if (!filial || filial === 'N/A') return;\n        \n        if (!statsFilial[filial]) {\n            statsFilial[filial] = {\n                total: 0,\n                emRota: 0,\n                pendentes: 0,\n                atrasadas: 0,\n                totalPedidos: 0,\n                comSaidaId: 0, // ‚úÖ Novo contador\n                semSaidaId: 0, // ‚úÖ Novo contador\n                rotas: []\n            };\n        }\n        \n        statsFilial[filial].total++;\n        statsFilial[filial].rotas.push(rota);\n        \n        // ‚úÖ VALIDA√á√ÉO: Contar rotas com e sem saida_numero\n        const temSaida = rota.saida_numero && rota.saida_numero !== null && rota.saida_numero !== '';\n        if (temSaida) {\n            statsFilial[filial].comSaidaId++;\n        } else {\n            statsFilial[filial].semSaidaId++;\n        }\n        \n        // Contar pedidos √∫nicos desta rota\n        const pedidosRota = rota.pedidosUnicos ? rota.pedidosUnicos.length : (rota.pedidos ? rota.pedidos.length : 0);\n        statsFilial[filial].totalPedidos += pedidosRota;\n        \n        // Calcular status da rota\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min\n        const isAtrasada = tempo.minutos >= 20 && !isPendente;\n        \n        if (isPendente) {\n            statsFilial[filial].pendentes++;\n        } else {\n            statsFilial[filial].emRota++;\n            if (isAtrasada) {\n                statsFilial[filial].atrasadas++;\n            }\n        }\n    });\n    \n    console.log('üìä Stats por filial calculadas:', statsFilial);\n    \n    // Renderizar stats por filial\n    const container = document.getElementById('statsFilial');\n    if (!container) {\n        console.error('‚ùå Container statsFilial n√£o encontrado!');\n        return;\n    }\n    \n    const filiaisOrdenadas = Object.keys(statsFilial).sort();\n    \n    container.innerHTML = filiaisOrdenadas.map(filial => {\n        const stats = statsFilial[filial];\n        \n        return `\n            <div class=\"filial-item\" onclick=\"filtrarPorFilial('${filial}')\" style=\"cursor: pointer;\" title=\"Clique para filtrar por ${filial}\" id=\"filialCard_${filial}\">\n                <div class=\"filial-nome\">${filial}</div>\n                <div class=\"filial-stats\">\n                    <div class=\"filial-stat ativo\">\n                        <div class=\"filial-stat-valor\">${stats.emRota}</div>\n                        <div class=\"filial-stat-label\">üöö Em Rota</div>\n                    </div>\n                    <div class=\"filial-stat pendente\">\n                        <div class=\"filial-stat-valor\">${stats.pendentes}</div>\n                        <div class=\"filial-stat-label\">‚è≥ Aguardando</div>\n                    </div>\n                    <div class=\"filial-stat atrasada\">\n                        <div class=\"filial-stat-valor\">${stats.atrasadas}</div>\n                        <div class=\"filial-stat-label\">üö® Atrasadas</div>\n                    </div>\n                </div>\n                <div style=\"text-align: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;\">\n                    <div style=\"font-size: 11px; color: #374151; font-weight: 600; margin-bottom: 4px;\">\n                        ${stats.total} rotas ‚Ä¢ ${stats.totalPedidos} pedidos\n                    </div>\n                    <div style=\"display: flex; justify-content: center; gap: 8px; font-size: 10px;\">\n                        <div style=\"color: #10b981; font-weight: 600;\" title=\"Rotas com Sa√≠da ID preenchido\">\n                            ‚úÖ ${stats.comSaidaId}\n                        </div>\n                        <div style=\"color: #f59e0b; font-weight: 600;\" title=\"Rotas sem Sa√≠da ID (pendentes)\">\n                            ‚è≥ ${stats.semSaidaId}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Stats por filial renderizadas para', filiaisOrdenadas.length, 'filiais');\n}\n\n// Filtrar por filial (clique no card da filial)\nfunction filtrarPorFilial(filial) {\n    console.log(`üè¢ Clique no card da filial: ${filial} - aplicando filtro`);\n    \n    // Remover destaque de todos os cards de filial\n    document.querySelectorAll('.filial-item').forEach(card => {\n        card.style.border = '1px solid #e5e7eb';\n        card.style.boxShadow = 'none';\n    });\n    \n    // Destacar card selecionado\n    const cardSelecionado = document.getElementById(`filialCard_${filial}`);\n    if (cardSelecionado) {\n        cardSelecionado.style.border = '2px solid #1890ff';\n        cardSelecionado.style.boxShadow = '0 4px 12px rgba(24, 144, 255, 0.3)';\n    }\n    \n    // Atualizar select de filial\n    const selectFilial = document.getElementById('filterFilial');\n    if (selectFilial) {\n        selectFilial.value = filial;\n        aplicarFiltros();\n        \n        // Feedback visual\n        console.log(`‚úÖ Filtro de filial aplicado: ${filial}`);\n        \n        // Scroll para os cards/lista\n        const target = modoAtual === 'cards' ? document.getElementById('rotasGrid') : document.getElementById('rotasLista');\n        if (target) {\n            target.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }\n    } else {\n        console.error('‚ùå Select filterFilial n√£o encontrado!');\n    }\n}\n\n// Limpar todos os filtros\nfunction limparFiltros() {\n    console.log('üßπ Limpando todos os filtros...');\n    \n    // Remover destaque de todos os cards de filial\n    document.querySelectorAll('.filial-item').forEach(card => {\n        card.style.border = '1px solid #e5e7eb';\n        card.style.boxShadow = 'none';\n    });\n    \n    // Limpar selects\n    document.getElementById('filterFilial').value = '';\n    document.getElementById('filterStatus').value = '';\n    document.getElementById('filterMotoboy').value = '';\n    \n    aplicarFiltros();\n    \n    console.log('‚úÖ Filtros limpos - mostrando todas as rotas');\n}\n\n// Testar URLs das rotas (debug)\nfunction testarURLs() {\n    console.log('üß™ === TESTANDO URLs DAS ROTAS ===');\n    \n    if (!rotasData || rotasData.length === 0) {\n        console.log('‚ùå Nenhuma rota dispon√≠vel para testar');\n        return;\n    }\n    \n    rotasData.forEach((rota, index) => {\n        const sessionId = rota.session_id.substring(0,8);\n        console.log(`üß™ Testando Rota ${index + 1} (#${sessionId}):`);\n        console.log(`   üè¢ Filial: ${rota.filial}`);\n        console.log(`   üèçÔ∏è Motoboy: ${rota.descricao_motorista}`);\n        console.log(`   üó∫Ô∏è URL existe? ${rota.url ? 'SIM' : 'N√ÉO'}`);\n        \n        if (rota.url) {\n            console.log(`   üìè Tamanho: ${rota.url.length} chars`);\n            console.log(`   üîó URL: ${rota.url}`);\n            console.log(`   ‚úÖ Formato v√°lido? ${rota.url.includes('google.com/maps') ? 'SIM' : 'N√ÉO'}`);\n            \n            // Teste de abertura\n            try {\n                console.log(`   üß™ Testando abertura...`);\n                window.open(rota.url, '_blank');\n                console.log(`   ‚úÖ URL aberta com sucesso!`);\n            } catch (error) {\n                console.error(`   ‚ùå Erro ao abrir URL:`, error);\n            }\n        } else {\n            console.log(`   ‚ùå URL n√£o dispon√≠vel`);\n        }\n        \n        console.log('   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n    });\n    \n    const totalComURL = rotasData.filter(r => r.url).length;\n    console.log(`üìä RESUMO: ${totalComURL}/${rotasData.length} rotas t√™m URL v√°lida`);\n    console.log('üß™ === TESTE DE URLs FINALIZADO ===');\n}\n\n// Copiar URL para √°rea de transfer√™ncia\nfunction copiarURL(url, rotaId) {\n    console.log(`üìã Copiando URL da rota #${rotaId}:`, url);\n    \n    try {\n        // Tentar usar a API moderna\n        if (navigator.clipboard) {\n            navigator.clipboard.writeText(url).then(() => {\n                console.log('‚úÖ URL copiada com sucesso para √°rea de transfer√™ncia');\n                mostrarMensagem(`‚úÖ URL da rota #${rotaId} copiada!`, 'success');\n            }).catch(err => {\n                console.error('‚ùå Erro ao copiar com navigator.clipboard:', err);\n                copiarURLFallback(url, rotaId);\n            });\n        } else {\n            // Fallback para browsers antigos\n            copiarURLFallback(url, rotaId);\n        }\n    } catch (error) {\n        console.error('‚ùå Erro ao copiar URL:', error);\n        copiarURLFallback(url, rotaId);\n    }\n}\n\n// Fallback para copiar URL\nfunction copiarURLFallback(url, rotaId) {\n    try {\n        // Criar elemento tempor√°rio\n        const textarea = document.createElement('textarea');\n        textarea.value = url;\n        textarea.style.position = 'fixed';\n        textarea.style.opacity = '0';\n        document.body.appendChild(textarea);\n        textarea.select();\n        \n        const sucesso = document.execCommand('copy');\n        document.body.removeChild(textarea);\n        \n        if (sucesso) {\n            console.log('‚úÖ URL copiada usando fallback');\n            mostrarMensagem(`‚úÖ URL da rota #${rotaId} copiada!`, 'success');\n        } else {\n            console.log('‚ùå Falha no fallback - mostrando URL para c√≥pia manual');\n            mostrarURLParaCopia(url, rotaId);\n        }\n    } catch (error) {\n        console.error('‚ùå Erro no fallback:', error);\n        mostrarURLParaCopia(url, rotaId);\n    }\n}\n\n// Mostrar URL para c√≥pia manual\nfunction mostrarURLParaCopia(url, rotaId) {\n    console.log('üìã Mostrando URL para c√≥pia manual');\n    alert(`Rota #${rotaId}:\\n\\nCopie a URL abaixo:\\n\\n${url}`);\n}\n\n// Abrir modal com informa√ß√µes da rota\nfunction abrirModalMaps(url, rotaId, nomeRota) {\n    console.log(`üó∫Ô∏è Abrindo modal para rota #${rotaId}`);\n    \n    const modal = document.getElementById('modalMaps');\n    const container = document.getElementById('mapsContainer');\n    \n    container.innerHTML = `\n        <div style=\"margin-bottom: 20px;\">\n            <h3 style=\"color: #1890ff; margin-bottom: 8px;\">Rota #${rotaId}</h3>\n            <p style=\"color: #6b7280; margin-bottom: 16px;\">${nomeRota}</p>\n        </div>\n        \n        <div class=\"url-display\" onclick=\"selecionarTexto(this)\" title=\"Clique para selecionar toda a URL\">\n            ${url}\n        </div>\n        \n        <div style=\"display: flex; gap: 12px; justify-content: center;\">\n            <button onclick=\"copiarURL('${url}', '${rotaId}')\" \n                    style=\"padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üìã Copiar URL\n            </button>\n            \n            <button onclick=\"tentarAbrirMaps('${url}')\" \n                    style=\"padding: 12px 24px; background: #1890ff; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üåê Tentar Abrir\n            </button>\n            \n            <button onclick=\"baixarRota('${url}', '${rotaId}')\" \n                    style=\"padding: 12px 24px; background: #8b5cf6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üíæ Baixar Link\n            </button>\n        </div>\n        \n        <div style=\"margin-top: 20px; padding: 12px; background: #fef3c7; border-radius: 8px; font-size: 12px;\">\n            <strong>üí° Como usar:</strong><br>\n            ‚Ä¢ <strong>üìã Copiar URL</strong>: Copia para √°rea de transfer√™ncia<br>\n            ‚Ä¢ <strong>üåê Tentar Abrir</strong>: For√ßa abertura em nova aba<br>\n            ‚Ä¢ <strong>üíæ Baixar Link</strong>: Salva como arquivo para abrir depois<br>\n            ‚Ä¢ <strong>Clique na URL</strong>: Seleciona todo o texto para copiar manualmente\n        </div>\n    `;\n    \n    modal.style.display = 'block';\n}\n\n// Fechar modal maps\nfunction fecharModalMaps() {\n    document.getElementById('modalMaps').style.display = 'none';\n}\n\n// Selecionar texto no elemento\nfunction selecionarTexto(elemento) {\n    if (window.getSelection) {\n        const selection = window.getSelection();\n        const range = document.createRange();\n        range.selectNodeContents(elemento);\n        selection.removeAllRanges();\n        selection.addRange(range);\n        console.log('üìã Texto selecionado para c√≥pia manual');\n    }\n}\n\n// Tentar abrir Maps (for√ßar nova janela)\nfunction tentarAbrirMaps(url) {\n    console.log('üåê Tentando for√ßar abertura do Google Maps...');\n    \n    try {\n        // M√©todo 1: window.open com configura√ß√µes espec√≠ficas\n        const novaJanela = window.open(url, '_blank', 'noopener,noreferrer,width=1200,height=800');\n        \n        if (novaJanela) {\n            console.log('‚úÖ Nova janela aberta com sucesso');\n            mostrarMensagem('‚úÖ Maps aberto em nova janela!', 'success');\n        } else {\n            console.log('‚ùå Pop-up bloqueado - tentando m√©todo alternativo');\n            \n            // M√©todo 2: Criar link tempor√°rio e clicar\n            const link = document.createElement('a');\n            link.href = url;\n            link.target = '_blank';\n            link.rel = 'noopener noreferrer';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            \n            mostrarMensagem('üåê Tentativa de abertura realizada!', 'info');\n        }\n    } catch (error) {\n        console.error('‚ùå Erro ao abrir Maps:', error);\n        mostrarMensagem('‚ùå N√£o foi poss√≠vel abrir o Maps', 'error');\n    }\n}\n\n// Baixar link como arquivo\nfunction baixarRota(url, rotaId) {\n    console.log(`üíæ Criando arquivo de link para rota #${rotaId}`);\n    \n    try {\n        const conteudo = `[InternetShortcut]\nURL=${url}\nIconIndex=0`;\n        \n        const blob = new Blob([conteudo], { type: 'text/plain' });\n        const urlBlob = window.URL.createObjectURL(blob);\n        \n        const link = document.createElement('a');\n        link.href = urlBlob;\n        link.download = `Rota_${rotaId}_GoogleMaps.url`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        window.URL.revokeObjectURL(urlBlob);\n        \n        console.log('‚úÖ Arquivo de link criado com sucesso');\n        mostrarMensagem(`üíæ Arquivo Rota_${rotaId}_GoogleMaps.url baixado!`, 'success');\n    } catch (error) {\n        console.error('‚ùå Erro ao criar arquivo:', error);\n        mostrarMensagem('‚ùå Erro ao baixar arquivo', 'error');\n    }\n}\n\n// Mostrar mensagem tempor√°ria\nfunction mostrarMensagem(texto, tipo = 'info') {\n    const div = document.createElement('div');\n    div.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 2000;\n        padding: 12px 20px;\n        border-radius: 8px;\n        font-weight: 600;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n        animation: slideIn 0.3s ease;\n    `;\n    \n    if (tipo === 'success') {\n        div.style.background = '#10b981';\n        div.style.color = 'white';\n    } else if (tipo === 'error') {\n        div.style.background = '#ef4444';\n        div.style.color = 'white';\n    } else {\n        div.style.background = '#1890ff';\n        div.style.color = 'white';\n    }\n    \n    div.textContent = texto;\n    document.body.appendChild(div);\n    \n    // Remover ap√≥s 3 segundos\n    setTimeout(() => {\n        div.style.animation = 'slideOut 0.3s ease';\n        setTimeout(() => {\n            document.body.removeChild(div);\n        }, 300);\n    }, 3000);\n}\n\n// Atualizar cron√¥metros (sem recarregar dados)\nfunction atualizarCronometros() {\n    let statusMudou = false;\n    \n    rotasData.forEach(rota => {\n        const elemento = document.querySelector(`[data-rota-id=\"${rota.session_id}\"]`);\n        if (elemento) {\n            // üéØ N√ÉO ATUALIZAR se o motoboy J√Å SAIU (tem tempo de resposta fixo)\n            if (rota.dadosBI && rota.dadosBI.tempoRespostaMotoboy !== null) {\n                // Tempo fixo j√° est√° exibido, n√£o precisa atualizar\n                return;\n            }\n            \n            const tempoAnterior = elemento.textContent;\n            const tempo = calcularTempoDecorrido(\n                rota.data_criacao_rota,\n                rota.updated_at,\n                rota.saida_numero\n            );\n            \n            elemento.textContent = tempo.formatted;\n            \n            // Verificar se uma rota ficou atrasada agora\n            const wasAtrasada = rota.wasAtrasada || false;\n            // üÜï NOVA REGRA: Atrasada = rota ATRIBU√çDA h√° mais de 20min (E ainda n√£o saiu)\n            const isAtrasada = tempo.minutos >= 20 && !tempo.isPendente;\n            \n            if (isAtrasada !== wasAtrasada) {\n                statusMudou = true;\n                rota.wasAtrasada = isAtrasada;\n            }\n        }\n    });\n    \n    // Reconfigurar sons a cada 30 segundos ou quando status muda\n    const agora = Date.now();\n    if (!atualizarCronometros.ultimaConfig || agora - atualizarCronometros.ultimaConfig > 30000 || statusMudou) {\n        atualizarCronometros.ultimaConfig = agora;\n        \n        // S√≥ reconfigurar se som estiver ativo e houver rotas\n        if (somAtivo && rotasData.length > 0) {\n            configurarSistemaSons();\n        }\n    }\n}\n\n// Atualizar dados manualmente (sem reload - Appsmith j√° atualiza a query)\nfunction atualizarManual() {\n    console.log('üîÑ Reprocessando dados (mantendo filtros)...');\n    processarRotas();\n}\n\n// Log inicial do sistema\nconsole.log('üöÄüöÄüöÄ SISTEMA DE LOGS INICIALIZADO - PAINEL MONITORAMENTO üöÄüöÄüöÄ');\nconsole.log('üìä Capturando todos os logs do sistema...');\nconsole.log('‚è∞ Timestamp:', new Date().toLocaleTimeString('pt-BR'));\nconsole.log('üåê URL atual:', window.location.href);\n\n// Inicializar dados (executar imediatamente)\nconsole.log('‚ö° Verificando queries antes da inje√ß√£o...');\nconsole.log('  - dmaplicativo_prod_rotas_otimiz:', typeof dmaplicativo_prod_rotas_otimiz);\nconsole.log('  - pedidos_e_saidas_do_dia:', typeof pedidos_e_saidas_do_dia);\n\n{{\n    (() => {\n        console.log('üîß Executando inje√ß√£o de dados...');\n        const rotas = (dmaplicativo_prod_rotas_otimiz && dmaplicativo_prod_rotas_otimiz.data) || [];\n        console.log('üìä Rotas encontradas na query:', rotas.length);\n        return `\n            console.log('üíâ Injetando globalRotasData com', ${rotas.length}, 'registros');\n            globalRotasData = ${JSON.stringify(rotas)};\n        `;\n    })()\n}}\n\n{{\n    (() => {\n        const pedidos = (pedidos_e_saidas_do_dia && pedidos_e_saidas_do_dia.data) || [];\n        console.log('üìã Pedidos encontrados na query:', pedidos.length);\n        return `\n            console.log('üíâ Injetando globalPedidosData com', ${pedidos.length}, 'registros');\n            globalPedidosData = ${JSON.stringify(pedidos)};\n        `;\n    })()\n}}\n\n{{\n    (() => {\n        const rotasBI = (rotas_bi_motoboy && rotas_bi_motoboy.data) || [];\n        console.log('üìä Rotas BI encontradas na query:', rotasBI.length);\n        return `\n            console.log('üíâ Injetando globalRotasBIData com', ${rotasBI.length}, 'registros');\n            globalRotasBIData = ${JSON.stringify(rotasBI)};\n        `;\n    })()\n}}\n\n// Inicializar quando a p√°gina carregar  \nsetTimeout(() => {\n    console.log('üöÄüöÄüöÄ === INICIANDO PAINEL DE MONITORAMENTO === üöÄüöÄüöÄ');\n    console.log('üìç setTimeout executado - sistema iniciando...');\n    \n    // Debug: verificar se dados existem\n    console.log('üîç Verificando dados globais:');\n    console.log('  - globalRotasData existe?', typeof globalRotasData);\n    console.log('  - globalRotasData length:', globalRotasData ? globalRotasData.length : 'undefined');\n    console.log('  - globalPedidosData existe?', typeof globalPedidosData);\n    console.log('  - globalPedidosData length:', globalPedidosData ? globalPedidosData.length : 'undefined');\n    \n    if (typeof globalRotasData === 'undefined') {\n        console.error('‚ùå globalRotasData est√° undefined!');\n        globalRotasData = [];\n    }\n    if (typeof globalPedidosData === 'undefined') {\n        console.error('‚ùå globalPedidosData est√° undefined!');\n        globalPedidosData = [];\n    }\n    if (typeof globalRotasBIData === 'undefined') {\n        console.warn('‚ö†Ô∏è globalRotasBIData est√° undefined! M√©tricas avan√ßadas n√£o estar√£o dispon√≠veis.');\n        globalRotasBIData = [];\n    }\n    \n    console.log('üì¶ Dados carregados:', {\n        rotas: globalRotasData.length,\n        pedidos: globalPedidosData.length,\n        rotasBI: globalRotasBIData.length\n    });\n    \n    // Processar rotas\n    console.log('üéØ CHAMANDO processarRotas()...');\n    console.log('üìä Antes de processar - rotasData.length:', rotasData.length);\n    \n    try {\n        processarRotas();\n        console.log('‚úÖ processarRotas() executado com sucesso');\n        console.log('üìä Ap√≥s processar - rotasData.length:', rotasData.length);\n        console.log('üìä Ap√≥s processar - rotasFiltradas.length:', rotasFiltradas.length);\n    } catch (error) {\n        console.error('‚ùå ERRO no processarRotas():', error);\n        console.error('‚ùå Stack trace:', error.stack);\n    }\n    \n    // Atualizar cron√¥metros a cada 1 segundo\n    setInterval(atualizarCronometros, tempoAtualizacao);\n    \n    // Sistema simplificado - filtros internos persistem automaticamente no Appsmith\n    console.log('üîÑ Sistema otimizado para Appsmith - sem auto-refresh');\n    \n    // No Appsmith a query j√° atualiza automaticamente - n√£o precisa de reload!\n    // setInterval com location.reload() REMOVIDO para n√£o resetar filtros\n    \n    console.log('‚úÖ Painel inicializado!');\n    console.log('   üìä ' + rotasData.length + ' rotas ativas (√∫ltima otimiza√ß√£o)');\n    console.log('   ‚è±Ô∏è Cron√¥metros atualizando a cada ' + (tempoAtualizacao/1000) + 's');\n    console.log('   üîÑ Query atualiza automaticamente no Appsmith');\n    console.log('   üéØ Filtros persistem sem refresh');\n    console.log('   üÜï NOVA REGRA: Cron√¥metro come√ßa quando rota √© ATRIBU√çDA');\n    console.log('   üÜï NOVA REGRA: Atrasadas = rotas ATRIBU√çDAS h√° mais de 20min');\n    \n    // Status final dos sons\n    const statusFinal = analisarStatusRotas();\n    console.log('üîä Sistema de sons ativo:');\n    console.log('   üö® Rotas atrasadas (atribu√≠das >20min, som a cada 1s):', statusFinal.atrasadas);\n    console.log('   ‚è≥ Rotas pendentes (sem atribui√ß√£o, som a cada 5s):', statusFinal.pendentes);\n    console.log('   üöö Rotas em rota (sem som):', statusFinal.emRota);\n}, 500); // Aumentado para 500ms para dar tempo da inje√ß√£o\n</script>\n\n{{''}}\n\n",
  "topRow": 289,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "7hud3vqtxr",
  "widgetName": "Iframe13"
}