{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 111,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "s8pv9rmes3",
  "leftColumn": 0,
  "mobileBottomRow": 33,
  "mobileLeftColumn": 0,
  "mobileRightColumn": 8,
  "mobileTopRow": 1,
  "needsErrorInfo": false,
  "parentColumnSpace": 21.109375,
  "parentId": "5dg9v9a4we",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "https://www.example.com",
  "srcDoc": "<style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    body {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;\n        background: #f5f7fa;\n        padding: 12px;\n        font-size: 11px;\n    }\n    \n    .relatorio-container {\n        max-width: 100%;\n        background: white;\n        border-radius: 8px;\n        padding: 16px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n    \n    /* Header */\n    .header-title {\n        font-size: 24px;\n        font-weight: 900;\n        color: #1890ff;\n        text-align: center;\n        margin-bottom: 20px;\n        border-bottom: 3px solid #1890ff;\n        padding-bottom: 12px;\n    }\n    \n    /* Filtros */\n    .filters-container {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n        gap: 10px;\n        margin-bottom: 20px;\n        padding: 16px;\n        background: #f9fafb;\n        border-radius: 8px;\n        border: 2px solid #e5e7eb;\n    }\n    \n    .filter-item {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .filter-label {\n        font-size: 9px;\n        font-weight: 700;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .filter-select {\n        padding: 6px 10px;\n        background: white;\n        border: 1px solid #d1d5db;\n        border-radius: 6px;\n        font-size: 11px;\n        color: #111827;\n        font-weight: 600;\n    }\n    \n    /* Tabela Hier√°rquica */\n    .table-container {\n        border-radius: 8px;\n        overflow: hidden;\n        border: 1px solid #e5e7eb;\n        margin-bottom: 20px;\n    }\n    \n    .table-header {\n        background: #1890ff;\n        color: white;\n        padding: 12px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-size: 11px;\n        font-weight: 700;\n        text-align: center;\n    }\n    \n    .table-header > div:first-child {\n        text-align: left;\n    }\n    \n    /* Linhas Hier√°rquicas */\n    .row-cidade {\n        background: #3b82f6;\n        color: white;\n        padding: 10px 12px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-weight: 700;\n        font-size: 12px;\n        cursor: pointer;\n        transition: background 0.2s;\n    }\n    \n    .row-cidade:hover {\n        background: #2563eb;\n    }\n    \n    .row-filial {\n        background: #e5e7eb;\n        color: #374151;\n        padding: 8px 12px;\n        padding-left: 24px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-weight: 600;\n        font-size: 11px;\n        cursor: pointer;\n        transition: background 0.2s;\n    }\n    \n    .row-filial:hover {\n        background: #d1d5db;\n    }\n    \n    .row-motoboy {\n        background: #f9fafb;\n        color: #1f2937;\n        padding: 6px 12px;\n        padding-left: 36px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-weight: 600;\n        font-size: 11px;\n        border-bottom: 1px solid #e5e7eb;\n        cursor: pointer;\n        transition: background 0.2s;\n    }\n    \n    .row-motoboy:hover {\n        background: #f3f4f6;\n    }\n    \n    .row-pedido {\n        background: white;\n        color: #6b7280;\n        padding: 4px 12px;\n        padding-left: 48px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-size: 10px;\n        border-bottom: 1px solid #f3f4f6;\n    }\n    \n    .row-total {\n        background: #1890ff;\n        color: white;\n        padding: 12px;\n        display: grid;\n        grid-template-columns: 300px 120px 80px 120px 80px 120px 80px;\n        gap: 8px;\n        font-weight: 700;\n        font-size: 12px;\n    }\n    \n    /* Indicadores de Expans√£o */\n    .expand-icon {\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        margin-right: 8px;\n        background: rgba(255,255,255,0.2);\n        border-radius: 3px;\n        text-align: center;\n        line-height: 16px;\n        font-size: 10px;\n        font-weight: 700;\n        cursor: pointer;\n    }\n    \n    /* Valores Positivos/Negativos */\n    .positivo {\n        color: #10b981;\n        font-weight: 700;\n    }\n    \n    .negativo {\n        color: #ef4444;\n        font-weight: 700;\n    }\n    \n    .neutro {\n        color: #374151;\n    }\n    \n    /* Estados Colapsados */\n    .collapsed {\n        display: none;\n    }\n    \n    /* Loading */\n    .loading {\n        text-align: center;\n        padding: 40px;\n        color: #6b7280;\n    }\n</style>\n\n<div class=\"relatorio-container\">\n    <!-- Header -->\n    <div class=\"header-title\">\n        üìä Relat√≥rio de Performance por Motoboy\n        <div style=\"margin-top: 10px; display: flex; gap: 12px; justify-content: center; align-items: center;\">\n            <button onclick=\"mostrarDebugDados()\" \n                    style=\"padding: 8px 16px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;\">\n                üîç Debug Dados\n            </button>\n            <button onclick=\"mostrarRegrasNegocio()\" \n                    style=\"padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;\">\n                üìã Regras de Neg√≥cio\n            </button>\n            <button onclick=\"analisarPedidosDias()\" \n                    style=\"padding: 8px 16px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;\">\n                üìÖ An√°lise Dias\n            </button>\n            <button onclick=\"analisarSemRota()\" \n                    style=\"padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;\">\n                üè∑Ô∏è An√°lise SEM ROTA\n            </button>\n            <button onclick=\"forcarZerarTransportadora()\" \n                    style=\"padding: 8px 16px; background: #991b1b; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;\">\n                ‚≠ï For√ßar Zero\n            </button>\n        </div>\n    </div>\n    \n    <!-- Legenda dos Tipos -->\n    <div style=\"background: #f0f9ff; border: 2px solid #1890ff; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 10px;\">\n        <strong>üìã Regras PED.DISP/ROTA:</strong>\n        <strong>üîß FIXA:</strong> 09:15‚Üí09:30h | 13:15‚Üí13:30h | \n        <strong>‚ö° IMEDIATA:</strong> Ap√≥s confer√™ncia | \n        <strong style=\"color: #ef4444;\">üöö TRANSPORTADORA:</strong> SEMPRE ZERADO | \n        <strong style=\"color: #ef4444;\">üöõ ROTA TRANSP:</strong> SEMPRE ZERADO | \n        <strong style=\"color: #ef4444;\">üõ£Ô∏è EM ROTA:</strong> SEMPRE ZERADO | \n        <strong style=\"color: #ef4444;\">üè∑Ô∏è SEM ROTA:</strong> SEMPRE ZERADO | \n        <strong>‚ö†Ô∏è IMPORTANTE:</strong> Apenas pedidos do mesmo dia contam!\n    </div>\n    \n    <!-- Filtros -->\n    <div class=\"filters-container\">\n        <div class=\"filter-item\">\n            <div class=\"filter-label\">üìä Status</div>\n            <select class=\"filter-select\" id=\"filterStatus\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n                <option value=\"FINALIZADO\">Finalizado</option>\n                <option value=\"EM_ROTA\">Em Rota</option>\n            </select>\n        </div>\n        <div class=\"filter-item\">\n            <div class=\"filter-label\">üì¶ Entregue</div>\n            <select class=\"filter-select\" id=\"filterEntregue\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n                <option value=\"SIM\">Sim</option>\n                <option value=\"NAO\">N√£o</option>\n            </select>\n        </div>\n        <div class=\"filter-item\">\n            <div class=\"filter-label\">üè¢ Filial</div>\n            <select class=\"filter-select\" id=\"filterFilial\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todas</option>\n            </select>\n        </div>\n        <div class=\"filter-item\">\n            <div class=\"filter-label\">üèçÔ∏è Motoboy</div>\n            <select class=\"filter-select\" id=\"filterMotoboy\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n            </select>\n        </div>\n        <div class=\"filter-item\">\n            <div class=\"filter-label\">üóìÔ∏è Data</div>\n            <input type=\"date\" class=\"filter-select\" id=\"filterData\" onchange=\"aplicarFiltros()\">\n        </div>\n    </div>\n    \n    <!-- Tabela Principal -->\n    <div class=\"table-container\">\n        <div class=\"table-header\">\n            <div>CIDADE / FILIAL / MOTOBOY</div>\n            <div>PED.DISP/ROTA</div>\n            <div>%</div>\n            <div>TTE</div>\n            <div>%</div>\n            <div>QTY.PED</div>\n            <div>%</div>\n        </div>\n        <div id=\"tabelaHierarquica\">\n            <div class=\"loading\">\n                üìä Carregando dados...\n            </div>\n        </div>\n    </div>\n</div>\n\n<script>\n// Vari√°veis globais\nlet dadosOriginais = [];\nlet dadosFiltrados = [];\nlet estruturaHierarquica = {};\n\n// Configura√ß√µes\nlet configExpandir = {\n    cidades: {},\n    filiais: {},\n    motoboys: {}\n};\n\n// Inicializar dados \n{{\n    (() => {\n        const dados = rotas_bi_motoboy?.data || [];\n        return `dadosOriginais = ${JSON.stringify(dados)};`;\n    })()\n}}\n\n// Converter data brasileira (dd/mm/yyyy HH:MM:SS) para Date\nfunction converterDataBrasileira(dataStr) {\n    if (!dataStr) return null;\n    \n    try {\n        // Formato: \"10/11/2025 08:03:27\"\n        const regex = /(\\d{2})\\/(\\d{2})\\/(\\d{4}) (\\d{2}):(\\d{2}):(\\d{2})/;\n        const match = dataStr.match(regex);\n        \n        if (match) {\n            const [, dia, mes, ano, hora, minuto, segundo] = match;\n            const data = new Date(ano, mes - 1, dia, hora, minuto, segundo);\n            \n            if (isNaN(data.getTime())) {\n                console.error(`‚ùå Data inv√°lida: ${dataStr}`);\n                return null;\n            }\n            \n            return data;\n        } else {\n            console.error(`‚ùå Formato de data inv√°lido: ${dataStr}`);\n            return null;\n        }\n    } catch (error) {\n        console.error(`‚ùå Erro ao converter data ${dataStr}:`, error);\n        return null;\n    }\n}\n\n// Calcular PED.DISP/ROTA baseado nas regras de neg√≥cio\nfunction calcularPedDispRota(item) {\n    const tipo = item.TIPO || '';\n    const rota = item.ROTA || '';\n    const posicao = item.POSICAO || '';\n    const datafim = item.DATAFIMPACOTE_STR;\n    const datasaida = item.DATASAIDA_STR;\n    \n    if (!datafim || !datasaida) return 0;\n    \n    const dataFimObj = converterDataBrasileira(datafim);\n    const dataSaidaObj = converterDataBrasileira(datasaida);\n    \n    if (!dataFimObj || !dataSaidaObj) return 0;\n    \n    // REGRA ESPECIAL: Pedidos de um dia para o outro N√ÉO contam\n    const dataFimDia = `${dataFimObj.getFullYear()}-${dataFimObj.getMonth()}-${dataFimObj.getDate()}`;\n    const dataSaidaDia = `${dataSaidaObj.getFullYear()}-${dataSaidaObj.getMonth()}-${dataSaidaObj.getDate()}`;\n    \n    if (dataFimDia !== dataSaidaDia) {\n        console.log(`‚ö†Ô∏è Pedido ${item.NUMPED} √© de um dia para outro - N√ÉO conta tempo`);\n        return 0; // N√£o contar tempo para pedidos de dias diferentes\n    }\n    \n    // Extrair hor√°rio da emiss√£o (hora:minuto da datafim)\n    const horaEmissao = dataFimObj.getHours() * 60 + dataFimObj.getMinutes(); // Em minutos desde 00:00\n    \n    let inicioContagem = null;\n    \n    // Verificar primeiro os casos especiais de status/rota\n    if (posicao && posicao.toUpperCase().includes('EM ROTA')) {\n        // EM ROTA: Segue modelo TRANSPORTADORA (ZERADO na maioria dos casos)\n        // S√≥ conta se emitido antes de 16:30 e saiu depois de 16:30 no mesmo dia\n        inicioContagem = new Date(dataFimObj);\n        inicioContagem.setHours(16, 30, 0, 0);\n        \n        // Se emitido ap√≥s 16:30h ‚Üí ZERAR\n        if (horaEmissao > (16 * 60 + 30)) {\n            console.log(`‚ö†Ô∏è EM ROTA - Pedido ${item.NUMPED} emitido ap√≥s 16:30h ‚Üí ZERADO`);\n            return 0; // ZERAR tempo\n        }\n        \n    } else if (rota.toUpperCase().includes('TRANSP')) {\n        // ROTA TRANSP: Segue modelo TRANSPORTADORA (ZERADO na maioria dos casos)\n        // S√≥ conta se emitido antes de 16:30 e saiu depois de 16:30 no mesmo dia\n        inicioContagem = new Date(dataFimObj);\n        inicioContagem.setHours(16, 30, 0, 0);\n        \n        // Se emitido ap√≥s 16:30h ‚Üí ZERAR\n        if (horaEmissao > (16 * 60 + 30)) {\n            console.log(`‚ö†Ô∏è ROTA TRANSP - Pedido ${item.NUMPED} emitido ap√≥s 16:30h ‚Üí ZERADO`);\n            return 0; // ZERAR tempo\n        }\n        \n    } else if (tipo.toUpperCase().includes('FIXA')) {\n        // ROTA FIXA:\n        // - Emitidos at√© 09:15 ‚Üí saem √†s 09:30 ‚Üí contar a partir de 09:30\n        // - Emitidos ap√≥s 09:15 at√© 13:15 ‚Üí saem √†s 13:30 ‚Üí contar a partir de 13:30\n        \n        if (horaEmissao <= (9 * 60 + 15)) { // At√© 09:15\n            // Saem √†s 09:30\n            inicioContagem = new Date(dataFimObj);\n            inicioContagem.setHours(9, 30, 0, 0);\n        } else if (horaEmissao <= (13 * 60 + 15)) { // 09:15 at√© 13:15\n            // Saem √†s 13:30  \n            inicioContagem = new Date(dataFimObj);\n            inicioContagem.setHours(13, 30, 0, 0);\n        } else {\n            // Ap√≥s 13:15 (pr√≥ximo dia)\n            inicioContagem = new Date(dataFimObj);\n            inicioContagem.setDate(inicioContagem.getDate() + 1);\n            inicioContagem.setHours(9, 30, 0, 0);\n        }\n        \n    } else if (tipo.toUpperCase().includes('IMEDIATA')) {\n        // IMEDIATO: Come√ßa a contar depois da confer√™ncia (DATAFIMPACOTE_STR)\n        inicioContagem = dataFimObj;\n        \n    } else if (tipo.toUpperCase().includes('TRANSPORTADORA')) {\n        // TRANSPORTADORA: Modelo que ZERA na maioria dos casos\n        // S√≥ conta se emitido antes de 16:30 e saiu depois de 16:30 no mesmo dia  \n        inicioContagem = new Date(dataFimObj);\n        inicioContagem.setHours(16, 30, 0, 0);\n        \n        // Se emitido ap√≥s 16:30h ‚Üí ZERAR\n        if (horaEmissao > (16 * 60 + 30)) {\n            console.log(`‚ö†Ô∏è TRANSPORTADORA - Pedido ${item.NUMPED} emitido ap√≥s 16:30h ‚Üí ZERADO`);\n            return 0; // ZERAR tempo\n        }\n        \n    } else if (item.ROTA && item.ROTA.toUpperCase().includes('SEM ROTA')) {\n        // SEM ROTA CADASTRADA: Segue modelo TRANSPORTADORA (ZERADO na maioria dos casos)\n        // S√≥ conta se emitido antes de 16:30 e saiu depois de 16:30 no mesmo dia\n        inicioContagem = new Date(dataFimObj);\n        inicioContagem.setHours(16, 30, 0, 0);\n        \n        // Se emitido ap√≥s 16:30h OU se √© dia diferente ‚Üí ZERAR\n        if (horaEmissao > (16 * 60 + 30)) {\n            console.log(`‚ö†Ô∏è SEM ROTA - Pedido ${item.NUMPED} emitido ap√≥s 16:30h ‚Üí ZERADO`);\n            return 0; // ZERAR tempo\n        }\n        \n    } else {\n        // Tipo desconhecido - verificar se √© outro padr√£o\n        console.warn(`‚ö†Ô∏è Tipo n√£o reconhecido para ${item.NUMPED}: TIPO=\"${tipo}\", ROTA=\"${rota}\", POSICAO=\"${posicao}\"`);\n        \n        // Se n√£o reconheceu mas cont√©m palavras-chave de transportadora, zerar\n        if (rota.toUpperCase().includes('TRANSP') || \n            rota.toUpperCase().includes('SEM ROTA') ||\n            posicao.toUpperCase().includes('EM ROTA') ||\n            tipo.toUpperCase().includes('TRANSPORTADORA')) {\n            console.log(`‚ö†Ô∏è Palavra-chave de transportadora detectada ‚Üí ZERADO`);\n            return 0;\n        }\n        \n        inicioContagem = dataFimObj; // Usar confer√™ncia como padr√£o\n    }\n    \n    // Verifica√ß√£o adicional: Se sa√≠da foi muito antes de 16:30h, pode ser caso especial que deve zerar\n    const horaSaida = dataSaidaObj.getHours() * 60 + dataSaidaObj.getMinutes();\n    const isModeloTransportadora = (posicao && posicao.toUpperCase().includes('EM ROTA')) ||\n                                   (rota.toUpperCase().includes('TRANSP')) ||\n                                   (rota.toUpperCase().includes('SEM ROTA')) ||\n                                   (tipo.toUpperCase().includes('TRANSPORTADORA'));\n    \n    // Se √© modelo transportadora e sa√≠da foi muito cedo (antes de 14:00h), provavelmente deve zerar\n    if (isModeloTransportadora && horaSaida < (14 * 60)) {\n        console.log(`‚ö†Ô∏è Modelo TRANSPORTADORA - Pedido ${item.NUMPED} sa√≠da muito cedo (${Math.floor(horaSaida/60)}:${String(horaSaida%60).padStart(2,'0')}) ‚Üí ZERADO`);\n        return 0; // ZERAR para sa√≠das muito cedo\n    }\n    \n    // Para modelos TRANSPORTADORA: aplicar regra mais restritiva\n    if (isModeloTransportadora) {\n        // S√≥ conta se sa√≠da foi EXATAMENTE ap√≥s 16:30h e no mesmo dia\n        const horaSaida = dataSaidaObj.getHours() * 60 + dataSaidaObj.getMinutes();\n        \n        // Se sa√≠da foi antes de 16:30h ‚Üí ZERAR (n√£o deveria sair antes do hor√°rio de expedi√ß√£o)\n        if (horaSaida < (16 * 60 + 30)) {\n            const tipoParaLog = (posicao && posicao.toUpperCase().includes('EM ROTA')) ? 'EM ROTA' :\n                               (rota.toUpperCase().includes('TRANSP')) ? 'ROTA TRANSP' :\n                               tipo.toUpperCase().includes('TRANSPORTADORA') ? 'TRANSPORTADORA' :\n                               (rota.toUpperCase().includes('SEM ROTA')) ? 'SEM ROTA' : 'MODELO TRANSP';\n            \n            console.log(`‚ö†Ô∏è ${tipoParaLog} - Pedido ${item.NUMPED} sa√≠da antes de 16:30h (${Math.floor(horaSaida/60)}:${String(horaSaida%60).padStart(2,'0')}) ‚Üí ZERADO`);\n            return 0;\n        }\n        \n        // Se emiss√£o foi ap√≥s 16:30h ‚Üí ZERAR (j√° implementado acima)\n        // Se for dia diferente ‚Üí ZERAR (j√° implementado acima)\n    }\n    \n    // Calcular tempo entre in√≠cio da contagem e sa√≠da real\n    const tempoDispRota = Math.max(0, Math.floor((dataSaidaObj - inicioContagem) / 60000));\n    \n    // Debug inteligente\n    const tipoRegra = (item.POSICAO && item.POSICAO.toUpperCase().includes('EM ROTA')) ? 'EM ROTA' :\n                     (item.ROTA && item.ROTA.toUpperCase().includes('TRANSP')) ? 'ROTA TRANSP' :\n                     tipo.toUpperCase().includes('FIXA') ? 'FIXA' : \n                     tipo.toUpperCase().includes('IMEDIATA') ? 'IMEDIATA' : \n                     tipo.toUpperCase().includes('TRANSPORTADORA') ? 'TRANSPORTADORA' :\n                     (item.ROTA && item.ROTA.toUpperCase().includes('SEM ROTA')) ? 'SEM ROTA' : 'PADR√ÉO';\n    \n    // FOR√áAR ZERO para modelo transportadora (conforme solicitado)\n    if (isModeloTransportadora) {\n        console.log(`üìä ${tipoRegra} - ${item.NUMPED}: FOR√áADO ZERO (modelo transportadora)`);\n        console.log(`   ‚è∞ Emiss√£o: ${`${Math.floor(horaEmissao / 60)}:${String(horaEmissao % 60).padStart(2, '0')}`} ‚Üí Sa√≠da: ${dataSaidaObj?.toLocaleTimeString('pt-BR')} ‚Üí ZERADO`);\n        return 0; // FOR√áAR ZERO para todos os modelos transportadora\n    }\n    \n    // Para outros tipos (FIXA, IMEDIATA), calcular normalmente\n    console.log(`üìä ${tipoRegra} - ${item.NUMPED}: ${tempoDispRota}min`);\n    console.log(`   ‚è∞ Emiss√£o: ${`${Math.floor(horaEmissao / 60)}:${String(horaEmissao % 60).padStart(2, '0')}`} ‚Üí In√≠cio: ${inicioContagem?.toLocaleTimeString('pt-BR')} ‚Üí Sa√≠da: ${dataSaidaObj?.toLocaleTimeString('pt-BR')}`);\n    \n    return tempoDispRota;\n}\n\n// Fun√ß√£o para formatar valores\nfunction formatarValor(valor, tipo = 'tempo') {\n    if (!valor || valor === '0' || valor === 0) return '00:00:00';\n    \n    if (tipo === 'tempo' || tipo === 'minutos') {\n        // Se j√° est√° formatado como tempo, retornar como est√°\n        if (typeof valor === 'string' && valor.includes(':')) {\n            return valor;\n        }\n        \n        // Se √© n√∫mero de minutos, converter para HH:MM:SS\n        const minutos = parseInt(valor) || 0;\n        const horas = Math.floor(minutos / 60);\n        const mins = minutos % 60;\n        const segs = Math.floor((valor % 1) * 60); // Para casos com decimais\n        \n        return `${String(horas).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(segs).padStart(2, '0')}`;\n    }\n    \n    return valor;\n}\n\n// Fun√ß√£o para formatar percentual\nfunction formatarPercentual(valor) {\n    if (!valor) return '0%';\n    \n    const num = parseFloat(valor.toString().replace(',', '.'));\n    const classe = num > 0 ? 'positivo' : num < 0 ? 'negativo' : 'neutro';\n    const sinal = num > 0 ? '+' : '';\n    \n    return `<span class=\"${classe}\">${sinal}${num.toFixed(1)}%</span>`;\n}\n\n// Processar dados hier√°rquicos\nfunction processarDadosHierarquicos() {\n    console.log('üìä Processando dados hier√°rquicos...');\n    console.log('üì¶ Total de registros:', dadosOriginais.length);\n    \n    estruturaHierarquica = {};\n    \n    dadosOriginais.forEach((item, index) => {\n        // Extrair cidade da filial (primeira palavra antes do h√≠fen)\n        const filialCompleta = item.FILIAL || 'N/A';\n        const cidade = filialCompleta.split('-')[0] || filialCompleta;\n        const rota = item.ROTA || 'N/A';\n        const motoboy = item.NOMEMOTSAIDA || 'N/A';\n        const pedido = item.NUMPED || 'N/A';\n        \n        // Debug espec√≠fico para primeiros itens\n        if (index < 3) {\n            console.log(`üìä PROCESSANDO Item ${index}:`);\n            console.log(`   üèôÔ∏è Cidade extra√≠da: \"${cidade}\" (de \"${filialCompleta}\")`);\n            console.log(`   üè¢ Rota: \"${rota}\"`);\n            console.log(`   üèçÔ∏è Motoboy: \"${motoboy}\"`);\n            console.log(`   üì¶ Pedido: \"${pedido}\"`);\n        }\n        \n        // Criar estrutura hier√°rquica\n        if (!estruturaHierarquica[cidade]) {\n            estruturaHierarquica[cidade] = {\n                nome: cidade,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                filiais: {}\n            };\n        }\n        \n        if (!estruturaHierarquica[cidade].filiais[rota]) {\n            estruturaHierarquica[cidade].filiais[rota] = {\n                nome: rota,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                motoboys: {}\n            };\n        }\n        \n        if (!estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy]) {\n            estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy] = {\n                nome: motoboy,\n                codigo: item.CODMOTORISTA,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                pedidos: []\n            };\n        }\n        \n        // Adicionar pedido (OBJETO ORIGINAL DA QUERY)\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].pedidos.push(item);\n        \n        // Calcular m√©tricas baseadas nos timestamps\n        const qtPedidosNum = parseInt((item.QT_PEDIDOS || '1/1').split('/')[0]) || 0;\n        const minutosAtraso = parseInt(item.MINUTOS_ATRASO) || 0;\n        \n        // Calcular PED.DISP/ROTA baseado nas regras de neg√≥cio por TIPO\n        let pedDispRota = 0;\n        try {\n            pedDispRota = calcularPedDispRota(item);\n        } catch (error) {\n            console.error(`‚ùå Erro ao calcular PedDispRota para item ${index}:`, error);\n        }\n        \n        // Calcular TTE (Time To Execute - tempo entre DATASAIDA_STR e DATAENTREGA_STR)\n        let tte = 0;\n        try {\n            if (item.DATASAIDA_STR && item.DATAENTREGA_STR) {\n                const dataSaida = converterDataBrasileira(item.DATASAIDA_STR);\n                const dataEntrega = converterDataBrasileira(item.DATAENTREGA_STR);\n                if (dataSaida && dataEntrega) {\n                    tte = Math.max(0, Math.floor((dataEntrega - dataSaida) / 60000)); // Diferen√ßa em minutos\n                }\n            }\n        } catch (error) {\n            console.error(`‚ùå Erro ao calcular TTE para item ${index}:`, error);\n        }\n        \n        if (index < 3) { // Log detalhado dos primeiros 3 itens para debug\n            console.log(`üìä DEBUG Item ${index} (${item.NUMPED}):`);\n            console.log(`   üìÖ DATAFIMPACOTE_STR: ${item.DATAFIMPACOTE_STR}`);\n            console.log(`   üìÖ DATASAIDA_STR: ${item.DATASAIDA_STR}`);\n            console.log(`   üìÖ DATAENTREGA_STR: ${item.DATAENTREGA_STR}`);\n            \n            // Testar convers√£o das datas\n            const dataFimTest = converterDataBrasileira(item.DATAFIMPACOTE_STR);\n            const dataSaidaTest = converterDataBrasileira(item.DATASAIDA_STR);\n            const dataEntregaTest = converterDataBrasileira(item.DATAENTREGA_STR);\n            \n            console.log(`   üîÑ Data fim convertida: ${dataFimTest}`);\n            console.log(`   üîÑ Data sa√≠da convertida: ${dataSaidaTest}`);\n            console.log(`   üîÑ Data entrega convertida: ${dataEntregaTest}`);\n            console.log(`   ‚è∞ PedDispRota calculado: ${pedDispRota} minutos`);\n            console.log(`   ‚è∞ TTE calculado: ${tte} minutos`);\n            console.log(`   üì¶ QtyPed: ${qtPedidosNum} (de ${item.QT_PEDIDOS})`);\n            console.log('   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n        }\n        \n        // Acumular no motoboy\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.tte += tte;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.count++;\n        \n        // Acumular na filial\n        estruturaHierarquica[cidade].filiais[rota].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].filiais[rota].dados.tte += tte;\n        estruturaHierarquica[cidade].filiais[rota].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].filiais[rota].dados.count++;\n        \n        // Acumular na cidade\n        estruturaHierarquica[cidade].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].dados.tte += tte;\n        estruturaHierarquica[cidade].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].dados.count++;\n    });\n    \n    // Contabilizar quantos foram zerados\n    let pedidosZerados = 0;\n    let pedidosComTempo = 0;\n    dadosOriginais.forEach(item => {\n        const tempo = calcularPedDispRota(item);\n        if (tempo === 0) {\n            pedidosZerados++;\n        } else {\n            pedidosComTempo++;\n        }\n    });\n    \n    console.log('üìä RESUMO DOS TEMPOS CALCULADOS:');\n    console.log(`   ‚≠ï Pedidos ZERADOS: ${pedidosZerados} (modelo transportadora ou dia diferente)`);\n    console.log(`   ‚úÖ Pedidos COM TEMPO: ${pedidosComTempo}`);\n    console.log(`   üìä Total: ${pedidosZerados + pedidosComTempo}`);\n    \n    // Log das m√©tricas finais calculadas\n    console.log('üìä ESTRUTURA HIER√ÅRQUICA FINAL:');\n    Object.values(estruturaHierarquica).forEach(cidade => {\n        console.log(`üèôÔ∏è ${cidade.nome}:`);\n        console.log(`   üìä PedDisp total: ${cidade.dados.pedDisp}min, M√©dia: ${Math.floor(cidade.dados.pedDisp / cidade.dados.count)}min`);\n        console.log(`   ‚è∞ TTE total: ${cidade.dados.tte}min, M√©dia: ${Math.floor(cidade.dados.tte / cidade.dados.count)}min`);\n        console.log(`   üì¶ QtyPed: ${cidade.dados.qtyPed}, Count: ${cidade.dados.count}`);\n        \n        Object.values(cidade.filiais).forEach(filial => {\n            // Destacar filiais que s√£o modelo transportadora\n            const isTransportadora = filial.nome.toUpperCase().includes('SEM ROTA') || \n                                     filial.nome.toUpperCase().includes('TRANSP');\n            const status = isTransportadora ? '(deve estar zerado/baixo)' : '';\n            \n            console.log(`     üè¢ ${filial.nome} ${status}:`);\n            console.log(`        üìä PedDisp: ${filial.dados.pedDisp}min, TTE: ${filial.dados.tte}min, QtyPed: ${filial.dados.qtyPed}`);\n        });\n    });\n    \n    console.log('üìä Estrutura hier√°rquica criada com m√©tricas calculadas');\n    renderizarTabela();\n}\n\n// Renderizar tabela hier√°rquica\nfunction renderizarTabela() {\n    console.log('üé® Renderizando tabela hier√°rquica...');\n    console.log('üìä Estrutura dispon√≠vel:', Object.keys(estruturaHierarquica));\n    \n    const container = document.getElementById('tabelaHierarquica');\n    let html = '';\n    \n    Object.values(estruturaHierarquica).forEach(cidade => {\n        const cidadeId = 'cidade_' + cidade.nome.replace(/[^a-zA-Z0-9]/g, '_');\n        const isExpandida = configExpandir.cidades[cidade.nome] !== false;\n        \n        // Calcular m√©dias para a cidade\n        const pedDispMediaCidade = cidade.dados.count > 0 ? Math.floor(cidade.dados.pedDisp / cidade.dados.count) : 0;\n        const tteMediaCidade = cidade.dados.count > 0 ? Math.floor(cidade.dados.tte / cidade.dados.count) : 0;\n        \n        // Linha da Cidade\n        html += `\n            <div class=\"row-cidade\" onclick=\"toggleCidade('${cidade.nome}')\">\n                <div>\n                    <span class=\"expand-icon\" id=\"icon_${cidadeId}\">\n                        ${isExpandida ? '‚àí' : '+'}\n                    </span>\n                    üèôÔ∏è ${cidade.nome}\n                </div>\n                <div>${formatarValor(pedDispMediaCidade, 'minutos')}</div>\n                <div>-</div>\n                <div>${formatarValor(tteMediaCidade, 'minutos')}</div>\n                <div>-</div>\n                <div>${cidade.dados.qtyPed}</div>\n                <div>-</div>\n            </div>\n        `;\n        \n        // Filiais da Cidade\n        Object.values(cidade.filiais).forEach(filial => {\n            const filialId = 'filial_' + filial.nome.replace(/[^a-zA-Z0-9]/g, '_');\n            const filialExpandida = configExpandir.filiais[filial.nome] !== false;\n            \n            // Calcular m√©dias para a filial\n            const pedDispMediaFilial = filial.dados.count > 0 ? Math.floor(filial.dados.pedDisp / filial.dados.count) : 0;\n            const tteMediaFilial = filial.dados.count > 0 ? Math.floor(filial.dados.tte / filial.dados.count) : 0;\n            \n            // √çcone baseado no tipo de rota\n            let iconeFilial = 'üè¢';\n            if (filial.nome.toUpperCase().includes('SEM ROTA')) {\n                iconeFilial = 'üè∑Ô∏è'; // √çcone diferente para \"SEM ROTA CADASTRADA\"\n            }\n            \n            html += `\n                <div class=\"row-filial ${isExpandida ? '' : 'collapsed'}\" \n                     id=\"filiais_${cidadeId}\" \n                     onclick=\"toggleFilial('${filial.nome}')\">\n                    <div>\n                        <span class=\"expand-icon\" id=\"icon_${filialId}\">\n                            ${filialExpandida ? '‚àí' : '+'}\n                        </span>\n                        ${iconeFilial} ${filial.nome}\n                    </div>\n                    <div>${formatarValor(pedDispMediaFilial, 'minutos')}</div>\n                    <div>-</div>\n                    <div>${formatarValor(tteMediaFilial, 'minutos')}</div>\n                    <div>-</div>\n                    <div>${filial.dados.qtyPed}</div>\n                    <div>-</div>\n                </div>\n            `;\n            \n            // Motoboys da Filial\n            Object.values(filial.motoboys).forEach(motoboy => {\n                const motoboyId = 'motoboy_' + motoboy.nome.replace(/[^a-zA-Z0-9]/g, '_');\n                const motoboyExpandido = configExpandir.motoboys[motoboy.nome] !== false;\n                \n                // Calcular m√©dias para o motoboy\n                const pedDispMediaMotoboy = motoboy.dados.count > 0 ? Math.floor(motoboy.dados.pedDisp / motoboy.dados.count) : 0;\n                const tteMediaMotoboy = motoboy.dados.count > 0 ? Math.floor(motoboy.dados.tte / motoboy.dados.count) : 0;\n                \n                html += `\n                    <div class=\"row-motoboy ${isExpandida && filialExpandida ? '' : 'collapsed'}\" \n                         id=\"motoboys_${filialId}\" \n                         onclick=\"toggleMotoboy('${motoboy.nome}')\">\n                        <div>\n                            <span class=\"expand-icon\" id=\"icon_${motoboyId}\">\n                                ${motoboyExpandido ? '‚àí' : '+'}\n                            </span>\n                            üèçÔ∏è ${motoboy.nome}\n                        </div>\n                        <div>${formatarValor(pedDispMediaMotoboy, 'minutos')}</div>\n                        <div>-</div>\n                        <div>${formatarValor(tteMediaMotoboy, 'minutos')}</div>\n                        <div>-</div>\n                        <div>${motoboy.dados.qtyPed}</div>\n                        <div>-</div>\n                    </div>\n                `;\n                \n                // Debug antes dos pedidos\n                console.log(`üèçÔ∏è Renderizando ${motoboy.pedidos.length} pedidos do motoboy ${motoboy.nome}`);\n                \n                // Pedidos do Motoboy\n                motoboy.pedidos.forEach((pedido, pedidoIndex) => {\n                    // Verificar tipo do objeto pedido\n                    const numeroPedido = pedido.NUMPED || 'N/A';\n                    const qtPedidos = pedido.QT_PEDIDOS || 'N/A';\n                    const minutosAtraso = pedido.MINUTOS_ATRASO || '0';\n                    \n                    // Debug se algum campo for undefined\n                    if (numeroPedido === 'N/A' || qtPedidos === 'N/A') {\n                        console.error(`‚ùå UNDEFINED encontrado no pedido ${pedidoIndex}:`, {\n                            pedidoObjeto: pedido,\n                            NUMPED: pedido.NUMPED,\n                            QT_PEDIDOS: pedido.QT_PEDIDOS,\n                            todasAsPropriedades: Object.keys(pedido)\n                        });\n                    }\n                    \n                    html += `\n                        <div class=\"row-pedido ${isExpandida && filialExpandida && motoboyExpandido ? '' : 'collapsed'}\" \n                             id=\"pedidos_${motoboyId}\">\n                            <div>üì¶ ${numeroPedido}</div>\n                            <div>-</div>\n                            <div>-</div>\n                            <div>-</div>\n                            <div>-</div>\n                            <div>${qtPedidos}</div>\n                            <div class=\"${parseInt(minutosAtraso) > 0 ? 'negativo' : 'positivo'}\">\n                                ${minutosAtraso}min\n                            </div>\n                        </div>\n                    `;\n                });\n            });\n        });\n    });\n    \n    // Calcular totais gerais\n    let totalPedDisp = 0;\n    let totalTTE = 0;\n    let totalQtyPed = 0;\n    let totalCount = 0;\n    \n    Object.values(estruturaHierarquica).forEach(cidade => {\n        totalPedDisp += cidade.dados.pedDisp;\n        totalTTE += cidade.dados.tte;\n        totalQtyPed += cidade.dados.qtyPed;\n        totalCount += cidade.dados.count;\n    });\n    \n    const mediaPedDisp = totalCount > 0 ? Math.floor(totalPedDisp / totalCount) : 0;\n    const mediaTTE = totalCount > 0 ? Math.floor(totalTTE / totalCount) : 0;\n    \n    // Adicionar linha de total\n    html += `\n        <div class=\"row-total\">\n            <div>üìä TOTAL GERAL</div>\n            <div>${formatarValor(mediaPedDisp, 'minutos')}</div>\n            <div>-</div>\n            <div>${formatarValor(mediaTTE, 'minutos')}</div>\n            <div>-</div>\n            <div>${totalQtyPed}</div>\n            <div>-</div>\n        </div>\n    `;\n    \n    container.innerHTML = html;\n    console.log('‚úÖ Tabela hier√°rquica renderizada');\n    console.log(`üìä Totais: PedDisp=${mediaPedDisp}min, TTE=${mediaTTE}min, QtyPed=${totalQtyPed}, Registros=${totalCount}`);\n}\n\n// Fun√ß√µes de Toggle (Expandir/Colapsar)\nfunction toggleCidade(nomeCidade) {\n    console.log(`üèôÔ∏è Toggle cidade: ${nomeCidade}`);\n    \n    const isExpandida = configExpandir.cidades[nomeCidade] !== false;\n    configExpandir.cidades[nomeCidade] = !isExpandida;\n    \n    renderizarTabela();\n}\n\nfunction toggleFilial(nomeFilial) {\n    console.log(`üè¢ Toggle filial: ${nomeFilial}`);\n    \n    const isExpandida = configExpandir.filiais[nomeFilial] !== false;\n    configExpandir.filiais[nomeFilial] = !isExpandida;\n    \n    renderizarTabela();\n}\n\nfunction toggleMotoboy(nomeMotoboy) {\n    console.log(`üèçÔ∏è Toggle motoboy: ${nomeMotoboy}`);\n    \n    const isExpandido = configExpandir.motoboys[nomeMotoboy] !== false;\n    configExpandir.motoboys[nomeMotoboy] = !isExpandido;\n    \n    renderizarTabela();\n}\n\n// Popular filtros\nfunction popularFiltros() {\n    console.log('üìã Populando filtros...');\n    \n    // Popular filiais\n    const filiais = [...new Set(dadosOriginais.map(d => d.FILIAL))].filter(f => f).sort();\n    const selectFilial = document.getElementById('filterFilial');\n    selectFilial.innerHTML = '<option value=\"\">Todas</option>';\n    filiais.forEach(filial => {\n        selectFilial.innerHTML += `<option value=\"${filial}\">${filial}</option>`;\n    });\n    \n    // Popular motoboys\n    const motoboys = [...new Set(dadosOriginais.map(d => d.NOMEMOTSAIDA))].filter(m => m).sort();\n    const selectMotoboy = document.getElementById('filterMotoboy');\n    selectMotoboy.innerHTML = '<option value=\"\">Todos</option>';\n    motoboys.forEach(motoboy => {\n        selectMotoboy.innerHTML += `<option value=\"${motoboy}\">${motoboy}</option>`;\n    });\n    \n    console.log('üìã Filtros populados:', { filiais: filiais.length, motoboys: motoboys.length });\n}\n\n// Aplicar filtros\nfunction aplicarFiltros() {\n    console.log('üîç Aplicando filtros...');\n    \n    const filterStatus = document.getElementById('filterStatus').value;\n    const filterEntregue = document.getElementById('filterEntregue').value;\n    const filterFilial = document.getElementById('filterFilial').value;\n    const filterMotoboy = document.getElementById('filterMotoboy').value;\n    const filterData = document.getElementById('filterData').value;\n    \n    console.log('üìä Filtros ativos:', { filterStatus, filterEntregue, filterFilial, filterMotoboy, filterData });\n    \n    dadosFiltrados = dadosOriginais.filter(item => {\n        // Filtro por filial\n        if (filterFilial && item.FILIAL !== filterFilial) return false;\n        \n        // Filtro por motoboy\n        if (filterMotoboy && item.NOMEMOTSAIDA !== filterMotoboy) return false;\n        \n        // Filtro por data (comparar com DATAENTREGA_STR)\n        if (filterData && item.DATAENTREGA_STR) {\n            const dataItem = item.DATAENTREGA_STR.split(' ')[0]; // Pegar s√≥ a data\n            const dataFiltro = new Date(filterData).toLocaleDateString('pt-BR');\n            const dataItemFormatada = dataItem.split('/').reverse().join('-');\n            const dataItemDate = new Date(dataItemFormatada).toLocaleDateString('pt-BR');\n            \n            if (dataItemDate !== dataFiltro) return false;\n        }\n        \n        return true;\n    });\n    \n    console.log(`üìä Filtros aplicados: ${dadosFiltrados.length}/${dadosOriginais.length} registros`);\n    \n    // Debug dos dados filtrados\n    if (dadosFiltrados.length > 0 && dadosFiltrados.length <= 10) {\n        console.log('üîç DADOS FILTRADOS (amostra):');\n        dadosFiltrados.slice(0, 3).forEach((item, i) => {\n            console.log(`${i + 1}. ${item.NUMPED}:`, {\n                FILIAL: item.FILIAL,\n                ROTA: item.ROTA, \n                NOMEMOTSAIDA: item.NOMEMOTSAIDA,\n                QT_PEDIDOS: item.QT_PEDIDOS,\n                MINUTOS_ATRASO: item.MINUTOS_ATRASO\n            });\n        });\n    }\n    \n    // Reprocessar dados filtrados\n    processarDadosHierarquicosFiltrados();\n}\n\n// Processar dados filtrados (usar mesma l√≥gica da fun√ß√£o principal)\nfunction processarDadosHierarquicosFiltrados() {\n    console.log('üîç Reprocessando dados com filtros...');\n    \n    // Usar dadosFiltrados em vez de dadosOriginais para reprocessar\n    const dadosParaProcessar = dadosFiltrados.length > 0 ? dadosFiltrados : dadosOriginais;\n    console.log(`üìä Processando ${dadosParaProcessar.length} registros filtrados`);\n    \n    // Resetar estrutura\n    estruturaHierarquica = {};\n    \n    dadosParaProcessar.forEach((item, index) => {\n        // Extrair cidade da filial (primeira palavra antes do h√≠fen)\n        const filialCompleta = item.FILIAL || 'N/A';\n        const cidade = filialCompleta.split('-')[0] || filialCompleta;\n        const rota = item.ROTA || 'N/A';\n        const motoboy = item.NOMEMOTSAIDA || 'N/A';\n        \n        // Criar estrutura hier√°rquica (mesma l√≥gica)\n        if (!estruturaHierarquica[cidade]) {\n            estruturaHierarquica[cidade] = {\n                nome: cidade,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                filiais: {}\n            };\n        }\n        \n        if (!estruturaHierarquica[cidade].filiais[rota]) {\n            estruturaHierarquica[cidade].filiais[rota] = {\n                nome: rota,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                motoboys: {}\n            };\n        }\n        \n        if (!estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy]) {\n            estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy] = {\n                nome: motoboy,\n                codigo: item.CODMOTORISTA,\n                dados: { pedDisp: 0, tte: 0, qtyPed: 0, count: 0 },\n                pedidos: []\n            };\n        }\n        \n        // Adicionar pedido (OBJETO ORIGINAL DA QUERY)\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].pedidos.push(item);\n        \n        // Calcular m√©tricas (MESMA L√ìGICA)\n        const qtPedidosNum = parseInt((item.QT_PEDIDOS || '1/1').split('/')[0]) || 0;\n        \n        // Calcular PED.DISP/ROTA (mesma l√≥gica de neg√≥cio)\n        let pedDispRota = 0;\n        try {\n            pedDispRota = calcularPedDispRota(item);\n        } catch (error) {\n            console.error(`‚ùå Erro ao calcular PedDispRota (filtro) item ${index}:`, error);\n        }\n        \n        // Calcular TTE\n        let tte = 0;\n        try {\n            if (item.DATASAIDA_STR && item.DATAENTREGA_STR) {\n                const dataSaida = converterDataBrasileira(item.DATASAIDA_STR);\n                const dataEntrega = converterDataBrasileira(item.DATAENTREGA_STR);\n                if (dataSaida && dataEntrega) {\n                    tte = Math.max(0, Math.floor((dataEntrega - dataSaida) / 60000));\n                }\n            }\n        } catch (error) {\n            console.error(`‚ùå Erro ao calcular TTE (filtro) item ${index}:`, error);\n        }\n        \n        // Acumular no motoboy\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.tte += tte;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].filiais[rota].motoboys[motoboy].dados.count++;\n        \n        // Acumular na filial\n        estruturaHierarquica[cidade].filiais[rota].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].filiais[rota].dados.tte += tte;\n        estruturaHierarquica[cidade].filiais[rota].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].filiais[rota].dados.count++;\n        \n        // Acumular na cidade\n        estruturaHierarquica[cidade].dados.pedDisp += pedDispRota;\n        estruturaHierarquica[cidade].dados.tte += tte;\n        estruturaHierarquica[cidade].dados.qtyPed += qtPedidosNum;\n        estruturaHierarquica[cidade].dados.count++;\n    });\n    \n    console.log('üìä Dados filtrados reprocessados');\n    \n    // Debug da estrutura filtrada\n    console.log('üîç Estrutura filtrada criada:');\n    Object.entries(estruturaHierarquica).forEach(([nomeCidade, cidade]) => {\n        console.log(`üèôÔ∏è ${nomeCidade}: ${Object.keys(cidade.filiais).length} filiais`);\n        Object.entries(cidade.filiais).forEach(([nomeFilial, filial]) => {\n            console.log(`   üè¢ ${nomeFilial}: ${Object.keys(filial.motoboys).length} motoboys`);\n            Object.entries(filial.motoboys).forEach(([nomeMotoboy, motoboy]) => {\n                console.log(`      üèçÔ∏è ${nomeMotoboy}: ${motoboy.pedidos.length} pedidos`);\n                if (motoboy.pedidos.length > 0) {\n                    console.log(`         üì¶ Primeiro pedido:`, motoboy.pedidos[0]);\n                }\n            });\n        });\n    });\n    \n    renderizarTabela();\n}\n\n// Inicializar quando a p√°gina carregar\nsetTimeout(() => {\n    console.log('üöÄ Inicializando Relat√≥rio de Motoboys...');\n    console.log('üì¶ Dados carregados:', dadosOriginais.length, 'registros');\n    \n    if (dadosOriginais.length > 0) {\n        console.log('üîç Exemplo de registro:', dadosOriginais[0]);\n        console.log('üîë Campos dispon√≠veis:', Object.keys(dadosOriginais[0]));\n        \n        // Debug espec√≠fico dos campos de tempo e tipos\n        console.log('üìÖ Campos de data/hora no primeiro registro:');\n        console.log(`   POSICAO: ${dadosOriginais[0].POSICAO} (para detectar EM ROTA)`);\n        console.log(`   TIPO: ${dadosOriginais[0].TIPO} (${dadosOriginais[0].TIPO?.toUpperCase()})`);\n        console.log(`   ROTA: ${dadosOriginais[0].ROTA} (para detectar TRANSP)`);\n        console.log(`   PREVISAO_SAIDA: ${dadosOriginais[0].PREVISAO_SAIDA}`);\n        console.log(`   DATAFIMPACOTE_STR: ${dadosOriginais[0].DATAFIMPACOTE_STR}`);\n        console.log(`   DATASAIDA_STR: ${dadosOriginais[0].DATASAIDA_STR}`);\n        console.log(`   DATAENTREGA_STR: ${dadosOriginais[0].DATAENTREGA_STR}`);\n        console.log(`   DATARETORNO_STR: ${dadosOriginais[0].DATARETORNO_STR}`);\n        console.log(`   MINUTOS_ATRASO: ${dadosOriginais[0].MINUTOS_ATRASO}`);\n        \n        // Testar c√°lculo do primeiro item\n        console.log('üß™ TESTE do c√°lculo PedDispRota para primeiro item:');\n        const testePedDisp = calcularPedDispRota(dadosOriginais[0]);\n        console.log(`   üìä Resultado: ${testePedDisp} minutos`);\n        \n        // Analisar distribui√ß√£o de tipos\n        console.log('üìä AN√ÅLISE DE TIPOS DE ROTA:');\n        const contagemTipos = {};\n        dadosOriginais.forEach(item => {\n            let categoria = 'OUTROS';\n            \n            // Verificar na ordem de prioridade\n            if (item.POSICAO && item.POSICAO.toUpperCase().includes('EM ROTA')) {\n                categoria = 'EM ROTA (POSI√á√ÉO)';\n            } else if (item.ROTA && item.ROTA.toUpperCase().includes('TRANSP')) {\n                categoria = 'ROTA TRANSP';\n            } else if (item.TIPO && item.TIPO.toUpperCase().includes('FIXA')) {\n                categoria = 'FIXA';\n            } else if (item.TIPO && item.TIPO.toUpperCase().includes('IMEDIATA')) {\n                categoria = 'IMEDIATA';\n            } else if (item.TIPO && item.TIPO.toUpperCase().includes('TRANSPORTADORA')) {\n                categoria = 'TRANSPORTADORA';\n            } else if (item.ROTA && item.ROTA.toUpperCase().includes('SEM ROTA')) {\n                categoria = 'SEM ROTA CADASTRADA';\n            }\n            \n            contagemTipos[categoria] = (contagemTipos[categoria] || 0) + 1;\n        });\n        \n        console.log('   üìä Distribui√ß√£o por tipo:', contagemTipos);\n        \n        // Verificar pedidos de dias diferentes\n        let pedidosDiaDiferente = 0;\n        dadosOriginais.forEach(item => {\n            if (item.DATAFIMPACOTE_STR && item.DATASAIDA_STR) {\n                const dataFim = converterDataBrasileira(item.DATAFIMPACOTE_STR);\n                const dataSaida = converterDataBrasileira(item.DATASAIDA_STR);\n                \n                if (dataFim && dataSaida) {\n                    const dataFimDia = `${dataFim.getFullYear()}-${dataFim.getMonth()}-${dataFim.getDate()}`;\n                    const dataSaidaDia = `${dataSaida.getFullYear()}-${dataSaida.getMonth()}-${dataSaida.getDate()}`;\n                    \n                    if (dataFimDia !== dataSaidaDia) {\n                        pedidosDiaDiferente++;\n                    }\n                }\n            }\n        });\n        \n        console.log(`‚ö†Ô∏è Pedidos de um dia para outro: ${pedidosDiaDiferente} (n√£o contam no tempo)`);\n        console.log(`‚úÖ Pedidos do mesmo dia: ${dadosOriginais.length - pedidosDiaDiferente} (contam tempo normal)`);\n        \n        // Mostrar exemplos de cada tipo\n        Object.keys(contagemTipos).forEach(tipo => {\n            const exemplo = dadosOriginais.find(item => {\n                if (tipo === 'EM ROTA (POSI√á√ÉO)') return item.POSICAO?.toUpperCase().includes('EM ROTA');\n                if (tipo === 'ROTA TRANSP') return item.ROTA?.toUpperCase().includes('TRANSP');\n                if (tipo === 'FIXA') return item.TIPO?.toUpperCase().includes('FIXA');\n                if (tipo === 'IMEDIATA') return item.TIPO?.toUpperCase().includes('IMEDIATA');\n                if (tipo === 'TRANSPORTADORA') return item.TIPO?.toUpperCase().includes('TRANSPORTADORA');\n                if (tipo === 'SEM ROTA CADASTRADA') return item.ROTA?.toUpperCase().includes('SEM ROTA');\n                return true;\n            });\n            \n            if (exemplo) {\n                console.log(`   üîç Exemplo ${tipo}:`, {\n                    NUMPED: exemplo.NUMPED,\n                    POSICAO: exemplo.POSICAO,\n                    TIPO: exemplo.TIPO,\n                    ROTA: exemplo.ROTA,\n                    DATAFIMPACOTE_STR: exemplo.DATAFIMPACOTE_STR\n                });\n            }\n        });\n        \n        popularFiltros();\n        processarDadosHierarquicos();\n    } else {\n        console.error('‚ùå Nenhum dado encontrado na query rotas_bi_motoboy');\n        document.getElementById('tabelaHierarquica').innerHTML = `\n            <div class=\"loading\">\n                ‚ùå Nenhum dado encontrado na query rotas_bi_motoboy\n            </div>\n        `;\n    }\n}, 500);\n\n// Analisar pedidos de dias diferentes\nfunction analisarPedidosDias() {\n    console.log('üìÖ === AN√ÅLISE DE PEDIDOS POR DIA ===');\n    \n    let pedidosMesmoDia = 0;\n    let pedidosDiaDiferente = 0;\n    let exemplosDiaDiferente = [];\n    \n    dadosOriginais.forEach(item => {\n        if (item.DATAFIMPACOTE_STR && item.DATASAIDA_STR) {\n            const dataFim = converterDataBrasileira(item.DATAFIMPACOTE_STR);\n            const dataSaida = converterDataBrasileira(item.DATASAIDA_STR);\n            \n            if (dataFim && dataSaida) {\n                const dataFimDia = `${dataFim.getFullYear()}-${dataFim.getMonth()}-${dataFim.getDate()}`;\n                const dataSaidaDia = `${dataSaida.getFullYear()}-${dataSaida.getMonth()}-${dataSaida.getDate()}`;\n                \n                if (dataFimDia === dataSaidaDia) {\n                    pedidosMesmoDia++;\n                } else {\n                    pedidosDiaDiferente++;\n                    if (exemplosDiaDiferente.length < 5) {\n                        exemplosDiaDiferente.push({\n                            NUMPED: item.NUMPED,\n                            TIPO: item.TIPO,\n                            DATAFIMPACOTE: item.DATAFIMPACOTE_STR,\n                            DATASAIDA: item.DATASAIDA_STR,\n                            diaEmissao: dataFim.toLocaleDateString('pt-BR'),\n                            diaSaida: dataSaida.toLocaleDateString('pt-BR')\n                        });\n                    }\n                }\n            }\n        }\n    });\n    \n    console.log(`üìä RESULTADO DA AN√ÅLISE:`);\n    console.log(`   ‚úÖ Pedidos mesmo dia: ${pedidosMesmoDia}`);\n    console.log(`   ‚ö†Ô∏è Pedidos dia diferente: ${pedidosDiaDiferente} (N√ÉO contam tempo)`);\n    console.log(`   üìä Total analisados: ${pedidosMesmoDia + pedidosDiaDiferente}`);\n    \n    if (exemplosDiaDiferente.length > 0) {\n        console.log(`üìã Exemplos de pedidos de dia diferente:`, exemplosDiaDiferente);\n    }\n    \n    const mensagem = `\nüìÖ AN√ÅLISE DE PEDIDOS POR DIA:\n\n‚úÖ Mesmo dia: ${pedidosMesmoDia} pedidos (contam tempo)\n‚ö†Ô∏è Dia diferente: ${pedidosDiaDiferente} pedidos (N√ÉO contam)\n\n${exemplosDiaDiferente.length > 0 ? '\\nüìã Exemplos de dia diferente:\\n' + \nexemplosDiaDiferente.map(ex => \n    `‚Ä¢ ${ex.NUMPED}: ${ex.diaEmissao} ‚Üí ${ex.diaSaida}`\n).join('\\n') : ''}\n\nüí° Pedidos de um dia para outro t√™m PedDispRota = 0\n    `;\n    \n    alert(mensagem);\n}\n\n// Analisar especificamente rotas SEM ROTA CADASTRADA\nfunction analisarSemRota() {\n    console.log('üè∑Ô∏è === AN√ÅLISE ESPEC√çFICA: SEM ROTA CADASTRADA ===');\n    \n    const rotasSemRota = dadosOriginais.filter(item => \n        item.ROTA && item.ROTA.toUpperCase().includes('SEM ROTA')\n    );\n    \n    console.log(`üìä Total de pedidos SEM ROTA: ${rotasSemRota.length}`);\n    \n    let zerados = 0;\n    let comTempo = 0;\n    let exemplosDetalhados = [];\n    \n    rotasSemRota.forEach((item, index) => {\n        const tempo = calcularPedDispRota(item);\n        const dataFim = converterDataBrasileira(item.DATAFIMPACOTE_STR);\n        const dataSaida = converterDataBrasileira(item.DATASAIDA_STR);\n        \n        if (tempo === 0) {\n            zerados++;\n        } else {\n            comTempo++;\n        }\n        \n        // Coletar exemplos para an√°lise\n        if (index < 10) { // Primeiros 10\n            const horaEmissao = dataFim ? dataFim.getHours() * 60 + dataFim.getMinutes() : 0;\n            const horaSaida = dataSaida ? dataSaida.getHours() * 60 + dataSaida.getMinutes() : 0;\n            \n            exemplosDetalhados.push({\n                pedido: item.NUMPED,\n                motoboy: item.NOMEMOTSAIDA,\n                horaEmissao: `${Math.floor(horaEmissao / 60)}:${String(horaEmissao % 60).padStart(2, '0')}`,\n                horaSaida: `${Math.floor(horaSaida / 60)}:${String(horaSaida % 60).padStart(2, '0')}`,\n                tempoCalculado: tempo,\n                dataEmissao: item.DATAFIMPACOTE_STR,\n                dataSaida: item.DATASAIDA_STR\n            });\n        }\n    });\n    \n    console.log(`üìä RESULTADO SEM ROTA:`);\n    console.log(`   ‚≠ï Zerados: ${zerados}`);\n    console.log(`   ‚úÖ Com tempo: ${comTempo}`);\n    console.log(`   üìã Exemplos detalhados:`, exemplosDetalhados);\n    \n    // Mostrar padr√µes\n    console.log('üîç AN√ÅLISE DE PADR√ïES:');\n    exemplosDetalhados.forEach(ex => {\n        const statusTempo = ex.tempoCalculado === 0 ? '‚≠ï ZERADO' : '‚úÖ COM TEMPO';\n        console.log(`   ${statusTempo} - ${ex.pedido}: ${ex.horaEmissao} ‚Üí ${ex.horaSaida} = ${ex.tempoCalculado}min`);\n    });\n    \n    const mensagemSemRota = `\nüè∑Ô∏è AN√ÅLISE SEM ROTA CADASTRADA:\n\nüìä Total: ${rotasSemRota.length} pedidos\n‚≠ï Zerados: ${zerados} pedidos (correto - modelo transportadora)\n‚úÖ Com tempo: ${comTempo} pedidos (verificar se correto)\n\n${exemplosDetalhados.slice(0, 5).map(ex => \n    `‚Ä¢ ${ex.pedido}: ${ex.horaEmissao} ‚Üí ${ex.horaSaida} = ${ex.tempoCalculado}min ${ex.tempoCalculado === 0 ? '(ZERADO ‚úì)' : '(COM TEMPO - verificar)'}`\n).join('\\n')}\n\nüí° Modelo transportadora deve ter maioria zerada.\n    `;\n    \n    alert(mensagemSemRota);\n}\n\n// For√ßar zero para todos os tipos transportadora\nfunction forcarZerarTransportadora() {\n    console.log('‚≠ï === FOR√áANDO ZERO PARA MODELOS TRANSPORTADORA ===');\n    \n    let zerados = 0;\n    \n    // Iterar pela estrutura hier√°rquica e zerar todos os transportadora\n    Object.values(estruturaHierarquica).forEach(cidade => {\n        Object.values(cidade.filiais).forEach(filial => {\n            // Detectar se √© modelo transportadora\n            const isModeloTransp = filial.nome.toUpperCase().includes('SEM ROTA') ||\n                                   filial.nome.toUpperCase().includes('TRANSP') ||\n                                   filial.motoboys && Object.values(filial.motoboys).some(m => \n                                       m.pedidos.some(p => \n                                           (p.POSICAO && p.POSICAO.toUpperCase().includes('EM ROTA')) ||\n                                           (p.TIPO && p.TIPO.toUpperCase().includes('TRANSPORTADORA'))\n                                       )\n                                   );\n            \n            if (isModeloTransp) {\n                console.log(`‚≠ï Zerando filial: ${filial.nome}`);\n                \n                // Zerar dados da filial\n                filial.dados.pedDisp = 0;\n                // N√£o zerar TTE nem QtyPed, apenas PedDisp\n                zerados++;\n                \n                // Zerar dados dos motoboys tamb√©m\n                Object.values(filial.motoboys).forEach(motoboy => {\n                    motoboy.dados.pedDisp = 0;\n                });\n            }\n        });\n        \n        // Recalcular totais da cidade\n        cidade.dados.pedDisp = 0;\n        Object.values(cidade.filiais).forEach(filial => {\n            cidade.dados.pedDisp += filial.dados.pedDisp;\n        });\n    });\n    \n    console.log(`‚≠ï Filiais zeradas: ${zerados}`);\n    \n    // Re-renderizar tabela\n    renderizarTabela();\n    \n    alert(`‚≠ï ZERO FOR√áADO!\\n\\n${zerados} filiais de modelo transportadora foram zeradas.\\n\\nA tabela foi atualizada.`);\n}\n\n// Fun√ß√£o de debug para mostrar dados processados\nfunction mostrarDebugDados() {\n    console.log('üîç === DEBUG COMPLETO DOS DADOS ===');\n    console.log('üì¶ Dados originais:', dadosOriginais.length, 'registros');\n    \n    if (dadosOriginais.length > 0) {\n        console.log('üîç AMOSTRA DOS PRIMEIROS 5 REGISTROS:');\n        dadosOriginais.slice(0, 5).forEach((item, i) => {\n            console.log(`${i + 1}. Pedido ${item.NUMPED}:`);\n            console.log(`   üèçÔ∏è Motoboy: ${item.NOMEMOTSAIDA} (${item.CODMOTORISTA})`);\n            console.log(`   üè¢ Rota: ${item.ROTA}`);\n            console.log(`   üìÖ Fim Pacote: ${item.DATAFIMPACOTE_STR}`);\n            console.log(`   üìÖ Sa√≠da: ${item.DATASAIDA_STR}`);\n            console.log(`   üìÖ Entrega: ${item.DATAENTREGA_STR}`);\n            console.log(`   üìÖ Retorno: ${item.DATARETORNO_STR}`);\n            console.log(`   ‚è∞ Minutos Atraso: ${item.MINUTOS_ATRASO}`);\n            console.log(`   üì¶ Qt Pedidos: ${item.QT_PEDIDOS}`);\n            console.log('   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n        });\n    }\n    \n    console.log('üìä ESTRUTURA PROCESSADA:');\n    console.log('üèôÔ∏è Cidades:', Object.keys(estruturaHierarquica));\n    \n    Object.entries(estruturaHierarquica).forEach(([nomeCidade, cidade]) => {\n        console.log(`üèôÔ∏è ${nomeCidade}:`);\n        console.log(`   üìä Totais: PedDisp=${cidade.dados.pedDisp}min, TTE=${cidade.dados.tte}min, QtyPed=${cidade.dados.qtyPed}`);\n        console.log(`   üìã Filiais:`, Object.keys(cidade.filiais));\n        \n        Object.entries(cidade.filiais).forEach(([nomeFilial, filial]) => {\n            console.log(`     üè¢ ${nomeFilial}:`);\n            console.log(`        üìä Totais: PedDisp=${filial.dados.pedDisp}min, TTE=${filial.dados.tte}min`);\n            console.log(`        üèçÔ∏è Motoboys:`, Object.keys(filial.motoboys));\n        });\n    });\n    \n    console.log('üîç === DEBUG FINALIZADO ===');\n    \n    // Mostrar tamb√©m em alert para f√°cil visualiza√ß√£o\n    const resumo = `\nDEBUG DOS DADOS:\nüì¶ Total: ${dadosOriginais.length} registros\nüèôÔ∏è Cidades: ${Object.keys(estruturaHierarquica).length}\nüìä Estrutura: ${JSON.stringify(estruturaHierarquica, null, 2)}\n    `;\n    \n    // Mostrar apenas um resumo no alert para n√£o ser muito longo\n    alert(`Debug - ${dadosOriginais.length} registros processados em ${Object.keys(estruturaHierarquica).length} cidades. Veja console para detalhes completos.`);\n}\n\n// Mostrar regras de neg√≥cio\nfunction mostrarRegrasNegocio() {\n    const regras = `\nüìã REGRAS DE NEG√ìCIO - C√ÅLCULO PED.DISP/ROTA:\n\nüîß ROTA FIXA:\n‚Ä¢ Emitidos at√© 09:15h ‚Üí Saem √†s 09:30h ‚Üí Contar de 09:30h\n‚Ä¢ Emitidos 09:15h-13:15h ‚Üí Saem √†s 13:30h ‚Üí Contar de 13:30h  \n‚Ä¢ Emitidos ap√≥s 13:15h ‚Üí Pr√≥ximo dia √†s 09:30h\n\n‚ö° IMEDIATA:\n‚Ä¢ Conta imediatamente ap√≥s confer√™ncia (DATAFIMPACOTE_STR)\n\nüöö TRANSPORTADORA:\n‚Ä¢ SEMPRE ZERADO (modelo transportadora)\n\nüöõ ROTA TRANSP:\n‚Ä¢ SEMPRE ZERADO (modelo transportadora)\n\nüõ£Ô∏è EM ROTA (POSI√á√ÉO):\n‚Ä¢ SEMPRE ZERADO (modelo transportadora)\n\nüè∑Ô∏è SEM ROTA CADASTRADA:\n‚Ä¢ SEMPRE ZERADO (modelo transportadora)\n\nüìä C√ÅLCULOS:\n‚Ä¢ PED.DISP/ROTA = DATASAIDA - in√≠cio_contagem\n‚Ä¢ TTE = DATAENTREGA - DATASAIDA\n‚Ä¢ QTY.PED = extra√≠do de QT_PEDIDOS\n‚Ä¢ ATRASO = MINUTOS_ATRASO (direto da query)\n\n‚ö†Ô∏è REGRA ESPECIAL:\n‚Ä¢ Pedidos de um dia para outro N√ÉO contam no tempo\n‚Ä¢ Apenas pedidos do mesmo dia s√£o considerados no c√°lculo\n\nüîç DETEC√á√ÉO AUTOM√ÅTICA:\n‚Ä¢ POSICAO = \"EM ROTA\" ‚Üí regra 16:30h\n‚Ä¢ ROTA cont√©m \"TRANSP\" ‚Üí regra 16:30h  \n‚Ä¢ TIPO = \"FIXA/IMEDIATA/TRANSPORTADORA\" ‚Üí regras espec√≠ficas\n‚Ä¢ ROTA = \"SEM ROTA\" ‚Üí regra 16:30h\n\nüí° Sistema prioriza POSICAO > ROTA > TIPO para classifica√ß√£o.\n    `;\n    \n    alert(regras);\n    console.log('üìã REGRAS IMPLEMENTADAS (com SEM ROTA):', regras);\n}\n</script>\n\n{{''}}\n",
  "topRow": 4,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "657hm0z829",
  "widgetName": "Iframe10"
}