{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 96,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "aejnf55fns",
  "leftColumn": 0,
  "mobileBottomRow": 41,
  "mobileLeftColumn": 4,
  "mobileRightColumn": 28,
  "mobileTopRow": 9,
  "needsErrorInfo": false,
  "originalBottomRow": 123,
  "originalTopRow": 23,
  "parentColumnSpace": 22.85107421875,
  "parentId": "7ihs9l9ks3",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "https://www.example.com",
  "srcDoc": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dashboard - An√°lise de Tempo Atraso</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n\n        .container {\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n\n        .header {\n            background: white;\n            padding: 24px 32px;\n            border-radius: 16px;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);\n            margin-bottom: 24px;\n        }\n\n        .header h1 {\n            font-size: 28px;\n            font-weight: 800;\n            color: #111827;\n            margin-bottom: 8px;\n        }\n\n        .header p {\n            color: #6b7280;\n            font-size: 14px;\n        }\n\n        /* KPIs */\n        .kpis {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .kpi-card {\n            background: white;\n            padding: 20px;\n            border-radius: 12px;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n            border-left: 4px solid;\n        }\n\n        .kpi-card.primary { border-left-color: #667eea; }\n        .kpi-card.success { border-left-color: #10b981; }\n        .kpi-card.warning { border-left-color: #f59e0b; }\n        .kpi-card.danger { border-left-color: #ef4444; }\n\n        .kpi-label {\n            font-size: 12px;\n            color: #6b7280;\n            text-transform: uppercase;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n\n        .kpi-value {\n            font-size: 32px;\n            font-weight: 800;\n            color: #111827;\n            margin-bottom: 4px;\n        }\n\n        .kpi-subtitle {\n            font-size: 13px;\n            color: #9ca3af;\n        }\n\n        /* Filtros */\n        .filters-card {\n            background: white;\n            padding: 24px;\n            border-radius: 12px;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n            margin-bottom: 24px;\n        }\n\n        .filters-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 20px;\n        }\n\n        .filters-header h3 {\n            font-size: 18px;\n            font-weight: 700;\n            color: #111827;\n        }\n\n        .filters-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 16px;\n            margin-bottom: 16px;\n        }\n\n        .filter-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .filter-group label {\n            font-size: 12px;\n            font-weight: 600;\n            color: #374151;\n            margin-bottom: 6px;\n        }\n\n        .filter-group select,\n        .filter-group input {\n            padding: 10px 12px;\n            border: 2px solid #e5e7eb;\n            border-radius: 8px;\n            font-size: 14px;\n            transition: all 0.2s;\n            background: white;\n        }\n\n        .filter-group select:focus,\n        .filter-group input:focus {\n            outline: none;\n            border-color: #667eea;\n            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n        }\n\n        .filter-buttons {\n            display: flex;\n            gap: 12px;\n        }\n\n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: inline-flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .btn-primary {\n            background: #667eea;\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5568d3;\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n\n        .btn-secondary {\n            background: #f3f4f6;\n            color: #374151;\n        }\n\n        .btn-secondary:hover {\n            background: #e5e7eb;\n        }\n\n        /* Abas */\n        .tabs {\n            display: flex;\n            gap: 8px;\n            margin-bottom: 0;\n            background: white;\n            padding: 16px 16px 0 16px;\n            border-radius: 12px 12px 0 0;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n        }\n\n        .tab {\n            padding: 12px 24px;\n            background: transparent;\n            border: none;\n            border-radius: 8px 8px 0 0;\n            font-size: 14px;\n            font-weight: 600;\n            color: #6b7280;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .tab:hover {\n            background: #f3f4f6;\n            color: #374151;\n        }\n\n        .tab.active {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n\n        /* Conte√∫do das abas */\n        .content-card {\n            background: white;\n            padding: 24px;\n            border-radius: 0 0 12px 12px;\n            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n        }\n\n        .tab-content {\n            display: none;\n        }\n\n        .tab-content.active {\n            display: block;\n        }\n\n        /* Tabela */\n        .table-wrapper {\n            overflow-x: auto;\n            border-radius: 8px;\n            border: 1px solid #e5e7eb;\n        }\n\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n        }\n\n        thead {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n\n        th {\n            padding: 14px 16px;\n            text-align: left;\n            font-size: 12px;\n            font-weight: 700;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            white-space: nowrap;\n        }\n\n        td {\n            padding: 14px 16px;\n            border-bottom: 1px solid #f3f4f6;\n            font-size: 14px;\n            color: #374151;\n        }\n\n        tbody tr {\n            transition: all 0.2s;\n        }\n\n        tbody tr:hover {\n            background: #f9fafb;\n        }\n\n        .td-strong {\n            font-weight: 700;\n            color: #111827;\n        }\n\n        .td-muted {\n            color: #9ca3af;\n        }\n\n        /* Badges */\n        .badge {\n            display: inline-block;\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            font-weight: 600;\n            white-space: nowrap;\n        }\n\n        .badge-success {\n            background: #d1fae5;\n            color: #065f46;\n        }\n\n        .badge-warning {\n            background: #fef3c7;\n            color: #92400e;\n        }\n\n        .badge-danger {\n            background: #fee2e2;\n            color: #991b1b;\n        }\n\n        .badge-info {\n            background: #dbeafe;\n            color: #1e40af;\n        }\n\n        /* Pagina√ß√£o */\n        .pagination {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            margin-top: 20px;\n            padding: 16px;\n        }\n\n        .pagination button {\n            padding: 8px 16px;\n            border: 2px solid #e5e7eb;\n            background: white;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 600;\n            color: #374151;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .pagination button:hover:not(:disabled) {\n            border-color: #667eea;\n            color: #667eea;\n        }\n\n        .pagination button:disabled {\n            opacity: 0.4;\n            cursor: not-allowed;\n        }\n\n        .pagination button.active {\n            background: #667eea;\n            color: white;\n            border-color: #667eea;\n        }\n\n        .pagination-info {\n            font-size: 14px;\n            color: #6b7280;\n            margin: 0 12px;\n        }\n\n        /* Grupo de Cards */\n        .group-cards {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 16px;\n            margin-bottom: 20px;\n        }\n\n        .group-card {\n            background: white;\n            border: 2px solid #e5e7eb;\n            border-radius: 12px;\n            padding: 20px;\n            transition: all 0.3s;\n        }\n\n        .group-card:hover {\n            border-color: #667eea;\n            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);\n            transform: translateY(-2px);\n        }\n\n        .group-card-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 16px;\n            padding-bottom: 12px;\n            border-bottom: 2px solid #f3f4f6;\n        }\n\n        .group-card-title {\n            font-size: 16px;\n            font-weight: 700;\n            color: #111827;\n        }\n\n        .group-card-count {\n            font-size: 24px;\n            font-weight: 800;\n            color: #667eea;\n        }\n\n        .group-card-body {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n\n        .group-stat {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            font-size: 13px;\n        }\n\n        .group-stat-label {\n            color: #6b7280;\n        }\n\n        .group-stat-value {\n            font-weight: 600;\n            color: #111827;\n        }\n\n        /* Estado vazio */\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: #9ca3af;\n        }\n\n        .empty-state-icon {\n            font-size: 48px;\n            margin-bottom: 16px;\n        }\n\n        .empty-state-text {\n            font-size: 16px;\n            font-weight: 600;\n        }\n\n        /* Responsivo */\n        @media (max-width: 768px) {\n            body {\n                padding: 12px;\n            }\n\n            .header h1 {\n                font-size: 22px;\n            }\n\n            .kpis {\n                grid-template-columns: 1fr;\n            }\n\n            .filters-grid {\n                grid-template-columns: 1fr;\n            }\n\n            .tabs {\n                overflow-x: auto;\n                padding: 12px 12px 0 12px;\n            }\n\n            .tab {\n                padding: 10px 16px;\n                font-size: 13px;\n            }\n\n            table {\n                font-size: 12px;\n            }\n\n            th, td {\n                padding: 10px 12px;\n            }\n        }\n\n        /* Loading */\n        .loading {\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 40px;\n            color: #6b7280;\n            font-size: 14px;\n        }\n\n        .spinner {\n            border: 3px solid #f3f4f6;\n            border-top: 3px solid #667eea;\n            border-radius: 50%;\n            width: 30px;\n            height: 30px;\n            animation: spin 1s linear infinite;\n            margin-right: 12px;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <h1>‚è±Ô∏è Dashboard de Tempo Atraso</h1>\n            <p>An√°lise detalhada de atraso de motoboys e otimiza√ß√£o de rotas</p>\n        </div>\n\n        <!-- KPIs -->\n        <div class=\"kpis\" id=\"kpis\">\n            <!-- Preenchido dinamicamente -->\n        </div>\n\n        <!-- Filtros -->\n        <div class=\"filters-card\">\n            <div class=\"filters-header\">\n                <h3>üîç Filtros</h3>\n            </div>\n            <div class=\"filters-grid\">\n                <div class=\"filter-group\">\n                    <label for=\"filterFilial\">Filial</label>\n                    <select id=\"filterFilial\">\n                        <option value=\"\">Todas as Filiais</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label for=\"filterMotorista\">Motorista</label>\n                    <select id=\"filterMotorista\">\n                        <option value=\"\">Todos os Motoristas</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label for=\"filterStatus\">Status</label>\n                    <select id=\"filterStatus\">\n                        <option value=\"\">Todos os Status</option>\n                        <option value=\"Com atraso\">Com atraso</option>\n                        <option value=\"Sem atraso\">Sem atraso</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label for=\"filterSaidaId\">ID Sa√≠da</label>\n                    <input type=\"text\" id=\"filterSaidaId\" placeholder=\"Pesquisar sa√≠da...\">\n                </div>\n                <div class=\"filter-group\">\n                    <label for=\"filterPedido\">N√∫mero do Pedido</label>\n                    <input type=\"text\" id=\"filterPedido\" placeholder=\"Pesquisar pedido...\">\n                </div>\n                <div class=\"filter-group\">\n                    <label for=\"filterTempoMin\">Tempo Atraso (min)</label>\n                    <select id=\"filterTempoMin\">\n                        <option value=\"\">Todos</option>\n                        <option value=\"0-5\">0 a 5 min</option>\n                        <option value=\"5-10\">5 a 10 min</option>\n                        <option value=\"10-15\">10 a 15 min</option>\n                        <option value=\"15+\">Mais de 15 min</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"filter-buttons\">\n                <button class=\"btn btn-primary\" onclick=\"applyFilters()\">\n                    üîç Aplicar Filtros\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"clearFilters()\">\n                    ‚úï Limpar Filtros\n                </button>\n            </div>\n        </div>\n\n        <!-- Abas -->\n        <div class=\"tabs\">\n            <button class=\"tab active\" onclick=\"switchTab('detalhes')\">üìã Detalhes</button>\n            <button class=\"tab\" onclick=\"switchTab('por-saida')\">üì¶ Por Sa√≠da</button>\n            <button class=\"tab\" onclick=\"switchTab('por-filial')\">üè¢ Por Filial</button>\n            <button class=\"tab\" onclick=\"switchTab('por-motorista')\">üèçÔ∏è Por Motorista</button>\n        </div>\n\n        <!-- Conte√∫do -->\n        <div class=\"content-card\">\n            <!-- Aba: Detalhes -->\n            <div class=\"tab-content active\" id=\"tab-detalhes\">\n                <div class=\"table-wrapper\">\n                    <table>\n                        <thead>\n                            <tr>\n                                <th>Sa√≠da ID</th>\n                                <th>Filial</th>\n                                <th>Motorista</th>\n                                <th>Pedido</th>\n                                <th>Data Sa√≠da</th>\n                                <th>In√≠cio atraso</th>\n                                <th>Tempo Atraso</th>\n                                <th>Status</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableDetalhes\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-detalhes\"></div>\n            </div>\n\n            <!-- Aba: Por Sa√≠da -->\n            <div class=\"tab-content\" id=\"tab-por-saida\">\n                <div id=\"groupBySaida\" class=\"group-cards\">\n                    <!-- Preenchido dinamicamente -->\n                </div>\n            </div>\n\n            <!-- Aba: Por Filial -->\n            <div class=\"tab-content\" id=\"tab-por-filial\">\n                <div id=\"groupByFilial\" class=\"group-cards\">\n                    <!-- Preenchido dinamicamente -->\n                </div>\n            </div>\n\n            <!-- Aba: Por Motorista -->\n            <div class=\"tab-content\" id=\"tab-por-motorista\">\n                <div id=\"groupByMotorista\" class=\"group-cards\">\n                    <!-- Preenchido dinamicamente -->\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // ========================================\n        // DADOS GLOBAIS\n        // ========================================\n        let rawData = [];\n        let filteredData = [];\n        let currentTab = 'detalhes';\n\n        // Pagina√ß√£o\n        let pagination = {\n            currentPage: 1,\n            itemsPerPage: 20\n        };\n\n        // Filtros ativos\n        let activeFilters = {\n            filial: '',\n            motorista: '',\n            status: '',\n            saidaId: '',\n            pedido: '',\n            tempoMin: ''\n        };\n\n        // ========================================\n        // CARREGAR DADOS DO APPSMITH\n        // ========================================\n        function loadDataFromAppsmith(dados) {\n            try {\n                console.log('üîç Verificando dados recebidos:', dados);\n                \n                if (typeof dados === 'string') {\n                    try {\n                        const parsed = JSON.parse(dados);\n                        console.log('‚úÖ String JSON detectada e parseada');\n                        dados = parsed;\n                    } catch (parseError) {\n                        console.error('‚ùå Erro ao fazer parse do JSON string:', parseError);\n                    }\n                }\n                \n                // Verificar se dados √© um array direto\n                if (Array.isArray(dados)) {\n                    rawData = dados;\n                    console.log('‚úÖ Array direto detectado');\n                }\n                // Verificar se tem propriedade 'detalhes'\n                else if (dados && dados.detalhes && Array.isArray(dados.detalhes)) {\n                    rawData = dados.detalhes;\n                    console.log('‚úÖ Propriedade detalhes encontrada');\n                }\n                // Tentar outras varia√ß√µes comuns\n                else if (dados && Array.isArray(dados.data)) {\n                    rawData = dados.data;\n                    console.log('‚úÖ Propriedade data encontrada');\n                }\n                else {\n                    console.error('‚ùå Formato de dados inv√°lido:', typeof dados);\n                    console.error('Estrutura recebida:', JSON.stringify(dados).substring(0, 200));\n                    showEmptyState();\n                    return;\n                }\n                \n                filteredData = [...rawData];\n                console.log('‚úÖ Total de registros carregados:', rawData.length);\n                \n                if (rawData.length > 0) {\n                    console.log('üìã Amostra do primeiro registro:', rawData[0]);\n                }\n                \n                // Inicializar dashboard\n                populateFilters();\n                updateKPIs();\n                renderCurrentTab();\n                \n            } catch (error) {\n                console.error('‚ùå Erro ao carregar dados:', error);\n                console.error('Stack:', error.stack);\n                showEmptyState();\n            }\n        }\n\n        // ========================================\n        // POPULAR FILTROS\n        // ========================================\n        function populateFilters() {\n            // Filiais √∫nicas\n            const filiais = [...new Set(rawData.map(d => d.filial))].filter(f => f).sort();\n            const selectFilial = document.getElementById('filterFilial');\n            selectFilial.innerHTML = '<option value=\"\">Todas as Filiais</option>' + \n                filiais.map(f => `<option value=\"${f}\">${f}</option>`).join('');\n\n            // Motoristas √∫nicos\n            const motoristas = [...new Set(rawData.map(d => d.codMotorista))].filter(m => m).sort();\n            const selectMotorista = document.getElementById('filterMotorista');\n            selectMotorista.innerHTML = '<option value=\"\">Todos os Motoristas</option>' + \n                motoristas.map(m => `<option value=\"${m}\">${m}</option>`).join('');\n        }\n\n        // ========================================\n        // APLICAR FILTROS\n        // ========================================\n        function applyFilters() {\n            // Capturar valores\n            activeFilters.filial = document.getElementById('filterFilial').value;\n            activeFilters.motorista = document.getElementById('filterMotorista').value;\n            activeFilters.status = document.getElementById('filterStatus').value;\n            activeFilters.saidaId = document.getElementById('filterSaidaId').value.trim();\n            activeFilters.pedido = document.getElementById('filterPedido').value.trim();\n            activeFilters.tempoMin = document.getElementById('filterTempoMin').value;\n\n            console.log('üîç Aplicando filtros:', activeFilters);\n\n            // Filtrar dados\n            filteredData = rawData.filter(item => {\n                if (activeFilters.filial && item.filial !== activeFilters.filial) return false;\n                if (activeFilters.motorista && item.codMotorista !== activeFilters.motorista) return false;\n                if (activeFilters.status && item.status !== activeFilters.status) return false;\n                if (activeFilters.saidaId && !String(item.saidaId).includes(activeFilters.saidaId)) return false;\n                if (activeFilters.pedido && !String(item.numPed).includes(activeFilters.pedido)) return false;\n                \n                if (activeFilters.tempoMin) {\n                    const tempo = item.tempoOciosoMinutos || 0;\n                    if (activeFilters.tempoMin === '0-5' && (tempo < 0 || tempo > 5)) return false;\n                    if (activeFilters.tempoMin === '5-10' && (tempo < 5 || tempo > 10)) return false;\n                    if (activeFilters.tempoMin === '10-15' && (tempo < 10 || tempo > 15)) return false;\n                    if (activeFilters.tempoMin === '15+' && tempo < 15) return false;\n                }\n\n                return true;\n            });\n\n            console.log('‚úÖ Dados filtrados:', filteredData.length, 'registros');\n\n            // Resetar pagina√ß√£o\n            pagination.currentPage = 1;\n\n            // Atualizar visualiza√ß√£o\n            updateKPIs();\n            renderCurrentTab();\n        }\n\n        function clearFilters() {\n            // Limpar inputs\n            document.getElementById('filterFilial').value = '';\n            document.getElementById('filterMotorista').value = '';\n            document.getElementById('filterStatus').value = '';\n            document.getElementById('filterSaidaId').value = '';\n            document.getElementById('filterPedido').value = '';\n            document.getElementById('filterTempoMin').value = '';\n\n            // Limpar filtros ativos\n            activeFilters = {\n                filial: '',\n                motorista: '',\n                status: '',\n                saidaId: '',\n                pedido: '',\n                tempoMin: ''\n            };\n\n            // Restaurar dados\n            filteredData = [...rawData];\n            pagination.currentPage = 1;\n\n            // Atualizar visualiza√ß√£o\n            updateKPIs();\n            renderCurrentTab();\n        }\n\n        // ========================================\n        // ATUALIZAR KPIs\n        // ========================================\n        function updateKPIs() {\n            const totalRegistros = filteredData.length;\n            const comOciosidade = filteredData.filter(d => d.status === 'Com atraso').length;\n            const totalOcioso = filteredData.reduce((sum, d) => sum + (d.tempoOciosoMinutos || 0), 0);\n            const mediaOcioso = totalRegistros > 0 ? totalOcioso / totalRegistros : 0;\n\n            const kpisContainer = document.getElementById('kpis');\n            kpisContainer.innerHTML = `\n                <div class=\"kpi-card primary\">\n                    <div class=\"kpi-label\">üìä Total de Registros</div>\n                    <div class=\"kpi-value\">${totalRegistros}</div>\n                    <div class=\"kpi-subtitle\">Detalhes processados</div>\n                </div>\n                <div class=\"kpi-card danger\">\n                    <div class=\"kpi-label\">‚è±Ô∏è Com atraso</div>\n                    <div class=\"kpi-value\">${comOciosidade}</div>\n                    <div class=\"kpi-subtitle\">${totalRegistros > 0 ? ((comOciosidade / totalRegistros) * 100).toFixed(1) : 0}% do total</div>\n                </div>\n                <div class=\"kpi-card warning\">\n                    <div class=\"kpi-label\">üïê Tempo Total Atraso</div>\n                    <div class=\"kpi-value\">${formatarTempo(totalOcioso)}</div>\n                    <div class=\"kpi-subtitle\">${totalOcioso.toFixed(1)} minutos</div>\n                </div>\n                <div class=\"kpi-card success\">\n                    <div class=\"kpi-label\">üìà M√©dia de atraso</div>\n                    <div class=\"kpi-value\">${mediaOcioso.toFixed(1)} min</div>\n                    <div class=\"kpi-subtitle\">Por registro</div>\n                </div>\n            `;\n        }\n\n        // ========================================\n        // TROCAR ABA\n        // ========================================\n        function switchTab(tabName) {\n            currentTab = tabName;\n\n            // Atualizar bot√µes\n            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));\n            event.target.classList.add('active');\n\n            // Atualizar conte√∫do\n            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));\n            document.getElementById(`tab-${tabName}`).classList.add('active');\n\n            // Renderizar conte√∫do da aba\n            renderCurrentTab();\n        }\n\n        function renderCurrentTab() {\n            switch (currentTab) {\n                case 'detalhes':\n                    renderTableDetalhes();\n                    break;\n                case 'por-saida':\n                    renderGroupBySaida();\n                    break;\n                case 'por-filial':\n                    renderGroupByFilial();\n                    break;\n                case 'por-motorista':\n                    renderGroupByMotorista();\n                    break;\n            }\n        }\n\n        // ========================================\n        // RENDERIZAR TABELA DETALHES\n        // ========================================\n        function renderTableDetalhes() {\n            const tbody = document.getElementById('tableDetalhes');\n            \n            if (filteredData.length === 0) {\n                tbody.innerHTML = '<tr><td colspan=\"8\" class=\"empty-state\"><div class=\"empty-state-icon\">üì≠</div><div class=\"empty-state-text\">Nenhum registro encontrado</div></td></tr>';\n                document.getElementById('pagination-detalhes').innerHTML = '';\n                return;\n            }\n\n            // Pagina√ß√£o\n            const start = (pagination.currentPage - 1) * pagination.itemsPerPage;\n            const end = start + pagination.itemsPerPage;\n            const paginatedData = filteredData.slice(start, end);\n\n            tbody.innerHTML = paginatedData.map(item => {\n                const statusClass = item.status === 'Com atraso' ? 'badge-danger' : 'badge-success';\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${item.saidaId || '-'}</td>\n                        <td>${item.filial || '-'}</td>\n                        <td class=\"td-strong\">${item.codMotorista || '-'}</td>\n                        <td>${item.numPed || '-'}</td>\n                        <td class=\"td-muted\">${item.dataSaida || '-'}</td>\n                        <td class=\"td-muted\">${item.inicioOciosidade || '-'}</td>\n                        <td class=\"td-strong\" style=\"color: ${(item.tempoOciosoMinutos || 0) > 10 ? '#ef4444' : '#f59e0b'};\">\n                            ${item.tempoOciosoFormatado || '0m 0s'}\n                            <div style=\"font-size: 11px; color: #9ca3af;\">(${(item.tempoOciosoMinutos || 0).toFixed(1)} min)</div>\n                        </td>\n                        <td><span class=\"badge ${statusClass}\">${item.status || 'N/A'}</span></td>\n                    </tr>\n                `;\n            }).join('');\n\n            renderPagination();\n        }\n\n        // ========================================\n        // RENDERIZAR AGRUPAMENTO POR SA√çDA\n        // ========================================\n        function renderGroupBySaida() {\n            const container = document.getElementById('groupBySaida');\n            \n            // Agrupar por sa√≠da\n            const grouped = {};\n            filteredData.forEach(item => {\n                const key = item.saidaId;\n                if (!grouped[key]) {\n                    grouped[key] = {\n                        saidaId: key,\n                        filial: item.filial,\n                        motorista: item.codMotorista,\n                        items: [],\n                        totalOcioso: 0\n                    };\n                }\n                grouped[key].items.push(item);\n                grouped[key].totalOcioso += (item.tempoOciosoMinutos || 0);\n            });\n\n            const groups = Object.values(grouped).sort((a, b) => b.totalOcioso - a.totalOcioso);\n\n            if (groups.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì≠</div><div class=\"empty-state-text\">Nenhuma sa√≠da encontrada</div></div>';\n                return;\n            }\n\n            container.innerHTML = groups.map(group => `\n                <div class=\"group-card\">\n                    <div class=\"group-card-header\">\n                        <div class=\"group-card-title\">Sa√≠da #${group.saidaId}</div>\n                        <div class=\"group-card-count\">${group.items.length}</div>\n                    </div>\n                    <div class=\"group-card-body\">\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Filial:</span>\n                            <span class=\"group-stat-value\">${group.filial || '-'}</span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Motorista:</span>\n                            <span class=\"group-stat-value\">${group.motorista || '-'}</span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Pedidos:</span>\n                            <span class=\"group-stat-value\">${group.items.length}</span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Tempo Atraso Total:</span>\n                            <span class=\"group-stat-value\" style=\"color: ${group.totalOcioso > 10 ? '#ef4444' : '#f59e0b'};\">\n                                ${formatarTempo(group.totalOcioso)}\n                            </span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">M√©dia por Pedido:</span>\n                            <span class=\"group-stat-value\">${(group.totalOcioso / group.items.length).toFixed(1)} min</span>\n                        </div>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // ========================================\n        // RENDERIZAR AGRUPAMENTO POR FILIAL\n        // ========================================\n        function renderGroupByFilial() {\n            const container = document.getElementById('groupByFilial');\n            \n            // Agrupar por filial\n            const grouped = {};\n            filteredData.forEach(item => {\n                const key = item.filial || 'Sem Filial';\n                if (!grouped[key]) {\n                    grouped[key] = {\n                        filial: key,\n                        items: [],\n                        totalOcioso: 0,\n                        saidas: new Set()\n                    };\n                }\n                grouped[key].items.push(item);\n                grouped[key].totalOcioso += (item.tempoOciosoMinutos || 0);\n                grouped[key].saidas.add(item.saidaId);\n            });\n\n            const groups = Object.values(grouped).sort((a, b) => b.totalOcioso - a.totalOcioso);\n\n            if (groups.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì≠</div><div class=\"empty-state-text\">Nenhuma filial encontrada</div></div>';\n                return;\n            }\n\n            container.innerHTML = groups.map(group => `\n                <div class=\"group-card\">\n                    <div class=\"group-card-header\">\n                        <div class=\"group-card-title\">üè¢ ${group.filial}</div>\n                        <div class=\"group-card-count\">${group.items.length}</div>\n                    </div>\n                    <div class=\"group-card-body\">\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Registros:</span>\n                            <span class=\"group-stat-value\">${group.items.length}</span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Sa√≠das:</span>\n                            <span class=\"group-stat-value\">${group.saidas.size}</span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">Tempo Atraso Total:</span>\n                            <span class=\"group-stat-value\" style=\"color: ${group.totalOcioso > 30 ? '#ef4444' : '#f59e0b'};\">\n                                ${formatarTempo(group.totalOcioso)}\n                            </span>\n                        </div>\n                        <div class=\"group-stat\">\n                            <span class=\"group-stat-label\">M√©dia:</span>\n                            <span class=\"group-stat-value\">${(group.totalOcioso / group.items.length).toFixed(1)} min</span>\n                        </div>\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // ========================================\n        // RENDERIZAR AGRUPAMENTO POR MOTORISTA\n        // ========================================\n        function renderGroupByMotorista() {\n            const container = document.getElementById('groupByMotorista');\n            \n            // Agrupar por motorista\n            const grouped = {};\n            filteredData.forEach(item => {\n                const key = item.codMotorista || 'Sem Motorista';\n                if (!grouped[key]) {\n                    grouped[key] = {\n                        motorista: key,\n                        items: [],\n                        totalOcioso: 0,\n                        saidas: new Set()\n                    };\n                }\n                grouped[key].items.push(item);\n                grouped[key].totalOcioso += (item.tempoOciosoMinutos || 0);\n                grouped[key].saidas.add(item.saidaId);\n            });\n\n            const groups = Object.values(grouped).sort((a, b) => b.totalOcioso - a.totalOcioso);\n\n            if (groups.length === 0) {\n                container.innerHTML = '<div class=\"empty-state\"><div class=\"empty-state-icon\">üì≠</div><div class=\"empty-state-text\">Nenhum motorista encontrado</div></div>';\n                return;\n            }\n\n            container.innerHTML = groups.map(group => {\n                const media = group.totalOcioso / group.items.length;\n                let performance = 'Excelente';\n                let performanceColor = '#10b981';\n                \n                if (media > 10) {\n                    performance = 'Cr√≠tico';\n                    performanceColor = '#ef4444';\n                } else if (media > 5) {\n                    performance = 'Aten√ß√£o';\n                    performanceColor = '#f59e0b';\n                }\n\n                return `\n                    <div class=\"group-card\">\n                        <div class=\"group-card-header\">\n                            <div class=\"group-card-title\">üèçÔ∏è Motorista ${group.motorista}</div>\n                            <div class=\"group-card-count\">${group.items.length}</div>\n                        </div>\n                        <div class=\"group-card-body\">\n                            <div class=\"group-stat\">\n                                <span class=\"group-stat-label\">Registros:</span>\n                                <span class=\"group-stat-value\">${group.items.length}</span>\n                            </div>\n                            <div class=\"group-stat\">\n                                <span class=\"group-stat-label\">Sa√≠das:</span>\n                                <span class=\"group-stat-value\">${group.saidas.size}</span>\n                            </div>\n                            <div class=\"group-stat\">\n                                <span class=\"group-stat-label\">Tempo Atraso Total:</span>\n                                <span class=\"group-stat-value\" style=\"color: ${group.totalOcioso > 30 ? '#ef4444' : '#f59e0b'};\">\n                                    ${formatarTempo(group.totalOcioso)}\n                                </span>\n                            </div>\n                            <div class=\"group-stat\">\n                                <span class=\"group-stat-label\">M√©dia:</span>\n                                <span class=\"group-stat-value\">${media.toFixed(1)} min</span>\n                            </div>\n                            <div class=\"group-stat\">\n                                <span class=\"group-stat-label\">Performance:</span>\n                                <span class=\"group-stat-value\" style=\"color: ${performanceColor}; font-weight: 700;\">\n                                    ${performance}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            }).join('');\n        }\n\n        // ========================================\n        // PAGINA√á√ÉO\n        // ========================================\n        function renderPagination() {\n            const container = document.getElementById('pagination-detalhes');\n            const totalPages = Math.ceil(filteredData.length / pagination.itemsPerPage);\n\n            if (totalPages <= 1) {\n                container.innerHTML = '';\n                return;\n            }\n\n            const start = (pagination.currentPage - 1) * pagination.itemsPerPage + 1;\n            const end = Math.min(start + pagination.itemsPerPage - 1, filteredData.length);\n\n            let html = `\n                <button onclick=\"changePage(${pagination.currentPage - 1})\" ${pagination.currentPage === 1 ? 'disabled' : ''}>\n                    ‚Üê Anterior\n                </button>\n            `;\n\n            // P√°ginas\n            for (let i = 1; i <= totalPages; i++) {\n                if (i === 1 || i === totalPages || (i >= pagination.currentPage - 2 && i <= pagination.currentPage + 2)) {\n                    html += `\n                        <button onclick=\"changePage(${i})\" class=\"${i === pagination.currentPage ? 'active' : ''}\">\n                            ${i}\n                        </button>\n                    `;\n                } else if (i === pagination.currentPage - 3 || i === pagination.currentPage + 3) {\n                    html += '<span style=\"padding: 0 8px;\">...</span>';\n                }\n            }\n\n            html += `\n                <button onclick=\"changePage(${pagination.currentPage + 1})\" ${pagination.currentPage === totalPages ? 'disabled' : ''}>\n                    Pr√≥xima ‚Üí\n                </button>\n                <span class=\"pagination-info\">\n                    ${start}-${end} de ${filteredData.length}\n                </span>\n            `;\n\n            container.innerHTML = html;\n        }\n\n        function changePage(page) {\n            const totalPages = Math.ceil(filteredData.length / pagination.itemsPerPage);\n            if (page < 1 || page > totalPages) return;\n            \n            pagination.currentPage = page;\n            renderTableDetalhes();\n        }\n\n        // ========================================\n        // UTILIT√ÅRIOS\n        // ========================================\n        function formatarTempo(minutos) {\n            if (!minutos || minutos < 0) return '0m 0s';\n            \n            const horas = Math.floor(minutos / 60);\n            const mins = Math.floor(minutos % 60);\n            const segs = Math.floor((minutos % 1) * 60);\n            \n            if (horas > 0) {\n                return `${horas}h ${mins}m`;\n            } else {\n                return `${mins}m ${segs}s`;\n            }\n        }\n\n        function showEmptyState() {\n            document.getElementById('kpis').innerHTML = `\n                <div class=\"empty-state\" style=\"grid-column: 1/-1; padding: 40px;\">\n                    <div class=\"empty-state-icon\">‚ö†Ô∏è</div>\n                    <div class=\"empty-state-text\">Nenhum dado dispon√≠vel</div>\n                    <p style=\"color: #9ca3af; font-size: 13px; margin-top: 12px;\">\n                        Verifique se a consulta <code>tempo_atraso.calcularTempoOcioso.data</code> est√° retornando dados.\n                    </p>\n                    <button class=\"btn btn-primary\" onclick=\"location.reload()\" style=\"margin-top: 16px;\">\n                        üîÑ Recarregar P√°gina\n                    </button>\n                </div>\n            `;\n            document.getElementById('tableDetalhes').innerHTML = '<tr><td colspan=\"8\" class=\"empty-state\"><div class=\"empty-state-icon\">üì≠</div><div class=\"empty-state-text\">Aguardando dados do Appsmith...</div></td></tr>';\n        }\n\n        // ========================================\n        // INICIALIZA√á√ÉO\n        // ========================================\n        function inicializarDashboard() {\n            console.log('üöÄ Inicializando Dashboard de Tempo Atraso...');\n            \n            try {\n                // Capturar dados do Appsmith injetados globalmente\n                if (typeof window.dadosTempoOcioso !== 'undefined') {\n                    loadDataFromAppsmith(window.dadosTempoOcioso);\n                } else {\n                    console.warn('‚ö†Ô∏è Aguardando dados do Appsmith...');\n                    showEmptyState();\n                }\n            } catch (error) {\n                console.error('‚ùå Erro na inicializa√ß√£o:', error);\n                showEmptyState();\n            }\n        }\n\n        // Executar quando DOM estiver pronto\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', inicializarDashboard);\n        } else {\n            inicializarDashboard();\n        }\n    </script>\n\n    <!-- Script de inje√ß√£o de dados do Appsmith -->\n    <script>\n        // Dados injetados pelo Appsmith (sintaxe de template)\n        try {\n            console.log('üîÑ Tentando carregar dados do Appsmith...');\n            \n            {{\n                (() => {\n                    const dados = tempo_atraso.calcularTempoOcioso();\n                    return `window.dadosTempoOcioso = ${JSON.stringify(dados)};`;\n                })()\n            }}\n            \n            console.log('üìä Dados do Appsmith recebidos!');\n            console.log('   Tipo:', typeof window.dadosTempoOcioso);\n            console.log('   √â Array?', Array.isArray(window.dadosTempoOcioso));\n            console.log('   Tem propriedade detalhes?', window.dadosTempoOcioso && window.dadosTempoOcioso.detalhes);\n            \n            if (window.dadosTempoOcioso) {\n                console.log('   Estrutura:', Object.keys(window.dadosTempoOcioso));\n                \n                if (window.dadosTempoOcioso.detalhes) {\n                    console.log('   Total de registros em detalhes:', window.dadosTempoOcioso.detalhes.length);\n                }\n            }\n            \n            // Se j√° est√° carregado, inicializar agora\n            if (typeof loadDataFromAppsmith !== 'undefined') {\n                console.log('‚úÖ Fun√ß√£o loadDataFromAppsmith dispon√≠vel, carregando dados...');\n                loadDataFromAppsmith(window.dadosTempoOcioso);\n            } else {\n                console.warn('‚ö†Ô∏è Fun√ß√£o loadDataFromAppsmith ainda n√£o dispon√≠vel');\n            }\n        } catch (error) {\n            console.error('‚ùå Erro ao carregar dados do Appsmith:', error);\n            console.error('   Stack:', error.stack);\n            window.dadosTempoOcioso = { detalhes: [] };\n        }\n    </script>\n</body>\n</html>\n",
  "topRow": 0,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "ef1im9gxng",
  "widgetName": "Iframe13"
}