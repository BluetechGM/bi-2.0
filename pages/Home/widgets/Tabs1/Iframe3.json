{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 199,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "v104wcek7u",
  "leftColumn": 0,
  "mobileBottomRow": 33,
  "mobileLeftColumn": 0,
  "mobileRightColumn": 21,
  "mobileTopRow": 1,
  "needsErrorInfo": false,
  "parentColumnSpace": 19.9375,
  "parentId": "2jahgj1omi",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "https://www.example.com",
  "srcDoc": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Auditoria Completa - BlueTech Log√≠stica</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;\n            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n            min-height: 100vh;\n            padding: 20px;\n        }\n\n        .audit-container {\n            max-width: 1800px;\n            margin: 0 auto;\n        }\n\n        /* ========== HEADER ========== */\n        .audit-header {\n            background: white;\n            padding: 24px 32px;\n            border-radius: 16px;\n            box-shadow: 0 8px 32px rgba(0,0,0,0.12);\n            margin-bottom: 24px;\n        }\n\n        .audit-header h1 {\n            font-size: 32px;\n            font-weight: 900;\n            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            margin-bottom: 8px;\n        }\n\n        .audit-header p {\n            color: #6b7280;\n            font-size: 14px;\n        }\n\n        /* ========== FILTERS ========== */\n        .filters-section {\n            background: white;\n            padding: 20px 32px;\n            border-radius: 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n            margin-bottom: 24px;\n        }\n\n        .filters-title {\n            font-size: 16px;\n            font-weight: 700;\n            color: #374151;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .filters-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 16px;\n        }\n\n        .filter-group {\n            display: flex;\n            flex-direction: column;\n            gap: 6px;\n        }\n\n        .filter-group label {\n            font-size: 12px;\n            font-weight: 600;\n            color: #6b7280;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .filter-group select,\n        .filter-group input {\n            padding: 10px 14px;\n            border: 2px solid #e5e7eb;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            color: #374151;\n            background: white;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n\n        .filter-group select:hover,\n        .filter-group input:hover {\n            border-color: #1890ff;\n        }\n\n        .filter-group select:focus,\n        .filter-group input:focus {\n            outline: none;\n            border-color: #1890ff;\n            box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.1);\n        }\n\n        .filter-actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 16px;\n        }\n\n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: inline-flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .btn-primary {\n            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n            color: white;\n            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);\n        }\n\n        .btn-primary:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(24, 144, 255, 0.4);\n        }\n\n        .btn-secondary {\n            background: #f3f4f6;\n            color: #374151;\n        }\n\n        .btn-secondary:hover {\n            background: #e5e7eb;\n        }\n\n        /* ========== INSIGHTS / ALERTAS ========== */\n        .insights-section {\n            background: white;\n            padding: 24px 32px;\n            border-radius: 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n            margin-bottom: 24px;\n        }\n\n        .insights-title {\n            font-size: 18px;\n            font-weight: 800;\n            color: #374151;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .insights-grid {\n            display: grid;\n            gap: 12px;\n        }\n\n        .insight-card {\n            padding: 16px 20px;\n            border-radius: 12px;\n            border-left: 4px solid;\n            display: flex;\n            align-items: flex-start;\n            gap: 12px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n\n        .insight-card:hover {\n            transform: translateX(4px);\n            box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n        }\n\n        .insight-card.critical {\n            background: #fef2f2;\n            border-color: #ef4444;\n        }\n\n        .insight-card.warning {\n            background: #fffbeb;\n            border-color: #f59e0b;\n        }\n\n        .insight-card.info {\n            background: #eff6ff;\n            border-color: #3b82f6;\n        }\n\n        .insight-card.success {\n            background: #f0fdf4;\n            border-color: #10b981;\n        }\n\n        .insight-icon {\n            font-size: 24px;\n            line-height: 1;\n        }\n\n        .insight-content {\n            flex: 1;\n        }\n\n        .insight-content strong {\n            display: block;\n            font-size: 14px;\n            font-weight: 700;\n            margin-bottom: 4px;\n            color: #111827;\n        }\n\n        .insight-content span {\n            font-size: 13px;\n            color: #6b7280;\n        }\n\n        /* ========== KPIs ========== */\n        .kpis-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .kpi-card {\n            background: white;\n            padding: 24px;\n            border-radius: 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n            position: relative;\n            overflow: hidden;\n            transition: all 0.2s;\n        }\n\n        .kpi-card:hover {\n            transform: translateY(-4px);\n            box-shadow: 0 8px 24px rgba(0,0,0,0.12);\n        }\n\n        .kpi-card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            right: 0;\n            width: 120px;\n            height: 120px;\n            background: linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(0, 80, 179, 0.1) 100%);\n            border-radius: 50%;\n            transform: translate(30%, -30%);\n        }\n\n        .kpi-label {\n            font-size: 12px;\n            font-weight: 700;\n            color: #6b7280;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            margin-bottom: 8px;\n            position: relative;\n            z-index: 1;\n        }\n\n        .kpi-value {\n            font-size: 36px;\n            font-weight: 900;\n            color: #111827;\n            line-height: 1;\n            margin-bottom: 8px;\n            position: relative;\n            z-index: 1;\n        }\n\n        .kpi-trend {\n            font-size: 13px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 4px;\n            position: relative;\n            z-index: 1;\n        }\n\n        .kpi-trend.up {\n            color: #10b981;\n        }\n\n        .kpi-trend.down {\n            color: #ef4444;\n        }\n\n        .kpi-trend.neutral {\n            color: #6b7280;\n        }\n\n        /* ========== TABS ========== */\n        .tabs-section {\n            background: white;\n            border-radius: 16px;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n            overflow: hidden;\n        }\n\n        .tabs-header {\n            display: flex;\n            border-bottom: 2px solid #f3f4f6;\n            background: #fafafa;\n        }\n\n        .tab-button {\n            flex: 1;\n            padding: 16px 24px;\n            border: none;\n            background: transparent;\n            font-size: 14px;\n            font-weight: 600;\n            color: #6b7280;\n            cursor: pointer;\n            transition: all 0.2s;\n            position: relative;\n        }\n\n        .tab-button:hover {\n            background: #f3f4f6;\n            color: #374151;\n        }\n\n        .tab-button.active {\n            color: #1890ff;\n            background: white;\n        }\n\n        .tab-button.active::after {\n            content: '';\n            position: absolute;\n            bottom: -2px;\n            left: 0;\n            right: 0;\n            height: 2px;\n            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        }\n\n        .tab-content {\n            padding: 24px 32px;\n            display: none;\n        }\n\n        .tab-content.active {\n            display: block;\n        }\n\n        /* ========== TABLES ========== */\n        .table-wrapper {\n            overflow-x: auto;\n            margin-top: 16px;\n        }\n\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 13px;\n        }\n\n        thead {\n            background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        }\n\n        th {\n            padding: 12px 16px;\n            text-align: left;\n            font-weight: 700;\n            font-size: 11px;\n            color: white;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            border-right: 1px solid rgba(255,255,255,0.2);\n        }\n\n        th:last-child {\n            border-right: none;\n        }\n\n        tbody tr {\n            border-bottom: 1px solid #f3f4f6;\n            transition: all 0.2s;\n        }\n\n        tbody tr:hover {\n            background: #f9fafb;\n        }\n\n        td {\n            padding: 14px 16px;\n            color: #374151;\n            border-right: 1px solid #f9fafb;\n        }\n\n        td:last-child {\n            border-right: none;\n        }\n\n        .td-strong {\n            font-weight: 700;\n            color: #111827;\n        }\n\n        .td-muted {\n            color: #9ca3af;\n            font-size: 12px;\n        }\n\n        .badge {\n            display: inline-block;\n            padding: 4px 10px;\n            border-radius: 999px;\n            font-size: 10px;\n            font-weight: 700;\n            letter-spacing: 0.3px;\n            text-transform: uppercase;\n        }\n\n        .badge-success {\n            background: #d1fae5;\n            color: #065f46;\n            border: 1px solid #a7f3d0;\n        }\n\n        .badge-warning {\n            background: #fef3c7;\n            color: #92400e;\n            border: 1px solid #fde68a;\n        }\n\n        .badge-danger {\n            background: #fee2e2;\n            color: #991b1b;\n            border: 1px solid #fecaca;\n        }\n\n        .badge-info {\n            background: #dbeafe;\n            color: #1e40af;\n            border: 1px solid #bfdbfe;\n        }\n\n        /* ========== CHARTS PLACEHOLDER ========== */\n        .chart-container {\n            background: #f9fafb;\n            border-radius: 12px;\n            padding: 20px;\n            margin: 16px 0;\n            min-height: 250px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            border: 2px dashed #e5e7eb;\n        }\n\n        .chart-placeholder {\n            text-align: center;\n            color: #9ca3af;\n        }\n\n        /* ========== MODAL ========== */\n        .modal {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0,0,0,0.7);\n            z-index: 9999;\n            align-items: center;\n            justify-content: center;\n            padding: 20px;\n        }\n\n        .modal.active {\n            display: flex;\n        }\n\n        .modal-content {\n            background: white;\n            border-radius: 16px;\n            max-width: 900px;\n            width: 100%;\n            max-height: 90vh;\n            overflow-y: auto;\n            box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n            animation: modalSlideIn 0.3s ease;\n        }\n\n        @keyframes modalSlideIn {\n            from {\n                opacity: 0;\n                transform: translateY(-30px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n\n        .modal-header {\n            padding: 24px 32px;\n            border-bottom: 2px solid #f3f4f6;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .modal-header h3 {\n            font-size: 20px;\n            font-weight: 800;\n            color: #111827;\n        }\n\n        .modal-close {\n            width: 32px;\n            height: 32px;\n            border: none;\n            background: #f3f4f6;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 18px;\n            color: #6b7280;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .modal-close:hover {\n            background: #e5e7eb;\n            color: #374151;\n        }\n\n        .modal-body {\n            padding: 24px 32px;\n        }\n\n        .detail-grid {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .detail-item {\n            padding: 16px;\n            background: #f9fafb;\n            border-radius: 8px;\n        }\n\n        .detail-item label {\n            display: block;\n            font-size: 11px;\n            font-weight: 700;\n            color: #6b7280;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            margin-bottom: 6px;\n        }\n\n        .detail-item .value {\n            font-size: 16px;\n            font-weight: 700;\n            color: #111827;\n        }\n\n        /* ========== PROGRESS BAR ========== */\n        .progress-bar-wrapper {\n            width: 100%;\n            background: #e5e7eb;\n            border-radius: 999px;\n            height: 8px;\n            overflow: hidden;\n            margin-top: 6px;\n        }\n\n        .progress-bar-fill {\n            height: 100%;\n            border-radius: 999px;\n            transition: width 0.3s ease;\n            background: linear-gradient(90deg, #1890ff, #0050b3);\n        }\n\n    /* ========== PAGINA√á√ÉO ========== */\n    .pagination {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 8px;\n        margin-top: 20px;\n        padding: 16px;\n    }\n\n    .pagination-btn {\n        padding: 8px 12px;\n        border: 2px solid #e5e7eb;\n        background: white;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        color: #374151;\n        cursor: pointer;\n        transition: all 0.2s;\n        min-width: 40px;\n    }\n\n    .pagination-btn:hover:not(:disabled) {\n        border-color: #1890ff;\n        color: #1890ff;\n        background: #e6f7ff;\n    }\n\n    .pagination-btn.active {\n        background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        color: white;\n        border-color: #1890ff;\n    }\n\n    .pagination-btn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n    }\n\n    .pagination-info {\n        padding: 8px 16px;\n        font-size: 13px;\n        color: #6b7280;\n        font-weight: 600;\n    }\n\n    /* ========== RESPONSIVE ========== */\n    @media (max-width: 768px) {\n        .filters-grid {\n            grid-template-columns: 1fr;\n        }\n\n        .kpis-grid {\n            grid-template-columns: 1fr;\n        }\n\n        .tabs-header {\n            overflow-x: auto;\n        }\n\n        .tab-button {\n            white-space: nowrap;\n        }\n\n        .detail-grid {\n            grid-template-columns: 1fr;\n        }\n\n        .pagination {\n            flex-wrap: wrap;\n        }\n\n        .pagination-btn {\n            min-width: 35px;\n            padding: 6px 10px;\n            font-size: 12px;\n        }\n    }\n\n        /* ========== EMPTY STATE ========== */\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: #9ca3af;\n        }\n\n        .empty-state-icon {\n            font-size: 48px;\n            margin-bottom: 16px;\n        }\n\n        .empty-state-text {\n            font-size: 16px;\n            font-weight: 600;\n            color: #6b7280;\n        }\n\n        /* ========== LOADING ========== */\n        .loading {\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            border: 3px solid #f3f4f6;\n            border-top-color: #1890ff;\n            border-radius: 50%;\n            animation: spin 0.8s linear infinite;\n        }\n\n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"audit-container\">\n        <!-- HEADER -->\n        <div class=\"audit-header\">\n            <h1>üîç Auditoria Completa - BlueTech Log√≠stica</h1>\n            <p>Sistema de An√°lise e Detec√ß√£o de Fragilidades Operacionais</p>\n        </div>\n\n        <!-- FILTROS -->\n        <div class=\"filters-section\" id=\"filtersSection\">\n            <div class=\"filters-title\">\n                üéõÔ∏è Filtros de An√°lise\n            </div>\n            <div class=\"filters-grid\">\n                <div class=\"filter-group\">\n                    <label>Filial / Cidade</label>\n                    <select id=\"filterFilial\">\n                        <option value=\"\">Todas as Filiais</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label>Motoboy</label>\n                    <select id=\"filterMotoboy\">\n                        <option value=\"\">Todos os Motoboys</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label>Status</label>\n                    <select id=\"filterStatus\">\n                        <option value=\"\">Todos os Status</option>\n                        <option value=\"entregue\">‚úÖ Entregue</option>\n                        <option value=\"em-transporte\">üöö Em Transporte</option>\n                        <option value=\"nao-entregue\">‚è≥ N√£o Entregue</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label>Performance</label>\n                    <select id=\"filterPerformance\">\n                        <option value=\"\">Todas</option>\n                        <option value=\"dentro-prazo\">‚úÖ Dentro do Prazo</option>\n                        <option value=\"fora-prazo\">‚ö†Ô∏è Fora do Prazo</option>\n                        <option value=\"critico\">üö® Cr√≠tico (&gt;150%)</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label>ID Sa√≠da</label>\n                    <input type=\"text\" id=\"filterSaidaId\" placeholder=\"Digite o ID...\">\n                </div>\n                <div class=\"filter-group\">\n                    <label>Pedido</label>\n                    <input type=\"text\" id=\"filterPedido\" placeholder=\"Digite o pedido...\">\n                </div>\n            </div>\n            <div class=\"filter-actions\">\n                <button class=\"btn btn-primary\" onclick=\"applyFilters()\">\n                    üîç Aplicar Filtros\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"clearFilters()\">\n                    üîÑ Limpar\n                </button>\n            </div>\n        </div>\n\n        <!-- INSIGHTS / FRAGILIDADES -->\n        <div class=\"insights-section\" id=\"insightsSection\">\n            <div class=\"insights-title\">\n                üí° Fragilidades Detectadas\n            </div>\n            <div class=\"insights-grid\" id=\"insightsContainer\">\n                <!-- Preenchido dinamicamente -->\n            </div>\n        </div>\n\n        <!-- KPIs -->\n        <div class=\"kpis-grid\" id=\"kpisContainer\">\n            <!-- Preenchido dinamicamente -->\n        </div>\n\n        <!-- TABS -->\n        <div class=\"tabs-section\">\n            <div class=\"tabs-header\">\n                <button class=\"tab-button active\" onclick=\"switchTab(event, 'rotas')\">\n                    üöö An√°lise por Rota\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'motoboys')\">\n                    üèçÔ∏è Performance Motoboys\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'filiais')\">\n                    üè¢ Comparativo Filiais\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'atrasos')\">\n                    ‚è±Ô∏è Atrasos Detalhados\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'timeline')\">\n                    üìÖ Timeline Entregas\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'atrasos-pedido')\">\n                    ‚ö†Ô∏è Atrasos por Pedido\n                </button>\n                <button class=\"tab-button\" onclick=\"switchTab(event, 'retorno-motoboy')\">\n                    üè† Retorno Motoboy\n                </button>\n            </div>\n\n            <!-- TAB: AN√ÅLISE POR ROTA -->\n            <div class=\"tab-content active\" id=\"tab-rotas\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    üöö An√°lise Detalhada por Rota (SAIDAID)\n                </h3>\n                <div class=\"table-wrapper\">\n                    <table id=\"tableRotas\">\n                        <thead>\n                            <tr>\n                                <th>ID Sa√≠da</th>\n                                <th>Filial</th>\n                                <th>Motoboy</th>\n                                <th>Entregas</th>\n                                <th>Paradas</th>\n                                <th>KM Total</th>\n                                <th>Tempo Real</th>\n                                <th>Tempo Prev.</th>\n                                <th>Ratio</th>\n                                <th>Status</th>\n                                <th>A√ß√£o</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableRotasBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-rotas\"></div>\n            </div>\n\n            <!-- TAB: PERFORMANCE MOTOBOYS -->\n            <div class=\"tab-content\" id=\"tab-motoboys\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    üèçÔ∏è Ranking e Performance Individual\n                </h3>\n                <div class=\"table-wrapper\">\n                    <table id=\"tableMotoboys\">\n                        <thead>\n                            <tr>\n                                <th>Ranking</th>\n                                <th>Motoboy</th>\n                                <th>Rotas</th>\n                                <th>Entregas</th>\n                                <th>KM Total</th>\n                                <th>Tempo M√©dio</th>\n                                <th>Taxa Sucesso</th>\n                                <th>Atrasos</th>\n                                <th>Performance</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableMotoboysBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-motoboys\"></div>\n            </div>\n\n            <!-- TAB: COMPARATIVO FILIAIS -->\n            <div class=\"tab-content\" id=\"tab-filiais\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    üè¢ Comparativo de Efici√™ncia entre Filiais\n                </h3>\n                <div class=\"table-wrapper\">\n                    <table id=\"tableFiliais\">\n                        <thead>\n                            <tr>\n                                <th>Filial</th>\n                                <th>Rotas</th>\n                                <th>Entregas</th>\n                                <th>Dentro Prazo</th>\n                                <th>Fora Prazo</th>\n                                <th>% Efici√™ncia</th>\n                                <th>Tempo M√©dio</th>\n                                <th>KM Total</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableFiliaisBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-filiais\"></div>\n            </div>\n\n            <!-- TAB: ATRASOS DETALHADOS -->\n            <div class=\"tab-content\" id=\"tab-atrasos\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    ‚è±Ô∏è Atrasos e Desvios de Tempo\n                </h3>\n                <div class=\"table-wrapper\">\n                    <table id=\"tableAtrasos\">\n                        <thead>\n                            <tr>\n                                <th>ID Sa√≠da</th>\n                                <th>Filial</th>\n                                <th>Motoboy</th>\n                                <th>Tempo Prev.</th>\n                                <th>Tempo Real</th>\n                                <th>Diferen√ßa</th>\n                                <th>% Desvio</th>\n                                <th>Gravidade</th>\n                                <th>Ver Detalhes</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableAtrasosBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-atrasos\"></div>\n            </div>\n\n            <!-- TAB: TIMELINE -->\n            <div class=\"tab-content\" id=\"tab-timeline\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    üìÖ Timeline de Entregas (√öltimas 50)\n                </h3>\n                <div class=\"table-wrapper\">\n                    <table id=\"tableTimeline\">\n                        <thead>\n                            <tr>\n                                <th>Pedido</th>\n                                <th>SAIDA ID</th>\n                                <th>Cliente</th>\n                                <th>Cidade</th>\n                                <th>Motoboy</th>\n                                <th>In√≠cio Rota</th>\n                                <th>Entrega</th>\n                                <th>Fim Rota</th>\n                                <th>Dura√ß√£o</th>\n                                <th>Status</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableTimelineBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-timeline\"></div>\n            </div>\n\n            <!-- TAB: ATRASOS POR PEDIDO -->\n            <div class=\"tab-content\" id=\"tab-atrasos-pedido\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    ‚ö†Ô∏è An√°lise de Atrasos por Pedido Individual\n                </h3>\n                \n                <!-- Resumo e Filtros R√°pidos -->\n                <div id=\"resumoAtrasosPedido\" style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;\">\n                    <!-- Preenchido dinamicamente -->\n                </div>\n                \n                <div class=\"table-wrapper\">\n                    <table id=\"tableAtrasosPedido\">\n                        <thead>\n                            <tr>\n                                <th>Pedido</th>\n                                <th>SAIDA ID</th>\n                                <th>Filial</th>\n                                <th>Motoboy</th>\n                                <th>Cliente</th>\n                                <th>Cidade</th>\n                                <th>Ordem</th>\n                                <th>Tempo Real</th>\n                                <th>Tempo Google+5</th>\n                                <th>Diferen√ßa</th>\n                                <th>Status Prazo</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableAtrasosPedidoBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-atrasos-pedido\"></div>\n            </div>\n\n            <!-- TAB: RETORNO MOTOBOY -->\n            <div class=\"tab-content\" id=\"tab-retorno-motoboy\">\n                <h3 style=\"font-size: 18px; font-weight: 800; color: #111827; margin-bottom: 16px;\">\n                    üè† An√°lise de Efici√™ncia de Retorno por Motoboy\n                </h3>\n                \n                <!-- Resumo de Retornos -->\n                <div id=\"resumoRetornos\" style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;\">\n                    <!-- Preenchido dinamicamente -->\n                </div>\n                \n                <div class=\"table-wrapper\">\n                    <table id=\"tableRetornoMotoboy\">\n                        <thead>\n                            <tr>\n                                <th>Motoboy</th>\n                                <th>Total Retornos</th>\n                                <th>No Prazo</th>\n                                <th>Atrasados</th>\n                                <th>% Efici√™ncia</th>\n                                <th>Tempo M√©dio Real</th>\n                                <th>Tempo M√©dio Google</th>\n                                <th>Diferen√ßa M√©dia</th>\n                                <th>Desempenho</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"tableRetornoMotoboyBody\">\n                            <!-- Preenchido dinamicamente -->\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"pagination\" id=\"pagination-retorno-motoboy\"></div>\n            </div>\n        </div>\n    </div>\n\n    <!-- MODAL DE DETALHES -->\n    <div class=\"modal\" id=\"detailModal\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3 id=\"modalTitle\">Detalhes da Rota</h3>\n                <button class=\"modal-close\" onclick=\"closeModal()\">‚úï</button>\n            </div>\n            <div class=\"modal-body\" id=\"modalBody\">\n                <!-- Preenchido dinamicamente -->\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // ========================================\n        // DADOS GLOBAIS\n        // ========================================\n        let rawData = {\n            pedidos: [],\n            calculo: [],\n            rotas: []\n        };\n\n        let filteredData = {\n            rotas: [],\n            motoboys: [],\n            filiais: [],\n            atrasos: [],\n            timeline: [],\n            pedidosIndividuais: [],\n            retornoMotoboy: []\n        };\n\n        // ========================================\n        // CONFIGURA√á√ïES DE PAGINA√á√ÉO\n        // ========================================\n        let pagination = {\n            rotas: { currentPage: 1, itemsPerPage: 20 },\n            motoboys: { currentPage: 1, itemsPerPage: 20 },\n            filiais: { currentPage: 1, itemsPerPage: 20 },\n            atrasos: { currentPage: 1, itemsPerPage: 20 },\n            timeline: { currentPage: 1, itemsPerPage: 20 },\n            'atrasos-pedido': { currentPage: 1, itemsPerPage: 50 },\n            'retorno-motoboy': { currentPage: 1, itemsPerPage: 20 }\n        };\n\n        // ========================================\n        // FILTROS ATIVOS\n        // ========================================\n        let activeFilters = {\n            filial: '',\n            motoboy: '',\n            status: '',\n            performance: '',\n            saidaId: '',\n            pedido: ''\n        };\n\n        // ========================================\n        // INICIALIZA√á√ÉO\n        // ========================================\n        function initDashboard() {\n            // Os dados ser√£o carregados e processados automaticamente\n            // via inje√ß√£o do Appsmith (ver script no final do HTML)\n            console.log('Dashboard inicializado. Aguardando dados do Appsmith...');\n        }\n\n        // ========================================\n        // CARREGAR DADOS DO APPSMITH\n        // ========================================\n        function loadData() {\n            // Os dados ser√£o injetados via Appsmith\n        }\n\n        // ========================================\n        // PROCESSAR DADOS\n        // ========================================\n        function processData() {\n            const pedidos = rawData.pedidos;\n            const calc = rawData.calculo;\n            const rotas = rawData.rotas;\n\n            // Agrupar por SAIDAID\n            const groupedBySaida = {};\n            pedidos.forEach(p => {\n                const saidaId = p.SAIDAID;\n                if (!groupedBySaida[saidaId]) {\n                    groupedBySaida[saidaId] = {\n                        SAIDAID: saidaId,\n                        MOTOBOY: p.MOTOBOY,\n                        CIDADEFILIAL: p.CIDADEFILIAL,\n                        items: [],\n                        clientesUnicos: new Set()\n                    };\n                }\n                groupedBySaida[saidaId].items.push(p);\n                if (p.COD_CLI) {\n                    groupedBySaida[saidaId].clientesUnicos.add(p.COD_CLI);\n                }\n            });\n\n            // Calcular m√©tricas por rota - COM AN√ÅLISE PEDIDO A PEDIDO (igual aos outros templates)\n            filteredData.rotas = Object.values(groupedBySaida).map(rota => {\n                const rotaOtimizada = rotas.filter(r => r.saida_numero === rota.SAIDAID)\n                    .sort((a, b) => b.num_ordem - a.num_ordem);\n                const ultimoPonto = rotaOtimizada[0];\n\n                // Ordenar pedidos por ENTREGA_CLIENTE para an√°lise sequencial\n                const pedidosOrdenados = [...rota.items].sort((a, b) => {\n                    if (!a.ENTREGA_CLIENTE) return 1;\n                    if (!b.ENTREGA_CLIENTE) return -1;\n                    return new Date(a.ENTREGA_CLIENTE) - new Date(b.ENTREGA_CLIENTE);\n                });\n\n                // AN√ÅLISE PEDIDO A PEDIDO (igual TOTAL ENTREGAS RESUMO)\n                let tempoPrevistoPedidos = 0;\n                let tempoRealPedidos = 0;\n                let dentroCount = 0;\n                let foraCount = 0;\n                let naoEntregueCount = 0;\n                \n                const pedidosComStatus = pedidosOrdenados.map((item, index) => {\n                    // Buscar Google\n                    const log = calc.find(l => l.PEDIDO == item.PEDIDO);\n                    \n                    // Se n√£o tem Google = N√£o Entregue\n                    if (!log) {\n                        naoEntregueCount++;\n                        return { ...item, statusPedido: 'nao-entregue', tempoLocal: 0, tempoGoogle: 0 };\n                    }\n                    \n                    // Tempo Google + 5min\n                    const tempoGoogle = Number((log.TEMPO || \"0\").toString().replace(/\\D+/g, '')) + 5;\n                    tempoPrevistoPedidos += tempoGoogle * 60; // em segundos\n                    \n                    // Calcular tempo local SEQUENCIAL\n                    let tempoLocal = 0;\n                    if (item.ENTREGA_CLIENTE && item.INICIO_ROTA) {\n                        if (index === 0) {\n                            // 1¬∫ pedido: ENTREGA_CLIENTE - INICIO_ROTA\n                            tempoLocal = (new Date(item.ENTREGA_CLIENTE) - new Date(item.INICIO_ROTA)) / 60000;\n                        } else {\n                            // Pedidos seguintes: ENTREGA_CLIENTE atual - ENTREGA_CLIENTE anterior\n                            const anterior = pedidosOrdenados[index - 1];\n                            if (anterior.ENTREGA_CLIENTE) {\n                                tempoLocal = (new Date(item.ENTREGA_CLIENTE) - new Date(anterior.ENTREGA_CLIENTE)) / 60000;\n                            }\n                        }\n                        tempoRealPedidos += tempoLocal;\n                    }\n                    \n                    // Classificar pedido\n                    let statusPedido = 'nao-entregue';\n                    if (tempoLocal > 0 && tempoGoogle > 0) {\n                        if (tempoLocal <= tempoGoogle) {\n                            statusPedido = 'dentro';\n                            dentroCount++;\n                        } else {\n                            statusPedido = 'fora';\n                            foraCount++;\n                        }\n                    } else {\n                        naoEntregueCount++;\n                    }\n                    \n                    return { ...item, statusPedido, tempoLocal, tempoGoogle };\n                });\n\n                // TEMPO TOTAL DA ROTA (usar tempo sequencial acumulado)\n                const tempoReal = tempoRealPedidos * 60; // converter min para segundos\n                const tempoPrevisto = tempoPrevistoPedidos; // j√° est√° em segundos\n\n                // KM Total\n                const kmTotal = rota.items.reduce((sum, item) => {\n                    const log = calc.find(l => l.PEDIDO === item.PEDIDO || l.SAIDAID === parseInt(item.SAIDAID));\n                    return sum + (parseFloat(log?.KM || 0));\n                }, 0);\n\n                // Status\n                const entregues = rota.items.filter(i => i.ENTREGA_CLIENTE && i.ENTREGA_CLIENTE !== 'null').length;\n                const total = rota.items.length;\n                const ratio = tempoPrevisto > 0 && tempoReal > 0 ? tempoReal / tempoPrevisto : null;\n\n                return {\n                    SAIDAID: rota.SAIDAID,\n                    CIDADEFILIAL: rota.CIDADEFILIAL,\n                    MOTOBOY: rota.MOTOBOY,\n                    qtdEntregas: total,\n                    qtdEntregues: entregues,\n                    paradas: rota.clientesUnicos.size,\n                    kmTotal: kmTotal,\n                    tempoReal: tempoReal,\n                    tempoPrevisto: tempoPrevisto,\n                    ratio: ratio,\n                    items: pedidosComStatus, // Com status individual\n                    dentroCount: dentroCount,\n                    foraCount: foraCount,\n                    naoEntregueCount: naoEntregueCount\n                };\n            });\n\n            // Processar motoboys\n            const motoboyStats = {};\n            filteredData.rotas.forEach(rota => {\n                const mb = rota.MOTOBOY || 'SEM MOTOBOY';\n                if (!motoboyStats[mb]) {\n                    motoboyStats[mb] = {\n                        motoboy: mb,\n                        rotas: 0,\n                        entregas: 0,\n                        entregues: 0,\n                        km: 0,\n                        tempos: [],\n                        atrasos: 0\n                    };\n                }\n                motoboyStats[mb].rotas++;\n                motoboyStats[mb].entregas += rota.qtdEntregas;\n                motoboyStats[mb].entregues += rota.qtdEntregues;\n                motoboyStats[mb].km += rota.kmTotal;\n                if (rota.tempoReal > 0) {\n                    motoboyStats[mb].tempos.push(rota.tempoReal);\n                }\n                if (rota.ratio && rota.ratio > 1.05) {\n                    motoboyStats[mb].atrasos++;\n                }\n            });\n            filteredData.motoboys = Object.values(motoboyStats)\n                .map(mb => {\n                    const tempoMedio = mb.tempos.length > 0 \n                        ? mb.tempos.reduce((a,b) => a+b, 0) / mb.tempos.length \n                        : 0;\n                    const taxaSucesso = mb.entregas > 0 ? (mb.entregues / mb.entregas) : 0;\n                    const performance = mb.rotas > 0 ? ((mb.rotas - mb.atrasos) / mb.rotas) : 0;\n                    return { ...mb, tempoMedio, taxaSucesso, performance };\n                })\n                .sort((a, b) => b.entregas - a.entregas);\n\n            // Processar filiais - CONTANDO PEDIDOS com status individual\n            const filialStats = {};\n            filteredData.rotas.forEach(rota => {\n                const fil = rota.CIDADEFILIAL || 'SEM FILIAL';\n                if (!filialStats[fil]) {\n                    filialStats[fil] = {\n                        filial: fil,\n                        rotas: 0,\n                        entregas: 0,\n                        dentroPrazo: 0,\n                        foraPrazo: 0,\n                        tempos: [],\n                        km: 0\n                    };\n                }\n                filialStats[fil].rotas++;\n                filialStats[fil].entregas += rota.qtdEntregas;\n                filialStats[fil].km += rota.kmTotal;\n                if (rota.tempoReal > 0) {\n                    filialStats[fil].tempos.push(rota.tempoReal);\n                }\n                \n                // Usar os contadores de pedidos individuais (n√£o ratio da rota)\n                filialStats[fil].dentroPrazo += (rota.dentroCount || 0);\n                filialStats[fil].foraPrazo += (rota.foraCount || 0);\n            });\n            filteredData.filiais = Object.values(filialStats)\n                .map(f => {\n                    const tempoMedio = f.tempos.length > 0 \n                        ? f.tempos.reduce((a,b) => a+b, 0) / f.tempos.length \n                        : 0;\n                    const eficiencia = f.entregas > 0 ? (f.dentroPrazo / f.entregas) : 0;\n                    return { ...f, tempoMedio, eficiencia };\n                })\n                .sort((a, b) => a.filial.localeCompare(b.filial));\n\n            // Processar atrasos\n            filteredData.atrasos = filteredData.rotas\n                .filter(r => r.ratio !== null && r.ratio > 1.05)\n                .map(r => {\n                    const diferenca = r.tempoReal - r.tempoPrevisto;\n                    const desvio = ((r.ratio - 1) * 100);\n                    let gravidade = 'warning';\n                    if (desvio > 50) gravidade = 'critical';\n                    else if (desvio > 20) gravidade = 'high';\n                    return { ...r, diferenca, desvio, gravidade };\n                })\n                .sort((a, b) => b.desvio - a.desvio);\n\n            // Timeline\n            filteredData.timeline = pedidos\n                .filter(p => p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null')\n                .sort((a, b) => new Date(b.ENTREGA_CLIENTE) - new Date(a.ENTREGA_CLIENTE))\n                .slice(0, 50)\n                .map(p => {\n                    const inicio = p.INICIO_ROTA ? new Date(p.INICIO_ROTA) : null;\n                    const entrega = p.ENTREGA_CLIENTE ? new Date(p.ENTREGA_CLIENTE) : null;\n                    const fim = p.FIM_ROTA ? new Date(p.FIM_ROTA) : null;\n                    const duracao = inicio && entrega ? Math.floor((entrega - inicio) / 60000) : 0;\n                    \n                    let status = 'entregue';\n                    if (!entrega) status = 'nao-entregue';\n                    else if (inicio && !fim) status = 'em-transporte';\n                    \n                    return { ...p, inicio, entrega, fim, duracao, status };\n                });\n            \n            // Processar pedidos individuais para a nova aba\n            filteredData.pedidosIndividuais = [];\n            filteredData.rotas.forEach(rota => {\n                rota.items.forEach((item, index) => {\n                    filteredData.pedidosIndividuais.push({\n                        PEDIDO: item.PEDIDO,\n                        SAIDAID: rota.SAIDAID,\n                        CIDADEFILIAL: rota.CIDADEFILIAL,\n                        MOTOBOY: rota.MOTOBOY,\n                        RAZAO_SOCIAL: item.RAZAO_SOCIAL,\n                        CIDADE: item.CIDADE,\n                        ordem: index + 1,\n                        tempoLocal: item.tempoLocal || 0,\n                        tempoGoogle: item.tempoGoogle || 0,\n                        diferenca: (item.tempoLocal || 0) - (item.tempoGoogle || 0),\n                        statusPedido: item.statusPedido || 'nao-entregue',\n                        ENTREGA_CLIENTE: item.ENTREGA_CLIENTE,\n                        INICIO_ROTA: item.INICIO_ROTA\n                    });\n                });\n            });\n            \n            // DEBUG: Comparar com TOTAL ENTREGAS RESUMO\n            console.log('=== AUDITORIA COMPLETA - DEBUG COMPARATIVO ===');\n            console.log('üì¶ Total de rotas:', filteredData.rotas.length);\n            \n            // Contar pedidos por status\n            let totalDentro = 0;\n            let totalFora = 0;\n            let totalNaoEntregue = 0;\n            let totalPedidos = 0;\n            \n            filteredData.rotas.forEach(rota => {\n                totalDentro += (rota.dentroCount || 0);\n                totalFora += (rota.foraCount || 0);\n                totalNaoEntregue += (rota.naoEntregueCount || 0);\n                totalPedidos += rota.qtdEntregas;\n            });\n            \n            console.log('üìä TOTAIS (deve bater com TOTAL ENTREGAS RESUMO):');\n            console.log('  ‚úÖ Dentro do Prazo:', totalDentro, `(${((totalDentro / totalPedidos) * 100).toFixed(2)}%)`);\n            console.log('  ‚ùå Fora do Prazo:', totalFora, `(${((totalFora / totalPedidos) * 100).toFixed(2)}%)`);\n            console.log('  üü† N√£o Entregue:', totalNaoEntregue, `(${((totalNaoEntregue / totalPedidos) * 100).toFixed(2)}%)`);\n            console.log('  üì¶ Total de Pedidos:', totalPedidos);\n            console.log('  ‚úîÔ∏è Soma:', totalDentro + totalFora + totalNaoEntregue, '(deve ser igual ao total)');\n            console.log('  üìã Pedidos individuais processados:', filteredData.pedidosIndividuais.length);\n            \n            // Processar dados de retorno por motoboy\n            processarRetornoMotoboy();\n        }\n        \n        // ========================================\n        // PROCESSAR RETORNO MOTOBOY\n        // ========================================\n        function processarRetornoMotoboy() {\n            const pedidos = rawData.pedidos;\n            const calc = rawData.calculo;\n            \n            // Agrupar por SAIDAID para encontrar retornos\n            const groupedBySaida = {};\n            \n            pedidos.forEach(pedido => {\n                const saidaId = pedido.SAIDAID;\n                if (!saidaId) return;\n                \n                if (!groupedBySaida[saidaId]) {\n                    groupedBySaida[saidaId] = {\n                        SAIDAID: saidaId,\n                        MOTOBOY: pedido.MOTOBOY,\n                        CIDADEFILIAL: pedido.CIDADEFILIAL,\n                        entregas: [],\n                        ultimaEntrega: null,\n                        temFimRota: false\n                    };\n                }\n                \n                groupedBySaida[saidaId].entregas.push(pedido);\n                \n                // Verificar FIM_ROTA\n                if (pedido.FIM_ROTA && pedido.FIM_ROTA !== 'null' && pedido.FIM_ROTA !== null) {\n                    groupedBySaida[saidaId].temFimRota = true;\n                    groupedBySaida[saidaId].fimRota = pedido.FIM_ROTA;\n                }\n                \n                // Encontrar √∫ltima entrega\n                const dataEntrega = pedido.ENTREGA_CLIENTE ? new Date(pedido.ENTREGA_CLIENTE) : null;\n                if (dataEntrega && !isNaN(dataEntrega)) {\n                    if (!groupedBySaida[saidaId].ultimaEntregaData || dataEntrega > groupedBySaida[saidaId].ultimaEntregaData) {\n                        groupedBySaida[saidaId].ultimaEntregaData = dataEntrega;\n                        groupedBySaida[saidaId].ultimaEntrega = pedido.ENTREGA_CLIENTE;\n                    }\n                }\n            });\n            \n            // Buscar tempos de retorno do Google\n            Object.values(groupedBySaida).forEach(saida => {\n                const pedidoDaSaida = saida.entregas[0];\n                if (pedidoDaSaida) {\n                    const googleInfo = calc.find(g => \n                        g.PEDIDO == pedidoDaSaida.PEDIDO || \n                        g.SAIDAID == saida.SAIDAID\n                    );\n                    \n                    if (googleInfo && googleInfo.RETORNO) {\n                        const retornoStr = (googleInfo.RETORNO || \"\").toString();\n                        const match = retornoStr.match(/(\\d+)\\s*min/i);\n                        if (match) {\n                            saida.tempoPrevistoRetorno = parseInt(match[1]);\n                        }\n                    }\n                }\n            });\n            \n            // Filtrar sa√≠das com retorno completo (tem FIM_ROTA)\n            const saidasComRetorno = Object.values(groupedBySaida).filter(saida => {\n                return saida.ultimaEntrega && saida.temFimRota && saida.MOTOBOY;\n            });\n            \n            // Agrupar por motoboy e calcular m√©tricas\n            const motoboyRetornos = {};\n            \n            saidasComRetorno.forEach(saida => {\n                const mb = saida.MOTOBOY;\n                \n                if (!motoboyRetornos[mb]) {\n                    motoboyRetornos[mb] = {\n                        motoboy: mb,\n                        totalRetornos: 0,\n                        noPrazo: 0,\n                        atrasados: 0,\n                        temposReais: [],\n                        temposGoogle: [],\n                        diferencas: []\n                    };\n                }\n                \n                motoboyRetornos[mb].totalRetornos++;\n                \n                // Calcular tempo real de retorno\n                if (saida.ultimaEntrega && saida.fimRota) {\n                    const ultimaEntrega = new Date(saida.ultimaEntrega);\n                    const fimRota = new Date(saida.fimRota);\n                    const tempoRealMinutos = Math.floor((fimRota - ultimaEntrega) / 60000);\n                    \n                    motoboyRetornos[mb].temposReais.push(tempoRealMinutos);\n                    \n                    // Se tem tempo do Google, comparar\n                    if (saida.tempoPrevistoRetorno && saida.tempoPrevistoRetorno > 0) {\n                        const tempoGoogle = saida.tempoPrevistoRetorno;\n                        motoboyRetornos[mb].temposGoogle.push(tempoGoogle);\n                        \n                        const diferenca = tempoRealMinutos - tempoGoogle;\n                        motoboyRetornos[mb].diferencas.push(diferenca);\n                        \n                        // Toler√¢ncia de +20%\n                        const tempoGoogleComTolerancia = tempoGoogle * 1.2;\n                        if (tempoRealMinutos <= tempoGoogleComTolerancia) {\n                            motoboyRetornos[mb].noPrazo++;\n                        } else {\n                            motoboyRetornos[mb].atrasados++;\n                        }\n                    }\n                }\n            });\n            \n            // Calcular m√©dias e criar array final\n            filteredData.retornoMotoboy = Object.values(motoboyRetornos)\n                .map(mb => {\n                    const tempoMedioReal = mb.temposReais.length > 0\n                        ? mb.temposReais.reduce((a, b) => a + b, 0) / mb.temposReais.length\n                        : 0;\n                    \n                    const tempoMedioGoogle = mb.temposGoogle.length > 0\n                        ? mb.temposGoogle.reduce((a, b) => a + b, 0) / mb.temposGoogle.length\n                        : 0;\n                    \n                    const diferencaMedia = mb.diferencas.length > 0\n                        ? mb.diferencas.reduce((a, b) => a + b, 0) / mb.diferencas.length\n                        : 0;\n                    \n                    const totalComDados = mb.noPrazo + mb.atrasados;\n                    const eficiencia = totalComDados > 0 ? (mb.noPrazo / totalComDados) : 0;\n                    \n                    return {\n                        ...mb,\n                        tempoMedioReal,\n                        tempoMedioGoogle,\n                        diferencaMedia,\n                        eficiencia\n                    };\n                })\n                .filter(mb => mb.totalRetornos > 0)\n                .sort((a, b) => b.eficiencia - a.eficiencia);\n            \n            console.log('üè† Retornos processados por motoboy:', filteredData.retornoMotoboy.length);\n        }\n\n        // ========================================\n        // GERAR INSIGHTS\n        // ========================================\n        function generateInsights() {\n            const insights = [];\n            const rotas = filteredData.rotas;\n            const motoboys = filteredData.motoboys;\n            const atrasos = filteredData.atrasos;\n\n            // Insight 1: Atrasos cr√≠ticos\n            const atrasoCritico = atrasos.filter(a => a.gravidade === 'critical').length;\n            if (atrasoCritico > 0) {\n                insights.push({\n                    type: 'critical',\n                    icon: 'üö®',\n                    title: `${atrasoCritico} rotas com atraso cr√≠tico (&gt;150%)`,\n                    desc: 'Requer aten√ß√£o imediata! Verificar motivos e tomar a√ß√µes corretivas.'\n                });\n            }\n\n            // Insight 2: Motoboys com baixa performance\n            const motoboysBaixaPerf = motoboys.filter(m => m.performance < 0.7 && m.rotas >= 3).length;\n            if (motoboysBaixaPerf > 0) {\n                insights.push({\n                    type: 'warning',\n                    icon: '‚ö†Ô∏è',\n                    title: `${motoboysBaixaPerf} motoboys com performance abaixo de 70%`,\n                    desc: 'Considere treinamento ou reavalia√ß√£o de rotas.'\n                });\n            }\n\n            // Insight 3: Taxa de sucesso geral\n            const totalEntregas = rotas.reduce((sum, r) => sum + r.qtdEntregas, 0);\n            const totalEntregues = rotas.reduce((sum, r) => sum + r.qtdEntregues, 0);\n            const taxaSucessoGeral = totalEntregas > 0 ? (totalEntregues / totalEntregas) : 0;\n            if (taxaSucessoGeral < 0.9) {\n                insights.push({\n                    type: 'warning',\n                    icon: 'üìâ',\n                    title: `Taxa de sucesso geral: ${(taxaSucessoGeral * 100).toFixed(1)}%`,\n                    desc: 'Meta ideal: acima de 95%. Identificar causas de n√£o-entrega.'\n                });\n            } else if (taxaSucessoGeral >= 0.95) {\n                insights.push({\n                    type: 'success',\n                    icon: '‚úÖ',\n                    title: `Excelente taxa de sucesso: ${(taxaSucessoGeral * 100).toFixed(1)}%`,\n                    desc: 'Opera√ß√£o est√° dentro dos padr√µes de excel√™ncia!'\n                });\n            }\n\n            // Insight 4: Rotas sem dados de tempo\n            const rotasSemTempo = rotas.filter(r => r.ratio === null).length;\n            if (rotasSemTempo > 0) {\n                insights.push({\n                    type: 'info',\n                    icon: 'üìä',\n                    title: `${rotasSemTempo} rotas sem dados completos de tempo`,\n                    desc: 'Verificar integra√ß√£o de sistemas e coleta de timestamps.'\n                });\n            }\n\n            // Insight 5: Top performer\n            if (motoboys.length > 0) {\n                const topMotoboy = motoboys[0];\n                if (topMotoboy.performance > 0.9 && topMotoboy.taxaSucesso > 0.95) {\n                    insights.push({\n                        type: 'success',\n                        icon: 'üèÜ',\n                        title: `Destaque: ${topMotoboy.motoboy}`,\n                        desc: `${topMotoboy.entregas} entregas, ${(topMotoboy.taxaSucesso * 100).toFixed(1)}% sucesso, ${(topMotoboy.performance * 100).toFixed(1)}% performance.`\n                    });\n                }\n            }\n\n            // Renderizar\n            const container = document.getElementById('insightsContainer');\n            if (insights.length === 0) {\n                container.innerHTML = `\n                    <div class=\"empty-state\">\n                        <div class=\"empty-state-icon\">‚ú®</div>\n                        <div class=\"empty-state-text\">Nenhuma fragilidade cr√≠tica detectada!</div>\n                    </div>\n                `;\n            } else {\n                container.innerHTML = insights.map(i => `\n                    <div class=\"insight-card ${i.type}\">\n                        <div class=\"insight-icon\">${i.icon}</div>\n                        <div class=\"insight-content\">\n                            <strong>${i.title}</strong>\n                            <span>${i.desc}</span>\n                        </div>\n                    </div>\n                `).join('');\n            }\n        }\n\n        // ========================================\n        // RENDERIZAR KPIs\n        // ========================================\n        function renderKPIs() {\n            const rotas = filteredData.rotas;\n            const totalRotas = rotas.length;\n            const totalEntregas = rotas.reduce((sum, r) => sum + r.qtdEntregas, 0);\n            const totalEntregues = rotas.reduce((sum, r) => sum + r.qtdEntregues, 0);\n            const taxaSucesso = totalEntregas > 0 ? (totalEntregues / totalEntregas) : 0;\n            \n            const temposValidos = rotas.filter(r => r.tempoReal > 0).map(r => r.tempoReal);\n            const tempoMedioSeg = temposValidos.length > 0 \n                ? temposValidos.reduce((a,b) => a+b, 0) / temposValidos.length \n                : 0;\n            const tempoMedioMin = Math.round(tempoMedioSeg / 60);\n            \n            const totalKm = rotas.reduce((sum, r) => sum + r.kmTotal, 0);\n            \n            const dentroPrazo = rotas.filter(r => r.ratio !== null && r.ratio <= 1.05).length;\n            const foraPrazo = rotas.filter(r => r.ratio !== null && r.ratio > 1.05).length;\n            const totalComDados = dentroPrazo + foraPrazo;\n            const percNoPrazo = totalComDados > 0 ? (dentroPrazo / totalComDados) : 0;\n\n            const kpis = [\n                {\n                    label: 'üöö Total de Rotas',\n                    value: totalRotas,\n                    trend: 'neutral',\n                    trendText: `${totalEntregas} entregas`\n                },\n                {\n                    label: '‚úÖ Taxa de Sucesso',\n                    value: `${(taxaSucesso * 100).toFixed(1)}%`,\n                    trend: taxaSucesso >= 0.95 ? 'up' : taxaSucesso >= 0.85 ? 'neutral' : 'down',\n                    trendText: `${totalEntregues} de ${totalEntregas}`\n                },\n                {\n                    label: '‚è±Ô∏è Tempo M√©dio',\n                    value: `${tempoMedioMin} min`,\n                    trend: 'neutral',\n                    trendText: `${temposValidos.length} rotas analisadas`\n                },\n                {\n                    label: 'üìç KM Total',\n                    value: totalKm.toFixed(1),\n                    trend: 'neutral',\n                    trendText: `${(totalKm / totalRotas).toFixed(1)} km/rota`\n                },\n                {\n                    label: 'üìä Efici√™ncia (‚â§105%)',\n                    value: `${(percNoPrazo * 100).toFixed(1)}%`,\n                    trend: percNoPrazo >= 0.8 ? 'up' : percNoPrazo >= 0.6 ? 'neutral' : 'down',\n                    trendText: `${dentroPrazo}/${totalComDados} rotas`\n                },\n                {\n                    label: 'üö® Atrasos Detectados',\n                    value: foraPrazo,\n                    trend: foraPrazo === 0 ? 'up' : foraPrazo < 5 ? 'neutral' : 'down',\n                    trendText: foraPrazo === 0 ? 'Excelente!' : 'Requer aten√ß√£o'\n                },\n                {\n                    label: 'üè† Efici√™ncia Retorno',\n                    value: calcularEficienciaRetorno(),\n                    trend: 'neutral',\n                    trendText: 'An√°lise de retornos'\n                }\n            ];\n\n            const container = document.getElementById('kpisContainer');\n            container.innerHTML = kpis.map(kpi => `\n                <div class=\"kpi-card\">\n                    <div class=\"kpi-label\">${kpi.label}</div>\n                    <div class=\"kpi-value\">${kpi.value}</div>\n                    <div class=\"kpi-trend ${kpi.trend}\">\n                        ${kpi.trend === 'up' ? '‚Üó' : kpi.trend === 'down' ? '‚Üò' : '‚Üí'} ${kpi.trendText}\n                    </div>\n                </div>\n            `).join('');\n        }\n\n        // ========================================\n        // RENDERIZAR TABELAS\n        // ========================================\n        function renderTables() {\n            renderTableRotas();\n            renderTableMotoboys();\n            renderTableFiliais();\n            renderTableAtrasos();\n            renderTableTimeline();\n            renderTableAtrasosPedido();\n            renderTableRetornoMotoboy();\n        }\n        \n        // ========================================\n        // CALCULAR EFICI√äNCIA DE RETORNO\n        // ========================================\n        function calcularEficienciaRetorno() {\n            const retornos = filteredData.retornoMotoboy || [];\n            \n            if (retornos.length === 0) return 'N/A';\n            \n            let totalComDados = 0;\n            let totalNoPrazo = 0;\n            \n            retornos.forEach(mb => {\n                totalComDados += (mb.noPrazo + mb.atrasados);\n                totalNoPrazo += mb.noPrazo;\n            });\n            \n            if (totalComDados === 0) return 'N/A';\n            \n            const eficiencia = (totalNoPrazo / totalComDados) * 100;\n            return `${eficiencia.toFixed(1)}%`;\n        }\n\n        function renderTableRotas() {\n            const tbody = document.getElementById('tableRotasBody');\n            const rotas = filteredData.rotas;\n            \n            if (rotas.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"11\" class=\"empty-state\">Nenhuma rota encontrada</td></tr>`;\n                document.getElementById('pagination-rotas').innerHTML = '';\n                return;\n            }\n\n            const rotasPaginadas = getPaginatedData(rotas, 'rotas');\n\n            tbody.innerHTML = rotasPaginadas.map(r => {\n                let statusBadge = 'badge-info';\n                let statusText = 'Sem dados';\n                if (r.ratio !== null) {\n                    if (r.ratio <= 1.05) {\n                        statusBadge = 'badge-success';\n                        statusText = `‚úÖ ${(r.ratio * 100).toFixed(0)}%`;\n                    } else if (r.ratio <= 1.5) {\n                        statusBadge = 'badge-warning';\n                        statusText = `‚ö†Ô∏è ${(r.ratio * 100).toFixed(0)}%`;\n                    } else {\n                        statusBadge = 'badge-danger';\n                        statusText = `üö® ${(r.ratio * 100).toFixed(0)}%`;\n                    }\n                }\n\n                return `\n                    <tr>\n                        <td class=\"td-strong\">${r.SAIDAID}</td>\n                        <td>${r.CIDADEFILIAL || '-'}</td>\n                        <td>${r.MOTOBOY || '-'}</td>\n                        <td class=\"td-strong\">${r.qtdEntregas}</td>\n                        <td class=\"td-muted\">${r.paradas}</td>\n                        <td>${r.kmTotal.toFixed(1)} km</td>\n                        <td>${Math.floor(r.tempoReal / 60)} min</td>\n                        <td class=\"td-muted\">${Math.floor(r.tempoPrevisto / 60)} min</td>\n                        <td class=\"td-strong\">${r.ratio !== null ? (r.ratio * 100).toFixed(0) + '%' : '-'}</td>\n                        <td><span class=\"badge ${statusBadge}\">${statusText}</span></td>\n                        <td>\n                            <button class=\"btn btn-secondary\" style=\"padding: 6px 12px; font-size: 12px;\" onclick=\"openModal(${r.SAIDAID})\">\n                                üîç Ver\n                            </button>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('rotas');\n        }\n\n        function renderTableMotoboys() {\n            const tbody = document.getElementById('tableMotoboysBody');\n            const motoboys = filteredData.motoboys;\n            \n            if (motoboys.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"9\" class=\"empty-state\">Nenhum motoboy encontrado</td></tr>`;\n                document.getElementById('pagination-motoboys').innerHTML = '';\n                return;\n            }\n\n            const motoboysPaginados = getPaginatedData(motoboys, 'motoboys');\n\n            tbody.innerHTML = motoboysPaginados.map((mb, idx) => {\n                const globalIdx = (pagination.motoboys.currentPage - 1) * pagination.motoboys.itemsPerPage + idx;\n                const medal = globalIdx < 3 ? ['ü•á','ü•à','ü•â'][globalIdx] : `${globalIdx+1}¬∫`;\n                const perfBadge = mb.performance >= 0.8 ? 'badge-success' : mb.performance >= 0.6 ? 'badge-warning' : 'badge-danger';\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${medal}</td>\n                        <td>${mb.motoboy}</td>\n                        <td class=\"td-muted\">${mb.rotas}</td>\n                        <td class=\"td-strong\">${mb.entregas}</td>\n                        <td>${mb.km.toFixed(1)} km</td>\n                        <td class=\"td-muted\">${Math.floor(mb.tempoMedio / 60)} min</td>\n                        <td>${(mb.taxaSucesso * 100).toFixed(1)}%</td>\n                        <td class=\"td-strong\">${mb.atrasos}</td>\n                        <td><span class=\"badge ${perfBadge}\">${(mb.performance * 100).toFixed(0)}%</span></td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('motoboys');\n        }\n\n        function renderTableFiliais() {\n            const tbody = document.getElementById('tableFiliaisBody');\n            const filiais = filteredData.filiais;\n            \n            if (filiais.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"8\" class=\"empty-state\">Nenhuma filial encontrada</td></tr>`;\n                document.getElementById('pagination-filiais').innerHTML = '';\n                return;\n            }\n\n            const filiaisPaginadas = getPaginatedData(filiais, 'filiais');\n\n            tbody.innerHTML = filiaisPaginadas.map(f => {\n                return `\n                    <tr>\n                        <td class=\"td-strong\">${f.filial}</td>\n                        <td class=\"td-muted\">${f.rotas}</td>\n                        <td class=\"td-strong\">${f.entregas}</td>\n                        <td>${f.dentroPrazo}</td>\n                        <td>${f.foraPrazo}</td>\n                        <td>\n                            ${(f.eficiencia * 100).toFixed(1)}%\n                            <div class=\"progress-bar-wrapper\">\n                                <div class=\"progress-bar-fill\" style=\"width: ${f.eficiencia * 100}%\"></div>\n                            </div>\n                        </td>\n                        <td class=\"td-muted\">${Math.floor(f.tempoMedio / 60)} min</td>\n                        <td>${f.km.toFixed(1)} km</td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('filiais');\n        }\n\n        function renderTableAtrasos() {\n            const tbody = document.getElementById('tableAtrasosBody');\n            const atrasos = filteredData.atrasos;\n            \n            if (atrasos.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"9\" class=\"empty-state\">‚úÖ Nenhum atraso detectado!</td></tr>`;\n                document.getElementById('pagination-atrasos').innerHTML = '';\n                return;\n            }\n\n            const atrasosPaginados = getPaginatedData(atrasos, 'atrasos');\n\n            tbody.innerHTML = atrasosPaginados.map(a => {\n                const gravBadge = a.gravidade === 'critical' ? 'badge-danger' : a.gravidade === 'high' ? 'badge-warning' : 'badge-info';\n                const gravText = a.gravidade === 'critical' ? 'üö® Cr√≠tico' : a.gravidade === 'high' ? '‚ö†Ô∏è Alto' : '‚ÑπÔ∏è Moderado';\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${a.SAIDAID}</td>\n                        <td>${a.CIDADEFILIAL || '-'}</td>\n                        <td>${a.MOTOBOY || '-'}</td>\n                        <td class=\"td-muted\">${Math.floor(a.tempoPrevisto / 60)} min</td>\n                        <td class=\"td-strong\">${Math.floor(a.tempoReal / 60)} min</td>\n                        <td style=\"color: #ef4444; font-weight: 700;\">+${Math.floor(a.diferenca / 60)} min</td>\n                        <td class=\"td-strong\">${a.desvio.toFixed(1)}%</td>\n                        <td><span class=\"badge ${gravBadge}\">${gravText}</span></td>\n                        <td>\n                            <button class=\"btn btn-secondary\" style=\"padding: 6px 12px; font-size: 12px;\" onclick=\"openModal(${a.SAIDAID})\">\n                                üîç Ver\n                            </button>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('atrasos');\n        }\n\n        function renderTableTimeline() {\n            const tbody = document.getElementById('tableTimelineBody');\n            const timeline = filteredData.timeline;\n            \n            if (timeline.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"10\" class=\"empty-state\">Nenhuma entrega encontrada</td></tr>`;\n                document.getElementById('pagination-timeline').innerHTML = '';\n                return;\n            }\n\n            const timelinePaginado = getPaginatedData(timeline, 'timeline');\n\n            tbody.innerHTML = timelinePaginado.map(t => {\n                let statusBadge = 'badge-success';\n                let statusText = '‚úÖ Entregue';\n                if (!t.ENTREGA_CLIENTE || t.ENTREGA_CLIENTE === 'null') {\n                    statusBadge = 'badge-danger';\n                    statusText = '‚è≥ Pendente';\n                } else if (t.INICIO_ROTA && !t.FIM_ROTA) {\n                    statusBadge = 'badge-warning';\n                    statusText = 'üöö Em Transporte';\n                }\n                \n                const formatDate = (d) => {\n                    if (!d || d === 'null') return '-';\n                    try {\n                        const date = new Date(d);\n                        return date.toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });\n                    } catch(e) {\n                        return '-';\n                    }\n                };\n\n                const inicio = t.INICIO_ROTA ? new Date(t.INICIO_ROTA) : null;\n                const entrega = t.ENTREGA_CLIENTE ? new Date(t.ENTREGA_CLIENTE) : null;\n                const duracao = inicio && entrega ? Math.floor((entrega - inicio) / 60000) : 0;\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${t.PEDIDO}</td>\n                        <td class=\"td-muted\">${t.SAIDAID}</td>\n                        <td>${(t.RAZAO_SOCIAL || '').substring(0, 25)}${t.RAZAO_SOCIAL && t.RAZAO_SOCIAL.length > 25 ? '...' : ''}</td>\n                        <td>${t.CIDADE || '-'}</td>\n                        <td class=\"td-muted\">${t.MOTOBOY || '-'}</td>\n                        <td class=\"td-muted\">${formatDate(t.INICIO_ROTA)}</td>\n                        <td class=\"td-strong\">${formatDate(t.ENTREGA_CLIENTE)}</td>\n                        <td class=\"td-muted\">${formatDate(t.FIM_ROTA)}</td>\n                        <td>${duracao > 0 ? duracao + ' min' : '-'}</td>\n                        <td><span class=\"badge ${statusBadge}\">${statusText}</span></td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('timeline');\n        }\n\n        let filtroAtrasosPedido = 'todos'; // 'todos', 'dentro', 'fora', 'nao-entregue'\n\n        function renderTableAtrasosPedido() {\n            const tbody = document.getElementById('tableAtrasosPedidoBody');\n            const todosPedidos = filteredData.pedidosIndividuais;\n            \n            if (todosPedidos.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"11\" class=\"empty-state\">Nenhum pedido encontrado</td></tr>`;\n                document.getElementById('pagination-atrasos-pedido').innerHTML = '';\n                return;\n            }\n\n            // Contar totais\n            const totalDentro = todosPedidos.filter(p => p.statusPedido === 'dentro').length;\n            const totalFora = todosPedidos.filter(p => p.statusPedido === 'fora').length;\n            const totalNaoEntregue = todosPedidos.filter(p => p.statusPedido === 'nao-entregue').length;\n            const total = todosPedidos.length;\n\n            // Renderizar resumo\n            const resumoContainer = document.getElementById('resumoAtrasosPedido');\n            resumoContainer.innerHTML = `\n                <div style=\"background: #f3f4f6; border: 2px solid ${filtroAtrasosPedido === 'todos' ? '#1890ff' : '#e5e7eb'}; padding: 16px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s;\" onclick=\"filtrarAtrasosPedido('todos')\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #111827;\">${total}</div>\n                    <div style=\"font-size: 12px; color: #6b7280; margin-top: 4px;\">üì¶ Todos os Pedidos</div>\n                </div>\n                <div style=\"background: #d1fae5; border: 2px solid ${filtroAtrasosPedido === 'dentro' ? '#10b981' : '#a7f3d0'}; padding: 16px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s;\" onclick=\"filtrarAtrasosPedido('dentro')\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #065f46;\">${totalDentro}</div>\n                    <div style=\"font-size: 12px; color: #047857; margin-top: 4px;\">‚úÖ Dentro do Prazo</div>\n                    <div style=\"font-size: 11px; color: #059669; margin-top: 2px;\">${((totalDentro / total) * 100).toFixed(1)}%</div>\n                </div>\n                <div style=\"background: #fee2e2; border: 2px solid ${filtroAtrasosPedido === 'fora' ? '#ef4444' : '#fecaca'}; padding: 16px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s;\" onclick=\"filtrarAtrasosPedido('fora')\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #991b1b;\">${totalFora}</div>\n                    <div style=\"font-size: 12px; color: #b91c1c; margin-top: 4px;\">‚ùå Fora do Prazo</div>\n                    <div style=\"font-size: 11px; color: #dc2626; margin-top: 2px;\">${((totalFora / total) * 100).toFixed(1)}%</div>\n                </div>\n                <div style=\"background: #fef3c7; border: 2px solid ${filtroAtrasosPedido === 'nao-entregue' ? '#f59e0b' : '#fde68a'}; padding: 16px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s;\" onclick=\"filtrarAtrasosPedido('nao-entregue')\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #92400e;\">${totalNaoEntregue}</div>\n                    <div style=\"font-size: 12px; color: #b45309; margin-top: 4px;\">üü† N√£o Entregue</div>\n                    <div style=\"font-size: 11px; color: #d97706; margin-top: 2px;\">${((totalNaoEntregue / total) * 100).toFixed(1)}%</div>\n                </div>\n            `;\n\n            // Filtrar pedidos\n            let pedidosFiltrados = todosPedidos;\n            if (filtroAtrasosPedido !== 'todos') {\n                pedidosFiltrados = todosPedidos.filter(p => p.statusPedido === filtroAtrasosPedido);\n            }\n\n            // Resetar pagina√ß√£o ao filtrar (mas n√£o quando renderizar novamente por mudan√ßa de p√°gina)\n            // pagination['atrasos-pedido'].currentPage = 1;\n\n            // Paginar manualmente\n            const pag = pagination['atrasos-pedido'];\n            const start = (pag.currentPage - 1) * pag.itemsPerPage;\n            const end = start + pag.itemsPerPage;\n            const pedidosPaginados = pedidosFiltrados.slice(start, end);\n\n            tbody.innerHTML = pedidosPaginados.map(p => {\n                let statusBadge = 'badge-warning';\n                let statusText = 'üü† N√£o Entregue';\n                let statusClass = 'nao-entregue';\n                \n                if (p.statusPedido === 'dentro') {\n                    statusBadge = 'badge-success';\n                    statusText = '‚úÖ Dentro';\n                    statusClass = 'dentro';\n                } else if (p.statusPedido === 'fora') {\n                    statusBadge = 'badge-danger';\n                    statusText = '‚ùå Fora';\n                    statusClass = 'fora';\n                }\n\n                const tempoLocalStr = p.tempoLocal > 0 ? p.tempoLocal.toFixed(1) + ' min' : '-';\n                const tempoGoogleStr = p.tempoGoogle > 0 ? p.tempoGoogle + ' min' : '-';\n                const diferencaStr = p.diferenca !== 0 && p.tempoLocal > 0 && p.tempoGoogle > 0 \n                    ? (p.diferenca > 0 ? '+' : '') + p.diferenca.toFixed(1) + ' min' \n                    : '-';\n                const diferencaColor = p.diferenca > 0 ? '#ef4444' : p.diferenca < 0 ? '#10b981' : '#6b7280';\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${p.PEDIDO}</td>\n                        <td class=\"td-muted\">${p.SAIDAID}</td>\n                        <td>${p.CIDADEFILIAL || '-'}</td>\n                        <td class=\"td-muted\">${p.MOTOBOY || '-'}</td>\n                        <td>${(p.RAZAO_SOCIAL || '').substring(0, 30)}${p.RAZAO_SOCIAL && p.RAZAO_SOCIAL.length > 30 ? '...' : ''}</td>\n                        <td class=\"td-muted\">${p.CIDADE || '-'}</td>\n                        <td class=\"td-strong\">${p.ordem}¬∫</td>\n                        <td>${tempoLocalStr}</td>\n                        <td class=\"td-muted\">${tempoGoogleStr}</td>\n                        <td style=\"color: ${diferencaColor}; font-weight: 700;\">${diferencaStr}</td>\n                        <td><span class=\"badge ${statusBadge}\">${statusText}</span></td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('atrasos-pedido', pedidosFiltrados.length);\n        }\n\n        function filtrarAtrasosPedido(tipo) {\n            console.log('üîç Filtrando por:', tipo);\n            filtroAtrasosPedido = tipo;\n            pagination['atrasos-pedido'].currentPage = 1; // Resetar para primeira p√°gina\n            renderTableAtrasosPedido();\n        }\n        \n        function renderTableRetornoMotoboy() {\n            const tbody = document.getElementById('tableRetornoMotoboyBody');\n            const retornos = filteredData.retornoMotoboy;\n            \n            if (retornos.length === 0) {\n                tbody.innerHTML = `<tr><td colspan=\"9\" class=\"empty-state\">Nenhum dado de retorno encontrado</td></tr>`;\n                document.getElementById('pagination-retorno-motoboy').innerHTML = '';\n                return;\n            }\n            \n            // Calcular totais para o resumo\n            let totalRetornos = 0;\n            let totalNoPrazo = 0;\n            let totalAtrasados = 0;\n            let eficienciaGeral = 0;\n            \n            retornos.forEach(mb => {\n                totalRetornos += mb.totalRetornos;\n                totalNoPrazo += mb.noPrazo;\n                totalAtrasados += mb.atrasados;\n            });\n            \n            const totalComDados = totalNoPrazo + totalAtrasados;\n            eficienciaGeral = totalComDados > 0 ? (totalNoPrazo / totalComDados) * 100 : 0;\n            \n            // Renderizar resumo\n            const resumoContainer = document.getElementById('resumoRetornos');\n            resumoContainer.innerHTML = `\n                <div style=\"background: #f3f4f6; border: 2px solid #e5e7eb; padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #111827;\">${totalRetornos}</div>\n                    <div style=\"font-size: 12px; color: #6b7280; margin-top: 4px;\">üèçÔ∏è Total de Retornos</div>\n                </div>\n                <div style=\"background: #d1fae5; border: 2px solid #10b981; padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #065f46;\">${totalNoPrazo}</div>\n                    <div style=\"font-size: 12px; color: #047857; margin-top: 4px;\">‚úÖ No Prazo</div>\n                    <div style=\"font-size: 11px; color: #059669; margin-top: 2px;\">${totalComDados > 0 ? ((totalNoPrazo / totalComDados) * 100).toFixed(1) : 0}%</div>\n                </div>\n                <div style=\"background: #fee2e2; border: 2px solid #ef4444; padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #991b1b;\">${totalAtrasados}</div>\n                    <div style=\"font-size: 12px; color: #b91c1c; margin-top: 4px;\">üö® Atrasados</div>\n                    <div style=\"font-size: 11px; color: #dc2626; margin-top: 2px;\">${totalComDados > 0 ? ((totalAtrasados / totalComDados) * 100).toFixed(1) : 0}%</div>\n                </div>\n                <div style=\"background: #dbeafe; border: 2px solid #3b82f6; padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 24px; font-weight: 800; color: #1e40af;\">${eficienciaGeral.toFixed(1)}%</div>\n                    <div style=\"font-size: 12px; color: #1e40af; margin-top: 4px;\">üìä Efici√™ncia Geral</div>\n                    <div style=\"font-size: 11px; color: #2563eb; margin-top: 2px;\">${totalNoPrazo}/${totalComDados} retornos</div>\n                </div>\n            `;\n            \n            const retornosPaginados = getPaginatedData(retornos, 'retorno-motoboy');\n            \n            tbody.innerHTML = retornosPaginados.map(mb => {\n                const totalComDados = mb.noPrazo + mb.atrasados;\n                const eficiencia = mb.eficiencia * 100;\n                \n                let eficienciaBadge = 'badge-success';\n                let eficienciaText = '‚úÖ Excelente';\n                if (eficiencia < 70) {\n                    eficienciaBadge = 'badge-danger';\n                    eficienciaText = 'üö® Cr√≠tico';\n                } else if (eficiencia < 85) {\n                    eficienciaBadge = 'badge-warning';\n                    eficienciaText = '‚ö†Ô∏è Aten√ß√£o';\n                }\n                \n                // Performance geral\n                let performanceBadge = 'badge-success';\n                let performanceIcon = 'üèÜ';\n                if (mb.diferencaMedia > 5) {\n                    performanceBadge = 'badge-danger';\n                    performanceIcon = 'üìâ';\n                } else if (mb.diferencaMedia > 2) {\n                    performanceBadge = 'badge-warning';\n                    performanceIcon = '‚ö°';\n                }\n                \n                return `\n                    <tr>\n                        <td class=\"td-strong\">${mb.motoboy}</td>\n                        <td class=\"td-muted\">${mb.totalRetornos}</td>\n                        <td style=\"color: #10b981; font-weight: 600;\">${mb.noPrazo}</td>\n                        <td style=\"color: #ef4444; font-weight: 600;\">${mb.atrasados}</td>\n                        <td>\n                            <span class=\"badge ${eficienciaBadge}\">${eficiencia.toFixed(1)}%</span>\n                            <div class=\"progress-bar-wrapper\">\n                                <div class=\"progress-bar-fill\" style=\"width: ${eficiencia}%; background: ${eficiencia >= 85 ? '#10b981' : eficiencia >= 70 ? '#f59e0b' : '#ef4444'};\"></div>\n                            </div>\n                        </td>\n                        <td class=\"td-strong\">${mb.tempoMedioReal.toFixed(0)} min</td>\n                        <td class=\"td-muted\">${mb.tempoMedioGoogle.toFixed(0)} min</td>\n                        <td style=\"color: ${mb.diferencaMedia > 0 ? '#ef4444' : '#10b981'}; font-weight: 700;\">\n                            ${mb.diferencaMedia > 0 ? '+' : ''}${mb.diferencaMedia.toFixed(1)} min\n                        </td>\n                        <td>\n                            <span class=\"badge ${performanceBadge}\">${performanceIcon} ${eficienciaText}</span>\n                        </td>\n                    </tr>\n                `;\n            }).join('');\n            \n            renderPagination('retorno-motoboy');\n        }\n\n        // ========================================\n        // FILTROS\n        // ========================================\n        function populateFilters() {\n            const filiais = [...new Set(rawData.pedidos.map(p => p.CIDADEFILIAL))].filter(f => f).sort();\n            const motoboys = [...new Set(rawData.pedidos.map(p => p.MOTOBOY))].filter(m => m).sort();\n            \n            const selectFilial = document.getElementById('filterFilial');\n            const selectMotoboy = document.getElementById('filterMotoboy');\n            \n            selectFilial.innerHTML = '<option value=\"\">Todas as Filiais</option>' + \n                filiais.map(f => `<option value=\"${f}\">${f}</option>`).join('');\n            \n            selectMotoboy.innerHTML = '<option value=\"\">Todos os Motoboys</option>' + \n                motoboys.map(m => `<option value=\"${m}\">${m}</option>`).join('');\n        }\n\n        function applyFilters() {\n            // Capturar valores dos filtros\n            activeFilters.filial = document.getElementById('filterFilial').value;\n            activeFilters.motoboy = document.getElementById('filterMotoboy').value;\n            activeFilters.status = document.getElementById('filterStatus').value;\n            activeFilters.performance = document.getElementById('filterPerformance').value;\n            activeFilters.saidaId = document.getElementById('filterSaidaId').value;\n            activeFilters.pedido = document.getElementById('filterPedido').value;\n\n            console.log('üîç Aplicando filtros:', activeFilters);\n\n            // Resetar pagina√ß√£o\n            Object.keys(pagination).forEach(key => {\n                pagination[key].currentPage = 1;\n            });\n\n            // Re-processar dados com filtros\n            processDataWithFilters();\n            generateInsights();\n            renderKPIs();\n            renderTables();\n\n            console.log('‚úÖ Filtros aplicados!');\n        }\n\n        function clearFilters() {\n            document.getElementById('filterFilial').value = '';\n            document.getElementById('filterMotoboy').value = '';\n            document.getElementById('filterStatus').value = '';\n            document.getElementById('filterPerformance').value = '';\n            document.getElementById('filterSaidaId').value = '';\n            document.getElementById('filterPedido').value = '';\n            \n            // Limpar filtros ativos\n            activeFilters = {\n                filial: '',\n                motoboy: '',\n                status: '',\n                performance: '',\n                saidaId: '',\n                pedido: ''\n            };\n\n            // Re-processar sem filtros\n            applyFilters();\n        }\n\n        function processDataWithFilters() {\n            // Filtrar pedidos base\n            let pedidosFiltrados = rawData.pedidos;\n\n            if (activeFilters.filial) {\n                pedidosFiltrados = pedidosFiltrados.filter(p => p.CIDADEFILIAL === activeFilters.filial);\n            }\n\n            if (activeFilters.motoboy) {\n                pedidosFiltrados = pedidosFiltrados.filter(p => p.MOTOBOY === activeFilters.motoboy);\n            }\n\n            if (activeFilters.saidaId) {\n                pedidosFiltrados = pedidosFiltrados.filter(p => \n                    String(p.SAIDAID).includes(activeFilters.saidaId)\n                );\n            }\n\n            if (activeFilters.pedido) {\n                pedidosFiltrados = pedidosFiltrados.filter(p => \n                    String(p.PEDIDO).includes(activeFilters.pedido)\n                );\n            }\n\n            if (activeFilters.status) {\n                if (activeFilters.status === 'entregue') {\n                    pedidosFiltrados = pedidosFiltrados.filter(p => p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null');\n                } else if (activeFilters.status === 'em-transporte') {\n                    pedidosFiltrados = pedidosFiltrados.filter(p => \n                        p.INICIO_ROTA && !p.FIM_ROTA && (!p.ENTREGA_CLIENTE || p.ENTREGA_CLIENTE === 'null')\n                    );\n                } else if (activeFilters.status === 'nao-entregue') {\n                    pedidosFiltrados = pedidosFiltrados.filter(p => \n                        !p.ENTREGA_CLIENTE || p.ENTREGA_CLIENTE === 'null'\n                    );\n                }\n            }\n\n            // Processar com pedidos filtrados\n            processDataFromPedidos(pedidosFiltrados);\n\n            // Aplicar filtro de performance nas rotas\n            if (activeFilters.performance) {\n                if (activeFilters.performance === 'dentro-prazo') {\n                    filteredData.rotas = filteredData.rotas.filter(r => r.ratio !== null && r.ratio <= 1.05);\n                } else if (activeFilters.performance === 'fora-prazo') {\n                    filteredData.rotas = filteredData.rotas.filter(r => r.ratio !== null && r.ratio > 1.05);\n                } else if (activeFilters.performance === 'critico') {\n                    filteredData.rotas = filteredData.rotas.filter(r => r.ratio !== null && r.ratio > 1.5);\n                }\n            }\n        }\n\n        function processDataFromPedidos(pedidosFiltrados) {\n            const pedidos = pedidosFiltrados;\n            const calc = rawData.calculo;\n            const rotas = rawData.rotas;\n\n            // [Copiar toda a l√≥gica de processamento do processData() aqui]\n            // Por simplicidade, vou chamar processData() e depois filtrar\n            // Em produ√ß√£o, voc√™ pode otimizar isso\n            \n            // Agrupar por SAIDAID\n            const groupedBySaida = {};\n            pedidos.forEach(p => {\n                const saidaId = p.SAIDAID;\n                if (!groupedBySaida[saidaId]) {\n                    groupedBySaida[saidaId] = {\n                        SAIDAID: saidaId,\n                        MOTOBOY: p.MOTOBOY,\n                        CIDADEFILIAL: p.CIDADEFILIAL,\n                        items: [],\n                        clientesUnicos: new Set()\n                    };\n                }\n                groupedBySaida[saidaId].items.push(p);\n                if (p.COD_CLI) {\n                    groupedBySaida[saidaId].clientesUnicos.add(p.COD_CLI);\n                }\n            });\n\n            // Calcular m√©tricas por rota - COM AN√ÅLISE PEDIDO A PEDIDO (mesma l√≥gica)\n            filteredData.rotas = Object.values(groupedBySaida).map(rota => {\n                const rotaOtimizada = rotas.filter(r => r.saida_numero === rota.SAIDAID)\n                    .sort((a, b) => b.num_ordem - a.num_ordem);\n                const ultimoPonto = rotaOtimizada[0];\n\n                // Ordenar pedidos por ENTREGA_CLIENTE para an√°lise sequencial\n                const pedidosOrdenados = [...rota.items].sort((a, b) => {\n                    if (!a.ENTREGA_CLIENTE) return 1;\n                    if (!b.ENTREGA_CLIENTE) return -1;\n                    return new Date(a.ENTREGA_CLIENTE) - new Date(b.ENTREGA_CLIENTE);\n                });\n\n                // AN√ÅLISE PEDIDO A PEDIDO (igual TOTAL ENTREGAS RESUMO)\n                let tempoPrevistoPedidos = 0;\n                let tempoRealPedidos = 0;\n                let dentroCount = 0;\n                let foraCount = 0;\n                let naoEntregueCount = 0;\n                \n                const pedidosComStatus = pedidosOrdenados.map((item, index) => {\n                    // Buscar Google\n                    const log = calc.find(l => l.PEDIDO == item.PEDIDO);\n                    \n                    // Se n√£o tem Google = N√£o Entregue\n                    if (!log) {\n                        naoEntregueCount++;\n                        return { ...item, statusPedido: 'nao-entregue', tempoLocal: 0, tempoGoogle: 0 };\n                    }\n                    \n                    // Tempo Google + 5min\n                    const tempoGoogle = Number((log.TEMPO || \"0\").toString().replace(/\\D+/g, '')) + 5;\n                    tempoPrevistoPedidos += tempoGoogle * 60; // em segundos\n                    \n                    // Calcular tempo local SEQUENCIAL\n                    let tempoLocal = 0;\n                    if (item.ENTREGA_CLIENTE && item.INICIO_ROTA) {\n                        if (index === 0) {\n                            // 1¬∫ pedido: ENTREGA_CLIENTE - INICIO_ROTA\n                            tempoLocal = (new Date(item.ENTREGA_CLIENTE) - new Date(item.INICIO_ROTA)) / 60000;\n                        } else {\n                            // Pedidos seguintes: ENTREGA_CLIENTE atual - ENTREGA_CLIENTE anterior\n                            const anterior = pedidosOrdenados[index - 1];\n                            if (anterior.ENTREGA_CLIENTE) {\n                                tempoLocal = (new Date(item.ENTREGA_CLIENTE) - new Date(anterior.ENTREGA_CLIENTE)) / 60000;\n                            }\n                        }\n                        tempoRealPedidos += tempoLocal;\n                    }\n                    \n                    // Classificar pedido\n                    let statusPedido = 'nao-entregue';\n                    if (tempoLocal > 0 && tempoGoogle > 0) {\n                        if (tempoLocal <= tempoGoogle) {\n                            statusPedido = 'dentro';\n                            dentroCount++;\n                        } else {\n                            statusPedido = 'fora';\n                            foraCount++;\n                        }\n                    } else {\n                        naoEntregueCount++;\n                    }\n                    \n                    return { ...item, statusPedido, tempoLocal, tempoGoogle };\n                });\n\n                // TEMPO TOTAL DA ROTA (usar tempo sequencial acumulado)\n                const tempoReal = tempoRealPedidos * 60; // converter min para segundos\n                const tempoPrevisto = tempoPrevistoPedidos; // j√° est√° em segundos\n\n                const kmTotal = rota.items.reduce((sum, item) => {\n                    const log = calc.find(l => l.PEDIDO === item.PEDIDO || l.SAIDAID === parseInt(item.SAIDAID));\n                    return sum + (parseFloat(log?.KM || 0));\n                }, 0);\n\n                const entregues = rota.items.filter(i => i.ENTREGA_CLIENTE && i.ENTREGA_CLIENTE !== 'null').length;\n                const total = rota.items.length;\n                const ratio = tempoPrevisto > 0 && tempoReal > 0 ? tempoReal / tempoPrevisto : null;\n\n                return {\n                    SAIDAID: rota.SAIDAID,\n                    CIDADEFILIAL: rota.CIDADEFILIAL,\n                    MOTOBOY: rota.MOTOBOY,\n                    qtdEntregas: total,\n                    qtdEntregues: entregues,\n                    paradas: rota.clientesUnicos.size,\n                    kmTotal: kmTotal,\n                    tempoReal: tempoReal,\n                    tempoPrevisto: tempoPrevisto,\n                    ratio: ratio,\n                    items: pedidosComStatus, // Com status individual\n                    dentroCount: dentroCount,\n                    foraCount: foraCount,\n                    naoEntregueCount: naoEntregueCount\n                };\n            });\n\n            // Processar motoboys, filiais, atrasos e timeline (mesma l√≥gica)\n            const motoboyStats = {};\n            filteredData.rotas.forEach(rota => {\n                const mb = rota.MOTOBOY || 'SEM MOTOBOY';\n                if (!motoboyStats[mb]) {\n                    motoboyStats[mb] = {\n                        motoboy: mb,\n                        rotas: 0,\n                        entregas: 0,\n                        entregues: 0,\n                        km: 0,\n                        tempos: [],\n                        atrasos: 0\n                    };\n                }\n                motoboyStats[mb].rotas++;\n                motoboyStats[mb].entregas += rota.qtdEntregas;\n                motoboyStats[mb].entregues += rota.qtdEntregues;\n                motoboyStats[mb].km += rota.kmTotal;\n                if (rota.tempoReal > 0) {\n                    motoboyStats[mb].tempos.push(rota.tempoReal);\n                }\n                if (rota.ratio && rota.ratio > 1.05) {\n                    motoboyStats[mb].atrasos++;\n                }\n            });\n\n            filteredData.motoboys = Object.values(motoboyStats)\n                .map(mb => {\n                    const tempoMedio = mb.tempos.length > 0 \n                        ? mb.tempos.reduce((a,b) => a+b, 0) / mb.tempos.length \n                        : 0;\n                    const taxaSucesso = mb.entregas > 0 ? (mb.entregues / mb.entregas) : 0;\n                    const performance = mb.rotas > 0 ? ((mb.rotas - mb.atrasos) / mb.rotas) : 0;\n                    return { ...mb, tempoMedio, taxaSucesso, performance };\n                })\n                .sort((a, b) => b.entregas - a.entregas);\n\n            const filialStats = {};\n            filteredData.rotas.forEach(rota => {\n                const fil = rota.CIDADEFILIAL || 'SEM FILIAL';\n                if (!filialStats[fil]) {\n                    filialStats[fil] = {\n                        filial: fil,\n                        rotas: 0,\n                        entregas: 0,\n                        dentroPrazo: 0,\n                        foraPrazo: 0,\n                        tempos: [],\n                        km: 0\n                    };\n                }\n                filialStats[fil].rotas++;\n                filialStats[fil].entregas += rota.qtdEntregas;\n                filialStats[fil].km += rota.kmTotal;\n                if (rota.tempoReal > 0) {\n                    filialStats[fil].tempos.push(rota.tempoReal);\n                }\n                \n                // Usar os contadores de pedidos individuais (n√£o ratio da rota)\n                filialStats[fil].dentroPrazo += (rota.dentroCount || 0);\n                filialStats[fil].foraPrazo += (rota.foraCount || 0);\n            });\n\n            filteredData.filiais = Object.values(filialStats)\n                .map(f => {\n                    const tempoMedio = f.tempos.length > 0 \n                        ? f.tempos.reduce((a,b) => a+b, 0) / f.tempos.length \n                        : 0;\n                    const eficiencia = f.entregas > 0 ? (f.dentroPrazo / f.entregas) : 0;\n                    return { ...f, tempoMedio, eficiencia };\n                })\n                .sort((a, b) => a.filial.localeCompare(b.filial));\n\n            filteredData.atrasos = filteredData.rotas\n                .filter(r => r.ratio !== null && r.ratio > 1.05)\n                .map(r => {\n                    const diferenca = r.tempoReal - r.tempoPrevisto;\n                    const desvio = ((r.ratio - 1) * 100);\n                    let gravidade = 'warning';\n                    if (desvio > 50) gravidade = 'critical';\n                    else if (desvio > 20) gravidade = 'high';\n                    return { ...r, diferenca, desvio, gravidade };\n                })\n                .sort((a, b) => b.desvio - a.desvio);\n\n            filteredData.timeline = pedidos\n                .filter(p => p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null')\n                .sort((a, b) => new Date(b.ENTREGA_CLIENTE) - new Date(a.ENTREGA_CLIENTE))\n                .slice(0, 100);\n            \n            // Processar pedidos individuais para a nova aba\n            filteredData.pedidosIndividuais = [];\n            filteredData.rotas.forEach(rota => {\n                rota.items.forEach((item, index) => {\n                    filteredData.pedidosIndividuais.push({\n                        PEDIDO: item.PEDIDO,\n                        SAIDAID: rota.SAIDAID,\n                        CIDADEFILIAL: rota.CIDADEFILIAL,\n                        MOTOBOY: rota.MOTOBOY,\n                        RAZAO_SOCIAL: item.RAZAO_SOCIAL,\n                        CIDADE: item.CIDADE,\n                        ordem: index + 1,\n                        tempoLocal: item.tempoLocal || 0,\n                        tempoGoogle: item.tempoGoogle || 0,\n                        diferenca: (item.tempoLocal || 0) - (item.tempoGoogle || 0),\n                        statusPedido: item.statusPedido || 'nao-entregue',\n                        ENTREGA_CLIENTE: item.ENTREGA_CLIENTE,\n                        INICIO_ROTA: item.INICIO_ROTA\n                    });\n                });\n            });\n            \n            // Processar retornos\n            processarRetornoMotoboy();\n        }\n\n        // ========================================\n        // PAGINA√á√ÉO\n        // ========================================\n        function renderPagination(tabName, customLength) {\n            const data = filteredData[tabName] || [];\n            const dataLength = customLength !== undefined ? customLength : data.length;\n            const pag = pagination[tabName];\n            const totalPages = Math.ceil(dataLength / pag.itemsPerPage);\n            \n            const container = document.getElementById(`pagination-${tabName}`);\n            if (!container) return;\n\n            if (totalPages <= 1) {\n                container.innerHTML = '';\n                return;\n            }\n\n            let html = '';\n            \n            // Bot√£o Anterior\n            html += `\n                <button class=\"pagination-btn\" onclick=\"changePage('${tabName}', ${pag.currentPage - 1})\" \n                    ${pag.currentPage === 1 ? 'disabled' : ''}>\n                    ‚Üê Anterior\n                </button>\n            `;\n\n            // P√°ginas numeradas\n            const maxButtons = 7;\n            let startPage = Math.max(1, pag.currentPage - Math.floor(maxButtons / 2));\n            let endPage = Math.min(totalPages, startPage + maxButtons - 1);\n            \n            if (endPage - startPage < maxButtons - 1) {\n                startPage = Math.max(1, endPage - maxButtons + 1);\n            }\n\n            if (startPage > 1) {\n                html += `<button class=\"pagination-btn\" onclick=\"changePage('${tabName}', 1)\">1</button>`;\n                if (startPage > 2) {\n                    html += `<span class=\"pagination-info\">...</span>`;\n                }\n            }\n\n            for (let i = startPage; i <= endPage; i++) {\n                html += `\n                    <button class=\"pagination-btn ${i === pag.currentPage ? 'active' : ''}\" \n                        onclick=\"changePage('${tabName}', ${i})\">\n                        ${i}\n                    </button>\n                `;\n            }\n\n            if (endPage < totalPages) {\n                if (endPage < totalPages - 1) {\n                    html += `<span class=\"pagination-info\">...</span>`;\n                }\n                html += `<button class=\"pagination-btn\" onclick=\"changePage('${tabName}', ${totalPages})\">${totalPages}</button>`;\n            }\n\n            // Bot√£o Pr√≥ximo\n            html += `\n                <button class=\"pagination-btn\" onclick=\"changePage('${tabName}', ${pag.currentPage + 1})\" \n                    ${pag.currentPage === totalPages ? 'disabled' : ''}>\n                    Pr√≥ximo ‚Üí\n                </button>\n            `;\n\n            // Info\n            const start = (pag.currentPage - 1) * pag.itemsPerPage + 1;\n            const end = Math.min(pag.currentPage * pag.itemsPerPage, dataLength);\n            html += `<span class=\"pagination-info\">${start}-${end} de ${dataLength}</span>`;\n\n            container.innerHTML = html;\n        }\n\n        function changePage(tabName, newPage) {\n            const data = filteredData[tabName] || [];\n            const totalPages = Math.ceil(data.length / pagination[tabName].itemsPerPage);\n            \n            if (newPage < 1 || newPage > totalPages) return;\n            \n            pagination[tabName].currentPage = newPage;\n            \n            // Re-renderizar apenas a tabela espec√≠fica\n            switch(tabName) {\n                case 'rotas':\n                    renderTableRotas();\n                    break;\n                case 'motoboys':\n                    renderTableMotoboys();\n                    break;\n                case 'filiais':\n                    renderTableFiliais();\n                    break;\n                case 'atrasos':\n                    renderTableAtrasos();\n                    break;\n                case 'timeline':\n                    renderTableTimeline();\n                    break;\n                case 'atrasos-pedido':\n                    renderTableAtrasosPedido();\n                    break;\n                case 'retorno-motoboy':\n                    renderTableRetornoMotoboy();\n                    break;\n            }\n        }\n\n        function getPaginatedData(data, tabName) {\n            const pag = pagination[tabName];\n            const start = (pag.currentPage - 1) * pag.itemsPerPage;\n            const end = start + pag.itemsPerPage;\n            return data.slice(start, end);\n        }\n\n        // ========================================\n        // TABS\n        // ========================================\n        function switchTab(event, tabName) {\n            // Desativar todos\n            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));\n            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));\n            \n            // Ativar selecionado\n            if (event && event.target) {\n                event.target.classList.add('active');\n            }\n            document.getElementById(`tab-${tabName}`).classList.add('active');\n        }\n\n        // ========================================\n        // MODAL\n        // ========================================\n        function openModal(saidaId) {\n            const rota = filteredData.rotas.find(r => r.SAIDAID === saidaId);\n            if (!rota) return;\n\n            const modal = document.getElementById('detailModal');\n            const modalTitle = document.getElementById('modalTitle');\n            const modalBody = document.getElementById('modalBody');\n\n            modalTitle.textContent = `Detalhes da Rota ${saidaId}`;\n\n            const formatTime = (seg) => {\n                const min = Math.floor(seg / 60);\n                const sec = seg % 60;\n                return `${min}min ${sec}s`;\n            };\n\n            modalBody.innerHTML = `\n                <div class=\"detail-grid\">\n                    <div class=\"detail-item\">\n                        <label>ID Sa√≠da</label>\n                        <div class=\"value\">${rota.SAIDAID}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Filial</label>\n                        <div class=\"value\">${rota.CIDADEFILIAL || '-'}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Motoboy</label>\n                        <div class=\"value\">${rota.MOTOBOY || '-'}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Total Entregas</label>\n                        <div class=\"value\">${rota.qtdEntregas}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Entregas Conclu√≠das</label>\n                        <div class=\"value\">${rota.qtdEntregues} (${((rota.qtdEntregues / rota.qtdEntregas) * 100).toFixed(1)}%)</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Paradas (Clientes)</label>\n                        <div class=\"value\">${rota.paradas}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>KM Total</label>\n                        <div class=\"value\">${rota.kmTotal.toFixed(2)} km</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>KM por Entrega</label>\n                        <div class=\"value\">${(rota.kmTotal / rota.qtdEntregas).toFixed(2)} km</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Tempo Previsto</label>\n                        <div class=\"value\">${formatTime(rota.tempoPrevisto)}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Tempo Real (TTE)</label>\n                        <div class=\"value\">${formatTime(rota.tempoReal)}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Ratio Real/Previsto</label>\n                        <div class=\"value\">${rota.ratio !== null ? (rota.ratio * 100).toFixed(1) + '%' : 'N/A'}</div>\n                    </div>\n                    <div class=\"detail-item\">\n                        <label>Status</label>\n                        <div class=\"value\">\n                            ${rota.ratio !== null && rota.ratio <= 1.05 \n                                ? '<span class=\"badge badge-success\">‚úÖ Dentro do Prazo</span>' \n                                : rota.ratio !== null \n                                    ? '<span class=\"badge badge-danger\">‚ö†Ô∏è Fora do Prazo</span>'\n                                    : '<span class=\"badge badge-info\">‚ÑπÔ∏è Sem dados</span>'\n                            }\n                        </div>\n                    </div>\n                </div>\n\n                <h4 style=\"font-size: 16px; font-weight: 800; color: #111827; margin: 24px 0 12px;\">\n                    üì¶ An√°lise Pedido a Pedido (${rota.items.length} pedidos)\n                </h4>\n                <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;\">\n                    <div style=\"background: #d1fae5; border: 2px solid #10b981; padding: 12px; border-radius: 8px; text-align: center;\">\n                        <div style=\"font-size: 24px; font-weight: 800; color: #065f46;\">${rota.dentroCount || 0}</div>\n                        <div style=\"font-size: 12px; color: #047857;\">‚úÖ Dentro do Prazo</div>\n                    </div>\n                    <div style=\"background: #fee2e2; border: 2px solid #ef4444; padding: 12px; border-radius: 8px; text-align: center;\">\n                        <div style=\"font-size: 24px; font-weight: 800; color: #991b1b;\">${rota.foraCount || 0}</div>\n                        <div style=\"font-size: 12px; color: #b91c1c;\">‚ùå Fora do Prazo</div>\n                    </div>\n                    <div style=\"background: #fef3c7; border: 2px solid #f59e0b; padding: 12px; border-radius: 8px; text-align: center;\">\n                        <div style=\"font-size: 24px; font-weight: 800; color: #92400e;\">${rota.naoEntregueCount || 0}</div>\n                        <div style=\"font-size: 12px; color: #b45309;\">üü† N√£o Entregue</div>\n                    </div>\n                </div>\n                \n                <div class=\"table-wrapper\">\n                    <table>\n                        <thead>\n                            <tr>\n                                <th>#</th>\n                                <th>Pedido</th>\n                                <th>Cliente</th>\n                                <th>Cidade</th>\n                                <th>Tempo Real</th>\n                                <th>Tempo Google+5</th>\n                                <th>Status Prazo</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${rota.items.map((item, idx) => {\n                                // Determinar status de prazo baseado no c√°lculo pedido a pedido\n                                let statusBadge = 'badge-warning';\n                                let statusText = 'üü† N√£o Entregue';\n                                \n                                if (item.statusPedido === 'dentro') {\n                                    statusBadge = 'badge-success';\n                                    statusText = '‚úÖ Dentro';\n                                } else if (item.statusPedido === 'fora') {\n                                    statusBadge = 'badge-danger';\n                                    statusText = '‚ùå Fora';\n                                } else {\n                                    statusBadge = 'badge-warning';\n                                    statusText = 'üü† Sem Dados';\n                                }\n\n                                const tempoLocalStr = item.tempoLocal > 0 ? item.tempoLocal.toFixed(1) + ' min' : '-';\n                                const tempoGoogleStr = item.tempoGoogle > 0 ? item.tempoGoogle + ' min' : '-';\n\n                                return `\n                                    <tr>\n                                        <td class=\"td-strong\">${idx + 1}¬∫</td>\n                                        <td class=\"td-strong\">${item.PEDIDO}</td>\n                                        <td>${(item.RAZAO_SOCIAL || '').substring(0, 25)}</td>\n                                        <td class=\"td-muted\">${item.CIDADE || '-'}</td>\n                                        <td>${tempoLocalStr}</td>\n                                        <td class=\"td-muted\">${tempoGoogleStr}</td>\n                                        <td><span class=\"badge ${statusBadge}\">${statusText}</span></td>\n                                    </tr>\n                                `;\n                            }).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            `;\n\n            modal.classList.add('active');\n        }\n\n        function closeModal() {\n            document.getElementById('detailModal').classList.remove('active');\n        }\n\n        // Fechar modal ao clicar fora\n        document.getElementById('detailModal').addEventListener('click', function(e) {\n            if (e.target === this) {\n                closeModal();\n            }\n        });\n\n        // ========================================\n        // INICIALIZAR AO CARREGAR\n        // ========================================\n        window.addEventListener('DOMContentLoaded', function() {\n            initDashboard();\n        });\n    </script>\n\n    <!-- Injetar dados do Appsmith -->\n    <script>\n        {{\n            (() => {\n                const pedidos = pedidos_e_saidas_do_dia?.data || [];\n                const calculo = calculo_do_google?.data || { logistica_motoboy: [] };\n                const rotas = dmaplicativo_prod_rotas_otimiz?.data || [];\n                \n                return `\n                    console.log('üîÑ Carregando dados do Appsmith...');\n                    console.log('üì¶ Pedidos:', ${pedidos.length});\n                    console.log('üìä C√°lculos:', ${(calculo.logistica_motoboy || []).length});\n                    console.log('üöö Rotas:', ${rotas.length});\n                    \n                    // Injetar dados nas vari√°veis globais\n                    rawData.pedidos = ${JSON.stringify(pedidos)};\n                    rawData.calculo = ${JSON.stringify(calculo.logistica_motoboy || [])};\n                    rawData.rotas = ${JSON.stringify(rotas)};\n                    \n                    console.log('‚úÖ Dados injetados com sucesso!');\n                    \n                    // Processar dados automaticamente ap√≥s inje√ß√£o\n                    setTimeout(() => {\n                        if (typeof processData === 'function') {\n                            console.log('üîÑ Processando dados...');\n                            processData();\n                            generateInsights();\n                            renderKPIs();\n                            renderTables();\n                            populateFilters();\n                            console.log('‚úÖ Dashboard carregado!');\n                        } else {\n                            console.error('‚ùå Fun√ß√µes de processamento n√£o encontradas!');\n                        }\n                    }, 100);\n                `;\n            })()\n        }}\n    </script>\n</body>\n</html>\n\n",
  "topRow": 1,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "5jvmjllqpd",
  "widgetName": "Iframe3"
}