{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 94,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "wh6z4zxt20",
  "leftColumn": 0,
  "mobileBottomRow": 32,
  "mobileLeftColumn": 0,
  "mobileRightColumn": 13,
  "mobileTopRow": 0,
  "needsErrorInfo": false,
  "parentColumnSpace": 19.9375,
  "parentId": "wr6lefczlv",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 63,
  "source": "https://www.example.com",
  "srcDoc": "<style>\n    * {\n        margin: 0;\n        padding: 0;\n        box-sizing: border-box;\n    }\n\n    body {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;\n        background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        min-height: 100vh;\n        padding: 20px;\n    }\n\n    .search-container {\n        max-width: 1600px;\n        margin: 0 auto;\n    }\n\n    /* ========== HEADER & SEARCH ========== */\n    .search-header {\n        background: white;\n        padding: 32px;\n        border-radius: 16px;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.12);\n        margin-bottom: 24px;\n    }\n\n    .search-header h1 {\n        font-size: 32px;\n        font-weight: 900;\n        background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        -webkit-background-clip: text;\n        -webkit-text-fill-color: transparent;\n        background-clip: text;\n        margin-bottom: 24px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n    }\n\n    .search-box {\n        display: flex;\n        gap: 12px;\n        margin-bottom: 20px;\n    }\n\n    .search-input {\n        flex: 1;\n        padding: 16px 20px;\n        border: 3px solid #1890ff;\n        border-radius: 12px;\n        font-size: 18px;\n        font-weight: 600;\n        color: #111827;\n        transition: all 0.2s;\n    }\n\n    .search-input:focus {\n        outline: none;\n        border-color: #0050b3;\n        box-shadow: 0 0 0 4px rgba(24, 144, 255, 0.1);\n    }\n\n    .search-btn {\n        padding: 16px 32px;\n        background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n        color: white;\n        border: none;\n        border-radius: 12px;\n        font-size: 16px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);\n    }\n\n    .search-btn:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 20px rgba(24, 144, 255, 0.4);\n    }\n\n    .search-suggestions {\n        display: flex;\n        gap: 8px;\n        flex-wrap: wrap;\n        margin-top: 12px;\n    }\n\n    .suggestion-chip {\n        padding: 8px 16px;\n        background: #e6f7ff;\n        border: 2px solid #1890ff;\n        border-radius: 999px;\n        font-size: 12px;\n        font-weight: 600;\n        color: #0050b3;\n        cursor: pointer;\n        transition: all 0.2s;\n    }\n\n    .suggestion-chip:hover {\n        background: #1890ff;\n        color: white;\n    }\n\n    /* ========== RESULTS SECTION ========== */\n    .results-section {\n        display: none;\n    }\n\n    .results-section.active {\n        display: block;\n    }\n\n    /* ========== ROUTE SUMMARY ========== */\n    .route-summary {\n        background: white;\n        padding: 32px;\n        border-radius: 16px;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.12);\n        margin-bottom: 24px;\n    }\n\n    .route-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 24px;\n        padding-bottom: 20px;\n        border-bottom: 3px solid #f3f4f6;\n    }\n\n    .route-id {\n        font-size: 36px;\n        font-weight: 900;\n        color: #1890ff;\n    }\n\n    .route-status {\n        padding: 12px 24px;\n        border-radius: 999px;\n        font-size: 14px;\n        font-weight: 800;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n\n    .route-status.success {\n        background: #d1fae5;\n        color: #065f46;\n        border: 2px solid #a7f3d0;\n    }\n\n    .route-status.warning {\n        background: #fef3c7;\n        color: #92400e;\n        border: 2px solid #fde68a;\n    }\n\n    .route-status.danger {\n        background: #fee2e2;\n        color: #991b1b;\n        border: 2px solid #fecaca;\n    }\n\n    /* ========== KPI CARDS ========== */\n    .kpi-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 16px;\n        margin-bottom: 24px;\n    }\n\n    .kpi-card {\n        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\n        padding: 20px;\n        border-radius: 12px;\n        border-left: 4px solid;\n        transition: all 0.2s;\n    }\n\n    .kpi-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 8px 16px rgba(0,0,0,0.1);\n    }\n\n    .kpi-card.blue { border-color: #1890ff; }\n    .kpi-card.green { border-color: #52c41a; }\n    .kpi-card.orange { border-color: #faad14; }\n    .kpi-card.cyan { border-color: #13c2c2; }\n    .kpi-card.purple { border-color: #722ed1; }\n    .kpi-card.red { border-color: #f5222d; }\n\n    .kpi-label {\n        font-size: 11px;\n        font-weight: 700;\n        text-transform: uppercase;\n        color: #6b7280;\n        letter-spacing: 0.5px;\n        margin-bottom: 8px;\n    }\n\n    .kpi-value {\n        font-size: 32px;\n        font-weight: 900;\n        color: #111827;\n        line-height: 1;\n        margin-bottom: 4px;\n    }\n\n    .kpi-subtitle {\n        font-size: 12px;\n        color: #9ca3af;\n        font-weight: 600;\n    }\n\n    /* ========== INSIGHTS ========== */\n    .insights-section {\n        background: white;\n        padding: 24px 32px;\n        border-radius: 16px;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n        margin-bottom: 24px;\n    }\n\n    .insights-title {\n        font-size: 18px;\n        font-weight: 800;\n        color: #374151;\n        margin-bottom: 16px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n\n    .insights-grid {\n        display: grid;\n        gap: 12px;\n    }\n\n    .insight-card {\n        padding: 16px 20px;\n        border-radius: 12px;\n        border-left: 4px solid;\n        display: flex;\n        align-items: flex-start;\n        gap: 12px;\n    }\n\n    .insight-card.critical {\n        background: #fef2f2;\n        border-color: #ef4444;\n    }\n\n    .insight-card.warning {\n        background: #fffbeb;\n        border-color: #f59e0b;\n    }\n\n    .insight-card.info {\n        background: #eff6ff;\n        border-color: #3b82f6;\n    }\n\n    .insight-card.success {\n        background: #f0fdf4;\n        border-color: #10b981;\n    }\n\n    .insight-icon {\n        font-size: 24px;\n        line-height: 1;\n    }\n\n    .insight-content strong {\n        display: block;\n        font-size: 14px;\n        font-weight: 700;\n        margin-bottom: 4px;\n        color: #111827;\n    }\n\n    .insight-content span {\n        font-size: 13px;\n        color: #6b7280;\n    }\n\n    /* ========== TIMELINE ========== */\n    .timeline-section {\n        background: white;\n        padding: 24px 32px;\n        border-radius: 16px;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n        margin-bottom: 24px;\n    }\n\n    .timeline-title {\n        font-size: 18px;\n        font-weight: 800;\n        color: #374151;\n        margin-bottom: 20px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n\n    .timeline {\n        position: relative;\n        padding-left: 40px;\n    }\n\n    .timeline::before {\n        content: '';\n        position: absolute;\n        left: 12px;\n        top: 0;\n        bottom: 0;\n        width: 3px;\n        background: linear-gradient(180deg, #1890ff, #52c41a);\n    }\n\n    .timeline-item {\n        position: relative;\n        padding-bottom: 24px;\n    }\n\n    .timeline-item::before {\n        content: '';\n        position: absolute;\n        left: -34px;\n        top: 4px;\n        width: 16px;\n        height: 16px;\n        background: white;\n        border: 4px solid #1890ff;\n        border-radius: 50%;\n        z-index: 2;\n    }\n\n    .timeline-item.completed::before {\n        border-color: #52c41a;\n        background: #52c41a;\n    }\n\n    .timeline-content {\n        background: #f9fafb;\n        padding: 16px 20px;\n        border-radius: 12px;\n        border: 1px solid #e5e7eb;\n    }\n\n    .timeline-time {\n        font-size: 12px;\n        font-weight: 700;\n        color: #1890ff;\n        margin-bottom: 6px;\n    }\n\n    .timeline-text {\n        font-size: 14px;\n        font-weight: 600;\n        color: #374151;\n    }\n\n    /* ========== DELIVERIES TABLE ========== */\n    .deliveries-section {\n        background: white;\n        padding: 24px 32px;\n        border-radius: 16px;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n        margin-bottom: 24px;\n    }\n\n    .deliveries-title {\n        font-size: 18px;\n        font-weight: 800;\n        color: #374151;\n        margin-bottom: 20px;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n    }\n\n    table {\n        width: 100%;\n        border-collapse: collapse;\n        font-size: 13px;\n    }\n\n    thead {\n        background: linear-gradient(135deg, #1890ff 0%, #0050b3 100%);\n    }\n\n    th {\n        padding: 14px 16px;\n        text-align: left;\n        font-weight: 700;\n        font-size: 11px;\n        color: white;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n\n    tbody tr {\n        border-bottom: 1px solid #f3f4f6;\n        transition: all 0.2s;\n    }\n\n    tbody tr:hover {\n        background: #f9fafb;\n    }\n\n    td {\n        padding: 14px 16px;\n        color: #374151;\n    }\n\n    .td-strong {\n        font-weight: 700;\n        color: #111827;\n    }\n\n    .td-muted {\n        color: #9ca3af;\n        font-size: 12px;\n    }\n\n    .badge {\n        display: inline-block;\n        padding: 4px 10px;\n        border-radius: 999px;\n        font-size: 10px;\n        font-weight: 700;\n        letter-spacing: 0.3px;\n        text-transform: uppercase;\n    }\n\n    .badge-success {\n        background: #d1fae5;\n        color: #065f46;\n        border: 1px solid #a7f3d0;\n    }\n\n    .badge-warning {\n        background: #fef3c7;\n        color: #92400e;\n        border: 1px solid #fde68a;\n    }\n\n    .badge-danger {\n        background: #fee2e2;\n        color: #991b1b;\n        border: 1px solid #fecaca;\n    }\n\n    /* ========== EMPTY STATE ========== */\n    .empty-state {\n        text-align: center;\n        padding: 80px 20px;\n        color: #9ca3af;\n    }\n\n    .empty-icon {\n        font-size: 64px;\n        margin-bottom: 16px;\n    }\n\n    .empty-title {\n        font-size: 24px;\n        font-weight: 700;\n        color: #6b7280;\n        margin-bottom: 8px;\n    }\n\n    .empty-text {\n        font-size: 14px;\n        color: #9ca3af;\n    }\n\n    /* ========== RESPONSIVE ========== */\n    @media (max-width: 768px) {\n        .search-box {\n            flex-direction: column;\n        }\n\n        .kpi-grid {\n            grid-template-columns: 1fr 1fr;\n        }\n\n        .route-header {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 12px;\n        }\n\n        table {\n            font-size: 11px;\n        }\n\n        th, td {\n            padding: 10px 8px;\n        }\n    }\n</style>\n\n<div class=\"search-container\">\n    <!-- HEADER & SEARCH -->\n    <div class=\"search-header\">\n        <h1>üîç Pesquisa Detalhada de Rota</h1>\n        \n        <div class=\"search-box\">\n            <input \n                type=\"number\" \n                id=\"searchInput\" \n                class=\"search-input\" \n                placeholder=\"Digite o ID da Sa√≠da (SAIDAID)...\"\n                onkeypress=\"if(event.key === 'Enter') searchRoute()\"\n            >\n            <button class=\"search-btn\" onclick=\"searchRoute()\">\n                üîç Buscar Rota\n            </button>\n            <button class=\"search-btn\" onclick=\"showAllSaidas()\" style=\"background: #52c41a;\">\n                üìã Ver Todas\n            </button>\n        </div>\n\n        <div class=\"search-suggestions\" id=\"suggestions\">\n            <!-- Preenchido dinamicamente -->\n        </div>\n        \n        <div id=\"dataStatus\" style=\"margin-top: 12px; font-size: 13px; color: #6b7280; font-weight: 600;\">\n            Carregando dados...\n        </div>\n    </div>\n\n    <!-- EMPTY STATE (inicial) -->\n    <div id=\"emptyState\" class=\"search-header\">\n        <div class=\"empty-state\">\n            <div class=\"empty-icon\">üì¶</div>\n            <div class=\"empty-title\">Digite um ID de Sa√≠da para come√ßar</div>\n            <div class=\"empty-text\">Voc√™ pode pesquisar qualquer SAIDAID dispon√≠vel no sistema</div>\n        </div>\n    </div>\n\n    <!-- RESULTS SECTION -->\n    <div id=\"resultsSection\" class=\"results-section\">\n        <!-- Preenchido dinamicamente via JavaScript -->\n    </div>\n</div>\n\n<script>\n    // ========================================\n    // DADOS GLOBAIS\n    // ========================================\n    let allData = {\n        pedidos: [],\n        calculo: [],\n        rotas: [],\n        allSaidas: []\n    };\n\n    // ========================================\n    // INICIALIZAR\n    // ========================================\n    function initSearch() {\n        console.log('üîç Inicializando pesquisa de rotas...');\n        loadSuggestions();\n    }\n\n    // ========================================\n    // CARREGAR SUGEST√ïES\n    // ========================================\n    function loadSuggestions() {\n        const pedidos = allData.pedidos;\n        const todasSaidas = [...new Set(pedidos.map(p => p.SAIDAID))].filter(s => s).sort((a,b) => b-a);\n        const saidas = todasSaidas.slice(0, 10);\n        allData.allSaidas = todasSaidas;\n\n        console.log('üìä Total de SAIDAIDs √∫nicas:', todasSaidas.length);\n        console.log('üìã SAIDAIDs dispon√≠veis:', todasSaidas.slice(0, 20));\n\n        const container = document.getElementById('suggestions');\n        const statusDiv = document.getElementById('dataStatus');\n\n        if (pedidos.length === 0) {\n            statusDiv.innerHTML = '‚ö†Ô∏è Aguardando dados do Appsmith...';\n            statusDiv.style.color = '#f59e0b';\n            container.innerHTML = '';\n            return;\n        }\n\n        statusDiv.innerHTML = `‚úÖ ${pedidos.length} pedidos carregados | ${todasSaidas.length} rotas dispon√≠veis`;\n        statusDiv.style.color = '#10b981';\n\n        if (saidas.length > 0) {\n            container.innerHTML = `\n                <span style=\"font-size: 12px; color: #6b7280; font-weight: 600;\">Sa√≠das recentes (${todasSaidas.length} dispon√≠veis):</span>\n                ${saidas.map(s => `\n                    <span class=\"suggestion-chip\" onclick=\"quickSearch(${s})\">${s}</span>\n                `).join('')}\n            `;\n        }\n    }\n\n    // ========================================\n    // MOSTRAR TODAS AS SAIDAS\n    // ========================================\n    function showAllSaidas() {\n        const saidas = allData.allSaidas;\n        \n        if (saidas.length === 0) {\n            alert('Nenhuma SAIDAID dispon√≠vel. Aguarde o carregamento dos dados.');\n            return;\n        }\n\n        const totalSaidas = saidas.length;\n        const saidasPorPagina = 50;\n        const primeiras = saidas.slice(0, saidasPorPagina);\n        \n        let mensagem = `üìã Total de ${totalSaidas} SAIDAIDs dispon√≠veis\\n\\n`;\n        mensagem += `Primeiras ${Math.min(saidasPorPagina, totalSaidas)} SAIDAIDs:\\n\\n`;\n        mensagem += primeiras.join(', ');\n        \n        if (totalSaidas > saidasPorPagina) {\n            mensagem += `\\n\\n... e mais ${totalSaidas - saidasPorPagina} rotas`;\n        }\n        \n        mensagem += '\\n\\nClique em qualquer chip abaixo para buscar r√°pido!';\n        \n        alert(mensagem);\n        \n        // Log completo no console\n        console.log('üìã TODAS AS SAIDAIDs DISPON√çVEIS:', saidas);\n    }\n\n    // ========================================\n    // BUSCA R√ÅPIDA\n    // ========================================\n    function quickSearch(saidaId) {\n        document.getElementById('searchInput').value = saidaId;\n        searchRoute();\n    }\n\n    // ========================================\n    // BUSCAR ROTA\n    // ========================================\n    function searchRoute() {\n        const inputValue = document.getElementById('searchInput').value;\n        \n        if (!inputValue) {\n            alert('Por favor, digite um ID de Sa√≠da v√°lido!');\n            return;\n        }\n\n        const saidaId = parseInt(inputValue);\n        \n        console.log('üîç Buscando SAIDAID:', saidaId);\n        console.log('üì¶ Total de pedidos dispon√≠veis:', allData.pedidos.length);\n        \n        // DEBUG: Ver alguns SAIDAIDs dispon√≠veis\n        const saidasDisponiveis = [...new Set(allData.pedidos.map(p => p.SAIDAID))].filter(s => s).slice(0, 10);\n        console.log('üìã Algumas SAIDAIDs dispon√≠veis:', saidasDisponiveis);\n\n        // Filtrar pedidos da rota (com convers√£o de tipos)\n        const pedidosDaRota = allData.pedidos.filter(p => {\n            // Tentar comparar como n√∫mero E como string\n            return p.SAIDAID == saidaId || \n                   parseInt(p.SAIDAID) === saidaId || \n                   String(p.SAIDAID) === String(saidaId);\n        });\n\n        console.log('‚úÖ Pedidos encontrados:', pedidosDaRota.length);\n\n        if (pedidosDaRota.length === 0) {\n            alert(`‚ùå Nenhuma rota encontrada com SAIDAID ${saidaId}\\n\\n` +\n                  `Total de pedidos no sistema: ${allData.pedidos.length}\\n` +\n                  `SAIDAIDs dispon√≠veis: ${saidasDisponiveis.join(', ')}...\\n\\n` +\n                  `Abra o Console (F12) para mais detalhes.`);\n            return;\n        }\n\n        // Processar e exibir\n        processRoute(saidaId, pedidosDaRota);\n    }\n\n    // ========================================\n    // PROCESSAR ROTA\n    // ========================================\n    function processRoute(saidaId, pedidos) {\n        const calc = allData.calculo;\n        const rotas = allData.rotas;\n\n        // Dados b√°sicos\n        const motoboy = pedidos[0].MOTOBOY || 'N√ÉO DEFINIDO';\n        const filial = pedidos[0].CIDADEFILIAL || 'N√ÉO DEFINIDO';\n        const clientesUnicos = new Set(pedidos.map(p => p.COD_CLI).filter(c => c)).size;\n\n        // Rota otimizada\n        const rotaOtimizada = rotas.filter(r => r.saida_numero === saidaId)\n            .sort((a, b) => a.num_ordem - b.num_ordem);\n\n        // Tempo previsto\n        let tempoPrevisto = 0;\n        pedidos.forEach(item => {\n            const log = calc.find(l => l.PEDIDO === item.PEDIDO || l.SAIDAID === parseInt(item.SAIDAID));\n            if (log) {\n                tempoPrevisto += (parseInt(log.TEMPO) || 0) * 60;\n            }\n        });\n\n        // KM Total\n        const kmTotal = pedidos.reduce((sum, item) => {\n            const log = calc.find(l => l.PEDIDO === item.PEDIDO || l.SAIDAID === parseInt(item.SAIDAID));\n            return sum + (parseFloat(log?.KM || 0));\n        }, 0);\n\n        // Tempos reais\n        const datasInicio = pedidos\n            .map(p => p.INICIO_ROTA)\n            .filter(d => d && d !== 'null')\n            .map(d => new Date(d));\n        \n        const datasEntrega = pedidos\n            .map(p => p.ENTREGA_CLIENTE)\n            .filter(d => d && d !== 'null')\n            .map(d => new Date(d));\n\n        const datasFim = pedidos\n            .map(p => p.FIM_ROTA)\n            .filter(d => d && d !== 'null')\n            .map(d => new Date(d));\n\n        let inicioRota = null;\n        let fimRota = null;\n        let tempoReal = 0;\n        let tempoRetorno = 0;\n\n        if (datasInicio.length > 0) {\n            inicioRota = new Date(Math.min(...datasInicio));\n        }\n\n        if (datasEntrega.length > 0 && datasInicio.length > 0) {\n            const ultimaEntrega = new Date(Math.max(...datasEntrega));\n            tempoReal = Math.floor((ultimaEntrega - inicioRota) / 1000);\n            const descontoClientes = clientesUnicos * 300;\n            tempoReal = Math.max(0, tempoReal - descontoClientes);\n        }\n\n        if (datasFim.length > 0 && datasEntrega.length > 0) {\n            fimRota = new Date(Math.max(...datasFim));\n            const ultimaEntrega = new Date(Math.max(...datasEntrega));\n            tempoRetorno = Math.floor((fimRota - ultimaEntrega) / 1000);\n        }\n\n        // Status da rota\n        const entregues = pedidos.filter(p => p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null').length;\n        const ratio = tempoPrevisto > 0 && tempoReal > 0 ? tempoReal / tempoPrevisto : null;\n        \n        let statusClass = 'warning';\n        let statusText = 'üöö EM ANDAMENTO';\n        let statusPerformance = 'info';\n\n        if (entregues === pedidos.length && fimRota) {\n            statusClass = 'success';\n            statusText = '‚úÖ CONCLU√çDA';\n        } else if (entregues === 0) {\n            statusClass = 'danger';\n            statusText = '‚è≥ PENDENTE';\n        }\n\n        if (ratio !== null) {\n            if (ratio <= 1.05) {\n                statusPerformance = 'success';\n            } else if (ratio <= 1.5) {\n                statusPerformance = 'warning';\n            } else {\n                statusPerformance = 'critical';\n            }\n        }\n\n        // Renderizar\n        renderResults({\n            saidaId,\n            motoboy,\n            filial,\n            pedidos,\n            entregues,\n            clientesUnicos,\n            kmTotal,\n            tempoPrevisto,\n            tempoReal,\n            tempoRetorno,\n            ratio,\n            statusClass,\n            statusText,\n            statusPerformance,\n            inicioRota,\n            fimRota,\n            rotaOtimizada\n        });\n    }\n\n    // ========================================\n    // RENDERIZAR RESULTADOS\n    // ========================================\n    function renderResults(data) {\n        document.getElementById('emptyState').style.display = 'none';\n        const section = document.getElementById('resultsSection');\n        section.classList.add('active');\n\n        // Insights\n        const insights = generateInsights(data);\n\n        // Timeline\n        const timeline = generateTimeline(data);\n\n        // HTML\n        let html = `\n            <!-- ROUTE SUMMARY -->\n            <div class=\"route-summary\">\n                <div class=\"route-header\">\n                    <div>\n                        <div class=\"route-id\">Rota #${data.saidaId}</div>\n                        <div style=\"font-size: 14px; color: #6b7280; margin-top: 4px;\">\n                            <strong>${data.motoboy}</strong> ‚Ä¢ ${data.filial}\n                        </div>\n                    </div>\n                    <div class=\"route-status ${data.statusClass}\">\n                        ${data.statusText}\n                    </div>\n                </div>\n\n                <!-- KPIs -->\n                <div class=\"kpi-grid\">\n                    <div class=\"kpi-card blue\">\n                        <div class=\"kpi-label\">üì¶ Total Entregas</div>\n                        <div class=\"kpi-value\">${data.pedidos.length}</div>\n                        <div class=\"kpi-subtitle\">${data.entregues} conclu√≠das</div>\n                    </div>\n                    \n                    <div class=\"kpi-card green\">\n                        <div class=\"kpi-label\">üìç Paradas (Clientes)</div>\n                        <div class=\"kpi-value\">${data.clientesUnicos}</div>\n                        <div class=\"kpi-subtitle\">${(data.pedidos.length / data.clientesUnicos).toFixed(1)} entregas/cliente</div>\n                    </div>\n                    \n                    <div class=\"kpi-card cyan\">\n                        <div class=\"kpi-label\">üöó KM Total</div>\n                        <div class=\"kpi-value\">${data.kmTotal.toFixed(1)}</div>\n                        <div class=\"kpi-subtitle\">${(data.kmTotal / data.pedidos.length).toFixed(2)} km/entrega</div>\n                    </div>\n                    \n                    <div class=\"kpi-card orange\">\n                        <div class=\"kpi-label\">‚è±Ô∏è Tempo Previsto</div>\n                        <div class=\"kpi-value\">${Math.floor(data.tempoPrevisto / 60)}</div>\n                        <div class=\"kpi-subtitle\">minutos</div>\n                    </div>\n                    \n                    <div class=\"kpi-card purple\">\n                        <div class=\"kpi-label\">‚è∞ Tempo Real (TTE)</div>\n                        <div class=\"kpi-value\">${Math.floor(data.tempoReal / 60)}</div>\n                        <div class=\"kpi-subtitle\">minutos executados</div>\n                    </div>\n                    \n                    <div class=\"kpi-card ${data.statusPerformance === 'success' ? 'green' : data.statusPerformance === 'critical' ? 'red' : 'orange'}\">\n                        <div class=\"kpi-label\">üìä Performance</div>\n                        <div class=\"kpi-value\">${data.ratio !== null ? (data.ratio * 100).toFixed(0) + '%' : '-'}</div>\n                        <div class=\"kpi-subtitle\">\n                            ${data.ratio !== null ? (data.ratio <= 1.05 ? '‚úÖ Dentro do prazo' : '‚ö†Ô∏è Fora do prazo') : 'Sem dados'}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- INSIGHTS -->\n            <div class=\"insights-section\">\n                <div class=\"insights-title\">üí° Insights da Rota</div>\n                <div class=\"insights-grid\">\n                    ${insights.map(i => `\n                        <div class=\"insight-card ${i.type}\">\n                            <div class=\"insight-icon\">${i.icon}</div>\n                            <div class=\"insight-content\">\n                                <strong>${i.title}</strong>\n                                <span>${i.desc}</span>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n\n            <!-- TIMELINE -->\n            <div class=\"timeline-section\">\n                <div class=\"timeline-title\">üìÖ Timeline da Rota</div>\n                <div class=\"timeline\">\n                    ${timeline}\n                </div>\n            </div>\n\n            <!-- DELIVERIES TABLE -->\n            <div class=\"deliveries-section\">\n                <div class=\"deliveries-title\">\n                    <span>üìã Todas as Entregas (${data.pedidos.length})</span>\n                    <span style=\"font-size: 12px; color: #9ca3af; font-weight: 600;\">\n                        ${data.entregues}/${data.pedidos.length} conclu√≠das\n                    </span>\n                </div>\n                <table>\n                    <thead>\n                        <tr>\n                            <th>#</th>\n                            <th>Pedido</th>\n                            <th>Cliente</th>\n                            <th>Cidade</th>\n                            <th>Endere√ßo</th>\n                            <th>In√≠cio</th>\n                            <th>Entrega</th>\n                            <th>Dura√ß√£o</th>\n                            <th>Status</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${data.pedidos.map((p, idx) => {\n                            const inicio = p.INICIO_ROTA ? new Date(p.INICIO_ROTA) : null;\n                            const entrega = p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null' ? new Date(p.ENTREGA_CLIENTE) : null;\n                            const duracao = inicio && entrega ? Math.floor((entrega - inicio) / 60000) : 0;\n                            \n                            let statusBadge = 'badge-danger';\n                            let statusText = '‚è≥ Pendente';\n                            if (entrega) {\n                                statusBadge = 'badge-success';\n                                statusText = '‚úÖ Entregue';\n                            } else if (inicio) {\n                                statusBadge = 'badge-warning';\n                                statusText = 'üöö Em Transporte';\n                            }\n\n                            const formatDate = (d) => {\n                                if (!d) return '-';\n                                try {\n                                    return d.toLocaleString('pt-BR', { \n                                        day: '2-digit', \n                                        month: '2-digit', \n                                        hour: '2-digit', \n                                        minute: '2-digit' \n                                    });\n                                } catch(e) {\n                                    return '-';\n                                }\n                            };\n\n                            return `\n                                <tr>\n                                    <td class=\"td-strong\">${idx + 1}</td>\n                                    <td class=\"td-strong\">${p.PEDIDO}</td>\n                                    <td>${(p.RAZAO_SOCIAL || '').substring(0, 30)}${p.RAZAO_SOCIAL && p.RAZAO_SOCIAL.length > 30 ? '...' : ''}</td>\n                                    <td class=\"td-muted\">${p.CIDADE || '-'}</td>\n                                    <td class=\"td-muted\" style=\"font-size: 11px;\">${(p.ENDERECO || '').substring(0, 40)}${p.ENDERECO && p.ENDERECO.length > 40 ? '...' : ''}</td>\n                                    <td class=\"td-muted\">${formatDate(inicio)}</td>\n                                    <td class=\"td-strong\">${formatDate(entrega)}</td>\n                                    <td>${duracao > 0 ? duracao + ' min' : '-'}</td>\n                                    <td><span class=\"badge ${statusBadge}\">${statusText}</span></td>\n                                </tr>\n                            `;\n                        }).join('')}\n                    </tbody>\n                </table>\n            </div>\n        `;\n\n        section.innerHTML = html;\n        \n        // Scroll para os resultados\n        section.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n\n    // ========================================\n    // GERAR INSIGHTS\n    // ========================================\n    function generateInsights(data) {\n        const insights = [];\n\n        // Taxa de conclus√£o\n        const taxaConclusao = (data.entregues / data.pedidos.length) * 100;\n        if (taxaConclusao === 100) {\n            insights.push({\n                type: 'success',\n                icon: 'üéâ',\n                title: 'Rota 100% conclu√≠da!',\n                desc: `Todas as ${data.pedidos.length} entregas foram realizadas com sucesso.`\n            });\n        } else if (taxaConclusao >= 80) {\n            insights.push({\n                type: 'success',\n                icon: '‚úÖ',\n                title: `${taxaConclusao.toFixed(0)}% das entregas conclu√≠das`,\n                desc: `${data.entregues} de ${data.pedidos.length} entregas realizadas.`\n            });\n        } else if (taxaConclusao > 0) {\n            insights.push({\n                type: 'warning',\n                icon: '‚ö†Ô∏è',\n                title: `Apenas ${taxaConclusao.toFixed(0)}% conclu√≠do`,\n                desc: `${data.pedidos.length - data.entregues} entregas ainda pendentes.`\n            });\n        } else {\n            insights.push({\n                type: 'critical',\n                icon: 'üö®',\n                title: 'Rota n√£o iniciada',\n                desc: 'Nenhuma entrega foi realizada ainda.'\n            });\n        }\n\n        // Performance de tempo\n        if (data.ratio !== null) {\n            if (data.ratio <= 1.05) {\n                insights.push({\n                    type: 'success',\n                    icon: '‚ö°',\n                    title: 'Excelente performance de tempo!',\n                    desc: `Rota executada em ${(data.ratio * 100).toFixed(0)}% do tempo previsto (dentro do limite de 105%).`\n                });\n            } else if (data.ratio <= 1.5) {\n                insights.push({\n                    type: 'warning',\n                    icon: '‚è∞',\n                    title: 'Tempo acima do previsto',\n                    desc: `Rota levou ${(data.ratio * 100).toFixed(0)}% do tempo previsto (${Math.floor((data.tempoReal - data.tempoPrevisto) / 60)} min a mais).`\n                });\n            } else {\n                insights.push({\n                    type: 'critical',\n                    icon: 'üö®',\n                    title: 'Atraso significativo!',\n                    desc: `Rota levou ${(data.ratio * 100).toFixed(0)}% do tempo previsto (${Math.floor((data.tempoReal - data.tempoPrevisto) / 60)} min de atraso).`\n                });\n            }\n        }\n\n        // Efici√™ncia de KM\n        const kmPorEntrega = data.kmTotal / data.pedidos.length;\n        if (kmPorEntrega < 5) {\n            insights.push({\n                type: 'success',\n                icon: 'üéØ',\n                title: 'Rota otimizada!',\n                desc: `M√©dia de apenas ${kmPorEntrega.toFixed(2)} km por entrega indica uma rota bem planejada.`\n            });\n        } else if (kmPorEntrega > 10) {\n            insights.push({\n                type: 'info',\n                icon: 'üìç',\n                title: 'Rota extensa',\n                desc: `M√©dia de ${kmPorEntrega.toFixed(2)} km por entrega. Considere revisar o planejamento.`\n            });\n        }\n\n        // Paradas por cliente\n        const entregasPorCliente = data.pedidos.length / data.clientesUnicos;\n        if (entregasPorCliente > 2) {\n            insights.push({\n                type: 'info',\n                icon: 'üì¶',\n                title: 'M√∫ltiplas entregas por cliente',\n                desc: `M√©dia de ${entregasPorCliente.toFixed(1)} entregas por parada (${data.clientesUnicos} clientes).`\n            });\n        }\n\n        return insights;\n    }\n\n    // ========================================\n    // GERAR TIMELINE\n    // ========================================\n    function generateTimeline(data) {\n        let html = '';\n\n        // In√≠cio da rota\n        if (data.inicioRota) {\n            html += `\n                <div class=\"timeline-item completed\">\n                    <div class=\"timeline-content\">\n                        <div class=\"timeline-time\">${data.inicioRota.toLocaleString('pt-BR', { \n                            day: '2-digit', \n                            month: '2-digit', \n                            year: 'numeric',\n                            hour: '2-digit', \n                            minute: '2-digit' \n                        })}</div>\n                        <div class=\"timeline-text\">üöÄ In√≠cio da Rota - ${data.motoboy} saiu da ${data.filial}</div>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Entregas realizadas\n        const entregasRealizadas = data.pedidos\n            .filter(p => p.ENTREGA_CLIENTE && p.ENTREGA_CLIENTE !== 'null')\n            .sort((a, b) => new Date(a.ENTREGA_CLIENTE) - new Date(b.ENTREGA_CLIENTE));\n\n        entregasRealizadas.forEach(p => {\n            const entrega = new Date(p.ENTREGA_CLIENTE);\n            html += `\n                <div class=\"timeline-item completed\">\n                    <div class=\"timeline-content\">\n                        <div class=\"timeline-time\">${entrega.toLocaleString('pt-BR', { \n                            hour: '2-digit', \n                            minute: '2-digit' \n                        })}</div>\n                        <div class=\"timeline-text\">\n                            ‚úÖ Entrega realizada - Pedido ${p.PEDIDO} \n                            <span style=\"color: #9ca3af;\">(${(p.RAZAO_SOCIAL || '').substring(0, 30)})</span>\n                        </div>\n                    </div>\n                </div>\n            `;\n        });\n\n        // Fim da rota\n        if (data.fimRota) {\n            html += `\n                <div class=\"timeline-item completed\">\n                    <div class=\"timeline-content\">\n                        <div class=\"timeline-time\">${data.fimRota.toLocaleString('pt-BR', { \n                            hour: '2-digit', \n                            minute: '2-digit' \n                        })}</div>\n                        <div class=\"timeline-text\">\n                            üèÅ Fim da Rota - Retorno √† ${data.filial}\n                            ${data.tempoRetorno > 0 ? `<span style=\"color: #9ca3af;\">(${Math.floor(data.tempoRetorno / 60)} min)</span>` : ''}\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n\n        return html || '<p style=\"color: #9ca3af; text-align: center;\">Nenhum evento registrado ainda</p>';\n    }\n\n    // ========================================\n    // INICIALIZAR AP√ìS DADOS CARREGADOS\n    // ========================================\n    window.addEventListener('DOMContentLoaded', function() {\n        console.log('üöÄ DOM carregado, aguardando dados do Appsmith...');\n        // Tentar inicializar ap√≥s um pequeno delay\n        setTimeout(() => {\n            if (allData.pedidos.length > 0) {\n                initSearch();\n            } else {\n                console.log('‚è≥ Dados ainda n√£o carregados, tentando novamente...');\n                setTimeout(() => {\n                    initSearch();\n                }, 500);\n            }\n        }, 200);\n    });\n</script>\n\n<!-- Injetar dados do Appsmith -->\n<script>\n    {{\n        (() => {\n            const pedidos = pedidos_e_saidas_do_dia?.data || [];\n            const calculo = calculo_do_google?.data || { logistica_motoboy: [] };\n            const rotas = dmaplicativo_prod_rotas_otimiz?.data || [];\n            \n            return `\n                console.log('üì¶ Carregando dados do Appsmith para pesquisa...');\n                console.log('üìä Pedidos recebidos:', ${pedidos.length});\n                console.log('üìä C√°lculos recebidos:', ${(calculo.logistica_motoboy || []).length});\n                console.log('üìä Rotas recebidas:', ${rotas.length});\n                \n                allData.pedidos = ${JSON.stringify(pedidos)};\n                allData.calculo = ${JSON.stringify(calculo.logistica_motoboy || [])};\n                allData.rotas = ${JSON.stringify(rotas)};\n                \n                console.log('‚úÖ Dados injetados nas vari√°veis globais!');\n                console.log('üîç allData.pedidos.length:', allData.pedidos.length);\n                \n                // Inicializar ap√≥s inje√ß√£o\n                setTimeout(() => {\n                    if (typeof initSearch === 'function') {\n                        console.log('üöÄ Inicializando pesquisa...');\n                        initSearch();\n                    } else {\n                        console.error('‚ùå Fun√ß√£o initSearch n√£o encontrada!');\n                    }\n                }, 150);\n            `;\n        })()\n    }}\n</script>\n\n",
  "topRow": 0,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "v1zf0xf7d8",
  "widgetName": "Iframe4"
}