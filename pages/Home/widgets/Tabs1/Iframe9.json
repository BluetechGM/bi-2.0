{
  "animateLoading": true,
  "borderOpacity": 100,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": 1,
  "bottomRow": 184,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "kqgs1ft9wu",
  "leftColumn": 0,
  "mobileBottomRow": 36,
  "mobileLeftColumn": 0,
  "mobileRightColumn": 19,
  "mobileTopRow": 4,
  "needsErrorInfo": false,
  "originalBottomRow": 160,
  "originalTopRow": 28,
  "parentColumnSpace": 27.359375,
  "parentId": "y289dus7cv",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "https://www.example.com",
  "srcDoc": "<style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    body {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;\n        background: #f5f7fa;\n        padding: 12px;\n        font-size: 11px;\n    }\n    \n    .painel-container {\n        max-width: 1600px;\n        margin: 0 auto;\n    }\n    \n    .painel-header {\n        background: white;\n        border-radius: 16px;\n        padding: 24px;\n        margin-bottom: 24px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    \n    .painel-title {\n        font-size: 32px;\n        font-weight: 900;\n        color: #1890ff;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n    }\n    \n    .live-indicator {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        color: #10b981;\n    }\n    \n    .live-dot {\n        width: 12px;\n        height: 12px;\n        background: #10b981;\n        border-radius: 50%;\n        animation: pulse 2s infinite;\n    }\n    \n    @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n    }\n    \n    .stats-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 16px;\n        margin-bottom: 24px;\n    }\n    \n    .stat-card {\n        background: white;\n        border-radius: 12px;\n        padding: 20px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        text-align: center;\n        transition: transform 0.2s;\n    }\n    \n    .stat-card:hover {\n        transform: translateY(-4px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.15);\n    }\n    \n    .stat-value {\n        font-size: 36px;\n        font-weight: 900;\n        color: #1890ff;\n        line-height: 1;\n        margin-bottom: 8px;\n    }\n    \n    .stat-label {\n        font-size: 12px;\n        font-weight: 600;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .rotas-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));\n        gap: 20px;\n    }\n    \n    .rota-card {\n        background: white;\n        border-radius: 16px;\n        padding: 20px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        transition: all 0.3s;\n        border-left: 6px solid #1890ff;\n        position: relative;\n        overflow: hidden;\n    }\n    \n    .rota-card.pendente {\n        border-left-color: #fbbf24;\n        background: linear-gradient(135deg, #fffbeb 0%, white 100%);\n    }\n    \n    .rota-card.em-rota {\n        border-left-color: #10b981;\n        background: linear-gradient(135deg, #ecfdf5 0%, white 100%);\n    }\n    \n    .rota-card.atrasada {\n        border-left-color: #ef4444;\n        background: linear-gradient(135deg, #fef2f2 0%, white 100%);\n        animation: shake 0.5s infinite;\n    }\n    \n    @keyframes shake {\n        0%, 100% { transform: translateX(0); }\n        25% { transform: translateX(-5px); }\n        75% { transform: translateX(5px); }\n    }\n    \n    .rota-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 16px;\n        padding-bottom: 12px;\n        border-bottom: 2px solid #f3f4f6;\n    }\n    \n    .rota-id {\n        font-size: 20px;\n        font-weight: 900;\n        color: #1f2937;\n    }\n    \n    .rota-status {\n        padding: 6px 12px;\n        border-radius: 999px;\n        font-size: 11px;\n        font-weight: 800;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .rota-status.pendente {\n        background: #fef3c7;\n        color: #92400e;\n    }\n    \n    .rota-status.em-rota {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .rota-status.atrasada {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    .cronometro {\n        text-align: center;\n        padding: 20px;\n        background: #1890ff;\n        border-radius: 12px;\n        margin-bottom: 16px;\n    }\n    \n    .cronometro-tempo {\n        font-size: 48px;\n        font-weight: 900;\n        color: white;\n        font-family: 'Courier New', monospace;\n        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n    }\n    \n    .cronometro-label {\n        font-size: 11px;\n        color: rgba(255,255,255,0.8);\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        margin-top: 4px;\n    }\n    \n    .rota-info {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 12px;\n        margin-bottom: 16px;\n    }\n    \n    .info-item {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .info-label {\n        font-size: 10px;\n        font-weight: 700;\n        color: #9ca3af;\n        text-transform: uppercase;\n    }\n    \n    .info-value {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1f2937;\n    }\n    \n    .pedidos-list {\n        margin-top: 12px;\n        padding-top: 12px;\n        border-top: 2px solid #f3f4f6;\n    }\n    \n    .pedidos-header {\n        font-size: 11px;\n        font-weight: 700;\n        color: #6b7280;\n        text-transform: uppercase;\n        margin-bottom: 8px;\n    }\n    \n    .pedido-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 8px;\n        background: #f9fafb;\n        border-radius: 6px;\n        margin-bottom: 6px;\n        font-size: 12px;\n    }\n    \n    .pedido-numero {\n        font-weight: 700;\n        color: #667eea;\n    }\n    \n    .pedido-status {\n        font-size: 10px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-weight: 700;\n    }\n    \n    .pedido-status.ok {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .pedido-status.fora-ordem {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    .alerta-pedidos {\n        background: #fef3c7;\n        border: 2px solid #f59e0b;\n        border-radius: 8px;\n        padding: 12px;\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: #92400e;\n        font-weight: 600;\n    }\n    \n    .sem-rotas {\n        text-align: center;\n        padding: 60px;\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n    }\n    \n    .sem-rotas-icon {\n        font-size: 80px;\n        margin-bottom: 20px;\n    }\n    \n    .sem-rotas-text {\n        font-size: 24px;\n        font-weight: 700;\n        color: #6b7280;\n    }\n    \n    .controles {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n    }\n    \n    .btn-controle {\n        padding: 10px 20px;\n        border: none;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .btn-atualizar {\n        background: #1890ff;\n        color: white;\n    }\n\n    .btn-atualizar:hover {\n        background: #1066cc;\n        transform: translateY(-2px);\n    }\n    \n    .btn-som {\n        background: #10b981;\n        color: white;\n    }\n    \n    .btn-som:hover {\n        background: #059669;\n    }\n    \n    .btn-som.muted {\n        background: #ef4444;\n    }\n    \n    .btn-log {\n        background: #6b7280;\n        color: white;\n        padding: 8px 16px;\n        border: none;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .btn-log:hover {\n        background: #4b5563;\n        transform: translateY(-2px);\n    }\n    \n    /* Modal */\n    .modal {\n        display: none;\n        position: fixed;\n        z-index: 1000;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0,0,0,0.5);\n    }\n    \n    .modal-content {\n        background-color: #1f2937;\n        color: #f9fafb;\n        margin: 5% auto;\n        padding: 20px;\n        border-radius: 8px;\n        width: 90%;\n        max-width: 800px;\n        max-height: 80%;\n        overflow-y: auto;\n        font-family: 'Courier New', monospace;\n        font-size: 12px;\n        line-height: 1.4;\n    }\n    \n    .modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n        border-bottom: 1px solid #374151;\n        padding-bottom: 10px;\n    }\n    \n    .modal-title {\n        color: #10b981;\n        font-size: 18px;\n        font-weight: 700;\n    }\n    \n    .close {\n        color: #9ca3af;\n        font-size: 24px;\n        font-weight: bold;\n        cursor: pointer;\n        background: none;\n        border: none;\n    }\n    \n    .close:hover {\n        color: #f87171;\n    }\n    \n    .log-entry {\n        margin-bottom: 5px;\n        padding: 5px;\n        border-left: 3px solid #374151;\n        padding-left: 10px;\n    }\n    \n    .log-entry.info {\n        border-left-color: #3b82f6;\n        color: #93c5fd;\n    }\n    \n    .log-entry.success {\n        border-left-color: #10b981;\n        color: #6ee7b7;\n    }\n    \n    .log-entry.warning {\n        border-left-color: #f59e0b;\n        color: #fbbf24;\n    }\n    \n    .log-entry.error {\n        border-left-color: #ef4444;\n        color: #fca5a5;\n    }\n    \n    /* Filters */\n    .filters-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n        gap: 10px;\n        margin-bottom: 16px;\n        padding: 16px;\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        border-bottom: 2px solid #e5e7eb;\n    }\n    \n    .filter-group {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .filter-label {\n        font-size: 9px;\n        font-weight: 700;\n        color: #6b7280;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n    \n    .filter-select {\n        padding: 6px 10px;\n        background: #f9fafb;\n        border: 1px solid #e5e7eb;\n        border-radius: 6px;\n        font-size: 11px;\n        color: #111827;\n        font-weight: 600;\n    }\n    \n    /* View modes */\n    .view-controls {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n        margin-bottom: 16px;\n    }\n    \n    .btn-modo {\n        padding: 8px 16px;\n        border: 2px solid #1890ff;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 700;\n        cursor: pointer;\n        transition: all 0.2s;\n        background: white;\n        color: #1890ff;\n    }\n    \n    .btn-modo.ativo {\n        background: #1890ff;\n        color: white;\n    }\n    \n    .btn-modo:hover {\n        background: #e6f3ff;\n    }\n    \n    .btn-modo.ativo:hover {\n        background: #1066cc;\n    }\n    \n    /* Lista mode */\n    .rotas-lista {\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        overflow: hidden;\n    }\n    \n    .lista-header {\n        background: #1890ff;\n        color: white;\n        padding: 12px 16px;\n        font-size: 12px;\n        font-weight: 700;\n        display: grid;\n        grid-template-columns: 100px 150px 140px 80px 80px 80px 120px 100px;\n        gap: 8px;\n        border-bottom: 2px solid #1066cc;\n    }\n    \n    .lista-item {\n        display: grid;\n        grid-template-columns: 100px 150px 140px 80px 80px 80px 120px 100px;\n        gap: 8px;\n        padding: 12px 16px;\n        border-bottom: 1px solid #f3f4f6;\n        align-items: center;\n        font-size: 11px;\n        transition: background 0.2s;\n    }\n    \n    .lista-item:hover {\n        background: #f9fafb;\n    }\n    \n    .lista-item.pendente {\n        border-left: 4px solid #fbbf24;\n    }\n    \n    .lista-item.em-rota {\n        border-left: 4px solid #10b981;\n    }\n    \n    .lista-item.atrasada {\n        border-left: 4px solid #ef4444;\n        background: #fef2f2;\n    }\n    \n    .lista-cronometro {\n        font-family: 'Courier New', monospace;\n        font-weight: 700;\n        font-size: 14px;\n    }\n    \n    .lista-status {\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 9px;\n        font-weight: 700;\n        text-align: center;\n    }\n    \n    .lista-status.pendente {\n        background: #fef3c7;\n        color: #92400e;\n    }\n    \n    .lista-status.em-rota {\n        background: #d1fae5;\n        color: #065f46;\n    }\n    \n    .lista-status.atrasada {\n        background: #fee2e2;\n        color: #991b1b;\n    }\n    \n    /* Bot√£o Ver Rota */\n    .btn-ver-rota {\n        display: inline-block;\n        padding: 6px 12px;\n        background: #10b981;\n        color: white !important;\n        text-decoration: none !important;\n        border-radius: 6px;\n        font-size: 11px;\n        font-weight: 600;\n        transition: all 0.2s;\n        border: none;\n        cursor: pointer;\n    }\n    \n    .btn-ver-rota:hover {\n        background: #059669 !important;\n        color: white !important;\n        text-decoration: none !important;\n        transform: translateY(-2px);\n        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);\n    }\n    \n    .btn-ver-rota:visited {\n        color: white !important;\n        text-decoration: none !important;\n    }\n    \n    .filial-badge {\n        background: #1890ff;\n        color: white;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 10px;\n        font-weight: 700;\n        margin-right: 8px;\n    }\n    \n    /* Estat√≠sticas por Filial */\n    .stats-filial {\n        background: white;\n        border-radius: 8px;\n        padding: 16px;\n        margin-bottom: 16px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n    \n    .stats-filial-title {\n        font-size: 16px;\n        font-weight: 700;\n        color: #1890ff;\n        margin-bottom: 12px;\n        border-bottom: 2px solid #1890ff;\n        padding-bottom: 8px;\n    }\n    \n    .filial-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        gap: 12px;\n    }\n    \n    @media (max-width: 768px) {\n        .filial-row {\n            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n            gap: 8px;\n        }\n        \n        .filial-item {\n            padding: 8px;\n        }\n        \n        .filial-nome {\n            font-size: 16px;\n        }\n        \n        .filial-stat-valor {\n            font-size: 18px;\n        }\n    }\n    \n    .filial-item {\n        border: 1px solid #e5e7eb;\n        border-radius: 6px;\n        padding: 12px;\n        transition: transform 0.2s;\n    }\n    \n    .filial-item:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(24, 144, 255, 0.2);\n        border-color: #1890ff;\n    }\n    \n    .filial-nome {\n        font-size: 18px;\n        font-weight: 900;\n        color: #1890ff;\n        margin-bottom: 8px;\n        text-align: center;\n    }\n    \n    .filial-stats {\n        display: flex;\n        justify-content: space-around;\n        gap: 8px;\n    }\n    \n    .filial-stat {\n        text-align: center;\n        flex: 1;\n    }\n    \n    .filial-stat-valor {\n        font-size: 20px;\n        font-weight: 800;\n        margin-bottom: 4px;\n    }\n    \n    .filial-stat-label {\n        font-size: 10px;\n        font-weight: 600;\n        text-transform: uppercase;\n    }\n    \n    .filial-stat.ativo .filial-stat-valor {\n        color: #10b981;\n    }\n    \n    .filial-stat.pendente .filial-stat-valor {\n        color: #f59e0b;\n    }\n    \n    .filial-stat.atrasada .filial-stat-valor {\n        color: #ef4444;\n    }\n    \n    /* Modal Maps */\n    .modal-maps {\n        position: fixed;\n        z-index: 1001;\n        left: 0;\n        top: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0,0,0,0.8);\n        display: none;\n    }\n    \n    .modal-maps-content {\n        background-color: white;\n        margin: 2% auto;\n        padding: 20px;\n        border-radius: 12px;\n        width: 90%;\n        max-width: 800px;\n        max-height: 90%;\n        overflow-y: auto;\n    }\n    \n    .modal-maps-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n        border-bottom: 2px solid #1890ff;\n        padding-bottom: 10px;\n    }\n    \n    .modal-maps-title {\n        color: #1890ff;\n        font-size: 18px;\n        font-weight: 700;\n    }\n    \n    .url-display {\n        background: #f9fafb;\n        border: 2px solid #e5e7eb;\n        border-radius: 8px;\n        padding: 12px;\n        font-family: monospace;\n        font-size: 12px;\n        word-break: break-all;\n        margin-bottom: 16px;\n        color: #374151;\n        cursor: pointer;\n        transition: all 0.2s;\n    }\n    \n    .url-display:hover {\n        background: #e5e7eb;\n        border-color: #1890ff;\n    }\n    \n    /* Anima√ß√µes para mensagens */\n    @keyframes slideIn {\n        from { transform: translateX(100%); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n    }\n    \n    @keyframes slideOut {\n        from { transform: translateX(0); opacity: 1; }\n        to { transform: translateX(100%); opacity: 0; }\n    }\n</style>\n\n<div class=\"painel-container\">\n    <!-- Header -->\n    <div class=\"painel-header\">\n        <div class=\"painel-title\">\n            üöö Painel de Monitoramento - Rotas em Tempo Real\n        </div>\n        <div style=\"display: flex; gap: 24px; align-items: center;\">\n            <div class=\"live-indicator\">\n                <div class=\"live-dot\"></div>\n                AO VIVO\n            </div>\n            <div class=\"controles\">\n                <button class=\"btn-controle btn-atualizar\" onclick=\"atualizarManual()\">\n                    üîÑ Atualizar\n                </button>\n                <button class=\"btn-controle btn-som\" id=\"btnSom\" onclick=\"toggleSom()\">\n                    üîî Som: ON\n                </button>\n                <div id=\"indicadorSons\" style=\"font-size: 10px; color: #6b7280; text-align: center; margin-left: 12px; min-width: 120px; padding: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; border: 1px solid rgba(255,255,255,0.2);\">\n                    <!-- Status dos sons ser√° inserido aqui -->\n                </div>\n                <button class=\"btn-controle btn-log\" onclick=\"abrirModalLogs()\">\n                    üìã LOGS\n                </button>\n                <button class=\"btn-controle\" onclick=\"testarURLs()\" style=\"background: #8b5cf6; color: white;\">\n                    üß™ Testar URLs\n                </button>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Filtros Internos -->\n    <div class=\"filters-row\">\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üìç Filial</div>\n            <select class=\"filter-select\" id=\"filterFilial\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todas</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üìä Status</div>\n            <select class=\"filter-select\" id=\"filterStatus\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n                <option value=\"pendente\">‚è≥ Pendentes</option>\n                <option value=\"em-rota\">üöö Em Rota</option>\n                <option value=\"atrasada\">üö® Atrasadas</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üèçÔ∏è Motoboy</div>\n            <select class=\"filter-select\" id=\"filterMotoboy\" onchange=\"aplicarFiltros()\">\n                <option value=\"\">Todos</option>\n            </select>\n        </div>\n        <div class=\"filter-group\">\n            <div class=\"filter-label\">üßπ A√ß√µes</div>\n            <button class=\"filter-select\" onclick=\"limparFiltros()\" style=\"cursor: pointer; text-align: center; background: #ef4444; color: white; border: none; font-weight: 600;\">\n                üßπ Limpar Filtros\n            </button>\n        </div>\n    </div>\n    \n    <!-- View Controls -->\n    <div class=\"view-controls\">\n        <button class=\"btn-modo ativo\" id=\"btnCards\" onclick=\"alterarModo('cards')\">\n            üì± Cards\n        </button>\n        <button class=\"btn-modo\" id=\"btnLista\" onclick=\"alterarModo('lista')\">\n            üìã Lista\n        </button>\n    </div>\n    \n    <!-- Stats Gerais -->\n    <div class=\"stats-row\">\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"totalRotas\">0</div>\n            <div class=\"stat-label\">Total de Rotas Ativas</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasPendentes\">0</div>\n            <div class=\"stat-label\">‚è≥ Pendentes</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasEmRota\">0</div>\n            <div class=\"stat-label\">üöö Em Rota</div>\n        </div>\n        <div class=\"stat-card\">\n            <div class=\"stat-value\" id=\"rotasAtrasadas\">0</div>\n            <div class=\"stat-label\">üö® Atrasadas (>20min)</div>\n        </div>\n    </div>\n    \n    <!-- Stats por Filial -->\n    <div class=\"stats-filial\">\n        <div class=\"stats-filial-title\">üìä Estat√≠sticas por Filial</div>\n        <div class=\"filial-row\" id=\"statsFilial\">\n            <!-- Estat√≠sticas por filial ser√£o inseridas aqui -->\n        </div>\n    </div>\n    \n    <!-- Grid de Rotas -->\n    <div class=\"rotas-grid\" id=\"rotasGrid\">\n        <!-- Cards ser√£o inseridos aqui via JavaScript -->\n    </div>\n    \n    <!-- Lista de Rotas -->\n    <div class=\"rotas-lista\" id=\"rotasLista\" style=\"display: none;\">\n        <div class=\"lista-header\">\n            <div>Rota ID</div>\n            <div>Nome da Rota</div>\n            <div>Motoboy</div>\n            <div>Status</div>\n            <div>Pedidos</div>\n            <div>Filial</div>\n            <div>Cron√¥metro</div>\n            <div>Ver Rota</div>\n        </div>\n        <div id=\"rotasListaBody\">\n            <!-- Lista ser√° inserida aqui via JavaScript -->\n        </div>\n    </div>\n</div>\n\n<!-- Modal Maps -->\n<div id=\"modalMaps\" class=\"modal-maps\">\n    <div class=\"modal-maps-content\">\n        <div class=\"modal-maps-header\">\n            <div class=\"modal-maps-title\">üó∫Ô∏è Rota no Google Maps</div>\n            <button class=\"close\" onclick=\"fecharModalMaps()\">&times;</button>\n        </div>\n        <div id=\"mapsContainer\">\n            <!-- Conte√∫do ser√° inserido aqui -->\n        </div>\n    </div>\n</div>\n\n<!-- Modal de Logs -->\n<div id=\"modalLogs\" class=\"modal\">\n    <div class=\"modal-content\">\n        <div class=\"modal-header\">\n            <div class=\"modal-title\">üìã Logs de Debug do Sistema</div>\n            <button class=\"close\" onclick=\"fecharModalLogs()\">&times;</button>\n        </div>\n        <div id=\"logsContainer\">\n            <!-- Logs ser√£o inseridos aqui -->\n        </div>\n    </div>\n</div>\n\n<script>\n// Configura√ß√µes\nlet somAtivo = true;\nlet tempoAtualizacao = 1000; // Atualizar cron√¥metros a cada 1 segundo\nlet tempoRecarregar = 30000; // Recarregar dados a cada 30 segundos\nlet rotasData = [];\nlet rotasFiltradas = [];\nlet modoAtual = 'cards'; // 'cards' ou 'lista'\n\n// Sistema simplificado - filtros internos HTML\n\n// Sistema de Logs\nlet systemLogs = [];\nconst originalConsoleLog = console.log;\nconst originalConsoleError = console.error;\nconst originalConsoleWarn = console.warn;\n\n// Fun√ß√£o para adicionar log ao sistema\nfunction addLog(message, type = 'info') {\n    const timestamp = new Date().toLocaleTimeString('pt-BR');\n    const logEntry = {\n        timestamp,\n        message: typeof message === 'object' ? JSON.stringify(message, null, 2) : String(message),\n        type\n    };\n    systemLogs.push(logEntry);\n    \n    // Manter apenas os √∫ltimos 100 logs\n    if (systemLogs.length > 100) {\n        systemLogs.shift();\n    }\n}\n\n// Sobrescrever console.log para capturar logs\nconsole.log = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'info');\n    originalConsoleLog.apply(console, args);\n};\n\nconsole.error = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'error');\n    originalConsoleError.apply(console, args);\n};\n\nconsole.warn = function(...args) {\n    const message = args.map(arg => \n        typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n    ).join(' ');\n    addLog(message, 'warning');\n    originalConsoleWarn.apply(console, args);\n};\n\n// Fun√ß√µes do Modal de Logs\nfunction abrirModalLogs() {\n    const modal = document.getElementById('modalLogs');\n    const container = document.getElementById('logsContainer');\n    \n    // Limpar container\n    container.innerHTML = '';\n    \n    // Adicionar logs\n    if (systemLogs.length === 0) {\n        container.innerHTML = '<div class=\"log-entry\">Nenhum log dispon√≠vel</div>';\n    } else {\n        systemLogs.forEach(log => {\n            const logDiv = document.createElement('div');\n            logDiv.className = 'log-entry ' + log.type;\n            logDiv.innerHTML = '[' + log.timestamp + '] ' + log.message;\n            container.appendChild(logDiv);\n        });\n    }\n    \n    // Scroll para o final\n    container.scrollTop = container.scrollHeight;\n    \n    // Mostrar modal\n    modal.style.display = 'block';\n}\n\nfunction fecharModalLogs() {\n    const modal = document.getElementById('modalLogs');\n    modal.style.display = 'none';\n}\n\n// Fechar modals clicando fora\nwindow.onclick = function(event) {\n    const modalLogs = document.getElementById('modalLogs');\n    const modalMaps = document.getElementById('modalMaps');\n    \n    if (event.target === modalLogs) {\n        modalLogs.style.display = 'none';\n    }\n    \n    if (event.target === modalMaps) {\n        modalMaps.style.display = 'none';\n    }\n}\n\n// Sistema de Sons Avan√ßado (Web Audio API)\nconst audioContext = new (window.AudioContext || window.webkitAudioContext)();\nlet intervalAtrasadas = null;\nlet intervalAguardando = null;\n\n// Som para rotas ATRASADAS (agudo, r√°pido, urgente)\nfunction playAlertAtrasadas() {\n    if (!somAtivo) return;\n    \n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.frequency.value = 1200; // Mais agudo = mais urgente\n    oscillator.type = 'square'; // Som mais √°spero para urg√™ncia\n    \n    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);\n    \n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.3);\n    \n    console.log('üö® Som de alerta para rotas atrasadas');\n}\n\n// Som para rotas AGUARDANDO (grave, lento, suave)\nfunction playAlertAguardando() {\n    if (!somAtivo) return;\n    \n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n    \n    oscillator.frequency.value = 400; // Mais grave = menos urgente\n    oscillator.type = 'sine'; // Som mais suave\n    \n    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);\n    \n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.8);\n    \n    console.log('‚è≥ Som de lembrete para rotas aguardando');\n}\n\n// Fun√ß√£o legacy (manter compatibilidade)\nfunction playAlertSound() {\n    playAlertAtrasadas();\n}\n\nfunction toggleSom() {\n    somAtivo = !somAtivo;\n    const btn = document.getElementById('btnSom');\n    if (somAtivo) {\n        btn.textContent = 'üîî Som: ON';\n        btn.classList.remove('muted');\n        // Reiniciar sistema de sons\n        configurarSistemaSons();\n    } else {\n        btn.textContent = 'üîá Som: OFF';\n        btn.classList.add('muted');\n        // Parar todos os sons\n        pararTodosSons();\n    }\n}\n\n// Configurar sistema de sons baseado no status das rotas\nfunction configurarSistemaSons() {\n    console.log('üîä Configurando sistema de sons...');\n    \n    // Parar intervalos antigos\n    pararTodosSons();\n    \n    if (!somAtivo) {\n        // Atualizar indicador para mostrar que est√° desabilitado\n        atualizarIndicadorSons({ atrasadas: 0, pendentes: 0, emRota: 0 });\n        return;\n    }\n    \n    // Verificar status atual das rotas\n    const statusRotas = analisarStatusRotas();\n    \n    console.log('üîç Status das rotas:', statusRotas);\n    \n    // Som para rotas ATRASADAS (1 em 1 segundo - URGENTE)\n    if (statusRotas.atrasadas > 0) {\n        console.log(`üö® Iniciando alertas para ${statusRotas.atrasadas} rotas atrasadas (a cada 1 segundo)`);\n        intervalAtrasadas = setInterval(() => {\n            playAlertAtrasadas();\n        }, 1000); // A cada 1 segundo\n    }\n    \n    // Som para rotas AGUARDANDO (a cada 5 segundos - LEMBRETE SUAVE)\n    if (statusRotas.pendentes > 0) {\n        console.log(`‚è≥ Iniciando lembretes para ${statusRotas.pendentes} rotas aguardando (a cada 5 segundos)`);\n        intervalAguardando = setInterval(() => {\n            playAlertAguardando();\n        }, 5000); // A cada 5 segundos\n    }\n    \n    console.log('‚úÖ Sistema de sons configurado');\n    \n    // Atualizar indicador visual\n    atualizarIndicadorSons(statusRotas);\n}\n\n// Parar todos os intervalos de som\nfunction pararTodosSons() {\n    if (intervalAtrasadas) {\n        clearInterval(intervalAtrasadas);\n        intervalAtrasadas = null;\n        console.log('üîá Parou sons de rotas atrasadas');\n    }\n    \n    if (intervalAguardando) {\n        clearInterval(intervalAguardando);\n        intervalAguardando = null;\n        console.log('üîá Parou sons de rotas aguardando');\n    }\n}\n\n// Analisar status atual das rotas (usar dados filtrados se existir)\nfunction analisarStatusRotas() {\n    let atrasadas = 0;\n    let pendentes = 0;\n    let emRota = 0;\n    \n    // Usar rotasFiltradas se houver filtros ativos, sen√£o rotasData\n    const rotasParaAnalisar = rotasFiltradas.length > 0 ? rotasFiltradas : rotasData;\n    \n    rotasParaAnalisar.forEach(rota => {\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        const isAtrasada = tempo.minutos >= 20 && isPendente;\n        \n        if (isAtrasada) {\n            atrasadas++;\n        } else if (isPendente) {\n            pendentes++;\n        } else {\n            emRota++;\n        }\n    });\n    \n    console.log(`üîç An√°lise de ${rotasParaAnalisar.length} rotas:`, { atrasadas, pendentes, emRota });\n    return { atrasadas, pendentes, emRota };\n}\n\n// Atualizar indicador visual de sons\nfunction atualizarIndicadorSons(statusRotas) {\n    const indicador = document.getElementById('indicadorSons');\n    if (!indicador) return;\n    \n    let status = [];\n    \n    if (!somAtivo) {\n        status.push('üîá Sons desabilitados');\n    } else {\n        if (statusRotas.atrasadas > 0) {\n            status.push(`üö® ${statusRotas.atrasadas} atrasada${statusRotas.atrasadas > 1 ? 's' : ''}`);\n            status.push(`üîî Alerta a cada 1s`);\n        }\n        if (statusRotas.pendentes > 0) {\n            status.push(`‚è≥ ${statusRotas.pendentes} aguardando`);\n            status.push(`üîî Lembrete a cada 5s`);\n        }\n        if (statusRotas.atrasadas === 0 && statusRotas.pendentes === 0) {\n            status.push('‚úÖ Todas em rota');\n            status.push('üîá Sem alertas');\n        }\n    }\n    \n    indicador.innerHTML = status.join('<br>');\n    \n    // Cor baseada na urg√™ncia\n    if (statusRotas.atrasadas > 0) {\n        indicador.style.color = '#ef4444'; // Vermelho para atrasadas\n    } else if (statusRotas.pendentes > 0) {\n        indicador.style.color = '#f59e0b'; // Amarelo para aguardando\n    } else {\n        indicador.style.color = '#10b981'; // Verde para ok\n    }\n}\n\n// Fun√ß√£o para calcular tempo decorrido\nfunction calcularTempoDecorrido(dataCriacao, dataAtualizacao, saidaNumero) {\n    const agora = new Date();\n    const criacao = new Date(dataCriacao);\n    \n    let tempoFim;\n    let isPendente = !saidaNumero || saidaNumero === null || saidaNumero === '';\n    \n    if (isPendente) {\n        // Saida_numero nulo = rota pendente, calcular desde cria√ß√£o at√© agora\n        tempoFim = agora;\n    } else {\n        // Saida_numero preenchido = motoboy atribu√≠do, calcular at√© updated_at (ajustando GMT-3)\n        tempoFim = new Date(dataAtualizacao);\n        // Ajustar para GMT-3: somar 3 horas para converter de GMT para Brasil\n        tempoFim.setHours(tempoFim.getHours() + 3);\n    }\n    \n    const diffMs = tempoFim - criacao;\n    const diffSegundos = Math.floor(diffMs / 1000);\n    \n    // Evitar tempos negativos\n    const segundosPositivos = Math.max(0, Math.abs(diffSegundos));\n    \n    const horas = Math.floor(segundosPositivos / 3600);\n    const minutos = Math.floor((segundosPositivos % 3600) / 60);\n    const segundos = segundosPositivos % 60;\n    \n    return {\n        total: diffMs,\n        horas,\n        minutos,\n        segundos,\n        isPendente,\n        formatted: String(horas).padStart(2, '0') + ':' + String(minutos).padStart(2, '0') + ':' + String(segundos).padStart(2, '0')\n    };\n}\n\n// Vari√°veis globais para dados\nlet globalRotasData = [];\nlet globalPedidosData = [];\n\n// Processar dados das rotas\nfunction processarRotas() {\n    console.log('üîç Iniciando processamento de rotas...');\n    \n    // Verificar se as vari√°veis globais existem\n    if (!globalRotasData) {\n        console.error('‚ùå globalRotasData n√£o existe!');\n        return;\n    }\n    if (!globalPedidosData) {\n        console.error('‚ùå globalPedidosData n√£o existe!');\n        return;\n    }\n    \n    const rotas = globalRotasData;\n    const pedidos = globalPedidosData;\n    \n    console.log('üìä Dados carregados:');\n    console.log('  - Rotas:', rotas.length, 'registros');\n    console.log('  - Pedidos:', pedidos.length, 'registros');\n    console.log('  - Tipo de rotas:', typeof rotas);\n    console.log('  - √â array?', Array.isArray(rotas));\n    \n    if (rotas.length > 0) {\n        console.log('üîç Exemplo de rota (primeira linha da query):', rotas[0]);\n        console.log('üîë Todos os campos dispon√≠veis:', Object.keys(rotas[0]));\n        console.log('üè¢ Campo filial:', rotas[0].filial);\n        console.log('üìç Campo rota_cliente:', rotas[0].rota_cliente);\n        console.log('üó∫Ô∏è Campo URL:', rotas[0].url);\n        \n        // Teste direto da URL da primeira rota\n        if (rotas[0].url) {\n            console.log('üß™ URL da primeira rota est√° dispon√≠vel - testando formato...');\n            console.log('   üîó URL completa:', rotas[0].url);\n            console.log('   ‚úÖ Cont√©m google.com/maps?', rotas[0].url.includes('google.com/maps'));\n            console.log('   üìè Tamanho:', rotas[0].url.length, 'caracteres');\n        } else {\n            console.log('‚ùå URL da primeira rota est√° VAZIA!');\n        }\n    }\n    \n    if (rotas.length === 0) {\n        console.error('‚ùå Nenhuma rota encontrada!');\n        rotasData = [];\n        renderizarRotas();\n        atualizarStats();\n        return;\n    }\n    \n    // L√ìGICA CORRETA DO SESSION_ID:\n    // - Cada session_id = 1 otimiza√ß√£o da rota (pode ter v√°rios pedidos)\n    // - Pedido novo chegou? ‚Üí Nova otimiza√ß√£o ‚Üí Novo session_id\n    // - Motoboy mudou? ‚Üí Nova otimiza√ß√£o ‚Üí Novo session_id  \n    // - SOLU√á√ÉO: Pegar apenas SESSION_ID MAIS RECENTE por filial\n    console.log('üîó Identificando session_ids mais recentes por filial...');\n    \n    // Primeiro: agrupar por session_id + motoboy (chave composta)\n    const rotasAgrupadas = {};\n    rotas.forEach((rota, index) => {\n        const sessionId = rota.session_id;\n        const motoboy = rota.descricao_motorista;\n        \n        if (!sessionId) {\n            console.warn(`‚ö†Ô∏è Rota ${index} sem session_id:`, rota);\n            return;\n        }\n        \n        // Chave composta: session_id + motoboy\n        const chaveRota = sessionId + '|' + (motoboy || 'SEM_MOTOBOY');\n        \n        if (!rotasAgrupadas[chaveRota]) {\n            rotasAgrupadas[chaveRota] = {\n                session_id: sessionId,\n                filial: rota.filial,\n                data_criacao_rota: rota.data_criacao_rota,\n                saida_numero: rota.saida_numero,\n                updated_at: rota.updated_at,\n                descricao_motorista: motoboy,\n                codigo_motorista: rota.codigo_motorista,\n                rota_cliente: rota.rota_cliente,\n                url: rota.url, // URL direta da query - sem processamento\n                pedidos: [],\n                pedidosUnicos: [],\n                pedidosOrdenados: []\n            };\n        }\n        \n        rotasAgrupadas[chaveRota].pedidos.push({\n            pedido_numero: rota.pedido_numero,\n            num_ordem: rota.num_ordem,\n            cod_cliente: rota.cod_cliente,\n            nome_cliente: rota.nome_cliente,\n            url_maps: rota.url\n        });\n        \n        // Atualizar informa√ß√µes mais recentes\n        if (rota.updated_at > rotasAgrupadas[chaveRota].updated_at) {\n            rotasAgrupadas[chaveRota].updated_at = rota.updated_at;\n            rotasAgrupadas[chaveRota].saida_numero = rota.saida_numero;\n        }\n        \n        // Garantir que temos a URL (usar sempre a √∫ltima encontrada)\n        if (rota.url) {\n            rotasAgrupadas[chaveRota].url = rota.url; // Sempre atualizar com a URL mais recente\n        }\n    });\n    \n    console.log('üîó Rotas agrupadas por session_id + motoboy:', Object.keys(rotasAgrupadas).length);\n    \n    // Segundo: encontrar a data de cria√ß√£o mais recente globalmente\n    const datasUnicas = [...new Set(Object.values(rotasAgrupadas).map(s => s.data_criacao_rota))].sort();\n    const dataMaisRecente = datasUnicas[datasUnicas.length - 1];\n    \n    console.log('üìÖ Datas de cria√ß√£o encontradas:', datasUnicas);\n    console.log('üìÖ Data mais recente:', dataMaisRecente);\n    \n    // Terceiro: pegar TODOS os sessions+motoboys da data mais recente (√∫ltima otimiza√ß√£o)\n    const rotasAtivas = Object.values(rotasAgrupadas).filter(rota => \n        rota.data_criacao_rota === dataMaisRecente\n    );\n    \n    console.log(`üéØ Filtrando rotas da data mais recente (${dataMaisRecente}):`);\n    rotasAtivas.forEach(rota => {\n        console.log(`   ‚úÖ Rota ${rota.session_id.substring(0,8)} + ${rota.descricao_motorista} (${rota.filial}) - ${rota.pedidos.length} pedidos`);\n    });\n    console.log('üìã Total de rotas encontradas:', Object.keys(rotasAgrupadas).length);\n    console.log('‚úÖ Rotas ativas (√∫ltima otimiza√ß√£o):', rotasAtivas.length);\n    \n    // Ordenar pedidos e remover duplicados por pedido_numero dentro de cada session_id\n    rotasAtivas.forEach(rota => {\n        console.log(`üîó Processando rota ativa ${rota.session_id.substring(0,8)} ‚Üí ${rota.descricao_motorista} (${rota.filial}):`);\n        console.log(`   üì¶ Total pedidos brutos: ${rota.pedidos.length}`);\n        console.log(`   üìç Nome: ${rota.rota_cliente || 'Sem nome'}`);\n        console.log(`   üèçÔ∏è Motoboy desta rota: ${rota.descricao_motorista}`);\n        \n        // Debug espec√≠fico da URL\n        console.log(`   üó∫Ô∏è URL original da query: ${rota.url || 'VAZIA'}`);\n        if (rota.url) {\n            const urlValida = rota.url.startsWith('https://www.google.com/maps');\n            console.log(`   ‚úÖ URL v√°lida? ${urlValida ? 'SIM' : 'N√ÉO'}`);\n            console.log(`   üîó URL completa: ${rota.url}`);\n            console.log(`   üìè Tamanho URL: ${rota.url.length} caracteres`);\n        } else {\n            console.log(`   ‚ùå Campo 'url' est√° vazio na query!`);\n        }\n        \n        // Remover duplicados por pedido_numero (manter o primeiro)\n        const pedidosMap = new Map();\n        rota.pedidos.forEach(pedido => {\n            if (!pedidosMap.has(pedido.pedido_numero)) {\n                pedidosMap.set(pedido.pedido_numero, pedido);\n            }\n        });\n        \n        rota.pedidosUnicos = Array.from(pedidosMap.values());\n        \n        // Ordenar pedidos √∫nicos por num_ordem\n        rota.pedidosOrdenados = [...rota.pedidosUnicos].sort((a, b) => a.num_ordem - b.num_ordem);\n        \n        console.log(`   ‚úÖ Pedidos √∫nicos: ${rota.pedidosUnicos.length}`);\n        console.log(`   üîÑ Duplicados removidos: ${rota.pedidos.length - rota.pedidosUnicos.length}`);\n        console.log(`   üìã Sequ√™ncia final: ${rota.pedidosOrdenados.map(p => `${p.num_ordem}¬∫-${p.pedido_numero}`).join(' ‚Üí ')}`);\n    });\n    \n    // Buscar informa√ß√µes adicionais dos pedidos na tabela pedidos_e_saidas_do_dia\n    rotasAtivas.forEach(rota => {\n        console.log(`üîç Enriquecendo dados da rota ${rota.session_id.substring(0,8)} do motoboy ${rota.descricao_motorista}:`);\n        \n        rota.pedidosOrdenados.forEach(pedido => {\n            const pedidoInfo = pedidos.find(p => p.PEDIDO === pedido.pedido_numero);\n            if (pedidoInfo) {\n                pedido.status = pedidoInfo.STATUS;\n                pedido.entrega_cliente = pedidoInfo.ENTREGA_CLIENTE;\n                // N√£o sobrescrever motoboy - j√° est√° correto no agrupamento\n            }\n        });\n        \n        // Motoboy j√° est√° correto (descricao_motorista do agrupamento)\n        rota.motoboy = rota.descricao_motorista || 'N/A';\n        \n        // Filial j√° est√° correta do session_id\n        if (!rota.filial || rota.filial === 'N/A') {\n            rota.filial = rota.rota_cliente || 'N/A';\n        }\n        \n        console.log(`   ‚úÖ Rota finalizada: ${rota.motoboy} com ${rota.pedidosUnicos.length} pedidos`);\n    });\n    \n    // Usar apenas as rotas mais recentes (1 por filial)\n    rotasData = rotasAtivas;\n    console.log('‚úÖ Rotas processadas:', rotasData.length);\n    \n    // Debug detalhado: rotas da √∫ltima otimiza√ß√£o (1 rota = 1 session_id + 1 motoboy)\n    console.log('üìä ROTAS ATIVAS (√öLTIMA OTIMIZA√á√ÉO - SESSION_ID + MOTOBOY):');\n    rotasData.forEach((rota, index) => {\n        console.log(`   ${index + 1}. Rota #${rota.session_id.substring(0,8)} ‚Üí ${rota.motoboy}:`);\n        console.log(`      üè¢ Filial: ${rota.filial}`);\n        console.log(`      üìÖ Cria√ß√£o: ${rota.data_criacao_rota}`);\n        console.log(`      üìç Nome: ${rota.rota_cliente}`);\n        console.log(`      üì¶ Pedidos √∫nicos: ${rota.pedidosUnicos.length} (brutos: ${rota.pedidos.length})`);\n        console.log(`      üèçÔ∏è Motoboy espec√≠fico: ${rota.motoboy}`);\n        console.log(`      üö¶ Sa√≠da: ${rota.saida_numero || 'Pendente'}`);\n        console.log(`      üó∫Ô∏è URL: ${rota.url ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o encontrada'}`);\n        if (rota.url) {\n            console.log(`      üîó Link Maps: ${rota.url.substring(0, 100)}...`);\n        }\n        console.log(`      üìã Sequ√™ncia: ${rota.pedidosOrdenados.map(p => `${p.num_ordem}¬∫-${p.pedido_numero}`).join(' ‚Üí ')}`);\n        console.log('      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n    });\n    \n    // Estat√≠sticas finais\n    const totalRotasProcessadas = Object.keys(rotasAgrupadas).length;\n    const totalPedidosUnicos = rotasData.reduce((total, r) => total + r.pedidosUnicos.length, 0);\n    const totalPedidosBrutos = rotasData.reduce((total, r) => total + r.pedidos.length, 0);\n    \n    const filiaisStats = {};\n    rotasData.forEach(r => {\n        const filial = r.filial || 'N/A';\n        filiaisStats[filial] = (filiaisStats[filial] || 0) + 1;\n    });\n    \n    const filiaisUnicas = Object.keys(filiaisStats).filter(f => f !== 'N/A');\n    \n    const rotasComURL = rotasData.filter(r => r.url).length;\n    \n    console.log('üéØ ESTAT√çSTICAS FINAIS:');\n    console.log('   üìä Total de combina√ß√µes processadas:', totalRotasProcessadas, '(session_id + motoboy)');\n    console.log('   üè¢ Filiais com rotas ativas:', filiaisUnicas.length);\n    console.log('   ‚úÖ Rotas da √∫ltima otimiza√ß√£o:', rotasData.length, '(apenas data mais recente)');\n    console.log('   üì¶ Total de pedidos √∫nicos:', totalPedidosUnicos);\n    console.log('   üì¶ Total de pedidos brutos:', totalPedidosBrutos);\n    console.log('   üîÑ Duplicados removidos:', totalPedidosBrutos - totalPedidosUnicos);\n    console.log('   üó∫Ô∏è Rotas com URL do Maps:', rotasComURL, 'de', rotasData.length);\n    console.log('   üè¢ Distribui√ß√£o por filial:', filiaisStats);\n    console.log('   üìä M√©dia de pedidos por rota:', (totalPedidosUnicos / rotasData.length).toFixed(1));\n    console.log('   üèçÔ∏è IMPORTANTE: Cada rota = 1 session_id + 1 motoboy espec√≠fico');\n    if (rotasData.length > 0) {\n        console.log('   üìÖ Data da otimiza√ß√£o atual:', rotasData[0].data_criacao_rota);\n        console.log('   üß™ Primeira rota tem URL?', !!rotasData[0].url);\n        if (rotasData[0].url) {\n            console.log('   üîó URL exemplo:', rotasData[0].url.substring(0, 80) + '...');\n        }\n    }\n    \n    const filiaisEncontradas = Object.keys(filiaisStats).filter(f => f !== 'N/A');\n    console.log('üè¢ Filiais dispon√≠veis para filtro:', filiaisEncontradas);\n    \n    // Popular filtros e aplicar inicial\n    popularFiltros();\n    aplicarFiltros();\n    \n    // Inicializar estat√≠sticas por filial\n    console.log('üè¢ Inicializando estat√≠sticas por filial...');\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons inicial\n    console.log('üîä Configurando sistema de sons inicial...');\n    configurarSistemaSons();\n    \n    console.log('üîç === PROCESSAR ROTAS FINALIZADO ===');\n}\n\n// Renderizar cards das rotas\nfunction renderizarRotas() {\n    console.log('üé¥ === RENDERIZAR ROTAS INICIADO ===');\n    console.log('üìä rotasFiltradas.length:', rotasFiltradas.length);\n    console.log('üéØ rotasFiltradas dados:', rotasFiltradas);\n    \n    const grid = document.getElementById('rotasGrid');\n    console.log('üé≠ Elemento rotasGrid encontrado:', !!grid);\n    \n    if (!grid) {\n        console.error('‚ùå Elemento rotasGrid n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        console.log('üì≠ Nenhuma rota para exibir');\n        grid.innerHTML = `\n            <div class=\"sem-rotas\">\n                <div class=\"sem-rotas-icon\">üì≠</div>\n                <div class=\"sem-rotas-text\">Nenhuma rota encontrada com os filtros selecionados</div>\n            </div>\n        `;\n        console.log('üì≠ HTML de \"sem rotas\" inserido');\n        return;\n    }\n    \n    console.log('üé® Gerando HTML para', rotasFiltradas.length, 'rotas...');\n    \n    grid.innerHTML = rotasFiltradas.map((rota, index) => {\n        const tempo = calcularTempoDecorrido(\n            rota.data_criacao_rota, \n            rota.updated_at, \n            rota.saida_numero\n        );\n        \n        const isPendente = tempo.isPendente;\n        const isAtrasada = tempo.minutos >= 20 && isPendente;\n        \n        let statusClass = isPendente ? 'pendente' : 'em-rota';\n        let statusText = isPendente ? '‚è≥ Aguardando Sa√≠da' : 'üöö Em Rota';\n        \n        if (isAtrasada) {\n            statusClass = 'atrasada';\n            statusText = 'üö® Atrasada';\n        }\n        \n        // Verificar se pedidos est√£o na ordem correta\n        const pedidosForaOrdem = rota.pedidosOrdenados.filter((p, idx) => {\n            if (idx === 0) return false;\n            return p.num_ordem < rota.pedidosOrdenados[idx - 1].num_ordem;\n        });\n        \n        // Alerta se h√° problemas na ordem dos pedidos OU se houve duplicados\n        const temAlerta = pedidosForaOrdem.length > 0 || rota.pedidos.length !== rota.pedidosUnicos.length;\n        \n        // Encurtar session_id para exibi√ß√£o (primeiros 8 caracteres)\n        const sessionIdCurto = rota.session_id.substring(0, 8);\n        \n        // Debug do bot√£o URL na renderiza√ß√£o\n        console.log(`üó∫Ô∏è Renderizando rota ${sessionIdCurto}: URL = ${rota.url || 'VAZIA'}`);\n        if (rota.url) {\n            console.log(`üîó URL completa: ${rota.url}`);\n        }\n        \n        return `\n            <div class=\"rota-card ${statusClass}\" data-index=\"${index}\">\n                <div class=\"rota-header\">\n                    <div class=\"rota-id\">\n                        <span class=\"filial-badge\">\n                            ${rota.filial}\n                        </span>\n                        Rota #${sessionIdCurto}\n                    </div>\n                    <div class=\"rota-status ${statusClass}\">${statusText}</div>\n                </div>\n                \n                <div style=\"margin-bottom: 16px;\">\n                    <div style=\"font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 8px;\">\n                        üìç ${rota.rota_cliente || 'Rota sem nome'}\n                    </div>\n                    ${rota.url ? \n                        `<div style=\"display: flex; gap: 8px;\">\n                            <button class=\"btn-ver-rota\" \n                                    onclick=\"copiarURL('${rota.url}', '${sessionIdCurto}');\" \n                                    title=\"Copiar URL para √°rea de transfer√™ncia\">\n                                üìã Copiar URL\n                            </button>\n                            <button class=\"btn-ver-rota\" \n                                    onclick=\"abrirModalMaps('${rota.url}', '${sessionIdCurto}', '${rota.rota_cliente}');\" \n                                    style=\"background: #8b5cf6;\" \n                                    title=\"Ver rota em modal interno\">\n                                üó∫Ô∏è Ver Mapa\n                            </button>\n                        </div>` \n                        : \n                        `<div style=\"padding: 6px 12px; background: #d1d5db; color: #6b7280; border-radius: 6px; font-size: 11px;\">\n                            üó∫Ô∏è URL n√£o dispon√≠vel\n                        </div>`\n                    }\n                </div>\n                \n                <div class=\"cronometro\">\n                    <div class=\"cronometro-tempo\" data-rota-id=\"${rota.session_id}\">\n                        ${tempo.formatted}\n                    </div>\n                    <div class=\"cronometro-label\">\n                        ${isPendente ? 'Tempo desde cria√ß√£o' : 'Tempo at√© sa√≠da'}\n                    </div>\n                </div>\n                \n                <div class=\"rota-info\">\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üèçÔ∏è Motoboy</div>\n                        <div class=\"info-value\">${rota.motoboy}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üì¶ Pedidos</div>\n                        <div class=\"info-value\">\n                            ${rota.pedidosUnicos.length}\n                            ${rota.pedidos.length !== rota.pedidosUnicos.length ? `<div style=\"font-size: 9px; color: #f59e0b;\">(${rota.pedidos.length - rota.pedidosUnicos.length} duplicados removidos)</div>` : ''}\n                        </div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üïê Cria√ß√£o</div>\n                        <div class=\"info-value\">${new Date(rota.data_criacao_rota).toLocaleTimeString('pt-BR')}</div>\n                    </div>\n                    <div class=\"info-item\">\n                        <div class=\"info-label\">üö¶ Sa√≠da</div>\n                        <div class=\"info-value\">${rota.saida_numero || 'Pendente'}</div>\n                    </div>\n                </div>\n                \n                <div class=\"pedidos-list\">\n                    <div class=\"pedidos-header\">Pedidos na Rota:</div>\n                    ${rota.pedidosOrdenados.map((p, idx) => `\n                        <div class=\"pedido-item\">\n                            <span>${idx + 1}¬∫ - <span class=\"pedido-numero\">Pedido ${p.pedido_numero}</span></span>\n                            <span class=\"pedido-status ok\">${p.nome_cliente || 'Cliente'}</span>\n                        </div>\n                    `).join('')}\n                </div>\n                \n                ${temAlerta ? `\n                    <div class=\"alerta-pedidos\">\n                        ${pedidosForaOrdem.length > 0 ? '‚ö†Ô∏è Pedidos fora da ordem prevista!' : ''} \n                        ${rota.pedidos.length !== rota.pedidosUnicos.length ? `üîÑ ${rota.pedidos.length - rota.pedidosUnicos.length} pedidos duplicados removidos` : ''}\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Rotas renderizadas com sucesso!');\n    console.log('üéØ HTML inserido no grid');\n    \n    // Atualizar estat√≠sticas por filial\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons baseado no status atual\n    configurarSistemaSons();\n    \n    console.log('üé¥ === RENDERIZAR ROTAS FINALIZADO ===');\n}\n\n// *** SISTEMA SIMPLIFICADO - APENAS FILTROS INTERNOS ***\n\n// Popular filtros internos\nfunction popularFiltros() {\n    console.log('üìã Populando filtros internos...');\n    \n    // Popular filtro de filial\n    const filiais = [...new Set(rotasData.map(r => r.filial))].filter(f => f && f !== 'N/A').sort();\n    const selectFilial = document.getElementById('filterFilial');\n    selectFilial.innerHTML = '<option value=\"\">Todas</option>';\n    filiais.forEach(filial => {\n        selectFilial.innerHTML += '<option value=\"' + filial + '\">' + filial + '</option>';\n    });\n    \n    // Popular filtro de motoboy\n    const motoboys = [...new Set(rotasData.map(r => r.motoboy))].filter(m => m && m !== 'N/A').sort();\n    const selectMotoboy = document.getElementById('filterMotoboy');\n    selectMotoboy.innerHTML = '<option value=\"\">Todos</option>';\n    motoboys.forEach(motoboy => {\n        selectMotoboy.innerHTML += '<option value=\"' + motoboy + '\">' + motoboy + '</option>';\n    });\n    \n    console.log('üìã Filtros populados:', { filiais: filiais.length, motoboys: motoboys.length });\n}\n\n// Aplicar filtros internos (sem localStorage - com valida√ß√£o completa)\nfunction aplicarFiltros() {\n    console.log('üîçüîçüîç === APLICAR FILTROS INTERNOS === üîçüîçüîç');\n    \n    const filterFilial = document.getElementById('filterFilial').value;\n    const filterStatus = document.getElementById('filterStatus').value;\n    const filterMotoboy = document.getElementById('filterMotoboy').value;\n    \n    // === ANTES DO FILTRO ===\n    console.log('üìä ANTES DO FILTRO:');\n    console.log(`   Total: ${rotasData.length} rotas`);\n    \n    // Contar quantidades por categoria\n    const filiaisDisponiveis = {};\n    const motoboyDisponiveis = {};\n    const statusCount = { pendentes: 0, emRota: 0, atrasadas: 0 };\n    \n    rotasData.forEach(rota => {\n        // Contar filiais\n        filiaisDisponiveis[rota.filial] = (filiaisDisponiveis[rota.filial] || 0) + 1;\n        \n        // Contar motoboys\n        motoboyDisponiveis[rota.motoboy] = (motoboyDisponiveis[rota.motoboy] || 0) + 1;\n        \n        // Contar status\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        const isAtrasada = tempo.minutos >= 20 && isPendente;\n        \n        if (isPendente) {\n            statusCount.pendentes++;\n            if (isAtrasada) statusCount.atrasadas++;\n        } else {\n            statusCount.emRota++;\n        }\n    });\n    \n    console.log('üìä Quantidade por filial:', filiaisDisponiveis);\n    console.log('üìä Quantidade por status:', statusCount);\n    console.log('üéØ FILTROS SELECIONADOS:', { filterFilial, filterStatus, filterMotoboy });\n    \n    // === APLICAR FILTROS ===\n    console.log('üîÑ Aplicando filtros...');\n    const rotasAntes = rotasData.length;\n    \n    rotasFiltradas = rotasData.filter(rota => {\n        // Filtro por filial\n        if (filterFilial && rota.filial !== filterFilial) return false;\n        \n        // Filtro por motoboy\n        if (filterMotoboy && rota.motoboy !== filterMotoboy) return false;\n        \n        // Filtro por status\n        if (filterStatus) {\n            const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n            const isPendente = tempo.isPendente;\n            const isAtrasada = tempo.minutos >= 20 && isPendente;\n            \n            if (filterStatus === 'pendente' && !isPendente) return false;\n            if (filterStatus === 'em-rota' && isPendente) return false;\n            if (filterStatus === 'atrasada' && !isAtrasada) return false;\n        }\n        \n        return true;\n    });\n    \n    // === DEPOIS DO FILTRO ===\n    console.log('üìà RESULTADO DO FILTRO:');\n    console.log(`   ‚úÖ ANTES: ${rotasAntes} rotas`);\n    console.log(`   ‚úÖ DEPOIS: ${rotasFiltradas.length} rotas`);\n    console.log(`   üéØ REDU√á√ÉO: ${rotasAntes - rotasFiltradas.length} rotas removidas`);\n    \n    if (rotasFiltradas.length > 0) {\n        const filiaisFiltradas = [...new Set(rotasFiltradas.map(r => r.filial))];\n        console.log(`   üè¢ Filiais no resultado:`, filiaisFiltradas);\n    }\n    \n    // Renderizar conforme modo atual\n    if (modoAtual === 'cards') {\n        renderizarRotas();\n    } else {\n        renderizarLista();\n    }\n    \n    atualizarStats();\n    atualizarStatsFilial();\n    \n    // Reconfigurar sons baseado nos dados filtrados\n    configurarSistemaSons();\n    \n    console.log('üîçüîçüîç === FILTROS APLICADOS COM SUCESSO === üîçüîçüîç');\n}\n\n// Alterar modo de visualiza√ß√£o\nfunction alterarModo(modo) {\n    modoAtual = modo;\n    \n    // Atualizar bot√µes\n    document.getElementById('btnCards').classList.toggle('ativo', modo === 'cards');\n    document.getElementById('btnLista').classList.toggle('ativo', modo === 'lista');\n    \n    // Mostrar/ocultar containers\n    document.getElementById('rotasGrid').style.display = modo === 'cards' ? 'grid' : 'none';\n    document.getElementById('rotasLista').style.display = modo === 'lista' ? 'block' : 'none';\n    \n    // Renderizar conforme modo\n    if (modo === 'cards') {\n        renderizarRotas();\n    } else {\n        renderizarLista();\n    }\n    \n    console.log('üëÄ Modo alterado para:', modo);\n}\n\n// Renderizar lista de rotas\nfunction renderizarLista() {\n    console.log('üìã Renderizando lista...', rotasFiltradas.length);\n    const listaBody = document.getElementById('rotasListaBody');\n    \n    if (!listaBody) {\n        console.error('‚ùå Elemento rotasListaBody n√£o encontrado!');\n        return;\n    }\n    \n    if (rotasFiltradas.length === 0) {\n        console.log('üì≠ Nenhuma rota para exibir na lista');\n        listaBody.innerHTML = `\n            <div style=\"padding: 40px; text-align: center; color: #6b7280; font-size: 14px;\">\n                üì≠ Nenhuma rota encontrada com os filtros selecionados\n            </div>\n        `;\n        return;\n    }\n    \n    listaBody.innerHTML = rotasFiltradas.map((rota, index) => {\n        const tempo = calcularTempoDecorrido(\n            rota.data_criacao_rota,\n            rota.updated_at,\n            rota.saida_numero\n        );\n        \n        const isPendente = tempo.isPendente;\n        const isAtrasada = tempo.minutos >= 20 && isPendente;\n        \n        let statusClass = isPendente ? 'pendente' : 'em-rota';\n        let statusText = isPendente ? '‚è≥ Pendente' : 'üöö Em Rota';\n        \n        if (isAtrasada) {\n            statusClass = 'atrasada';\n            statusText = 'üö® Atrasada';\n        }\n        \n        const sessionIdCurto = rota.session_id.substring(0, 8);\n        \n        return `\n            <div class=\"lista-item ${statusClass}\" data-index=\"${index}\">\n                <div style=\"font-weight: 700; color: #1890ff;\">\n                    <span class=\"filial-badge\">${rota.filial}</span>\n                    #${sessionIdCurto}\n                </div>\n                <div style=\"font-size: 10px; font-weight: 600; color: #374151;\">\n                    ${rota.rota_cliente || 'Sem nome'}\n                </div>\n                <div>${rota.motoboy}</div>\n                <div class=\"lista-status ${statusClass}\">${statusText}</div>\n                <div style=\"font-weight: 600; text-align: center;\">\n                    ${rota.pedidosUnicos.length}\n                    ${rota.pedidos.length !== rota.pedidosUnicos.length ? `<div style=\"color: #f59e0b; font-size: 8px;\">(${rota.pedidos.length - rota.pedidosUnicos.length} dup.)</div>` : ''}\n                </div>\n                <div style=\"text-align: center;\">${rota.filial}</div>\n                <div class=\"lista-cronometro\" data-rota-id=\"${rota.session_id}\" style=\"text-align: center;\">\n                    ${tempo.formatted}\n                </div>\n                <div style=\"text-align: center;\">\n                    ${rota.url ? \n                        `<button class=\"btn-ver-rota\" \n                                 style=\"padding: 4px 8px; font-size: 10px;\" \n                                 onclick=\"copiarURL('${rota.url}', '${rota.session_id.substring(0,8)}');\" \n                                 title=\"Copiar URL do Google Maps\">\n                            üìã URL\n                        </button>`\n                        :\n                        `<span style=\"font-size: 10px; color: #9ca3af;\">\n                            üö´ Sem URL\n                        </span>`\n                    }\n                </div>\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Lista renderizada com sucesso!');\n    \n    // Atualizar estat√≠sticas por filial\n    atualizarStatsFilial();\n    \n    // Configurar sistema de sons baseado no status atual\n    configurarSistemaSons();\n}\n\n// Atualizar estat√≠sticas\nfunction atualizarStats() {\n    console.log('üìà === ATUALIZAR STATS INICIADO ===');\n    console.log('üìä rotasData.length:', rotasData.length);\n    console.log('üì¶ Usando pedidos √∫nicos para estat√≠sticas');\n    \n    const total = rotasData.length;\n    const totalPedidos = rotasData.reduce((sum, r) => sum + (r.pedidosUnicos?.length || r.pedidos?.length || 0), 0);\n    \n    const pendentes = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return tempo.isPendente;\n    }).length;\n    const emRota = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return !tempo.isPendente;\n    }).length;\n    const atrasadas = rotasData.filter(r => {\n        const tempo = calcularTempoDecorrido(r.data_criacao_rota, r.updated_at, r.saida_numero);\n        return tempo.minutos >= 20 && tempo.isPendente;\n    }).length;\n    \n    console.log('üìä Estat√≠sticas calculadas:', { total, pendentes, emRota, atrasadas, totalPedidos });\n    \n    // Verificar se elementos existem\n    const elTotal = document.getElementById('totalRotas');\n    const elPendentes = document.getElementById('rotasPendentes');\n    const elEmRota = document.getElementById('rotasEmRota');\n    const elAtrasadas = document.getElementById('rotasAtrasadas');\n    \n    console.log('üé≠ Elementos encontrados:', {\n        totalRotas: !!elTotal,\n        rotasPendentes: !!elPendentes, \n        rotasEmRota: !!elEmRota,\n        rotasAtrasadas: !!elAtrasadas\n    });\n    \n    if (elTotal) elTotal.textContent = total;\n    if (elPendentes) elPendentes.textContent = pendentes;\n    if (elEmRota) elEmRota.textContent = emRota;\n    if (elAtrasadas) elAtrasadas.textContent = atrasadas;\n    \n    console.log('üìà === ATUALIZAR STATS FINALIZADO ===');\n}\n\n// Atualizar estat√≠sticas por filial\nfunction atualizarStatsFilial() {\n    console.log('üè¢ === ATUALIZANDO STATS POR FILIAL ===');\n    \n    const statsFilial = {};\n    \n    // Usar rotasFiltradas se existir, sen√£o rotasData (para mostrar stats dos dados filtrados)\n    const dadosParaStats = rotasFiltradas.length > 0 ? rotasFiltradas : rotasData;\n    console.log('üìä Usando dados:', dadosParaStats.length, 'rotas', rotasFiltradas.length > 0 ? '(filtradas)' : '(todas)');\n    \n    // Calcular stats para cada filial\n    dadosParaStats.forEach(rota => {\n        const filial = rota.filial;\n        if (!filial || filial === 'N/A') return;\n        \n        if (!statsFilial[filial]) {\n            statsFilial[filial] = {\n                total: 0,\n                emRota: 0,\n                pendentes: 0,\n                atrasadas: 0,\n                totalPedidos: 0,\n                rotas: []\n            };\n        }\n        \n        statsFilial[filial].total++;\n        statsFilial[filial].rotas.push(rota);\n        \n        // Contar pedidos √∫nicos desta rota\n        const pedidosRota = rota.pedidosUnicos ? rota.pedidosUnicos.length : (rota.pedidos ? rota.pedidos.length : 0);\n        statsFilial[filial].totalPedidos += pedidosRota;\n        \n        // Calcular status da rota\n        const tempo = calcularTempoDecorrido(rota.data_criacao_rota, rota.updated_at, rota.saida_numero);\n        const isPendente = tempo.isPendente;\n        const isAtrasada = tempo.minutos >= 20 && isPendente;\n        \n        if (isPendente) {\n            statsFilial[filial].pendentes++;\n            if (isAtrasada) {\n                statsFilial[filial].atrasadas++;\n            }\n        } else {\n            statsFilial[filial].emRota++;\n        }\n    });\n    \n    console.log('üìä Stats por filial calculadas:', statsFilial);\n    \n    // Renderizar stats por filial\n    const container = document.getElementById('statsFilial');\n    if (!container) {\n        console.error('‚ùå Container statsFilial n√£o encontrado!');\n        return;\n    }\n    \n    const filiaisOrdenadas = Object.keys(statsFilial).sort();\n    \n    container.innerHTML = filiaisOrdenadas.map(filial => {\n        const stats = statsFilial[filial];\n        \n        return `\n            <div class=\"filial-item\" onclick=\"filtrarPorFilial('${filial}')\" style=\"cursor: pointer;\" title=\"Clique para filtrar por ${filial}\" id=\"filialCard_${filial}\">\n                <div class=\"filial-nome\">${filial}</div>\n                <div class=\"filial-stats\">\n                    <div class=\"filial-stat ativo\">\n                        <div class=\"filial-stat-valor\">${stats.emRota}</div>\n                        <div class=\"filial-stat-label\">üöö Em Rota</div>\n                    </div>\n                    <div class=\"filial-stat pendente\">\n                        <div class=\"filial-stat-valor\">${stats.pendentes}</div>\n                        <div class=\"filial-stat-label\">‚è≥ Aguardando</div>\n                    </div>\n                    <div class=\"filial-stat atrasada\">\n                        <div class=\"filial-stat-valor\">${stats.atrasadas}</div>\n                        <div class=\"filial-stat-label\">üö® Atrasadas</div>\n                    </div>\n                </div>\n                <div style=\"text-align: center; margin-top: 8px; font-size: 11px; color: #6b7280;\">\n                    <div style=\"font-weight: 600;\">${stats.total} rotas</div>\n                    <div style=\"font-size: 10px;\">${stats.totalPedidos} pedidos</div>\n                </div>\n            </div>\n        `;\n    }).join('');\n    \n    console.log('‚úÖ Stats por filial renderizadas para', filiaisOrdenadas.length, 'filiais');\n}\n\n// Filtrar por filial (clique no card da filial)\nfunction filtrarPorFilial(filial) {\n    console.log(`üè¢ Clique no card da filial: ${filial} - aplicando filtro`);\n    \n    // Remover destaque de todos os cards de filial\n    document.querySelectorAll('.filial-item').forEach(card => {\n        card.style.border = '1px solid #e5e7eb';\n        card.style.boxShadow = 'none';\n    });\n    \n    // Destacar card selecionado\n    const cardSelecionado = document.getElementById(`filialCard_${filial}`);\n    if (cardSelecionado) {\n        cardSelecionado.style.border = '2px solid #1890ff';\n        cardSelecionado.style.boxShadow = '0 4px 12px rgba(24, 144, 255, 0.3)';\n    }\n    \n    // Atualizar select de filial\n    const selectFilial = document.getElementById('filterFilial');\n    if (selectFilial) {\n        selectFilial.value = filial;\n        aplicarFiltros();\n        \n        // Feedback visual\n        console.log(`‚úÖ Filtro de filial aplicado: ${filial}`);\n        \n        // Scroll para os cards/lista\n        const target = modoAtual === 'cards' ? document.getElementById('rotasGrid') : document.getElementById('rotasLista');\n        if (target) {\n            target.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }\n    } else {\n        console.error('‚ùå Select filterFilial n√£o encontrado!');\n    }\n}\n\n// Limpar todos os filtros\nfunction limparFiltros() {\n    console.log('üßπ Limpando todos os filtros...');\n    \n    // Remover destaque de todos os cards de filial\n    document.querySelectorAll('.filial-item').forEach(card => {\n        card.style.border = '1px solid #e5e7eb';\n        card.style.boxShadow = 'none';\n    });\n    \n    // Limpar selects\n    document.getElementById('filterFilial').value = '';\n    document.getElementById('filterStatus').value = '';\n    document.getElementById('filterMotoboy').value = '';\n    \n    aplicarFiltros();\n    \n    console.log('‚úÖ Filtros limpos - mostrando todas as rotas');\n}\n\n// Testar URLs das rotas (debug)\nfunction testarURLs() {\n    console.log('üß™ === TESTANDO URLs DAS ROTAS ===');\n    \n    if (!rotasData || rotasData.length === 0) {\n        console.log('‚ùå Nenhuma rota dispon√≠vel para testar');\n        return;\n    }\n    \n    rotasData.forEach((rota, index) => {\n        const sessionId = rota.session_id.substring(0,8);\n        console.log(`üß™ Testando Rota ${index + 1} (#${sessionId}):`);\n        console.log(`   üè¢ Filial: ${rota.filial}`);\n        console.log(`   üèçÔ∏è Motoboy: ${rota.descricao_motorista}`);\n        console.log(`   üó∫Ô∏è URL existe? ${rota.url ? 'SIM' : 'N√ÉO'}`);\n        \n        if (rota.url) {\n            console.log(`   üìè Tamanho: ${rota.url.length} chars`);\n            console.log(`   üîó URL: ${rota.url}`);\n            console.log(`   ‚úÖ Formato v√°lido? ${rota.url.includes('google.com/maps') ? 'SIM' : 'N√ÉO'}`);\n            \n            // Teste de abertura\n            try {\n                console.log(`   üß™ Testando abertura...`);\n                window.open(rota.url, '_blank');\n                console.log(`   ‚úÖ URL aberta com sucesso!`);\n            } catch (error) {\n                console.error(`   ‚ùå Erro ao abrir URL:`, error);\n            }\n        } else {\n            console.log(`   ‚ùå URL n√£o dispon√≠vel`);\n        }\n        \n        console.log('   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n    });\n    \n    const totalComURL = rotasData.filter(r => r.url).length;\n    console.log(`üìä RESUMO: ${totalComURL}/${rotasData.length} rotas t√™m URL v√°lida`);\n    console.log('üß™ === TESTE DE URLs FINALIZADO ===');\n}\n\n// Copiar URL para √°rea de transfer√™ncia\nfunction copiarURL(url, rotaId) {\n    console.log(`üìã Copiando URL da rota #${rotaId}:`, url);\n    \n    try {\n        // Tentar usar a API moderna\n        if (navigator.clipboard) {\n            navigator.clipboard.writeText(url).then(() => {\n                console.log('‚úÖ URL copiada com sucesso para √°rea de transfer√™ncia');\n                mostrarMensagem(`‚úÖ URL da rota #${rotaId} copiada!`, 'success');\n            }).catch(err => {\n                console.error('‚ùå Erro ao copiar com navigator.clipboard:', err);\n                copiarURLFallback(url, rotaId);\n            });\n        } else {\n            // Fallback para browsers antigos\n            copiarURLFallback(url, rotaId);\n        }\n    } catch (error) {\n        console.error('‚ùå Erro ao copiar URL:', error);\n        copiarURLFallback(url, rotaId);\n    }\n}\n\n// Fallback para copiar URL\nfunction copiarURLFallback(url, rotaId) {\n    try {\n        // Criar elemento tempor√°rio\n        const textarea = document.createElement('textarea');\n        textarea.value = url;\n        textarea.style.position = 'fixed';\n        textarea.style.opacity = '0';\n        document.body.appendChild(textarea);\n        textarea.select();\n        \n        const sucesso = document.execCommand('copy');\n        document.body.removeChild(textarea);\n        \n        if (sucesso) {\n            console.log('‚úÖ URL copiada usando fallback');\n            mostrarMensagem(`‚úÖ URL da rota #${rotaId} copiada!`, 'success');\n        } else {\n            console.log('‚ùå Falha no fallback - mostrando URL para c√≥pia manual');\n            mostrarURLParaCopia(url, rotaId);\n        }\n    } catch (error) {\n        console.error('‚ùå Erro no fallback:', error);\n        mostrarURLParaCopia(url, rotaId);\n    }\n}\n\n// Mostrar URL para c√≥pia manual\nfunction mostrarURLParaCopia(url, rotaId) {\n    console.log('üìã Mostrando URL para c√≥pia manual');\n    alert(`Rota #${rotaId}:\\n\\nCopie a URL abaixo:\\n\\n${url}`);\n}\n\n// Abrir modal com informa√ß√µes da rota\nfunction abrirModalMaps(url, rotaId, nomeRota) {\n    console.log(`üó∫Ô∏è Abrindo modal para rota #${rotaId}`);\n    \n    const modal = document.getElementById('modalMaps');\n    const container = document.getElementById('mapsContainer');\n    \n    container.innerHTML = `\n        <div style=\"margin-bottom: 20px;\">\n            <h3 style=\"color: #1890ff; margin-bottom: 8px;\">Rota #${rotaId}</h3>\n            <p style=\"color: #6b7280; margin-bottom: 16px;\">${nomeRota}</p>\n        </div>\n        \n        <div class=\"url-display\" onclick=\"selecionarTexto(this)\" title=\"Clique para selecionar toda a URL\">\n            ${url}\n        </div>\n        \n        <div style=\"display: flex; gap: 12px; justify-content: center;\">\n            <button onclick=\"copiarURL('${url}', '${rotaId}')\" \n                    style=\"padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üìã Copiar URL\n            </button>\n            \n            <button onclick=\"tentarAbrirMaps('${url}')\" \n                    style=\"padding: 12px 24px; background: #1890ff; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üåê Tentar Abrir\n            </button>\n            \n            <button onclick=\"baixarRota('${url}', '${rotaId}')\" \n                    style=\"padding: 12px 24px; background: #8b5cf6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;\">\n                üíæ Baixar Link\n            </button>\n        </div>\n        \n        <div style=\"margin-top: 20px; padding: 12px; background: #fef3c7; border-radius: 8px; font-size: 12px;\">\n            <strong>üí° Como usar:</strong><br>\n            ‚Ä¢ <strong>üìã Copiar URL</strong>: Copia para √°rea de transfer√™ncia<br>\n            ‚Ä¢ <strong>üåê Tentar Abrir</strong>: For√ßa abertura em nova aba<br>\n            ‚Ä¢ <strong>üíæ Baixar Link</strong>: Salva como arquivo para abrir depois<br>\n            ‚Ä¢ <strong>Clique na URL</strong>: Seleciona todo o texto para copiar manualmente\n        </div>\n    `;\n    \n    modal.style.display = 'block';\n}\n\n// Fechar modal maps\nfunction fecharModalMaps() {\n    document.getElementById('modalMaps').style.display = 'none';\n}\n\n// Selecionar texto no elemento\nfunction selecionarTexto(elemento) {\n    if (window.getSelection) {\n        const selection = window.getSelection();\n        const range = document.createRange();\n        range.selectNodeContents(elemento);\n        selection.removeAllRanges();\n        selection.addRange(range);\n        console.log('üìã Texto selecionado para c√≥pia manual');\n    }\n}\n\n// Tentar abrir Maps (for√ßar nova janela)\nfunction tentarAbrirMaps(url) {\n    console.log('üåê Tentando for√ßar abertura do Google Maps...');\n    \n    try {\n        // M√©todo 1: window.open com configura√ß√µes espec√≠ficas\n        const novaJanela = window.open(url, '_blank', 'noopener,noreferrer,width=1200,height=800');\n        \n        if (novaJanela) {\n            console.log('‚úÖ Nova janela aberta com sucesso');\n            mostrarMensagem('‚úÖ Maps aberto em nova janela!', 'success');\n        } else {\n            console.log('‚ùå Pop-up bloqueado - tentando m√©todo alternativo');\n            \n            // M√©todo 2: Criar link tempor√°rio e clicar\n            const link = document.createElement('a');\n            link.href = url;\n            link.target = '_blank';\n            link.rel = 'noopener noreferrer';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            \n            mostrarMensagem('üåê Tentativa de abertura realizada!', 'info');\n        }\n    } catch (error) {\n        console.error('‚ùå Erro ao abrir Maps:', error);\n        mostrarMensagem('‚ùå N√£o foi poss√≠vel abrir o Maps', 'error');\n    }\n}\n\n// Baixar link como arquivo\nfunction baixarRota(url, rotaId) {\n    console.log(`üíæ Criando arquivo de link para rota #${rotaId}`);\n    \n    try {\n        const conteudo = `[InternetShortcut]\nURL=${url}\nIconIndex=0`;\n        \n        const blob = new Blob([conteudo], { type: 'text/plain' });\n        const urlBlob = window.URL.createObjectURL(blob);\n        \n        const link = document.createElement('a');\n        link.href = urlBlob;\n        link.download = `Rota_${rotaId}_GoogleMaps.url`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        window.URL.revokeObjectURL(urlBlob);\n        \n        console.log('‚úÖ Arquivo de link criado com sucesso');\n        mostrarMensagem(`üíæ Arquivo Rota_${rotaId}_GoogleMaps.url baixado!`, 'success');\n    } catch (error) {\n        console.error('‚ùå Erro ao criar arquivo:', error);\n        mostrarMensagem('‚ùå Erro ao baixar arquivo', 'error');\n    }\n}\n\n// Mostrar mensagem tempor√°ria\nfunction mostrarMensagem(texto, tipo = 'info') {\n    const div = document.createElement('div');\n    div.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        z-index: 2000;\n        padding: 12px 20px;\n        border-radius: 8px;\n        font-weight: 600;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n        animation: slideIn 0.3s ease;\n    `;\n    \n    if (tipo === 'success') {\n        div.style.background = '#10b981';\n        div.style.color = 'white';\n    } else if (tipo === 'error') {\n        div.style.background = '#ef4444';\n        div.style.color = 'white';\n    } else {\n        div.style.background = '#1890ff';\n        div.style.color = 'white';\n    }\n    \n    div.textContent = texto;\n    document.body.appendChild(div);\n    \n    // Remover ap√≥s 3 segundos\n    setTimeout(() => {\n        div.style.animation = 'slideOut 0.3s ease';\n        setTimeout(() => {\n            document.body.removeChild(div);\n        }, 300);\n    }, 3000);\n}\n\n// Atualizar cron√¥metros (sem recarregar dados)\nfunction atualizarCronometros() {\n    let statusMudou = false;\n    \n    rotasData.forEach(rota => {\n        const elemento = document.querySelector(`[data-rota-id=\"${rota.session_id}\"]`);\n        if (elemento) {\n            const tempoAnterior = elemento.textContent;\n            const tempo = calcularTempoDecorrido(\n                rota.data_criacao_rota,\n                rota.updated_at,\n                rota.saida_numero\n            );\n            \n            elemento.textContent = tempo.formatted;\n            \n            // Verificar se uma rota ficou atrasada agora\n            const wasAtrasada = rota.wasAtrasada || false;\n            const isAtrasada = tempo.minutos >= 20 && tempo.isPendente;\n            \n            if (isAtrasada !== wasAtrasada) {\n                statusMudou = true;\n                rota.wasAtrasada = isAtrasada;\n            }\n        }\n    });\n    \n    // Reconfigurar sons a cada 30 segundos ou quando status muda\n    const agora = Date.now();\n    if (!atualizarCronometros.ultimaConfig || agora - atualizarCronometros.ultimaConfig > 30000 || statusMudou) {\n        atualizarCronometros.ultimaConfig = agora;\n        \n        // S√≥ reconfigurar se som estiver ativo e houver rotas\n        if (somAtivo && rotasData.length > 0) {\n            configurarSistemaSons();\n        }\n    }\n}\n\n// Atualizar dados manualmente (sem reload - Appsmith j√° atualiza a query)\nfunction atualizarManual() {\n    console.log('üîÑ Reprocessando dados (mantendo filtros)...');\n    processarRotas();\n}\n\n// Log inicial do sistema\nconsole.log('üöÄüöÄüöÄ SISTEMA DE LOGS INICIALIZADO - PAINEL MONITORAMENTO üöÄüöÄüöÄ');\nconsole.log('üìä Capturando todos os logs do sistema...');\nconsole.log('‚è∞ Timestamp:', new Date().toLocaleTimeString('pt-BR'));\nconsole.log('üåê URL atual:', window.location.href);\n\n// Inicializar dados (executar imediatamente)\nconsole.log('‚ö° Verificando queries antes da inje√ß√£o...');\nconsole.log('  - dmaplicativo_prod_rotas_otimiz:', typeof dmaplicativo_prod_rotas_otimiz);\nconsole.log('  - pedidos_e_saidas_do_dia:', typeof pedidos_e_saidas_do_dia);\n\n{{\n    (() => {\n        console.log('üîß Executando inje√ß√£o de dados...');\n        const rotas = (dmaplicativo_prod_rotas_otimiz && dmaplicativo_prod_rotas_otimiz.data) || [];\n        console.log('üìä Rotas encontradas na query:', rotas.length);\n        return `\n            console.log('üíâ Injetando globalRotasData com', ${rotas.length}, 'registros');\n            globalRotasData = ${JSON.stringify(rotas)};\n        `;\n    })()\n}}\n\n{{\n    (() => {\n        const pedidos = (pedidos_e_saidas_do_dia && pedidos_e_saidas_do_dia.data) || [];\n        console.log('üìã Pedidos encontrados na query:', pedidos.length);\n        return `\n            console.log('üíâ Injetando globalPedidosData com', ${pedidos.length}, 'registros');\n            globalPedidosData = ${JSON.stringify(pedidos)};\n        `;\n    })()\n}}\n\n// Inicializar quando a p√°gina carregar  \nsetTimeout(() => {\n    console.log('üöÄüöÄüöÄ === INICIANDO PAINEL DE MONITORAMENTO === üöÄüöÄüöÄ');\n    console.log('üìç setTimeout executado - sistema iniciando...');\n    \n    // Debug: verificar se dados existem\n    console.log('üîç Verificando dados globais:');\n    console.log('  - globalRotasData existe?', typeof globalRotasData);\n    console.log('  - globalRotasData length:', globalRotasData ? globalRotasData.length : 'undefined');\n    console.log('  - globalPedidosData existe?', typeof globalPedidosData);\n    console.log('  - globalPedidosData length:', globalPedidosData ? globalPedidosData.length : 'undefined');\n    \n    if (typeof globalRotasData === 'undefined') {\n        console.error('‚ùå globalRotasData est√° undefined!');\n        globalRotasData = [];\n    }\n    if (typeof globalPedidosData === 'undefined') {\n        console.error('‚ùå globalPedidosData est√° undefined!');\n        globalPedidosData = [];\n    }\n    \n    console.log('üì¶ Dados carregados:', {\n        rotas: globalRotasData.length,\n        pedidos: globalPedidosData.length\n    });\n    \n    // Processar rotas\n    console.log('üéØ CHAMANDO processarRotas()...');\n    console.log('üìä Antes de processar - rotasData.length:', rotasData.length);\n    \n    try {\n        processarRotas();\n        console.log('‚úÖ processarRotas() executado com sucesso');\n        console.log('üìä Ap√≥s processar - rotasData.length:', rotasData.length);\n        console.log('üìä Ap√≥s processar - rotasFiltradas.length:', rotasFiltradas.length);\n    } catch (error) {\n        console.error('‚ùå ERRO no processarRotas():', error);\n        console.error('‚ùå Stack trace:', error.stack);\n    }\n    \n    // Atualizar cron√¥metros a cada 1 segundo\n    setInterval(atualizarCronometros, tempoAtualizacao);\n    \n    // Sistema simplificado - filtros internos persistem automaticamente no Appsmith\n    console.log('üîÑ Sistema otimizado para Appsmith - sem auto-refresh');\n    \n    // No Appsmith a query j√° atualiza automaticamente - n√£o precisa de reload!\n    // setInterval com location.reload() REMOVIDO para n√£o resetar filtros\n    \n    console.log('‚úÖ Painel inicializado!');\n    console.log('   üìä ' + rotasData.length + ' rotas ativas (√∫ltima otimiza√ß√£o)');\n    console.log('   ‚è±Ô∏è Cron√¥metros atualizando a cada ' + (tempoAtualizacao/1000) + 's');\n    console.log('   üîÑ Query atualiza automaticamente no Appsmith');\n    console.log('   üéØ Filtros persistem sem refresh');\n    \n    // Status final dos sons\n    const statusFinal = analisarStatusRotas();\n    console.log('üîä Sistema de sons ativo:');\n    console.log('   üö® Rotas atrasadas (som a cada 1s):', statusFinal.atrasadas);\n    console.log('   ‚è≥ Rotas aguardando (som a cada 5s):', statusFinal.pendentes);\n    console.log('   üöö Rotas em rota (sem som):', statusFinal.emRota);\n}, 500); // Aumentado para 500ms para dar tempo da inje√ß√£o\n</script>\n\n{{''}}\n\n",
  "title": "",
  "topRow": 0,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "jy81x5guhz",
  "widgetName": "Iframe9"
}